{
    "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price,\n  ratio\nlimit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY78.TPL QUERY 10 IN STREAM 0 */ /* TPC-DS QUERY78.TPL 0.10 */ WITH WS AS ( SELECT D_YEAR AS WS_SOLD_YEAR , WS_ITEM_SK , WS_BILL_CUSTOMER_SK AS WS_CUSTOMER_SK , SUM ( WS_QUANTITY ) AS WS_QTY , SUM ( WS_WHOLESALE_COST ) AS WS_WC , SUM ( WS_SALES_PRICE ) AS WS_SP FROM WEB_SALES LEFT JOIN WEB_RETURNS ON WR_ORDER_NUMBER = WS_ORDER_NUMBER AND WS_ITEM_SK = WR_ITEM_SK JOIN DATE_DIM ON WS_SOLD_DATE_SK = D_DATE_SK WHERE WR_ORDER_NUMBER IS NULL GROUP BY D_YEAR , WS_ITEM_SK , WS_BILL_CUSTOMER_SK ) , CS AS ( SELECT D_YEAR AS CS_SOLD_YEAR , CS_ITEM_SK , CS_BILL_CUSTOMER_SK AS CS_CUSTOMER_SK , SUM ( CS_QUANTITY ) AS CS_QTY , SUM ( CS_WHOLESALE_COST ) AS CS_WC , SUM ( CS_SALES_PRICE ) AS CS_SP FROM CATALOG_SALES LEFT JOIN CATALOG_RETURNS ON CR_ORDER_NUMBER = CS_ORDER_NUMBER AND CS_ITEM_SK = CR_ITEM_SK JOIN DATE_DIM ON CS_SOLD_DATE_SK = D_DATE_SK WHERE CR_ORDER_NUMBER IS NULL GROUP BY D_YEAR , CS_ITEM_SK , CS_BILL_CUSTOMER_SK ) , SS AS ( SELECT D_YEAR AS SS_SOLD_YEAR , SS_ITEM_SK , SS_CUSTOMER_SK , SUM ( SS_QUANTITY ) AS SS_QTY , SUM ( SS_WHOLESALE_COST ) AS SS_WC , SUM ( SS_SALES_PRICE ) AS SS_SP FROM STORE_SALES LEFT JOIN STORE_RETURNS ON SR_TICKET_NUMBER = SS_TICKET_NUMBER AND SS_ITEM_SK = SR_ITEM_SK JOIN DATE_DIM ON SS_SOLD_DATE_SK = D_DATE_SK WHERE SR_TICKET_NUMBER IS NULL GROUP BY D_YEAR , SS_ITEM_SK , SS_CUSTOMER_SK ) SELECT SS_CUSTOMER_SK , ROUND ( SS_QTY / ( COALESCE ( WS_QTY , 0 ) + COALESCE ( CS_QTY , 0 ) ) , 2 ) AS RATIO , SS_QTY AS STORE_QTY , SS_WC AS STORE_WHOLESALE_COST , SS_SP AS STORE_SALES_PRICE , COALESCE ( WS_QTY , 0 ) + COALESCE ( CS_QTY , 0 ) AS OTHER_CHAN_QTY , COALESCE ( WS_WC , 0 ) + COALESCE ( CS_WC , 0 ) AS OTHER_CHAN_WHOLESALE_COST , COALESCE ( WS_SP , 0 ) + COALESCE ( CS_SP , 0 ) AS OTHER_CHAN_SALES_PRICE FROM SS LEFT JOIN WS ON ( WS_SOLD_YEAR = SS_SOLD_YEAR AND WS_ITEM_SK = SS_ITEM_SK AND WS_CUSTOMER_SK = SS_CUSTOMER_SK ) LEFT JOIN CS ON ( CS_SOLD_YEAR = SS_SOLD_YEAR AND CS_ITEM_SK = SS_ITEM_SK AND CS_CUSTOMER_SK = SS_CUSTOMER_SK ) WHERE ( COALESCE ( WS_QTY , 0 ) > 0 OR COALESCE ( CS_QTY , 0 ) > 0 ) AND SS_SOLD_YEAR = 2001 ORDER BY SS_CUSTOMER_SK NULLS FIRST , SS_QTY DESC NULLS LAST , SS_WC DESC NULLS LAST , SS_SP DESC NULLS LAST , OTHER_CHAN_QTY NULLS FIRST , OTHER_CHAN_WHOLESALE_COST NULLS FIRST , OTHER_CHAN_SALES_PRICE NULLS FIRST , RATIO NULLS FIRST LIMIT 21",
            "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 1.340717,
                "execution_time": 1.112169,
                "compile_time": 0.071643,
                "planning_time": 0.120517
            },
            "query_metrics_warm_up": {
                "elapsed_time": 7.923224,
                "execution_time": 1.261696,
                "compile_time": 6.40535,
                "planning_time": 0.215283
            }
        }
    ],
    "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/"
}