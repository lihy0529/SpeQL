{
    "input": "-- start template query4.tpl query 93 in stream 0\nwith /* TPC-DS query4.tpl 0.93 */ year_total as (\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum(((ss_ext_list_price-ss_ext_wholesale_cost-ss_ext_discount_amt)+ss_ext_sales_price)/2) year_total\n       ,'s' sale_type\n from customer\n     ,store_sales\n     ,date_dim\n where c_customer_sk = ss_customer_sk\n   and ss_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag\n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\n union all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum((((cs_ext_list_price-cs_ext_wholesale_cost-cs_ext_discount_amt)+cs_ext_sales_price)/2) ) year_total\n       ,'c' sale_type\n from customer\n     ,catalog_sales\n     ,date_dim\n where c_customer_sk = cs_bill_customer_sk\n   and cs_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag\n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\nunion all\n select c_customer_id customer_id\n       ,c_first_name customer_first_name\n       ,c_last_name customer_last_name\n       ,c_preferred_cust_flag customer_preferred_cust_flag\n       ,c_birth_country customer_birth_country\n       ,c_login customer_login\n       ,c_email_address customer_email_address\n       ,d_year dyear\n       ,sum((((ws_ext_list_price-ws_ext_wholesale_cost-ws_ext_discount_amt)+ws_ext_sales_price)/2) ) year_total\n       ,'w' sale_type\n from customer\n     ,web_sales\n     ,date_dim\n where c_customer_sk = ws_bill_customer_sk\n   and ws_sold_date_sk = d_date_sk\n group by c_customer_id\n         ,c_first_name\n         ,c_last_name\n         ,c_preferred_cust_flag\n         ,c_birth_country\n         ,c_login\n         ,c_email_address\n         ,d_year\n         )\n  select  \n                  t_s_secyear.customer_id\n                 ,t_s_secyear.customer_first_name\n                 ,t_s_secyear.customer_last_name\n                 ,t_s_secyear.customer_email_address\n from year_total t_s_firstyear\n     ,year_total t_s_secyear\n     ,year_total t_c_firstyear\n     ,year_total t_c_secyear\n     ,year_total t_w_firstyear\n     ,year_total t_w_secyear\n where t_s_secyear.customer_id = t_s_firstyear.customer_id\n   and t_s_firstyear.customer_id = t_c_secyear.customer_id\n   and t_s_firstyear.customer_id = t_c_firstyear.customer_id\n   and t_s_firstyear.customer_id = t_w_firstyear.customer_id\n   and t_s_firstyear.customer_id = t_w_secyear.customer_id\n   and t_s_firstyear.sale_type = 's'\n   and t_c_firstyear.sale_type = 'c'\n   and t_w_firstyear.sale_type = 'w'\n   and t_s_secyear.sale_type = 's'\n   and t_c_secyear.sale_type = 'c'\n   and t_w_secyear.sale_type = 'w'\n   and t_s_firstyear.dyear =  1998\n   and t_s_secyear.dyear = 1998+1\n   and t_c_firstyear.dyear =  1998\n   and t_c_secyear.dyear =  1998+1\n   and t_w_firstyear.dyear = 1998\n   and t_w_secyear.dyear = 1998+1\n   and t_s_firstyear.year_total > 0\n   and t_c_firstyear.year_total > 0\n   and t_w_firstyear.year_total > 0\n   and case when t_c_firstyear.year_total > 0 then t_c_secyear.year_total / t_c_firstyear.year_total else null end\n           > case when t_s_firstyear.year_total > 0 then t_s_secyear.year_total / t_s_firstyear.year_total else null end\n   and case when t_c_firstyear.year_total > 0 then t_c_secyear.year_total / t_c_firstyear.year_total else null end\n           > case when t_w_firstyear.year_total > 0 then t_w_secyear.year_total / t_w_firstyear.year_total else null end\n order by t_s_secyear.customer_id\n         ,t_s_secyear.customer_first_name\n         ,t_s_secyear.customer_last_name\n         ,t_s_secyear.customer_email_address\nlimit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY4.TPL QUERY 93 IN STREAM 0 */ /* TPC-DS QUERY4.TPL 0.93 */ WITH YEAR_TOTAL AS ( SELECT C_CUSTOMER_ID AS CUSTOMER_ID , C_FIRST_NAME AS CUSTOMER_FIRST_NAME , C_LAST_NAME AS CUSTOMER_LAST_NAME , C_PREFERRED_CUST_FLAG AS CUSTOMER_PREFERRED_CUST_FLAG , C_BIRTH_COUNTRY AS CUSTOMER_BIRTH_COUNTRY , C_LOGIN AS CUSTOMER_LOGIN , C_EMAIL_ADDRESS AS CUSTOMER_EMAIL_ADDRESS , D_YEAR AS DYEAR , SUM ( ( ( SS_EXT_LIST_PRICE - SS_EXT_WHOLESALE_COST - SS_EXT_DISCOUNT_AMT ) + SS_EXT_SALES_PRICE ) / 2 ) AS YEAR_TOTAL , 's' AS SALE_TYPE FROM CUSTOMER , STORE_SALES , DATE_DIM WHERE C_CUSTOMER_SK = SS_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK GROUP BY C_CUSTOMER_ID , C_FIRST_NAME , C_LAST_NAME , C_PREFERRED_CUST_FLAG , C_BIRTH_COUNTRY , C_LOGIN , C_EMAIL_ADDRESS , D_YEAR UNION ALL SELECT C_CUSTOMER_ID AS CUSTOMER_ID , C_FIRST_NAME AS CUSTOMER_FIRST_NAME , C_LAST_NAME AS CUSTOMER_LAST_NAME , C_PREFERRED_CUST_FLAG AS CUSTOMER_PREFERRED_CUST_FLAG , C_BIRTH_COUNTRY AS CUSTOMER_BIRTH_COUNTRY , C_LOGIN AS CUSTOMER_LOGIN , C_EMAIL_ADDRESS AS CUSTOMER_EMAIL_ADDRESS , D_YEAR AS DYEAR , SUM ( ( ( ( CS_EXT_LIST_PRICE - CS_EXT_WHOLESALE_COST - CS_EXT_DISCOUNT_AMT ) + CS_EXT_SALES_PRICE ) / 2 ) ) AS YEAR_TOTAL , 'c' AS SALE_TYPE FROM CUSTOMER , CATALOG_SALES , DATE_DIM WHERE C_CUSTOMER_SK = CS_BILL_CUSTOMER_SK AND CS_SOLD_DATE_SK = D_DATE_SK GROUP BY C_CUSTOMER_ID , C_FIRST_NAME , C_LAST_NAME , C_PREFERRED_CUST_FLAG , C_BIRTH_COUNTRY , C_LOGIN , C_EMAIL_ADDRESS , D_YEAR UNION ALL SELECT C_CUSTOMER_ID AS CUSTOMER_ID , C_FIRST_NAME AS CUSTOMER_FIRST_NAME , C_LAST_NAME AS CUSTOMER_LAST_NAME , C_PREFERRED_CUST_FLAG AS CUSTOMER_PREFERRED_CUST_FLAG , C_BIRTH_COUNTRY AS CUSTOMER_BIRTH_COUNTRY , C_LOGIN AS CUSTOMER_LOGIN , C_EMAIL_ADDRESS AS CUSTOMER_EMAIL_ADDRESS , D_YEAR AS DYEAR , SUM ( ( ( ( WS_EXT_LIST_PRICE - WS_EXT_WHOLESALE_COST - WS_EXT_DISCOUNT_AMT ) + WS_EXT_SALES_PRICE ) / 2 ) ) AS YEAR_TOTAL , 'w' AS SALE_TYPE FROM CUSTOMER , WEB_SALES , DATE_DIM WHERE C_CUSTOMER_SK = WS_BILL_CUSTOMER_SK AND WS_SOLD_DATE_SK = D_DATE_SK GROUP BY C_CUSTOMER_ID , C_FIRST_NAME , C_LAST_NAME , C_PREFERRED_CUST_FLAG , C_BIRTH_COUNTRY , C_LOGIN , C_EMAIL_ADDRESS , D_YEAR ) SELECT T_S_SECYEAR.CUSTOMER_ID , T_S_SECYEAR.CUSTOMER_FIRST_NAME , T_S_SECYEAR.CUSTOMER_LAST_NAME , T_S_SECYEAR.CUSTOMER_EMAIL_ADDRESS FROM YEAR_TOTAL AS T_S_FIRSTYEAR , YEAR_TOTAL AS T_S_SECYEAR , YEAR_TOTAL AS T_C_FIRSTYEAR , YEAR_TOTAL AS T_C_SECYEAR , YEAR_TOTAL AS T_W_FIRSTYEAR , YEAR_TOTAL AS T_W_SECYEAR WHERE T_S_SECYEAR.CUSTOMER_ID = T_S_FIRSTYEAR.CUSTOMER_ID AND T_S_FIRSTYEAR.CUSTOMER_ID = T_C_SECYEAR.CUSTOMER_ID AND T_S_FIRSTYEAR.CUSTOMER_ID = T_C_FIRSTYEAR.CUSTOMER_ID AND T_S_FIRSTYEAR.CUSTOMER_ID = T_W_FIRSTYEAR.CUSTOMER_ID AND T_S_FIRSTYEAR.CUSTOMER_ID = T_W_SECYEAR.CUSTOMER_ID AND T_S_FIRSTYEAR.SALE_TYPE = 's' AND T_C_FIRSTYEAR.SALE_TYPE = 'c' AND T_W_FIRSTYEAR.SALE_TYPE = 'w' AND T_S_SECYEAR.SALE_TYPE = 's' AND T_C_SECYEAR.SALE_TYPE = 'c' AND T_W_SECYEAR.SALE_TYPE = 'w' AND T_S_FIRSTYEAR.DYEAR = 1998 AND T_S_SECYEAR.DYEAR = 1998 + 1 AND T_C_FIRSTYEAR.DYEAR = 1998 AND T_C_SECYEAR.DYEAR = 1998 + 1 AND T_W_FIRSTYEAR.DYEAR = 1998 AND T_W_SECYEAR.DYEAR = 1998 + 1 AND T_S_FIRSTYEAR.YEAR_TOTAL > 0 AND T_C_FIRSTYEAR.YEAR_TOTAL > 0 AND T_W_FIRSTYEAR.YEAR_TOTAL > 0 AND CASE WHEN T_C_FIRSTYEAR.YEAR_TOTAL > 0 THEN T_C_SECYEAR.YEAR_TOTAL / T_C_FIRSTYEAR.YEAR_TOTAL ELSE NULL END > CASE WHEN T_S_FIRSTYEAR.YEAR_TOTAL > 0 THEN T_S_SECYEAR.YEAR_TOTAL / T_S_FIRSTYEAR.YEAR_TOTAL ELSE NULL END AND CASE WHEN T_C_FIRSTYEAR.YEAR_TOTAL > 0 THEN T_C_SECYEAR.YEAR_TOTAL / T_C_FIRSTYEAR.YEAR_TOTAL ELSE NULL END > CASE WHEN T_W_FIRSTYEAR.YEAR_TOTAL > 0 THEN T_W_SECYEAR.YEAR_TOTAL / T_W_FIRSTYEAR.YEAR_TOTAL ELSE NULL END ORDER BY T_S_SECYEAR.CUSTOMER_ID NULLS FIRST , T_S_SECYEAR.CUSTOMER_FIRST_NAME NULLS FIRST , T_S_SECYEAR.CUSTOMER_LAST_NAME NULLS FIRST , T_S_SECYEAR.CUSTOMER_EMAIL_ADDRESS NULLS FIRST LIMIT 21",
            "preview": "\n/*         customer_id customer_first_name customer_last_name                 customer_email_address\n0   AAAAAAAAAACNCAAA               Korey             Steele          Korey.Steele@g9belmoHo6K9.org\n1   AAAAAAAAAAEKGAAA                Paul              Green                      Paul.Green@ZZ.com\n2   AAAAAAAAABGIAAAA             Carolyn            Jimenez         Carolyn.Jimenez@MhOKMMmgt7.com\n3   AAAAAAAAABHMAAAA             Anthony           Thompson              Anthony.Thompson@GJRf.org\n4   AAAAAAAAABPJFAAA                Anne              Tyson          Anne.Tyson@3Bqo58h6qlpAhF.org\n5   AAAAAAAAACCPCAAA                 Rex           Martinez             Rex.Martinez@mH3R0CVcc.edu\n6   AAAAAAAAADFKEAAA                                         Carlos.Wright@xtAHtQqdmIXLQMUmCqe.com\n7   AAAAAAAAADFMAAAA              Evelyn             Gordon           Evelyn.Gordon@Az9hDU1frr.org\n8   AAAAAAAAADMEHAAA             Krystal            Dempsey                Krystal.Dempsey@xRN.edu\n9   AAAAAAAAAECMBAAA              Yvette               Ross                   Yvette.Ross@JnNH.edu\n10  AAAAAAAAAEMBBAAA               Patty             Butler                 Patty.Butler@tgkKR.edu\n11  AAAAAAAAAEODAAAA              Austin              Healy                 Austin.Healy@DoOKc.edu\n12  AAAAAAAAAEPDGAAA              Andrew              Boren         Andrew.Boren@BlIvf63YgsqNE.edu\n13  AAAAAAAAAFDHBAAA               Jerry              Price                  Jerry.Price@PlNrJ.com\n14  AAAAAAAAAFJMCAAA                John            Eastman     John.Eastman@n387t9ITxNgJZZVve.com\n15  AAAAAAAAAGCEHAAA              Gerald            Burgess  Gerald.Burgess@jNoYxH9L3sbJRJOfzM.org\n16  AAAAAAAAAGMHBAAA                                           Deshawn.Robertson@COEVQEP2RCZyK.edu\n17  AAAAAAAAAGNJFAAA                Sara               Leak           Sara.Leak@sSYrsmLsq7iYlb.edu\n18  AAAAAAAAAHJHCAAA             Beverly           Thompson          Beverly.Thompson@ELpfMS0j.edu\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 1.599667,
                "execution_time": 1.070958,
                "compile_time": 0.00308,
                "planning_time": 0.41755
            },
            "query_metrics_warm_up": {
                "elapsed_time": 1.84092,
                "execution_time": 1.214185,
                "compile_time": 0.003072,
                "planning_time": 0.514184
            }
        }
    ],
    "preview": "\n/*         customer_id customer_first_name customer_last_name                 customer_email_address\n0   AAAAAAAAAACNCAAA               Korey             Steele          Korey.Steele@g9belmoHo6K9.org\n1   AAAAAAAAAAEKGAAA                Paul              Green                      Paul.Green@ZZ.com\n2   AAAAAAAAABGIAAAA             Carolyn            Jimenez         Carolyn.Jimenez@MhOKMMmgt7.com\n3   AAAAAAAAABHMAAAA             Anthony           Thompson              Anthony.Thompson@GJRf.org\n4   AAAAAAAAABPJFAAA                Anne              Tyson          Anne.Tyson@3Bqo58h6qlpAhF.org\n5   AAAAAAAAACCPCAAA                 Rex           Martinez             Rex.Martinez@mH3R0CVcc.edu\n6   AAAAAAAAADFKEAAA                                         Carlos.Wright@xtAHtQqdmIXLQMUmCqe.com\n7   AAAAAAAAADFMAAAA              Evelyn             Gordon           Evelyn.Gordon@Az9hDU1frr.org\n8   AAAAAAAAADMEHAAA             Krystal            Dempsey                Krystal.Dempsey@xRN.edu\n9   AAAAAAAAAECMBAAA              Yvette               Ross                   Yvette.Ross@JnNH.edu\n10  AAAAAAAAAEMBBAAA               Patty             Butler                 Patty.Butler@tgkKR.edu\n11  AAAAAAAAAEODAAAA              Austin              Healy                 Austin.Healy@DoOKc.edu\n12  AAAAAAAAAEPDGAAA              Andrew              Boren         Andrew.Boren@BlIvf63YgsqNE.edu\n13  AAAAAAAAAFDHBAAA               Jerry              Price                  Jerry.Price@PlNrJ.com\n14  AAAAAAAAAFJMCAAA                John            Eastman     John.Eastman@n387t9ITxNgJZZVve.com\n15  AAAAAAAAAGCEHAAA              Gerald            Burgess  Gerald.Burgess@jNoYxH9L3sbJRJOfzM.org\n16  AAAAAAAAAGMHBAAA                                           Deshawn.Robertson@COEVQEP2RCZyK.edu\n17  AAAAAAAAAGNJFAAA                Sara               Leak           Sara.Leak@sSYrsmLsq7iYlb.edu\n18  AAAAAAAAAHJHCAAA             Beverly           Thompson          Beverly.Thompson@ELpfMS0j.edu\n...*/"
}