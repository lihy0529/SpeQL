{
    "input": "-- start template query86a.tpl query 11 in stream 0\nwith /* TPC-DS query86a.tpl 0.11 */ results as\n( select sum(ws_net_paid) as total_sum, i_category, i_class, 0 as g_category, 0 as g_class \n from\n    web_sales\n   ,date_dim       d1\n   ,item\n where\n    d1.d_month_seq between 1205 and 1205+11\n and d1.d_date_sk = ws_sold_date_sk\n and i_item_sk  = ws_item_sk\n group by i_category,i_class\n ) ,\n\n results_rollup as\n( select total_sum ,i_category ,i_class, g_category, g_class, 0 as lochierarchy from results\n  union\n  select sum(total_sum) as total_sum, i_category, NULL as i_class, 0 as g_category, 1 as g_class, 1 as lochierarchy from results group by i_category\n  union\n  select sum(total_sum) as total_sum, NULL as i_category, NULL as i_class, 1 as g_category, 1 as g_class, 2 as lochierarchy from results)\n select \n total_sum ,i_category ,i_class, lochierarchy \n   ,rank() over (\n \tpartition by lochierarchy,\n \tcase when g_class = 0 then i_category end \n \torder by total_sum desc) as rank_within_parent\n from\n results_rollup\n order by\n   lochierarchy desc,\n   case when lochierarchy = 0 then i_category end,\n   rank_within_parent \n limit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY86A.TPL QUERY 11 IN STREAM 0 */ /* TPC-DS QUERY86A.TPL 0.11 */ WITH RESULTS AS ( SELECT SUM ( WS_NET_PAID ) AS TOTAL_SUM , I_CATEGORY , I_CLASS , 0 AS G_CATEGORY , 0 AS G_CLASS FROM WEB_SALES , DATE_DIM AS D1 , ITEM WHERE D1.D_MONTH_SEQ BETWEEN 1205 AND 1205 + 11 AND D1.D_DATE_SK = WS_SOLD_DATE_SK AND I_ITEM_SK = WS_ITEM_SK GROUP BY I_CATEGORY , I_CLASS ) , RESULTS_ROLLUP AS ( SELECT TOTAL_SUM , I_CATEGORY , I_CLASS , G_CATEGORY , G_CLASS , 0 AS LOCHIERARCHY FROM RESULTS UNION SELECT SUM ( TOTAL_SUM ) AS TOTAL_SUM , I_CATEGORY , NULL AS I_CLASS , 0 AS G_CATEGORY , 1 AS G_CLASS , 1 AS LOCHIERARCHY FROM RESULTS GROUP BY I_CATEGORY UNION SELECT SUM ( TOTAL_SUM ) AS TOTAL_SUM , NULL AS I_CATEGORY , NULL AS I_CLASS , 1 AS G_CATEGORY , 1 AS G_CLASS , 2 AS LOCHIERARCHY FROM RESULTS ) SELECT TOTAL_SUM , I_CATEGORY , I_CLASS , LOCHIERARCHY , RANK ( ) OVER ( PARTITION BY LOCHIERARCHY , CASE WHEN G_CLASS = 0 THEN I_CATEGORY END ORDER BY TOTAL_SUM DESC NULLS LAST ) AS RANK_WITHIN_PARENT FROM RESULTS_ROLLUP ORDER BY LOCHIERARCHY DESC NULLS LAST , CASE WHEN LOCHIERARCHY = 0 THEN I_CATEGORY END NULLS FIRST , RANK_WITHIN_PARENT NULLS FIRST LIMIT 21",
            "preview": "\n/*       total_sum   i_category         i_class  lochierarchy  rank_within_parent\n0   3.289277e+09         None            None             2                   1\n1   3.343185e+08     Children            None             1                   1\n2   3.302986e+08         Home            None             1                   2\n3   3.299659e+08        Music            None             1                   3\n4   3.299202e+08        Women            None             1                   4\n5   3.297832e+08       Sports            None             1                   5\n6   3.293557e+08        Shoes            None             1                   6\n7   3.278090e+08          Men            None             1                   7\n8   3.275018e+08  Electronics            None             1                   8\n9   3.213138e+08        Books            None             1                   9\n10  3.211995e+08      Jewelry            None             1                  10\n11  7.810756e+06                         None             1                  11\n12  3.924596e+06                                          0                   1\n13  2.526895e+05                     swimwear             0                   2\n14  2.033678e+05                   fragrances             0                   3\n15  1.893191e+05                         mens             0                   4\n16  1.695366e+05                      dresses             0                   5\n17  1.679508e+05                     athletic             0                   6\n18  1.364807e+05                       womens             0                   7\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 0.218692,
                "execution_time": 0.098324,
                "compile_time": 0.000753,
                "planning_time": 0.089095
            },
            "query_metrics_warm_up": {
                "elapsed_time": 0.284705,
                "execution_time": 0.094084,
                "compile_time": 0.00074,
                "planning_time": 0.157785
            }
        }
    ],
    "preview": "\n/*       total_sum   i_category         i_class  lochierarchy  rank_within_parent\n0   3.289277e+09         None            None             2                   1\n1   3.343185e+08     Children            None             1                   1\n2   3.302986e+08         Home            None             1                   2\n3   3.299659e+08        Music            None             1                   3\n4   3.299202e+08        Women            None             1                   4\n5   3.297832e+08       Sports            None             1                   5\n6   3.293557e+08        Shoes            None             1                   6\n7   3.278090e+08          Men            None             1                   7\n8   3.275018e+08  Electronics            None             1                   8\n9   3.213138e+08        Books            None             1                   9\n10  3.211995e+08      Jewelry            None             1                  10\n11  7.810756e+06                         None             1                  11\n12  3.924596e+06                                          0                   1\n13  2.526895e+05                     swimwear             0                   2\n14  2.033678e+05                   fragrances             0                   3\n15  1.893191e+05                         mens             0                   4\n16  1.695366e+05                      dresses             0                   5\n17  1.679508e+05                     athletic             0                   6\n18  1.364807e+05                       womens             0                   7\n...*/"
}