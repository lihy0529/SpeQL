{
    "input": "-- start template query31.tpl query 50 in stream 0\nwith /* TPC-DS query31.tpl 0.50 */ ss as\n (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales\n from store_sales,date_dim,customer_address\n where ss_sold_date_sk = d_date_sk\n  and ss_addr_sk=ca_address_sk\n group by ca_county,d_qoy, d_year),\n ws as\n (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales\n from web_sales,date_dim,customer_address\n where ws_sold_date_sk = d_date_sk\n  and ws_bill_addr_sk=ca_address_sk\n group by ca_county,d_qoy, d_year)\n select \n        ss1.ca_county\n       ,ss1.d_year\n       ,ws2.web_sales/ws1.web_sales web_q1_q2_increase\n       ,ss2.store_sales/ss1.store_sales store_q1_q2_increase\n       ,ws3.web_sales/ws2.web_sales web_q2_q3_increase\n       ,ss3.store_sales/ss2.store_sales store_q2_q3_increase\n from\n        ss ss1\n       ,ss ss2\n       ,ss ss3\n       ,ws ws1\n       ,ws ws2\n       ,ws ws3\n where\n    ss1.d_qoy = 1\n    and ss1.d_year = 1998\n    and ss1.ca_county = ss2.ca_county\n    and ss2.d_qoy = 2\n    and ss2.d_year = 1998\n and ss2.ca_county = ss3.ca_county\n    and ss3.d_qoy = 3\n    and ss3.d_year = 1998\n    and ss1.ca_county = ws1.ca_county\n    and ws1.d_qoy = 1\n    and ws1.d_year = 1998\n    and ws1.ca_county = ws2.ca_county\n    and ws2.d_qoy = 2\n    and ws2.d_year = 1998\n    and ws1.ca_county = ws3.ca_county\n    and ws3.d_qoy = 3\n    and ws3.d_year =1998\n    and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end \n       > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end\n    and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end\n       > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end\n order by web_q1_q2_increase\nlimit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY31.TPL QUERY 50 IN STREAM 0 */ /* TPC-DS QUERY31.TPL 0.50 */ WITH SS AS ( SELECT CA_COUNTY , D_QOY , D_YEAR , SUM ( SS_EXT_SALES_PRICE ) AS STORE_SALES FROM STORE_SALES , DATE_DIM , CUSTOMER_ADDRESS WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ADDR_SK = CA_ADDRESS_SK GROUP BY CA_COUNTY , D_QOY , D_YEAR ) , WS AS ( SELECT CA_COUNTY , D_QOY , D_YEAR , SUM ( WS_EXT_SALES_PRICE ) AS WEB_SALES FROM WEB_SALES , DATE_DIM , CUSTOMER_ADDRESS WHERE WS_SOLD_DATE_SK = D_DATE_SK AND WS_BILL_ADDR_SK = CA_ADDRESS_SK GROUP BY CA_COUNTY , D_QOY , D_YEAR ) SELECT SS1.CA_COUNTY , SS1.D_YEAR , WS2.WEB_SALES / WS1.WEB_SALES AS WEB_Q1_Q2_INCREASE , SS2.STORE_SALES / SS1.STORE_SALES AS STORE_Q1_Q2_INCREASE , WS3.WEB_SALES / WS2.WEB_SALES AS WEB_Q2_Q3_INCREASE , SS3.STORE_SALES / SS2.STORE_SALES AS STORE_Q2_Q3_INCREASE FROM SS AS SS1 , SS AS SS2 , SS AS SS3 , WS AS WS1 , WS AS WS2 , WS AS WS3 WHERE SS1.D_QOY = 1 AND SS1.D_YEAR = 1998 AND SS1.CA_COUNTY = SS2.CA_COUNTY AND SS2.D_QOY = 2 AND SS2.D_YEAR = 1998 AND SS2.CA_COUNTY = SS3.CA_COUNTY AND SS3.D_QOY = 3 AND SS3.D_YEAR = 1998 AND SS1.CA_COUNTY = WS1.CA_COUNTY AND WS1.D_QOY = 1 AND WS1.D_YEAR = 1998 AND WS1.CA_COUNTY = WS2.CA_COUNTY AND WS2.D_QOY = 2 AND WS2.D_YEAR = 1998 AND WS1.CA_COUNTY = WS3.CA_COUNTY AND WS3.D_QOY = 3 AND WS3.D_YEAR = 1998 AND CASE WHEN WS1.WEB_SALES > 0 THEN WS2.WEB_SALES / WS1.WEB_SALES ELSE NULL END > CASE WHEN SS1.STORE_SALES > 0 THEN SS2.STORE_SALES / SS1.STORE_SALES ELSE NULL END AND CASE WHEN WS2.WEB_SALES > 0 THEN WS3.WEB_SALES / WS2.WEB_SALES ELSE NULL END > CASE WHEN SS2.STORE_SALES > 0 THEN SS3.STORE_SALES / SS2.STORE_SALES ELSE NULL END ORDER BY WEB_Q1_Q2_INCREASE NULLS FIRST LIMIT 21",
            "preview": "\n/*                 ca_county  d_year  web_q1_q2_increase  store_q1_q2_increase  web_q2_q3_increase  store_q2_q3_increase\n0          Siskiyou County    1998              0.4752                0.3809              6.1917                2.4127\n1             Wythe County    1998              0.5234                0.5229              2.7563                2.4487\n2        Otter Tail County    1998              0.5383                0.5332              5.5978                2.6971\n3   Dillingham Census Area    1998              0.5445                0.5116              5.5543                2.4110\n4          Faulkner County    1998              0.6256                0.6012              2.8769                2.1961\n5         Roscommon County    1998              0.6377                0.5012              2.8357                2.4854\n6         Del Norte County    1998              0.6532                0.4092              4.6935                4.6021\n7          Torrance County    1998              0.7244                0.5348              2.3226                1.3588\n8              Hyde County    1998              0.7275                0.6759              3.2179                2.7769\n9           Clarion County    1998              0.7536                0.5751              3.6085                2.4459\n10           Richmond city    1998              0.7649                0.6761              2.9395                1.6583\n11         Calloway County    1998              0.7786                0.7643              2.4491                1.3952\n12          Cameron County    1998              0.7807                0.6880              3.4391                2.2855\n13         Callaway County    1998              0.7848                0.6531              4.2713                1.8608\n14         Beltrami County    1998              0.7947                0.7578              4.4563                3.1516\n15         Flathead County    1998              0.7971                0.7383              4.2737                1.9220\n16           Moffat County    1998              0.8099                0.5684              3.1010                2.6861\n17       Shiawassee County    1998              0.8140                0.6276              3.1940                2.6082\n18            Boise County    1998              0.8147                0.7477              2.2096                1.9148\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 0.89516,
                "execution_time": 0.69982,
                "compile_time": 0.001453,
                "planning_time": 0.129724
            },
            "query_metrics_warm_up": {
                "elapsed_time": 4.348669,
                "execution_time": 0.729661,
                "compile_time": 3.351062,
                "planning_time": 0.203255
            }
        }
    ],
    "preview": "\n/*                 ca_county  d_year  web_q1_q2_increase  store_q1_q2_increase  web_q2_q3_increase  store_q2_q3_increase\n0          Siskiyou County    1998              0.4752                0.3809              6.1917                2.4127\n1             Wythe County    1998              0.5234                0.5229              2.7563                2.4487\n2        Otter Tail County    1998              0.5383                0.5332              5.5978                2.6971\n3   Dillingham Census Area    1998              0.5445                0.5116              5.5543                2.4110\n4          Faulkner County    1998              0.6256                0.6012              2.8769                2.1961\n5         Roscommon County    1998              0.6377                0.5012              2.8357                2.4854\n6         Del Norte County    1998              0.6532                0.4092              4.6935                4.6021\n7          Torrance County    1998              0.7244                0.5348              2.3226                1.3588\n8              Hyde County    1998              0.7275                0.6759              3.2179                2.7769\n9           Clarion County    1998              0.7536                0.5751              3.6085                2.4459\n10           Richmond city    1998              0.7649                0.6761              2.9395                1.6583\n11         Calloway County    1998              0.7786                0.7643              2.4491                1.3952\n12          Cameron County    1998              0.7807                0.6880              3.4391                2.2855\n13         Callaway County    1998              0.7848                0.6531              4.2713                1.8608\n14         Beltrami County    1998              0.7947                0.7578              4.4563                3.1516\n15         Flathead County    1998              0.7971                0.7383              4.2737                1.9220\n16           Moffat County    1998              0.8099                0.5684              3.1010                2.6861\n17       Shiawassee County    1998              0.8140                0.6276              3.1940                2.6082\n18            Boise County    1998              0.8147                0.7477              2.2096                1.9148\n...*/"
}