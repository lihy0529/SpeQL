{
    "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and\n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, psum\n limit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY57.TPL QUERY 70 IN STREAM 0 */ /* TPC-DS QUERY57.TPL 0.70 */ WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , PSUM NULLS FIRST LIMIT 21",
            "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0   Pacific Northwest_1    2001      2           25259.96   10434.50  16096.33  13484.44\n1              NY Metro    2001      2           25266.92   10556.63  14101.64  14596.04\n2         Hawaii/Alaska    2001      2           25123.31   10829.65  12625.99  15337.63\n3              NY Metro    2001      2           25118.78   10909.48  17620.17  12931.98\n4          California_1    2001      2           25277.88   11127.66  16528.07  13900.22\n5          Mid Atlantic    2001      2           25811.84   11846.32  12927.10  15369.77\n6       Hawaii/Alaska_1    2001      2           25168.96   11209.84  16383.61  14103.43\n7              NY Metro    2001      6           25295.40   11352.19  15895.04  16771.04\n8         North Midwest    2001      2           26101.42   12188.28  16005.68  14477.36\n9         North Midwest    2001      2           25637.94   11782.14  17576.24  16663.63\n10        North Midwest    2001      6           26468.08   12621.24  17134.39  17134.83\n11           NY Metro_1    2001      3           24565.31   10826.63  12508.26  14486.59\n12             NY Metro    2001      2           24754.52   11020.46  14399.95  13956.11\n13      North Midwest_1    2001      2           24753.03   11020.75  14442.65  13147.17\n14         Mid Atlantic    2001      2           25148.92   11474.23  13839.98  13575.60\n15           NY Metro_1    2001      2           26374.98   12724.62  14004.87  13867.23\n16      Hawaii/Alaska_1    2001      2           24980.73   11374.35  16186.64  13963.43\n17        North Midwest    2001      4           25286.96   11744.59  15754.92  17107.14\n18       Mid Atlantic_1    2001      2           24846.57   11321.21  15871.26  14731.95\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 0.86216,
                "execution_time": 0.498865,
                "compile_time": 0.001074,
                "planning_time": 0.570391
            },
            "query_metrics_warm_up": {
                "elapsed_time": 0.959177,
                "execution_time": 0.511937,
                "compile_time": 0.001124,
                "planning_time": 0.665609
            }
        }
    ],
    "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0   Pacific Northwest_1    2001      2           25259.96   10434.50  16096.33  13484.44\n1              NY Metro    2001      2           25266.92   10556.63  14101.64  14596.04\n2         Hawaii/Alaska    2001      2           25123.31   10829.65  12625.99  15337.63\n3              NY Metro    2001      2           25118.78   10909.48  17620.17  12931.98\n4          California_1    2001      2           25277.88   11127.66  16528.07  13900.22\n5          Mid Atlantic    2001      2           25811.84   11846.32  12927.10  15369.77\n6       Hawaii/Alaska_1    2001      2           25168.96   11209.84  16383.61  14103.43\n7              NY Metro    2001      6           25295.40   11352.19  15895.04  16771.04\n8         North Midwest    2001      2           26101.42   12188.28  16005.68  14477.36\n9         North Midwest    2001      2           25637.94   11782.14  17576.24  16663.63\n10        North Midwest    2001      6           26468.08   12621.24  17134.39  17134.83\n11           NY Metro_1    2001      3           24565.31   10826.63  12508.26  14486.59\n12             NY Metro    2001      2           24754.52   11020.46  14399.95  13956.11\n13      North Midwest_1    2001      2           24753.03   11020.75  14442.65  13147.17\n14         Mid Atlantic    2001      2           25148.92   11474.23  13839.98  13575.60\n15           NY Metro_1    2001      2           26374.98   12724.62  14004.87  13867.23\n16      Hawaii/Alaska_1    2001      2           24980.73   11374.35  16186.64  13963.43\n17        North Midwest    2001      4           25286.96   11744.59  15754.92  17107.14\n18       Mid Atlantic_1    2001      2           24846.57   11321.21  15871.26  14731.95\n...*/"
}