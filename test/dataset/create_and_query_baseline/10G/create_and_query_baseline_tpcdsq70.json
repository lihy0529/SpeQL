{
    "input": "-- start template query70a.tpl query 34 in stream 0\nwith /* TPC-DS query70a.tpl 0.34 */ results as\n( select\n    sum(ss_net_profit) as total_sum ,s_state ,s_county, 0 as gstate, 0 as g_county\n from\n    store_sales\n  ,date_dim      d1\n  ,store\n where\n    d1.d_month_seq between 1188 and 1188 + 11\n and d1.d_date_sk = ss_sold_date_sk\n and s_store_sk  = ss_store_sk\n and s_state in\n            ( select s_state\n              from  (select s_state as s_state,\n                 rank() over ( partition by s_state order by sum(ss_net_profit) desc) as ranking\n                      from  store_sales, store, date_dim\n                      where d_month_seq between 1188 and 1188 + 11\n                 and d_date_sk = ss_sold_date_sk\n                 and s_store_sk  = ss_store_sk\n                      group by s_state\n                    ) tmp1 \n              where ranking <= 5)\n  group by s_state,s_county) ,  \n results_rollup as \n(select total_sum ,s_state ,s_county, 0 as g_state, 0 as g_county, 0 as lochierarchy from results\n union\n select sum(total_sum) as total_sum,s_state, NULL as s_county, 0 as g_state, 1 as g_county, 1 as lochierarchy from results group by s_state\n union\n select sum(total_sum) as total_sum ,NULL as s_state ,NULL as s_county, 1 as g_state, 1 as g_county, 2 as lochierarchy from results)\n  select  total_sum ,s_state ,s_county, lochierarchy \n  ,rank() over (\n     partition by lochierarchy, \n     case when g_county = 0 then s_state end \n     order by total_sum desc) as rank_within_parent\n from results_rollup\n order by\n  lochierarchy desc\n  ,case when lochierarchy = 0 then s_state end\n  ,rank_within_parent\n limit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY70A.TPL QUERY 34 IN STREAM 0 */ /* TPC-DS QUERY70A.TPL 0.34 */ WITH RESULTS AS ( SELECT SUM ( SS_NET_PROFIT ) AS TOTAL_SUM , S_STATE , S_COUNTY , 0 AS GSTATE , 0 AS G_COUNTY FROM STORE_SALES , DATE_DIM AS D1 , STORE WHERE D1.D_MONTH_SEQ BETWEEN 1188 AND 1188 + 11 AND D1.D_DATE_SK = SS_SOLD_DATE_SK AND S_STORE_SK = SS_STORE_SK AND S_STATE IN ( SELECT S_STATE FROM ( SELECT S_STATE AS S_STATE , RANK ( ) OVER ( PARTITION BY S_STATE ORDER BY SUM ( SS_NET_PROFIT ) DESC NULLS LAST ) AS RANKING FROM STORE_SALES , STORE , DATE_DIM WHERE D_MONTH_SEQ BETWEEN 1188 AND 1188 + 11 AND D_DATE_SK = SS_SOLD_DATE_SK AND S_STORE_SK = SS_STORE_SK GROUP BY S_STATE ) AS TMP1 WHERE RANKING <= 5 ) GROUP BY S_STATE , S_COUNTY ) , RESULTS_ROLLUP AS ( SELECT TOTAL_SUM , S_STATE , S_COUNTY , 0 AS G_STATE , 0 AS G_COUNTY , 0 AS LOCHIERARCHY FROM RESULTS UNION SELECT SUM ( TOTAL_SUM ) AS TOTAL_SUM , S_STATE , NULL AS S_COUNTY , 0 AS G_STATE , 1 AS G_COUNTY , 1 AS LOCHIERARCHY FROM RESULTS GROUP BY S_STATE UNION SELECT SUM ( TOTAL_SUM ) AS TOTAL_SUM , NULL AS S_STATE , NULL AS S_COUNTY , 1 AS G_STATE , 1 AS G_COUNTY , 2 AS LOCHIERARCHY FROM RESULTS ) SELECT TOTAL_SUM , S_STATE , S_COUNTY , LOCHIERARCHY , RANK ( ) OVER ( PARTITION BY LOCHIERARCHY , CASE WHEN G_COUNTY = 0 THEN S_STATE END ORDER BY TOTAL_SUM DESC NULLS LAST ) AS RANK_WITHIN_PARENT FROM RESULTS_ROLLUP ORDER BY LOCHIERARCHY DESC NULLS LAST , CASE WHEN LOCHIERARCHY = 0 THEN S_STATE END NULLS FIRST , RANK_WITHIN_PARENT NULLS FIRST LIMIT 21",
            "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -4.403411e+09    None               None             2                   1\n1 -1.291712e+09      SD               None             1                   1\n2 -1.549025e+09      TN               None             1                   2\n3 -1.562675e+09      AL               None             1                   3\n4 -1.562675e+09      AL      Walker County             0                   1\n5 -1.291712e+09      SD     Ziebach County             0                   1\n6 -8.640159e+07      TN                                0                   1\n7 -1.462623e+09      TN  Williamson County             0                   2*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 0.448243,
                "execution_time": 0.231835,
                "compile_time": 0.001284,
                "planning_time": 0.253489
            },
            "query_metrics_warm_up": {
                "elapsed_time": 0.535378,
                "execution_time": 0.235405,
                "compile_time": 0.00129,
                "planning_time": 0.335008
            }
        }
    ],
    "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -4.403411e+09    None               None             2                   1\n1 -1.291712e+09      SD               None             1                   1\n2 -1.549025e+09      TN               None             1                   2\n3 -1.562675e+09      AL               None             1                   3\n4 -1.562675e+09      AL      Walker County             0                   1\n5 -1.291712e+09      SD     Ziebach County             0                   1\n6 -8.640159e+07      TN                                0                   1\n7 -1.462623e+09      TN  Williamson County             0                   2*/"
}