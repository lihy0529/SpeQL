{
    "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n )\n order by 1,4,5,2\n limit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY49.TPL QUERY 48 IN STREAM 0 */ /* TPC-DS QUERY49.TPL 0.48 */ SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) ORDER BY 1 NULLS FIRST , 4 NULLS FIRST , 5 NULLS FIRST , 2 NULLS FIRST LIMIT 21",
            "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog   72472        0E-16            1             66\n1   catalog   64867        0E-16            1            215\n2   catalog   75637        0E-16            1            284\n3   catalog   78628        0E-16            1            288\n4   catalog   28286     0.474747            5              1\n5   catalog   96284     0.515789            6              2\n6   catalog   28426      0.53125            7              3\n7   catalog   37682     0.538462            8              4\n8   catalog   43804     0.538462            8              4\n9   catalog   34826     0.546392           10              6\n10  catalog   27164     0.553191           12              7\n11  catalog   18626     0.555556           13              8\n12  catalog   73516     0.557895           14              9\n13  catalog   38071      0.56701           15             10\n14    store   57598     0.666667            1              1\n15    store   37879     0.670103            2              2\n16    store    3896     0.697674            3              3\n17    store   33284     0.705263            4              4\n18    store  101954     0.727273            5              5\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 0.264262,
                "execution_time": 0.092954,
                "compile_time": 0.001134,
                "planning_time": 0.124075
            },
            "query_metrics_warm_up": {
                "elapsed_time": 0.393883,
                "execution_time": 0.123705,
                "compile_time": 0.001139,
                "planning_time": 0.22131
            }
        }
    ],
    "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog   72472        0E-16            1             66\n1   catalog   64867        0E-16            1            215\n2   catalog   75637        0E-16            1            284\n3   catalog   78628        0E-16            1            288\n4   catalog   28286     0.474747            5              1\n5   catalog   96284     0.515789            6              2\n6   catalog   28426      0.53125            7              3\n7   catalog   37682     0.538462            8              4\n8   catalog   43804     0.538462            8              4\n9   catalog   34826     0.546392           10              6\n10  catalog   27164     0.553191           12              7\n11  catalog   18626     0.555556           13              8\n12  catalog   73516     0.557895           14              9\n13  catalog   38071      0.56701           15             10\n14    store   57598     0.666667            1              1\n15    store   37879     0.670103            2              2\n16    store    3896     0.697674            3              3\n17    store   33284     0.705263            4              4\n18    store  101954     0.727273            5              5\n...*/"
}