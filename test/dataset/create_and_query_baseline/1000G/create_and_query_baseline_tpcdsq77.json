{
    "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select NULL AS channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results\n) foo\norder by channel, id\n limit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY77A.TPL QUERY 78 IN STREAM 0 */ /* TPC-DS QUERY77A.TPL 0.78 */ WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) AS FOO ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
            "preview": "\n/*            channel    id         sales       returns        profit\n0              None   NaN  2.511778e+12  4.944189e+10 -3.183603e+11\n1   catalog channel   NaN  2.357734e+12  4.549756e+10 -2.628525e+11\n2   catalog channel   NaN  3.025787e+09  2.068071e+09 -1.807222e+09\n3   catalog channel   1.0  1.117677e+11  2.068071e+09 -1.230843e+10\n4   catalog channel   2.0  1.124598e+11  2.068071e+09 -1.230098e+10\n5   catalog channel   5.0  1.121806e+11  2.068071e+09 -1.254112e+10\n6   catalog channel   7.0  1.118066e+11  2.068071e+09 -1.242048e+10\n7   catalog channel   8.0  1.121242e+11  2.068071e+09 -1.240345e+10\n8   catalog channel  11.0  1.124947e+11  2.068071e+09 -1.246812e+10\n9   catalog channel  13.0  1.119693e+11  2.068071e+09 -1.227272e+10\n10  catalog channel  14.0  1.119016e+11  2.068071e+09 -1.238481e+10\n11  catalog channel  17.0  1.116380e+11  2.068071e+09 -1.246555e+10\n12  catalog channel  19.0  1.122321e+11  2.068071e+09 -1.255202e+10\n13  catalog channel  20.0  1.120734e+11  2.068071e+09 -1.247479e+10\n14  catalog channel  23.0  1.124069e+11  2.068071e+09 -1.247475e+10\n15  catalog channel  25.0  1.122557e+11  2.068071e+09 -1.243274e+10\n16  catalog channel  26.0  1.124460e+11  2.068071e+09 -1.242512e+10\n17  catalog channel  29.0  1.123220e+11  2.068071e+09 -1.250782e+10\n18  catalog channel  31.0  1.121909e+11  2.068071e+09 -1.243566e+10\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 1.711677,
                "execution_time": 0.970892,
                "compile_time": 0.003757,
                "planning_time": 1.514282
            },
            "query_metrics_warm_up": {
                "elapsed_time": 2.477417,
                "execution_time": 1.737827,
                "compile_time": 0.00387,
                "planning_time": 2.266853
            }
        }
    ],
    "preview": "\n/*            channel    id         sales       returns        profit\n0              None   NaN  2.511778e+12  4.944189e+10 -3.183603e+11\n1   catalog channel   NaN  2.357734e+12  4.549756e+10 -2.628525e+11\n2   catalog channel   NaN  3.025787e+09  2.068071e+09 -1.807222e+09\n3   catalog channel   1.0  1.117677e+11  2.068071e+09 -1.230843e+10\n4   catalog channel   2.0  1.124598e+11  2.068071e+09 -1.230098e+10\n5   catalog channel   5.0  1.121806e+11  2.068071e+09 -1.254112e+10\n6   catalog channel   7.0  1.118066e+11  2.068071e+09 -1.242048e+10\n7   catalog channel   8.0  1.121242e+11  2.068071e+09 -1.240345e+10\n8   catalog channel  11.0  1.124947e+11  2.068071e+09 -1.246812e+10\n9   catalog channel  13.0  1.119693e+11  2.068071e+09 -1.227272e+10\n10  catalog channel  14.0  1.119016e+11  2.068071e+09 -1.238481e+10\n11  catalog channel  17.0  1.116380e+11  2.068071e+09 -1.246555e+10\n12  catalog channel  19.0  1.122321e+11  2.068071e+09 -1.255202e+10\n13  catalog channel  20.0  1.120734e+11  2.068071e+09 -1.247479e+10\n14  catalog channel  23.0  1.124069e+11  2.068071e+09 -1.247475e+10\n15  catalog channel  25.0  1.122557e+11  2.068071e+09 -1.243274e+10\n16  catalog channel  26.0  1.124460e+11  2.068071e+09 -1.242512e+10\n17  catalog channel  29.0  1.123220e+11  2.068071e+09 -1.250782e+10\n18  catalog channel  31.0  1.121909e+11  2.068071e+09 -1.243566e+10\n...*/"
}