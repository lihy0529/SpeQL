{
    "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price,\n  ratio\nlimit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY78.TPL QUERY 10 IN STREAM 0 */ /* TPC-DS QUERY78.TPL 0.10 */ WITH WS AS ( SELECT D_YEAR AS WS_SOLD_YEAR , WS_ITEM_SK , WS_BILL_CUSTOMER_SK AS WS_CUSTOMER_SK , SUM ( WS_QUANTITY ) AS WS_QTY , SUM ( WS_WHOLESALE_COST ) AS WS_WC , SUM ( WS_SALES_PRICE ) AS WS_SP FROM WEB_SALES LEFT JOIN WEB_RETURNS ON WR_ORDER_NUMBER = WS_ORDER_NUMBER AND WS_ITEM_SK = WR_ITEM_SK JOIN DATE_DIM ON WS_SOLD_DATE_SK = D_DATE_SK WHERE WR_ORDER_NUMBER IS NULL GROUP BY D_YEAR , WS_ITEM_SK , WS_BILL_CUSTOMER_SK ) , CS AS ( SELECT D_YEAR AS CS_SOLD_YEAR , CS_ITEM_SK , CS_BILL_CUSTOMER_SK AS CS_CUSTOMER_SK , SUM ( CS_QUANTITY ) AS CS_QTY , SUM ( CS_WHOLESALE_COST ) AS CS_WC , SUM ( CS_SALES_PRICE ) AS CS_SP FROM CATALOG_SALES LEFT JOIN CATALOG_RETURNS ON CR_ORDER_NUMBER = CS_ORDER_NUMBER AND CS_ITEM_SK = CR_ITEM_SK JOIN DATE_DIM ON CS_SOLD_DATE_SK = D_DATE_SK WHERE CR_ORDER_NUMBER IS NULL GROUP BY D_YEAR , CS_ITEM_SK , CS_BILL_CUSTOMER_SK ) , SS AS ( SELECT D_YEAR AS SS_SOLD_YEAR , SS_ITEM_SK , SS_CUSTOMER_SK , SUM ( SS_QUANTITY ) AS SS_QTY , SUM ( SS_WHOLESALE_COST ) AS SS_WC , SUM ( SS_SALES_PRICE ) AS SS_SP FROM STORE_SALES LEFT JOIN STORE_RETURNS ON SR_TICKET_NUMBER = SS_TICKET_NUMBER AND SS_ITEM_SK = SR_ITEM_SK JOIN DATE_DIM ON SS_SOLD_DATE_SK = D_DATE_SK WHERE SR_TICKET_NUMBER IS NULL GROUP BY D_YEAR , SS_ITEM_SK , SS_CUSTOMER_SK ) SELECT SS_CUSTOMER_SK , ROUND ( SS_QTY / ( COALESCE ( WS_QTY , 0 ) + COALESCE ( CS_QTY , 0 ) ) , 2 ) AS RATIO , SS_QTY AS STORE_QTY , SS_WC AS STORE_WHOLESALE_COST , SS_SP AS STORE_SALES_PRICE , COALESCE ( WS_QTY , 0 ) + COALESCE ( CS_QTY , 0 ) AS OTHER_CHAN_QTY , COALESCE ( WS_WC , 0 ) + COALESCE ( CS_WC , 0 ) AS OTHER_CHAN_WHOLESALE_COST , COALESCE ( WS_SP , 0 ) + COALESCE ( CS_SP , 0 ) AS OTHER_CHAN_SALES_PRICE FROM SS LEFT JOIN WS ON ( WS_SOLD_YEAR = SS_SOLD_YEAR AND WS_ITEM_SK = SS_ITEM_SK AND WS_CUSTOMER_SK = SS_CUSTOMER_SK ) LEFT JOIN CS ON ( CS_SOLD_YEAR = SS_SOLD_YEAR AND CS_ITEM_SK = SS_ITEM_SK AND CS_CUSTOMER_SK = SS_CUSTOMER_SK ) WHERE ( COALESCE ( WS_QTY , 0 ) > 0 OR COALESCE ( CS_QTY , 0 ) > 0 ) AND SS_SOLD_YEAR = 2001 ORDER BY SS_CUSTOMER_SK NULLS FIRST , SS_QTY DESC NULLS LAST , SS_WC DESC NULLS LAST , SS_SP DESC NULLS LAST , OTHER_CHAN_QTY NULLS FIRST , OTHER_CHAN_WHOLESALE_COST NULLS FIRST , OTHER_CHAN_SALES_PRICE NULLS FIRST , RATIO NULLS FIRST LIMIT 21",
            "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              124      4         53                 46.67              47.82              12                      84.56                  144.17\n1              236      4         92                 31.31              20.24              20                      94.28                  120.64\n2              241      3         58                 91.53              13.69              15                      71.23                   16.83\n3              883     14         29                 40.71              50.11               2                      13.04                   15.98\n4             1153      1         91                 57.10              43.82              84                       6.27                    3.61\n5             1239      1         71                 73.91              79.20              56                      46.14                   28.01\n6             1258      0         57                 79.15              12.79              87                      23.66                   45.92\n7             1299      0          4                 75.65              56.35              31                      50.47                   88.97\n8             1700     21         63                 83.69              62.81               3                      91.25                   30.43\n9             1714      2         78                 38.60              56.75              28                      86.91                  134.79\n10            1756      0         21                 76.27              66.31              86                      73.56                   83.85\n11            1993      3         60                 63.90              26.00              20                      29.11                   48.66\n12            2051      1         95                 40.68              22.40              54                      22.15                    6.42\n13            2286      0         57                 83.73              56.63              79                      16.92                    1.69\n14            2389     23         94                 38.65              15.79               4                      26.00                   29.85\n15            2696      0         34                 15.64               4.14              99                      99.18                  141.70\n16            2729      0         62                 53.16              24.91              79                      25.50                   24.27\n17            2789      0         24                 43.06              21.08              72                      51.31                   26.22\n18            2811      0         43                 40.16              48.50              93                      41.62                   38.73\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 336.25934,
                "execution_time": 336.02331,
                "compile_time": 0.000796,
                "planning_time": 0.195912
            },
            "query_metrics_warm_up": {
                "elapsed_time": 365.724592,
                "execution_time": 350.112421,
                "compile_time": 15.527318,
                "planning_time": 0.221253
            }
        }
    ],
    "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              124      4         53                 46.67              47.82              12                      84.56                  144.17\n1              236      4         92                 31.31              20.24              20                      94.28                  120.64\n2              241      3         58                 91.53              13.69              15                      71.23                   16.83\n3              883     14         29                 40.71              50.11               2                      13.04                   15.98\n4             1153      1         91                 57.10              43.82              84                       6.27                    3.61\n5             1239      1         71                 73.91              79.20              56                      46.14                   28.01\n6             1258      0         57                 79.15              12.79              87                      23.66                   45.92\n7             1299      0          4                 75.65              56.35              31                      50.47                   88.97\n8             1700     21         63                 83.69              62.81               3                      91.25                   30.43\n9             1714      2         78                 38.60              56.75              28                      86.91                  134.79\n10            1756      0         21                 76.27              66.31              86                      73.56                   83.85\n11            1993      3         60                 63.90              26.00              20                      29.11                   48.66\n12            2051      1         95                 40.68              22.40              54                      22.15                    6.42\n13            2286      0         57                 83.73              56.63              79                      16.92                    1.69\n14            2389     23         94                 38.65              15.79               4                      26.00                   29.85\n15            2696      0         34                 15.64               4.14              99                      99.18                  141.70\n16            2729      0         62                 53.16              24.91              79                      25.50                   24.27\n17            2789      0         24                 43.06              21.08              72                      51.31                   26.22\n18            2811      0         43                 40.16              48.50              93                      41.62                   38.73\n...*/"
}