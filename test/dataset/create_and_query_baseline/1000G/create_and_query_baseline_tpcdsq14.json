{
    "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year \nWHERE  this_year.i_brand_id = last_year.i_brand_id \n       AND this_year.i_class_id = last_year.i_class_id \n       AND this_year.i_category_id = last_year.i_category_id \nORDER  BY this_year.channel, \n          this_year.i_brand_id, \n          this_year.i_class_id, \n          this_year.i_category_id\nLIMIT 100",
    "query": [
        {
            "query": "WITH CROSS_ITEMS AS ( SELECT I_ITEM_SK AS SS_ITEM_SK FROM ITEM , ( SELECT ISS.I_BRAND_ID AS BRAND_ID , ISS.I_CLASS_ID AS CLASS_ID , ISS.I_CATEGORY_ID AS CATEGORY_ID FROM STORE_SALES , ITEM AS ISS , DATE_DIM AS D1 WHERE SS_ITEM_SK = ISS.I_ITEM_SK AND SS_SOLD_DATE_SK = D1.D_DATE_SK AND D1.D_YEAR BETWEEN 1999 AND 1999 + 2 INTERSECT SELECT ICS.I_BRAND_ID , ICS.I_CLASS_ID , ICS.I_CATEGORY_ID FROM CATALOG_SALES , ITEM AS ICS , DATE_DIM AS D2 WHERE CS_ITEM_SK = ICS.I_ITEM_SK AND CS_SOLD_DATE_SK = D2.D_DATE_SK AND D2.D_YEAR BETWEEN 1999 AND 1999 + 2 INTERSECT SELECT IWS.I_BRAND_ID , IWS.I_CLASS_ID , IWS.I_CATEGORY_ID FROM WEB_SALES , ITEM AS IWS , DATE_DIM AS D3 WHERE WS_ITEM_SK = IWS.I_ITEM_SK AND WS_SOLD_DATE_SK = D3.D_DATE_SK AND D3.D_YEAR BETWEEN 1999 AND 1999 + 2 ) AS X WHERE I_BRAND_ID = BRAND_ID AND I_CLASS_ID = CLASS_ID AND I_CATEGORY_ID = CATEGORY_ID ) , AVG_SALES AS ( SELECT AVG ( QUANTITY * LIST_PRICE ) AS AVERAGE_SALES FROM ( SELECT SS_QUANTITY AS QUANTITY , SS_LIST_PRICE AS LIST_PRICE FROM STORE_SALES , DATE_DIM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR BETWEEN 1999 AND 1999 + 2 UNION ALL SELECT CS_QUANTITY AS QUANTITY , CS_LIST_PRICE AS LIST_PRICE FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR BETWEEN 1999 AND 1999 + 2 UNION ALL SELECT WS_QUANTITY AS QUANTITY , WS_LIST_PRICE AS LIST_PRICE FROM WEB_SALES , DATE_DIM WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR BETWEEN 1999 AND 1999 + 2 ) AS X ) SELECT * FROM ( SELECT 'store' AS CHANNEL , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , SUM ( SS_QUANTITY * SS_LIST_PRICE ) AS SALES , COUNT ( * ) AS NUMBER_SALES FROM STORE_SALES , ITEM , DATE_DIM WHERE SS_ITEM_SK IN ( SELECT SS_ITEM_SK FROM CROSS_ITEMS ) AND SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_WEEK_SEQ = ( SELECT D_WEEK_SEQ FROM DATE_DIM WHERE D_YEAR = 1999 + 1 AND D_MOY = 12 AND D_DOM = 25 ) GROUP BY I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID HAVING SUM ( SS_QUANTITY * SS_LIST_PRICE ) > ( SELECT AVERAGE_SALES FROM AVG_SALES ) ) AS THIS_YEAR , ( SELECT 'store' AS CHANNEL , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , SUM ( SS_QUANTITY * SS_LIST_PRICE ) AS SALES , COUNT ( * ) AS NUMBER_SALES FROM STORE_SALES , ITEM , DATE_DIM WHERE SS_ITEM_SK IN ( SELECT SS_ITEM_SK FROM CROSS_ITEMS ) AND SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_WEEK_SEQ = ( SELECT D_WEEK_SEQ FROM DATE_DIM WHERE D_YEAR = 1999 AND D_MOY = 12 AND D_DOM = 25 ) GROUP BY I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID HAVING SUM ( SS_QUANTITY * SS_LIST_PRICE ) > ( SELECT AVERAGE_SALES FROM AVG_SALES ) ) AS LAST_YEAR WHERE THIS_YEAR.I_BRAND_ID = LAST_YEAR.I_BRAND_ID AND THIS_YEAR.I_CLASS_ID = LAST_YEAR.I_CLASS_ID AND THIS_YEAR.I_CATEGORY_ID = LAST_YEAR.I_CATEGORY_ID ORDER BY THIS_YEAR.CHANNEL NULLS FIRST , THIS_YEAR.I_BRAND_ID NULLS FIRST , THIS_YEAR.I_CLASS_ID NULLS FIRST , THIS_YEAR.I_CATEGORY_ID NULLS FIRST LIMIT 21",
            "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id         sales  number_sales channel  i_brand_id  i_class_id  i_category_id         sales  number_sales\n0    store     1001001           1              1  6.699765e+08        181341   store     1001001           1              1  1.286399e+09        349149\n1    store     1001002           1              1  8.235056e+08        223629   store     1001002           1              1  6.720553e+08        181864\n2    store     1002001           2              1  6.504350e+08        176084   store     1002001           2              1  1.264378e+09        343232\n3    store     1002002           2              1  8.397788e+08        228365   store     1002002           2              1  6.518996e+08        176083\n4    store     1003001           3              1  6.899597e+08        186933   store     1003001           3              1  1.302700e+09        353573\n5    store     1003002           3              1  8.382580e+08        226900   store     1003002           3              1  6.400382e+08        173055\n6    store     1004001           4              1  6.545507e+08        177002   store     1004001           4              1  1.290918e+09        349291\n7    store     1004002           4              1  8.183819e+08        222557   store     1004002           4              1  6.463611e+08        175236\n8    store     2001001           1              2  6.724767e+08        182331   store     2001001           1              2  1.276723e+09        346279\n9    store     2001002           1              2  8.480241e+08        229995   store     2001002           1              2  6.603916e+08        179435\n10   store     2002001           2              2  6.490147e+08        175392   store     2002001           2              2  1.268540e+09        343627\n11   store     2002002           2              2  8.035972e+08        217498   store     2002002           2              2  6.272775e+08        169420\n12   store     2003001           3              2  6.479146e+08        175765   store     2003001           3              2  1.271169e+09        343073\n13   store     2003002           3              2  7.622761e+08        206595   store     2003002           3              2  5.966743e+08        160699\n14   store     2004001           4              2  6.709051e+08        181924   store     2004001           4              2  1.319027e+09        357632\n15   store     2004002           4              2  8.226526e+08        223446   store     2004002           4              2  6.142975e+08        166618\n16   store     3001001           1              3  6.893121e+08        186689   store     3001001           1              3  1.333683e+09        361261\n17   store     3001002           1              3  8.246980e+08        223093   store     3001002           1              3  6.238730e+08        169058\n18   store     3002001           2              3  6.780400e+08        182762   store     3002001           2              3  1.284585e+09        347869\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 56.477344,
                "execution_time": 56.047196,
                "compile_time": 0.002274,
                "planning_time": 55.821505
            },
            "query_metrics_warm_up": {
                "elapsed_time": 57.053779,
                "execution_time": 56.51563,
                "compile_time": 0.002419,
                "planning_time": 56.391949
            }
        }
    ],
    "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id         sales  number_sales channel  i_brand_id  i_class_id  i_category_id         sales  number_sales\n0    store     1001001           1              1  6.699765e+08        181341   store     1001001           1              1  1.286399e+09        349149\n1    store     1001002           1              1  8.235056e+08        223629   store     1001002           1              1  6.720553e+08        181864\n2    store     1002001           2              1  6.504350e+08        176084   store     1002001           2              1  1.264378e+09        343232\n3    store     1002002           2              1  8.397788e+08        228365   store     1002002           2              1  6.518996e+08        176083\n4    store     1003001           3              1  6.899597e+08        186933   store     1003001           3              1  1.302700e+09        353573\n5    store     1003002           3              1  8.382580e+08        226900   store     1003002           3              1  6.400382e+08        173055\n6    store     1004001           4              1  6.545507e+08        177002   store     1004001           4              1  1.290918e+09        349291\n7    store     1004002           4              1  8.183819e+08        222557   store     1004002           4              1  6.463611e+08        175236\n8    store     2001001           1              2  6.724767e+08        182331   store     2001001           1              2  1.276723e+09        346279\n9    store     2001002           1              2  8.480241e+08        229995   store     2001002           1              2  6.603916e+08        179435\n10   store     2002001           2              2  6.490147e+08        175392   store     2002001           2              2  1.268540e+09        343627\n11   store     2002002           2              2  8.035972e+08        217498   store     2002002           2              2  6.272775e+08        169420\n12   store     2003001           3              2  6.479146e+08        175765   store     2003001           3              2  1.271169e+09        343073\n13   store     2003002           3              2  7.622761e+08        206595   store     2003002           3              2  5.966743e+08        160699\n14   store     2004001           4              2  6.709051e+08        181924   store     2004001           4              2  1.319027e+09        357632\n15   store     2004002           4              2  8.226526e+08        223446   store     2004002           4              2  6.142975e+08        166618\n16   store     3001001           1              3  6.893121e+08        186689   store     3001001           1              3  1.333683e+09        361261\n17   store     3001002           1              3  8.246980e+08        223093   store     3001002           1              3  6.238730e+08        169058\n18   store     3002001           2              3  6.780400e+08        182762   store     3002001           2              3  1.284585e+09        347869\n...*/"
}