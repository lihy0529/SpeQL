{
    "input": "-- start template query75.tpl query 3 in stream 0\nWITH /* TPC-DS query75.tpl 0.3 */ all_sales AS (\n SELECT d_year\n       ,i_brand_id\n       ,i_class_id\n       ,i_category_id\n       ,i_manufact_id\n       ,SUM(sales_cnt) AS sales_cnt\n       ,SUM(sales_amt) AS sales_amt\n FROM (SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt\n             ,cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt\n       FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk\n                          JOIN date_dim ON d_date_sk=cs_sold_date_sk\n                          LEFT JOIN catalog_returns ON (cs_order_number=cr_order_number \n                                                    AND cs_item_sk=cr_item_sk)\n       WHERE i_category='Shoes'\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt\n             ,ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt\n       FROM store_sales JOIN item ON i_item_sk=ss_item_sk\n                        JOIN date_dim ON d_date_sk=ss_sold_date_sk\n                        LEFT JOIN store_returns ON (ss_ticket_number=sr_ticket_number \n                                                AND ss_item_sk=sr_item_sk)\n       WHERE i_category='Shoes'\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt\n             ,ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt\n       FROM web_sales JOIN item ON i_item_sk=ws_item_sk\n                      JOIN date_dim ON d_date_sk=ws_sold_date_sk\n                      LEFT JOIN web_returns ON (ws_order_number=wr_order_number \n                                            AND ws_item_sk=wr_item_sk)\n       WHERE i_category='Shoes') sales_detail\n GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)\n SELECT  prev_yr.d_year AS prev_year\n                          ,curr_yr.d_year AS year\n                          ,curr_yr.i_brand_id\n                          ,curr_yr.i_class_id\n                          ,curr_yr.i_category_id\n                          ,curr_yr.i_manufact_id\n                          ,prev_yr.sales_cnt AS prev_yr_cnt\n                          ,curr_yr.sales_cnt AS curr_yr_cnt\n                          ,curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff\n                          ,curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff\n FROM all_sales curr_yr, all_sales prev_yr\n WHERE curr_yr.i_brand_id=prev_yr.i_brand_id\n   AND curr_yr.i_class_id=prev_yr.i_class_id\n   AND curr_yr.i_category_id=prev_yr.i_category_id\n   AND curr_yr.i_manufact_id=prev_yr.i_manufact_id\n   AND curr_yr.d_year=2000\n   AND prev_yr.d_year=2000-1\n   AND CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9\n ORDER BY sales_cnt_diff,sales_amt_diff\n limit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY75.TPL QUERY 3 IN STREAM 0 */ /* TPC-DS QUERY75.TPL 0.3 */ WITH ALL_SALES AS ( SELECT D_YEAR , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , I_MANUFACT_ID , SUM ( SALES_CNT ) AS SALES_CNT , SUM ( SALES_AMT ) AS SALES_AMT FROM ( SELECT D_YEAR , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , I_MANUFACT_ID , CS_QUANTITY - COALESCE ( CR_RETURN_QUANTITY , 0 ) AS SALES_CNT , CS_EXT_SALES_PRICE - COALESCE ( CR_RETURN_AMOUNT , 0.0 ) AS SALES_AMT FROM CATALOG_SALES JOIN ITEM ON I_ITEM_SK = CS_ITEM_SK JOIN DATE_DIM ON D_DATE_SK = CS_SOLD_DATE_SK LEFT JOIN CATALOG_RETURNS ON ( CS_ORDER_NUMBER = CR_ORDER_NUMBER AND CS_ITEM_SK = CR_ITEM_SK ) WHERE I_CATEGORY = 'Shoes' UNION SELECT D_YEAR , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , I_MANUFACT_ID , SS_QUANTITY - COALESCE ( SR_RETURN_QUANTITY , 0 ) AS SALES_CNT , SS_EXT_SALES_PRICE - COALESCE ( SR_RETURN_AMT , 0.0 ) AS SALES_AMT FROM STORE_SALES JOIN ITEM ON I_ITEM_SK = SS_ITEM_SK JOIN DATE_DIM ON D_DATE_SK = SS_SOLD_DATE_SK LEFT JOIN STORE_RETURNS ON ( SS_TICKET_NUMBER = SR_TICKET_NUMBER AND SS_ITEM_SK = SR_ITEM_SK ) WHERE I_CATEGORY = 'Shoes' UNION SELECT D_YEAR , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , I_MANUFACT_ID , WS_QUANTITY - COALESCE ( WR_RETURN_QUANTITY , 0 ) AS SALES_CNT , WS_EXT_SALES_PRICE - COALESCE ( WR_RETURN_AMT , 0.0 ) AS SALES_AMT FROM WEB_SALES JOIN ITEM ON I_ITEM_SK = WS_ITEM_SK JOIN DATE_DIM ON D_DATE_SK = WS_SOLD_DATE_SK LEFT JOIN WEB_RETURNS ON ( WS_ORDER_NUMBER = WR_ORDER_NUMBER AND WS_ITEM_SK = WR_ITEM_SK ) WHERE I_CATEGORY = 'Shoes' ) AS SALES_DETAIL GROUP BY D_YEAR , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , I_MANUFACT_ID ) SELECT PREV_YR.D_YEAR AS PREV_YEAR , CURR_YR.D_YEAR AS YEAR , CURR_YR.I_BRAND_ID , CURR_YR.I_CLASS_ID , CURR_YR.I_CATEGORY_ID , CURR_YR.I_MANUFACT_ID , PREV_YR.SALES_CNT AS PREV_YR_CNT , CURR_YR.SALES_CNT AS CURR_YR_CNT , CURR_YR.SALES_CNT - PREV_YR.SALES_CNT AS SALES_CNT_DIFF , CURR_YR.SALES_AMT - PREV_YR.SALES_AMT AS SALES_AMT_DIFF FROM ALL_SALES AS CURR_YR , ALL_SALES AS PREV_YR WHERE CURR_YR.I_BRAND_ID = PREV_YR.I_BRAND_ID AND CURR_YR.I_CLASS_ID = PREV_YR.I_CLASS_ID AND CURR_YR.I_CATEGORY_ID = PREV_YR.I_CATEGORY_ID AND CURR_YR.I_MANUFACT_ID = PREV_YR.I_MANUFACT_ID AND CURR_YR.D_YEAR = 2000 AND PREV_YR.D_YEAR = 2000 - 1 AND CAST ( CURR_YR.SALES_CNT AS DECIMAL ( 17 , 2 ) ) / CAST ( PREV_YR.SALES_CNT AS DECIMAL ( 17 , 2 ) ) < 0.9 ORDER BY SALES_CNT_DIFF NULLS FIRST , SALES_AMT_DIFF NULLS FIRST LIMIT 21",
            "preview": "\n/*    prev_year  year  i_brand_id  i_class_id  i_category_id  i_manufact_id  prev_yr_cnt  curr_yr_cnt  sales_cnt_diff  sales_amt_diff\n0        1999  2000     4003001           3              4            325      2931936        12867        -2919069   -1.316202e+08\n1        1999  2000     4001001           1              4             25      2959994       636361        -2323633   -1.043919e+08\n2        1999  2000     4004001           4              4              1      3222779       923270        -2299509   -1.046268e+08\n3        1999  2000     4003001           3              4            177      2093958         9655        -2084303   -9.318227e+07\n4        1999  2000     4004001           4              4            304      2078007         9898        -2068109   -9.146429e+07\n5        1999  2000     4001001           1              4             45      2074216         9928        -2064288   -9.209382e+07\n6        1999  2000     4003001           3              4            297      2678015       620406        -2057609   -9.347262e+07\n7        1999  2000     4003001           3              4            331      2363259       321466        -2041793   -9.140894e+07\n8        1999  2000     4002001           2              4            145      2948074       919756        -2028318   -9.141396e+07\n9        1999  2000     4003001           3              4            124      3475682      1503367        -1972315   -9.002480e+07\n10       1999  2000     4004001           4              4            609      1802717         7907        -1794810   -8.028244e+07\n11       1999  2000     4004001           4              4            147      1795873         7214        -1788659   -7.932226e+07\n12       1999  2000     4001001           1              4             10      2078572       310172        -1768400   -7.875290e+07\n13       1999  2000     4001001           1              4            124      2395355       629962        -1765393   -7.827874e+07\n14       1999  2000     4001001           1              4            287      2380774       616691        -1764083   -7.937839e+07\n15       1999  2000     4001001           1              4             48      2675402       915188        -1760214   -7.864067e+07\n16       1999  2000     4002001           2              4            239      2685500       925837        -1759663   -7.984875e+07\n17       1999  2000     4003001           3              4            115      2367440       616400        -1751040   -7.910920e+07\n18       1999  2000     4001001           1              4             46      2362254       628179        -1734075   -7.675331e+07\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 36.444142,
                "execution_time": 36.099805,
                "compile_time": 0.001803,
                "planning_time": 0.272392
            },
            "query_metrics_warm_up": {
                "elapsed_time": 37.778929,
                "execution_time": 37.324845,
                "compile_time": 0.001751,
                "planning_time": 0.383588
            }
        }
    ],
    "preview": "\n/*    prev_year  year  i_brand_id  i_class_id  i_category_id  i_manufact_id  prev_yr_cnt  curr_yr_cnt  sales_cnt_diff  sales_amt_diff\n0        1999  2000     4003001           3              4            325      2931936        12867        -2919069   -1.316202e+08\n1        1999  2000     4001001           1              4             25      2959994       636361        -2323633   -1.043919e+08\n2        1999  2000     4004001           4              4              1      3222779       923270        -2299509   -1.046268e+08\n3        1999  2000     4003001           3              4            177      2093958         9655        -2084303   -9.318227e+07\n4        1999  2000     4004001           4              4            304      2078007         9898        -2068109   -9.146429e+07\n5        1999  2000     4001001           1              4             45      2074216         9928        -2064288   -9.209382e+07\n6        1999  2000     4003001           3              4            297      2678015       620406        -2057609   -9.347262e+07\n7        1999  2000     4003001           3              4            331      2363259       321466        -2041793   -9.140894e+07\n8        1999  2000     4002001           2              4            145      2948074       919756        -2028318   -9.141396e+07\n9        1999  2000     4003001           3              4            124      3475682      1503367        -1972315   -9.002480e+07\n10       1999  2000     4004001           4              4            609      1802717         7907        -1794810   -8.028244e+07\n11       1999  2000     4004001           4              4            147      1795873         7214        -1788659   -7.932226e+07\n12       1999  2000     4001001           1              4             10      2078572       310172        -1768400   -7.875290e+07\n13       1999  2000     4001001           1              4            124      2395355       629962        -1765393   -7.827874e+07\n14       1999  2000     4001001           1              4            287      2380774       616691        -1764083   -7.937839e+07\n15       1999  2000     4001001           1              4             48      2675402       915188        -1760214   -7.864067e+07\n16       1999  2000     4002001           2              4            239      2685500       925837        -1759663   -7.984875e+07\n17       1999  2000     4003001           3              4            115      2367440       616400        -1751040   -7.910920e+07\n18       1999  2000     4001001           1              4             46      2362254       628179        -1734075   -7.675331e+07\n...*/"
}