{
    "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n )\n order by 1,4,5,2\n limit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY49.TPL QUERY 48 IN STREAM 0 */ /* TPC-DS QUERY49.TPL 0.48 */ SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) ORDER BY 1 NULLS FIRST , 4 NULLS FIRST , 5 NULLS FIRST , 2 NULLS FIRST LIMIT 21",
            "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog  297421        0E-16            1              4\n1   catalog  220576        0E-16            1             99\n2   catalog  283364        0E-16            1            148\n3   catalog  127603        0E-16            1            198\n4   catalog  104572        0E-16            1            224\n5   catalog  128468        0E-16            1            328\n6   catalog  184012        0E-16            1            452\n7   catalog   47786        0E-16            1            518\n8   catalog  186205        0E-16            1            563\n9   catalog   29128        0E-16            1            624\n10  catalog   60559        0E-16            1            631\n11  catalog   75571        0E-16            1            699\n12  catalog  299752        0E-16            1            867\n13  catalog   64502        0E-16            1           1049\n14  catalog   84976        0E-16            1           1456\n15  catalog  134932        0E-16            1           1516\n16  catalog  106399        0E-16            1           1550\n17  catalog   72922        0E-16            1           1575\n18  catalog  226060        0E-16            1           1575\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 3.226014,
                "execution_time": 3.047705,
                "compile_time": 0.001211,
                "planning_time": 0.129172
            },
            "query_metrics_warm_up": {
                "elapsed_time": 7.066987,
                "execution_time": 6.784012,
                "compile_time": 0.001331,
                "planning_time": 0.23142
            }
        }
    ],
    "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog  297421        0E-16            1              4\n1   catalog  220576        0E-16            1             99\n2   catalog  283364        0E-16            1            148\n3   catalog  127603        0E-16            1            198\n4   catalog  104572        0E-16            1            224\n5   catalog  128468        0E-16            1            328\n6   catalog  184012        0E-16            1            452\n7   catalog   47786        0E-16            1            518\n8   catalog  186205        0E-16            1            563\n9   catalog   29128        0E-16            1            624\n10  catalog   60559        0E-16            1            631\n11  catalog   75571        0E-16            1            699\n12  catalog  299752        0E-16            1            867\n13  catalog   64502        0E-16            1           1049\n14  catalog   84976        0E-16            1           1456\n15  catalog  134932        0E-16            1           1516\n16  catalog  106399        0E-16            1           1550\n17  catalog   72922        0E-16            1           1575\n18  catalog  226060        0E-16            1           1575\n...*/"
}