{
    "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n     order by c_last_name,c_first_name,sales\n  limit 100",
    "query": [
        {
            "query": "/* TPC-DS QUERY23.TPL 0.68 PART2 */ WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) ORDER BY C_LAST_NAME NULLS FIRST , C_FIRST_NAME NULLS FIRST , SALES NULLS FIRST LIMIT 21",
            "preview": "\n/*   c_last_name c_first_name      sales\n0                             52655.68\n1                    Robert   62186.62\n2                      Sara   75233.00\n3      Acevedo       Joshua   37532.07\n4       Ackley       Thomas   55286.60\n5      Alvarez      William   52552.27\n6     Anderson       Lester  130778.07\n7        Baird        Jesse   49288.26\n8        Baird        Jesse   50061.99\n9       Barnes        Nancy   23788.30\n10     Barnett       Joshua   41192.98\n11     Bennett         Pete   30495.09\n12     Bradley      Chester   69407.11\n13       Brock      Darlene   70059.43\n14       Brown      Michael   81048.58\n15    Brownell      Laverne   30449.54\n16       Bunch       Amelia   64791.02\n17       Carey                20900.97\n18      Carter       Elwood   90422.47\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 307.290389,
                "execution_time": 306.898728,
                "compile_time": 0.001974,
                "planning_time": 306.661104
            },
            "query_metrics_warm_up": {
                "elapsed_time": 326.924497,
                "execution_time": 326.48237,
                "compile_time": 0.001954,
                "planning_time": 326.285085
            }
        }
    ],
    "preview": "\n/*   c_last_name c_first_name      sales\n0                             52655.68\n1                    Robert   62186.62\n2                      Sara   75233.00\n3      Acevedo       Joshua   37532.07\n4       Ackley       Thomas   55286.60\n5      Alvarez      William   52552.27\n6     Anderson       Lester  130778.07\n7        Baird        Jesse   49288.26\n8        Baird        Jesse   50061.99\n9       Barnes        Nancy   23788.30\n10     Barnett       Joshua   41192.98\n11     Bennett         Pete   30495.09\n12     Bradley      Chester   69407.11\n13       Brock      Darlene   70059.43\n14       Brown      Michael   81048.58\n15    Brownell      Laverne   30449.54\n16       Bunch       Amelia   64791.02\n17       Carey                20900.97\n18      Carter       Elwood   90422.47\n...*/"
}