{
    "input": "-- start template query31.tpl query 50 in stream 0\nwith /* TPC-DS query31.tpl 0.50 */ ss as\n (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales\n from store_sales,date_dim,customer_address\n where ss_sold_date_sk = d_date_sk\n  and ss_addr_sk=ca_address_sk\n group by ca_county,d_qoy, d_year),\n ws as\n (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales\n from web_sales,date_dim,customer_address\n where ws_sold_date_sk = d_date_sk\n  and ws_bill_addr_sk=ca_address_sk\n group by ca_county,d_qoy, d_year)\n select \n        ss1.ca_county\n       ,ss1.d_year\n       ,ws2.web_sales/ws1.web_sales web_q1_q2_increase\n       ,ss2.store_sales/ss1.store_sales store_q1_q2_increase\n       ,ws3.web_sales/ws2.web_sales web_q2_q3_increase\n       ,ss3.store_sales/ss2.store_sales store_q2_q3_increase\n from\n        ss ss1\n       ,ss ss2\n       ,ss ss3\n       ,ws ws1\n       ,ws ws2\n       ,ws ws3\n where\n    ss1.d_qoy = 1\n    and ss1.d_year = 1998\n    and ss1.ca_county = ss2.ca_county\n    and ss2.d_qoy = 2\n    and ss2.d_year = 1998\n and ss2.ca_county = ss3.ca_county\n    and ss3.d_qoy = 3\n    and ss3.d_year = 1998\n    and ss1.ca_county = ws1.ca_county\n    and ws1.d_qoy = 1\n    and ws1.d_year = 1998\n    and ws1.ca_county = ws2.ca_county\n    and ws2.d_qoy = 2\n    and ws2.d_year = 1998\n    and ws1.ca_county = ws3.ca_county\n    and ws3.d_qoy = 3\n    and ws3.d_year =1998\n    and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end \n       > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end\n    and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end\n       > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end\n order by web_q1_q2_increase\nlimit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY31.TPL QUERY 50 IN STREAM 0 */ /* TPC-DS QUERY31.TPL 0.50 */ WITH SS AS ( SELECT CA_COUNTY , D_QOY , D_YEAR , SUM ( SS_EXT_SALES_PRICE ) AS STORE_SALES FROM STORE_SALES , DATE_DIM , CUSTOMER_ADDRESS WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ADDR_SK = CA_ADDRESS_SK GROUP BY CA_COUNTY , D_QOY , D_YEAR ) , WS AS ( SELECT CA_COUNTY , D_QOY , D_YEAR , SUM ( WS_EXT_SALES_PRICE ) AS WEB_SALES FROM WEB_SALES , DATE_DIM , CUSTOMER_ADDRESS WHERE WS_SOLD_DATE_SK = D_DATE_SK AND WS_BILL_ADDR_SK = CA_ADDRESS_SK GROUP BY CA_COUNTY , D_QOY , D_YEAR ) SELECT SS1.CA_COUNTY , SS1.D_YEAR , WS2.WEB_SALES / WS1.WEB_SALES AS WEB_Q1_Q2_INCREASE , SS2.STORE_SALES / SS1.STORE_SALES AS STORE_Q1_Q2_INCREASE , WS3.WEB_SALES / WS2.WEB_SALES AS WEB_Q2_Q3_INCREASE , SS3.STORE_SALES / SS2.STORE_SALES AS STORE_Q2_Q3_INCREASE FROM SS AS SS1 , SS AS SS2 , SS AS SS3 , WS AS WS1 , WS AS WS2 , WS AS WS3 WHERE SS1.D_QOY = 1 AND SS1.D_YEAR = 1998 AND SS1.CA_COUNTY = SS2.CA_COUNTY AND SS2.D_QOY = 2 AND SS2.D_YEAR = 1998 AND SS2.CA_COUNTY = SS3.CA_COUNTY AND SS3.D_QOY = 3 AND SS3.D_YEAR = 1998 AND SS1.CA_COUNTY = WS1.CA_COUNTY AND WS1.D_QOY = 1 AND WS1.D_YEAR = 1998 AND WS1.CA_COUNTY = WS2.CA_COUNTY AND WS2.D_QOY = 2 AND WS2.D_YEAR = 1998 AND WS1.CA_COUNTY = WS3.CA_COUNTY AND WS3.D_QOY = 3 AND WS3.D_YEAR = 1998 AND CASE WHEN WS1.WEB_SALES > 0 THEN WS2.WEB_SALES / WS1.WEB_SALES ELSE NULL END > CASE WHEN SS1.STORE_SALES > 0 THEN SS2.STORE_SALES / SS1.STORE_SALES ELSE NULL END AND CASE WHEN WS2.WEB_SALES > 0 THEN WS3.WEB_SALES / WS2.WEB_SALES ELSE NULL END > CASE WHEN SS2.STORE_SALES > 0 THEN SS3.STORE_SALES / SS2.STORE_SALES ELSE NULL END ORDER BY WEB_Q1_Q2_INCREASE NULLS FIRST LIMIT 21",
            "preview": "\n/*                 ca_county  d_year  web_q1_q2_increase  store_q1_q2_increase  web_q2_q3_increase  store_q2_q3_increase\n0   San Luis Obispo County    1998              0.9756                0.9586              1.8902                1.8215\n1             Coosa County    1998              0.9780                0.9641              1.8255                1.8151\n2            Twiggs County    1998              0.9802                0.9748              1.8922                1.8480\n3      Indian River County    1998              0.9809                0.9789              1.9626                1.8760\n4           Payette County    1998              0.9810                0.9701              1.8384                1.8306\n5          Rockwall County    1998              0.9812                0.9548              2.0474                1.9227\n6          Sterling County    1998              0.9856                0.9464              1.9884                1.8972\n7           Kanabec County    1998              0.9902                0.9700              1.8697                1.7665\n8           Kimball County    1998              0.9950                0.9840              2.0883                1.9127\n9            McCone County    1998              0.9985                0.9926              1.9762                1.8318\n10         Converse County    1998              0.9987                0.9710              1.8714                1.8335\n11             Tama County    1998              1.0013                0.9740              1.8500                1.8358\n12           Ogemaw County    1998              1.0016                0.9660              1.9292                1.8245\n13       Huntington County    1998              1.0026                1.0015              1.9027                1.8996\n14           Emmons County    1998              1.0032                0.9946              1.9858                1.8670\n15          Daggett County    1998              1.0036                0.9755              1.9213                1.8789\n16         Woodbury County    1998              1.0045                0.9828              1.9643                1.9251\n17       Vermillion County    1998              1.0051                0.9768              2.0319                1.9849\n18          Alfalfa County    1998              1.0052                0.9804              1.8852                1.8806\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 4.358487,
                "execution_time": 4.165454,
                "compile_time": 0.00152,
                "planning_time": 0.128844
            },
            "query_metrics_warm_up": {
                "elapsed_time": 19.96809,
                "execution_time": 6.673808,
                "compile_time": 13.039685,
                "planning_time": 0.205033
            }
        }
    ],
    "preview": "\n/*                 ca_county  d_year  web_q1_q2_increase  store_q1_q2_increase  web_q2_q3_increase  store_q2_q3_increase\n0   San Luis Obispo County    1998              0.9756                0.9586              1.8902                1.8215\n1             Coosa County    1998              0.9780                0.9641              1.8255                1.8151\n2            Twiggs County    1998              0.9802                0.9748              1.8922                1.8480\n3      Indian River County    1998              0.9809                0.9789              1.9626                1.8760\n4           Payette County    1998              0.9810                0.9701              1.8384                1.8306\n5          Rockwall County    1998              0.9812                0.9548              2.0474                1.9227\n6          Sterling County    1998              0.9856                0.9464              1.9884                1.8972\n7           Kanabec County    1998              0.9902                0.9700              1.8697                1.7665\n8           Kimball County    1998              0.9950                0.9840              2.0883                1.9127\n9            McCone County    1998              0.9985                0.9926              1.9762                1.8318\n10         Converse County    1998              0.9987                0.9710              1.8714                1.8335\n11             Tama County    1998              1.0013                0.9740              1.8500                1.8358\n12           Ogemaw County    1998              1.0016                0.9660              1.9292                1.8245\n13       Huntington County    1998              1.0026                1.0015              1.9027                1.8996\n14           Emmons County    1998              1.0032                0.9946              1.9858                1.8670\n15          Daggett County    1998              1.0036                0.9755              1.9213                1.8789\n16         Woodbury County    1998              1.0045                0.9828              1.9643                1.9251\n17       Vermillion County    1998              1.0051                0.9768              2.0319                1.9849\n18          Alfalfa County    1998              1.0052                0.9804              1.8852                1.8806\n...*/"
}