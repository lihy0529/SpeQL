{
    "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n  ,rank_within_parent\n  limit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY36A.TPL QUERY 21 IN STREAM 0 */ /* TPC-DS QUERY36A.TPL 0.21 */ WITH RESULTS AS ( SELECT SUM ( SS_NET_PROFIT ) AS SS_NET_PROFIT , SUM ( SS_EXT_SALES_PRICE ) AS SS_EXT_SALES_PRICE , SUM ( SS_NET_PROFIT ) / SUM ( SS_EXT_SALES_PRICE ) AS GROSS_MARGIN , I_CATEGORY , I_CLASS , 0 AS G_CATEGORY , 0 AS G_CLASS FROM STORE_SALES , DATE_DIM AS D1 , ITEM , STORE WHERE D1.D_YEAR = 2002 AND D1.D_DATE_SK = SS_SOLD_DATE_SK AND I_ITEM_SK = SS_ITEM_SK AND S_STORE_SK = SS_STORE_SK AND S_STATE IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) GROUP BY I_CATEGORY , I_CLASS ) , RESULTS_ROLLUP AS ( SELECT GROSS_MARGIN , I_CATEGORY , I_CLASS , 0 AS T_CATEGORY , 0 AS T_CLASS , 0 AS LOCHIERARCHY FROM RESULTS UNION SELECT SUM ( SS_NET_PROFIT ) / SUM ( SS_EXT_SALES_PRICE ) AS GROSS_MARGIN , I_CATEGORY , NULL AS I_CLASS , 0 AS T_CATEGORY , 1 AS T_CLASS , 1 AS LOCHIERARCHY FROM RESULTS GROUP BY I_CATEGORY UNION SELECT SUM ( SS_NET_PROFIT ) / SUM ( SS_EXT_SALES_PRICE ) AS GROSS_MARGIN , NULL AS I_CATEGORY , NULL AS I_CLASS , 1 AS T_CATEGORY , 1 AS T_CLASS , 2 AS LOCHIERARCHY FROM RESULTS ) SELECT GROSS_MARGIN , I_CATEGORY , I_CLASS , LOCHIERARCHY , RANK ( ) OVER ( PARTITION BY LOCHIERARCHY , CASE WHEN T_CLASS = 0 THEN I_CATEGORY END ORDER BY GROSS_MARGIN ASC NULLS FIRST ) AS RANK_WITHIN_PARENT FROM RESULTS_ROLLUP ORDER BY LOCHIERARCHY DESC NULLS LAST , CASE WHEN LOCHIERARCHY = 0 THEN I_CATEGORY END NULLS FIRST , RANK_WITHIN_PARENT NULLS FIRST LIMIT 21",
            "preview": "\n/*    gross_margin   i_category       i_class  lochierarchy  rank_within_parent\n0        -0.4334         None          None             2                   1\n1        -0.4337      Jewelry          None             1                   1\n2        -0.4336  Electronics          None             1                   2\n3        -0.4336       Sports          None             1                   2\n4        -0.4335        Shoes          None             1                   4\n5        -0.4335     Children          None             1                   4\n6        -0.4335          Men          None             1                   4\n7        -0.4333         Home          None             1                   7\n8        -0.4333        Women          None             1                   7\n9        -0.4332                       None             1                   9\n10       -0.4332        Books          None             1                   9\n11       -0.4331        Music          None             1                  11\n12       -0.5068                 basketball             0                   1\n13       -0.4932                televisions             0                   2\n14       -0.4841                      pools             0                   3\n15       -0.4838                   flatware             0                   4\n16       -0.4718                    archery             0                   5\n17       -0.4687                  maternity             0                   6\n18       -0.4649               womens watch             0                   7\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 8.311552,
                "execution_time": 8.160484,
                "compile_time": 0.001001,
                "planning_time": 0.111423
            },
            "query_metrics_warm_up": {
                "elapsed_time": 25.853324,
                "execution_time": 12.338829,
                "compile_time": 13.283466,
                "planning_time": 0.184644
            }
        }
    ],
    "preview": "\n/*    gross_margin   i_category       i_class  lochierarchy  rank_within_parent\n0        -0.4334         None          None             2                   1\n1        -0.4337      Jewelry          None             1                   1\n2        -0.4336  Electronics          None             1                   2\n3        -0.4336       Sports          None             1                   2\n4        -0.4335        Shoes          None             1                   4\n5        -0.4335     Children          None             1                   4\n6        -0.4335          Men          None             1                   4\n7        -0.4333         Home          None             1                   7\n8        -0.4333        Women          None             1                   7\n9        -0.4332                       None             1                   9\n10       -0.4332        Books          None             1                   9\n11       -0.4331        Music          None             1                  11\n12       -0.5068                 basketball             0                   1\n13       -0.4932                televisions             0                   2\n14       -0.4841                      pools             0                   3\n15       -0.4838                   flatware             0                   4\n16       -0.4718                    archery             0                   5\n17       -0.4687                  maternity             0                   6\n18       -0.4649               womens watch             0                   7\n...*/"
}