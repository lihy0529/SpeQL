{
    "input": "-- start template query51.tpl query 46 in stream 0\nWITH /* TPC-DS query51.tpl 0.46 */ web_v1 as (\nselect\n  ws_item_sk item_sk, d_date,\n  sum(sum(ws_sales_price))\n      over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom web_sales\n    ,date_dim\nwhere ws_sold_date_sk=d_date_sk\n  and d_month_seq between 1181 and 1181+11\n  and ws_item_sk is not NULL\ngroup by ws_item_sk, d_date),\nstore_v1 as (\nselect\n  ss_item_sk item_sk, d_date,\n  sum(sum(ss_sales_price))\n      over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom store_sales\n    ,date_dim\nwhere ss_sold_date_sk=d_date_sk\n  and d_month_seq between 1181 and 1181+11\n  and ss_item_sk is not NULL\ngroup by ss_item_sk, d_date)\n select  *\nfrom (select item_sk\n     ,d_date\n     ,web_sales\n     ,store_sales\n     ,max(web_sales)\n         over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative\n     ,max(store_sales)\n         over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative\n     from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk\n                 ,case when web.d_date is not null then web.d_date else store.d_date end d_date\n                 ,web.cume_sales web_sales\n                 ,store.cume_sales store_sales\n           from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk\n                                                          and web.d_date = store.d_date)\n          )x )y\nwhere web_cumulative > store_cumulative\norder by item_sk\n        ,d_date\nlimit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY51.TPL QUERY 46 IN STREAM 0 */ /* TPC-DS QUERY51.TPL 0.46 */ WITH WEB_V1 AS ( SELECT WS_ITEM_SK AS ITEM_SK , D_DATE , SUM ( SUM ( WS_SALES_PRICE ) ) OVER ( PARTITION BY WS_ITEM_SK ORDER BY D_DATE NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW ) AS CUME_SALES FROM WEB_SALES , DATE_DIM WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_MONTH_SEQ BETWEEN 1181 AND 1181 + 11 AND NOT WS_ITEM_SK IS NULL GROUP BY WS_ITEM_SK , D_DATE ) , STORE_V1 AS ( SELECT SS_ITEM_SK AS ITEM_SK , D_DATE , SUM ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY SS_ITEM_SK ORDER BY D_DATE NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW ) AS CUME_SALES FROM STORE_SALES , DATE_DIM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_MONTH_SEQ BETWEEN 1181 AND 1181 + 11 AND NOT SS_ITEM_SK IS NULL GROUP BY SS_ITEM_SK , D_DATE ) SELECT * FROM ( SELECT ITEM_SK , D_DATE , WEB_SALES , STORE_SALES , MAX ( WEB_SALES ) OVER ( PARTITION BY ITEM_SK ORDER BY D_DATE NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW ) AS WEB_CUMULATIVE , MAX ( STORE_SALES ) OVER ( PARTITION BY ITEM_SK ORDER BY D_DATE NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW ) AS STORE_CUMULATIVE FROM ( SELECT CASE WHEN NOT WEB.ITEM_SK IS NULL THEN WEB.ITEM_SK ELSE STORE.ITEM_SK END AS ITEM_SK , CASE WHEN NOT WEB.D_DATE IS NULL THEN WEB.D_DATE ELSE STORE.D_DATE END AS D_DATE , WEB.CUME_SALES AS WEB_SALES , STORE.CUME_SALES AS STORE_SALES FROM WEB_V1 AS WEB FULL OUTER JOIN STORE_V1 AS STORE ON ( WEB.ITEM_SK = STORE.ITEM_SK AND WEB.D_DATE = STORE.D_DATE ) ) AS X ) AS Y WHERE WEB_CUMULATIVE > STORE_CUMULATIVE ORDER BY ITEM_SK NULLS FIRST , D_DATE NULLS FIRST LIMIT 21",
            "preview": "\n/*    item_sk    d_date  web_sales  store_sales  web_cumulative  store_cumulative\n0         1  19980602     107.74         2.64          107.74              2.64\n1         1  19980603        NaN        61.26          107.74             61.26\n2         1  19980608        NaN        72.59          107.74             72.59\n3         1  19980610        NaN        83.00          107.74             83.00\n4         7  19980601     125.37        51.18          125.37             51.18\n5         7  19980602        NaN        89.31          125.37             89.31\n6         7  19980604        NaN        89.89          125.37             89.89\n7        10  19980605     117.20          NaN          117.20             60.57\n8        10  19980607        NaN        87.82          117.20             87.82\n9        10  19980608        NaN       105.54          117.20            105.54\n10       10  19980616     324.11          NaN          324.11            312.76\n11       13  19980603        NaN        61.84           85.61             61.84\n12       13  19980606     235.99          NaN          235.99            126.43\n13       13  19980609     351.71       129.56          351.71            129.56\n14       13  19980610     354.63          NaN          354.63            129.56\n15       13  19980611        NaN       132.52          354.63            132.52\n16       13  19980612        NaN       155.72          354.63            155.72\n17       13  19980615     362.79       181.39          362.79            181.39\n18       13  19980616        NaN       288.15          362.79            288.15\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 4.287914,
                "execution_time": 4.199738,
                "compile_time": 0.000522,
                "planning_time": 0.063088
            },
            "query_metrics_warm_up": {
                "elapsed_time": 7.804022,
                "execution_time": 4.569961,
                "compile_time": 3.068213,
                "planning_time": 0.132139
            }
        }
    ],
    "preview": "\n/*    item_sk    d_date  web_sales  store_sales  web_cumulative  store_cumulative\n0         1  19980602     107.74         2.64          107.74              2.64\n1         1  19980603        NaN        61.26          107.74             61.26\n2         1  19980608        NaN        72.59          107.74             72.59\n3         1  19980610        NaN        83.00          107.74             83.00\n4         7  19980601     125.37        51.18          125.37             51.18\n5         7  19980602        NaN        89.31          125.37             89.31\n6         7  19980604        NaN        89.89          125.37             89.89\n7        10  19980605     117.20          NaN          117.20             60.57\n8        10  19980607        NaN        87.82          117.20             87.82\n9        10  19980608        NaN       105.54          117.20            105.54\n10       10  19980616     324.11          NaN          324.11            312.76\n11       13  19980603        NaN        61.84           85.61             61.84\n12       13  19980606     235.99          NaN          235.99            126.43\n13       13  19980609     351.71       129.56          351.71            129.56\n14       13  19980610     354.63          NaN          354.63            129.56\n15       13  19980611        NaN       132.52          354.63            132.52\n16       13  19980612        NaN       155.72          354.63            155.72\n17       13  19980615     362.79       181.39          362.79            181.39\n18       13  19980616        NaN       288.15          362.79            288.15\n...*/"
}