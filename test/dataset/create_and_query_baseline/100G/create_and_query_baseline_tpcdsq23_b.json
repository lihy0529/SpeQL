{
    "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n     order by c_last_name,c_first_name,sales\n  limit 100",
    "query": [
        {
            "query": "/* TPC-DS QUERY23.TPL 0.68 PART2 */ WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) ORDER BY C_LAST_NAME NULLS FIRST , C_FIRST_NAME NULLS FIRST , SALES NULLS FIRST LIMIT 21",
            "preview": "\n/*   c_last_name c_first_name     sales\n0                     Allen  40926.69\n1                     James  33699.93\n2        Brown       Gerald  66407.44\n3         Cady    Christine  31773.92\n4     Carranza       Nathan  56084.30\n5        Davis      Stephen  32198.04\n6      Douglas       Ruthie  79293.27\n7       Glover     Reinaldo  59736.31\n8       Gordon       Esther  62977.89\n9      Herrera    Petronila  49134.95\n10       Noble         Mark  50995.14\n11     Sanchez       Sylvia  37742.21\n12       White      Marilyn  54707.13\n13       White    Thomasine  67918.74*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 18.093416,
                "execution_time": 17.758016,
                "compile_time": 0.001837,
                "planning_time": 17.961054
            },
            "query_metrics_warm_up": {
                "elapsed_time": 30.642439,
                "execution_time": 30.206474,
                "compile_time": 0.001931,
                "planning_time": 30.482277
            }
        }
    ],
    "preview": "\n/*   c_last_name c_first_name     sales\n0                     Allen  40926.69\n1                     James  33699.93\n2        Brown       Gerald  66407.44\n3         Cady    Christine  31773.92\n4     Carranza       Nathan  56084.30\n5        Davis      Stephen  32198.04\n6      Douglas       Ruthie  79293.27\n7       Glover     Reinaldo  59736.31\n8       Gordon       Esther  62977.89\n9      Herrera    Petronila  49134.95\n10       Noble         Mark  50995.14\n11     Sanchez       Sylvia  37742.21\n12       White      Marilyn  54707.13\n13       White    Thomasine  67918.74*/"
}