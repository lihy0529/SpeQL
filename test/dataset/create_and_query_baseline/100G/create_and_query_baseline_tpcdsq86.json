{
    "input": "-- start template query86a.tpl query 11 in stream 0\nwith /* TPC-DS query86a.tpl 0.11 */ results as\n( select sum(ws_net_paid) as total_sum, i_category, i_class, 0 as g_category, 0 as g_class \n from\n    web_sales\n   ,date_dim       d1\n   ,item\n where\n    d1.d_month_seq between 1205 and 1205+11\n and d1.d_date_sk = ws_sold_date_sk\n and i_item_sk  = ws_item_sk\n group by i_category,i_class\n ) ,\n\n results_rollup as\n( select total_sum ,i_category ,i_class, g_category, g_class, 0 as lochierarchy from results\n  union\n  select sum(total_sum) as total_sum, i_category, NULL as i_class, 0 as g_category, 1 as g_class, 1 as lochierarchy from results group by i_category\n  union\n  select sum(total_sum) as total_sum, NULL as i_category, NULL as i_class, 1 as g_category, 1 as g_class, 2 as lochierarchy from results)\n select \n total_sum ,i_category ,i_class, lochierarchy \n   ,rank() over (\n \tpartition by lochierarchy,\n \tcase when g_class = 0 then i_category end \n \torder by total_sum desc) as rank_within_parent\n from\n results_rollup\n order by\n   lochierarchy desc,\n   case when lochierarchy = 0 then i_category end,\n   rank_within_parent \n limit 100",
    "query": [
        {
            "query": "/* START TEMPLATE QUERY86A.TPL QUERY 11 IN STREAM 0 */ /* TPC-DS QUERY86A.TPL 0.11 */ WITH RESULTS AS ( SELECT SUM ( WS_NET_PAID ) AS TOTAL_SUM , I_CATEGORY , I_CLASS , 0 AS G_CATEGORY , 0 AS G_CLASS FROM WEB_SALES , DATE_DIM AS D1 , ITEM WHERE D1.D_MONTH_SEQ BETWEEN 1205 AND 1205 + 11 AND D1.D_DATE_SK = WS_SOLD_DATE_SK AND I_ITEM_SK = WS_ITEM_SK GROUP BY I_CATEGORY , I_CLASS ) , RESULTS_ROLLUP AS ( SELECT TOTAL_SUM , I_CATEGORY , I_CLASS , G_CATEGORY , G_CLASS , 0 AS LOCHIERARCHY FROM RESULTS UNION SELECT SUM ( TOTAL_SUM ) AS TOTAL_SUM , I_CATEGORY , NULL AS I_CLASS , 0 AS G_CATEGORY , 1 AS G_CLASS , 1 AS LOCHIERARCHY FROM RESULTS GROUP BY I_CATEGORY UNION SELECT SUM ( TOTAL_SUM ) AS TOTAL_SUM , NULL AS I_CATEGORY , NULL AS I_CLASS , 1 AS G_CATEGORY , 1 AS G_CLASS , 2 AS LOCHIERARCHY FROM RESULTS ) SELECT TOTAL_SUM , I_CATEGORY , I_CLASS , LOCHIERARCHY , RANK ( ) OVER ( PARTITION BY LOCHIERARCHY , CASE WHEN G_CLASS = 0 THEN I_CATEGORY END ORDER BY TOTAL_SUM DESC NULLS LAST ) AS RANK_WITHIN_PARENT FROM RESULTS_ROLLUP ORDER BY LOCHIERARCHY DESC NULLS LAST , CASE WHEN LOCHIERARCHY = 0 THEN I_CATEGORY END NULLS FIRST , RANK_WITHIN_PARENT NULLS FIRST LIMIT 21",
            "preview": "\n/*       total_sum   i_category     i_class  lochierarchy  rank_within_parent\n0   3.294251e+10         None        None             2                   1\n1   3.332718e+09       Sports        None             1                   1\n2   3.295124e+09     Children        None             1                   2\n3   3.293035e+09        Music        None             1                   3\n4   3.292112e+09  Electronics        None             1                   4\n5   3.287496e+09        Women        None             1                   5\n6   3.281394e+09        Books        None             1                   6\n7   3.277926e+09        Shoes        None             1                   7\n8   3.274327e+09         Home        None             1                   8\n9   3.268762e+09      Jewelry        None             1                   9\n10  3.257970e+09          Men        None             1                  10\n11  8.165172e+07                     None             1                  11\n12  4.225234e+07                                      0                   1\n13  1.818782e+06                  dresses             0                   2\n14  1.724469e+06                 swimwear             0                   3\n15  1.597705e+06                   womens             0                   4\n16  1.448090e+06                 athletic             0                   5\n17  1.422952e+06                  newborn             0                   6\n18  1.395445e+06               fragrances             0                   7\n...*/",
            "retry_time": 0,
            "query_metrics": {
                "elapsed_time": 0.436325,
                "execution_time": 0.316693,
                "compile_time": 0.000767,
                "planning_time": 0.087342
            },
            "query_metrics_warm_up": {
                "elapsed_time": 1.009756,
                "execution_time": 0.819898,
                "compile_time": 0.000819,
                "planning_time": 0.155577
            }
        }
    ],
    "preview": "\n/*       total_sum   i_category     i_class  lochierarchy  rank_within_parent\n0   3.294251e+10         None        None             2                   1\n1   3.332718e+09       Sports        None             1                   1\n2   3.295124e+09     Children        None             1                   2\n3   3.293035e+09        Music        None             1                   3\n4   3.292112e+09  Electronics        None             1                   4\n5   3.287496e+09        Women        None             1                   5\n6   3.281394e+09        Books        None             1                   6\n7   3.277926e+09        Shoes        None             1                   7\n8   3.274327e+09         Home        None             1                   8\n9   3.268762e+09      Jewelry        None             1                   9\n10  3.257970e+09          Men        None             1                  10\n11  8.165172e+07                     None             1                  11\n12  4.225234e+07                                      0                   1\n13  1.818782e+06                  dresses             0                   2\n14  1.724469e+06                 swimwear             0                   3\n15  1.597705e+06                   womens             0                   4\n16  1.448090e+06                 athletic             0                   5\n17  1.422952e+06                  newborn             0                   6\n18  1.395445e+06               fragrances             0                   7\n...*/"
}