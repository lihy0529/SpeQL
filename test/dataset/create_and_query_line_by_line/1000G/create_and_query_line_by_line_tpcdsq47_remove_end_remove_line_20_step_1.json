[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name,\n        v1.d_year, v1.d_moy,\n        v1.avg_monthly_sales,\n        v1.sum_sales, lag(v1.sum_sales) over \n          (partition by v1.i_category, v1.i_brand, v1.s_store_name, v1.s_company_name order by v1.d_year, v1.d_moy) psum, \n        lead(v1.sum_sales) over \n          (partition by v1.i_category, v1.i_brand, v1.s_store_name, v1.s_company_name order by v1.d_year, v1.d_moy) nsum\n from v1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) , \"V2\" AS ( SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , LAG ( \"V1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"V1\".\"I_CATEGORY\" , \"V1\".\"I_BRAND\" , \"V1\".\"S_STORE_NAME\" , \"V1\".\"S_COMPANY_NAME\" ORDER BY \"V1\".\"D_YEAR\" NULLS LAST , \"V1\".\"D_MOY\" NULLS LAST ) AS \"PSUM\" , LEAD ( \"V1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"V1\".\"I_CATEGORY\" , \"V1\".\"I_BRAND\" , \"V1\".\"S_STORE_NAME\" , \"V1\".\"S_COMPANY_NAME\" ORDER BY \"V1\".\"D_YEAR\" NULLS LAST , \"V1\".\"D_MOY\" NULLS LAST ) AS \"NSUM\" FROM \"V1\" AS \"V1\" ) SELECT \"V2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V2\".\"D_YEAR\" AS \"D_YEAR\" , \"V2\".\"D_MOY\" AS \"D_MOY\" , \"V2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V2\".\"PSUM\" AS \"PSUM\" , \"V2\".\"NSUM\" AS \"NSUM\" FROM \"V2\" AS \"V2\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 18.969076,
                    "execution_time": 18.537778,
                    "compile_time": 0.00068,
                    "planning_time": 0.057776,
                    "create_size": 1408
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 20.637199,
                    "execution_time": 20.116318,
                    "compile_time": 0.007338,
                    "planning_time": 0.13898,
                    "create_size": 1408
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , LAG ( \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_COMPANY_NAME\" ORDER BY \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" NULLS LAST ) AS \"PSUM\" , LEAD ( \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_COMPANY_NAME\" ORDER BY \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" NULLS LAST ) AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.543572,
                    "execution_time": 0.118129,
                    "compile_time": 0.000491,
                    "planning_time": 0.006141,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.611444,
                    "execution_time": 0.113964,
                    "compile_time": 0.007021,
                    "planning_time": 0.071738,
                    "create_size": 1280
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_2\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales    sum_sales         psum         nsum\n0           ese    2001     11         5547610.19  10698516.01   7515071.18  11362574.45\n1           ese    2001     12         5547610.19  11362574.45  10698516.01   2611945.46\n2           ese    2002      1         2611945.46   2611945.46  11362574.45          NaN\n3         ought    2000     12         3800123.77   3800123.77          NaN   1757829.61\n4         ought    2001      1         2775794.64   1757829.61   3800123.77   1495780.62\n5         ought    2001      2         2775794.64   1495780.62   1757829.61   1601407.70\n6         ought    2001      3         2775794.64   1601407.70   1495780.62   1588817.38\n7         ought    2001      4         2775794.64   1588817.38   1601407.70   1627040.51\n8         ought    2001      5         2775794.64   1627040.51   1588817.38   1591129.18\n9         ought    2001      6         2775794.64   1591129.18   1627040.51   1638588.02\n10        ought    2001      7         2775794.64   1638588.02   1591129.18   3610550.80\n11        ought    2001      8         2775794.64   3610550.80   1638588.02   3630767.40\n12        ought    2001      9         2775794.64   3630767.40   3610550.80   3735425.32\n13        ought    2001     10         2775794.64   3735425.32   3630767.40   5340944.79\n14        ought    2001     11         2775794.64   5340944.79   3735425.32   5691254.36\n15        ought    2001     12         2775794.64   5691254.36   5340944.79   1298295.43\n16        ought    2002      1         1298295.43   1298295.43   5691254.36          NaN\n17          ese    2000     12           57953.60     57953.60          NaN     19173.21\n18          ese    2002      1           19173.21     19173.21     57953.60          NaN\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018252,
                    "execution_time": 0.007929,
                    "compile_time": 4.8e-05,
                    "planning_time": 0.004091
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.056738,
                    "execution_time": 0.008341,
                    "compile_time": 0.000993,
                    "planning_time": 0.039136
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_2\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_2\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales    sum_sales         psum         nsum\n0           ese    2001     11         5547610.19  10698516.01   7515071.18  11362574.45\n1           ese    2001     12         5547610.19  11362574.45  10698516.01   2611945.46\n2           ese    2002      1         2611945.46   2611945.46  11362574.45          NaN\n3         ought    2000     12         3800123.77   3800123.77          NaN   1757829.61\n4         ought    2001      1         2775794.64   1757829.61   3800123.77   1495780.62\n5         ought    2001      2         2775794.64   1495780.62   1757829.61   1601407.70\n6         ought    2001      3         2775794.64   1601407.70   1495780.62   1588817.38\n7         ought    2001      4         2775794.64   1588817.38   1601407.70   1627040.51\n8         ought    2001      5         2775794.64   1627040.51   1588817.38   1591129.18\n9         ought    2001      6         2775794.64   1591129.18   1627040.51   1638588.02\n10        ought    2001      7         2775794.64   1638588.02   1591129.18   3610550.80\n11        ought    2001      8         2775794.64   3610550.80   1638588.02   3630767.40\n12        ought    2001      9         2775794.64   3630767.40   3610550.80   3735425.32\n13        ought    2001     10         2775794.64   3735425.32   3630767.40   5340944.79\n14        ought    2001     11         2775794.64   5340944.79   3735425.32   5691254.36\n15        ought    2001     12         2775794.64   5691254.36   5340944.79   1298295.43\n16        ought    2002      1         1298295.43   1298295.43   5691254.36          NaN\n17          ese    2000     12           57953.60     57953.60          NaN     19173.21\n18          ese    2002      1           19173.21     19173.21     57953.60          NaN\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\nwhere v1.s_store_name = v1_lag.s_store_name\nand v1.s_store_name = v1_lead.s_store_name\nand v1_lag.d_year = v1.d_year\nand v1_lead.d_year = v1.d_year\nand v1_lag.d_moy = v1.d_moy - 1\nand v1_lead.d_moy = v1.d_moy + 1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1_LAG.D_YEAR = V1.D_YEAR AND V1_LEAD.D_YEAR = V1.D_YEAR AND V1_LAG.D_MOY = V1.D_MOY - 1 AND V1_LEAD.D_MOY = V1.D_MOY + 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum    nsum\n0          able    2001      3          262529.83  149972.22    5332.53  606.55\n1          able    2001      3          262529.83  149972.22  155956.35  606.55\n2          able    2001      3          262529.83  149972.22  123718.41  606.55\n3          able    2001      3          262529.83  149972.22  203200.60  606.55\n4          able    2001      3          262529.83  149972.22  118515.67  606.55\n5          able    2001      3          262529.83  149972.22   43374.89  606.55\n6          able    2001      3          262529.83  149972.22   44806.16  606.55\n7          able    2001      3          262529.83  149972.22  159693.20  606.55\n8          able    2001      3          262529.83  149972.22     453.37  606.55\n9          able    2001      3          262529.83  149972.22    1219.90  606.55\n10         able    2001      3          262529.83  149972.22    1942.54  606.55\n11         able    2001      3          262529.83  149972.22   38037.72  606.55\n12         able    2001      3          262529.83  149972.22   35189.51  606.55\n13         able    2001      3          262529.83  149972.22   47351.20  606.55\n14         able    2001      3          262529.83  149972.22   50835.40  606.55\n15         able    2001      3          262529.83  149972.22   55504.24  606.55\n16         able    2001      3          262529.83  149972.22   55108.61  606.55\n17         able    2001      3          262529.83  149972.22   42437.40  606.55\n18         able    2001      3          262529.83  149972.22   42150.58  606.55\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 39.718857,
                    "execution_time": 39.359355,
                    "compile_time": 0.000944,
                    "planning_time": 19.151246
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 44.590369,
                    "execution_time": 44.141871,
                    "compile_time": 0.014252,
                    "planning_time": 20.954337
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum    nsum\n0          able    2001      3          262529.83  149972.22    5332.53  606.55\n1          able    2001      3          262529.83  149972.22  155956.35  606.55\n2          able    2001      3          262529.83  149972.22  123718.41  606.55\n3          able    2001      3          262529.83  149972.22  203200.60  606.55\n4          able    2001      3          262529.83  149972.22  118515.67  606.55\n5          able    2001      3          262529.83  149972.22   43374.89  606.55\n6          able    2001      3          262529.83  149972.22   44806.16  606.55\n7          able    2001      3          262529.83  149972.22  159693.20  606.55\n8          able    2001      3          262529.83  149972.22     453.37  606.55\n9          able    2001      3          262529.83  149972.22    1219.90  606.55\n10         able    2001      3          262529.83  149972.22    1942.54  606.55\n11         able    2001      3          262529.83  149972.22   38037.72  606.55\n12         able    2001      3          262529.83  149972.22   35189.51  606.55\n13         able    2001      3          262529.83  149972.22   47351.20  606.55\n14         able    2001      3          262529.83  149972.22   50835.40  606.55\n15         able    2001      3          262529.83  149972.22   55504.24  606.55\n16         able    2001      3          262529.83  149972.22   55108.61  606.55\n17         able    2001      3          262529.83  149972.22   42437.40  606.55\n18         able    2001      3          262529.83  149972.22   42150.58  606.55\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n/*CURSOR_IDENTIFIER*/ v1.i_brand = v1_lag.i_brand\n and v1.s_store_name = v1_lag.s_store_name\n and v1.s_company_name = v1_lag.s_company_name\n and v1.d_year = v1_lag.d_year + 1\n and v1.i_category = v1_lead.i_category\n and v1.i_brand = v1_lead.i_brand\n and v1.s_store_name = v1_lead.s_store_name\n and v1.s_company_name = v1_lead.s_company_name\n and v1.d_year + 1 = v1_lead.d_year\n and v1.d_moy = 12\n) \nselect * from v2\norder by s_store_name, d_year, d_moy;",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.D_YEAR = V1_LAG.D_YEAR + 1 AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.D_YEAR + 1 = V1_LEAD.D_YEAR AND V1.D_MOY = 12 ) SELECT * FROM V2 ORDER BY S_STORE_NAME NULLS FIRST , D_YEAR NULLS FIRST , D_MOY NULLS FIRST LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001     12            3724.55    7201.86    8817.94    2200.16\n1                  2001     12            4995.98    9713.98    9028.19    3036.45\n2                  2001     12            3860.08    6331.43    6765.18    2232.12\n3                  2001     12            4123.40    8973.00    7592.94    3412.99\n4                  2001     12           11395.20   24597.86   15056.49    5823.77\n5                  2001     12           15550.48   31036.27   18482.53    6676.43\n6                  2001     12           11317.43   23031.92   14552.99    7073.34\n7                  2001     12           12459.60   25680.73   18954.64    4446.10\n8                  2001     12           13256.08   27269.99   16883.64    7010.99\n9                  2001     12              62.61      42.32     154.61     108.24\n10                 2001     12            2875.65    5372.77    7512.76    2375.22\n11                 2001     12           15287.00   32242.62   22493.02    7563.82\n12                 2001     12          246474.13  503849.02  339888.49  114681.75\n13                 2001     12           13844.07   27156.04   21694.96    6578.43\n14                 2001     12           15611.39   32668.73   21707.45    6975.65\n15                 2001     12          249847.56  504437.57  332598.49  122982.71\n16                 2001     12            3733.64    7046.75    7266.62    2604.41\n17                 2001     12           13045.66   26767.74   19104.39    6863.48\n18                 2001     12            3894.83    7180.07    8960.57    2683.93\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 45.219777,
                    "execution_time": 44.710455,
                    "compile_time": 0.001002,
                    "planning_time": 22.372012
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 47.423971,
                    "execution_time": 46.862716,
                    "compile_time": 0.012597,
                    "planning_time": 24.325742
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001     12            3724.55    7201.86    8817.94    2200.16\n1                  2001     12            4995.98    9713.98    9028.19    3036.45\n2                  2001     12            3860.08    6331.43    6765.18    2232.12\n3                  2001     12            4123.40    8973.00    7592.94    3412.99\n4                  2001     12           11395.20   24597.86   15056.49    5823.77\n5                  2001     12           15550.48   31036.27   18482.53    6676.43\n6                  2001     12           11317.43   23031.92   14552.99    7073.34\n7                  2001     12           12459.60   25680.73   18954.64    4446.10\n8                  2001     12           13256.08   27269.99   16883.64    7010.99\n9                  2001     12              62.61      42.32     154.61     108.24\n10                 2001     12            2875.65    5372.77    7512.76    2375.22\n11                 2001     12           15287.00   32242.62   22493.02    7563.82\n12                 2001     12          246474.13  503849.02  339888.49  114681.75\n13                 2001     12           13844.07   27156.04   21694.96    6578.43\n14                 2001     12           15611.39   32668.73   21707.45    6975.65\n15                 2001     12          249847.56  504437.57  332598.49  122982.71\n16                 2001     12            3733.64    7046.75    7266.62    2604.41\n17                 2001     12           13045.66   26767.74   19104.39    6863.48\n18                 2001     12            3894.83    7180.07    8960.57    2683.93\n...*/"
    },
    {
        "input": "with /* TPC-DS query47.tpl 0.42 */ v1 as (\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from store_sales, item, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy\n),\nv2 as (\n  select v1.s_store_name, v1.d_year, v1.d_moy,\n         v1.avg_monthly_sales, v1.sum_sales, \n         v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n  from v1\n  left join v1 v1_lag \n    on v1.i_category = v1_lag.i_category \n    and v1.s_store_name = v1_lag.s_store_name\n    and v1.d_year = v1_lag.d_year \n    and v1.d_moy = v1_lag.d_moy + 1\n  left join v1 v1_lead \n    on v1.i_category = v1_lead.i_category \n    and v1.s_store_name = v1_lead.s_store_name\n    and v1.d_year = v1_lead.d_year \n    and v1.d_moy = v1_lead.d_moy - 1\n  where v1.rn = 1\n)\nselect * from v2;\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" LEFT JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"V1\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" LEFT JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"V1\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"V1\".\"RN\" = 1"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 21.846843,
                    "execution_time": 21.434976,
                    "compile_time": 0.000723,
                    "planning_time": 0.066865,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 27.923306,
                    "execution_time": 22.383424,
                    "compile_time": 5.070849,
                    "planning_time": 0.136904,
                    "create_size": 1280
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_3\".\"RN\" = 1",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.254079,
                    "execution_time": 0.182163,
                    "compile_time": 0.000568,
                    "planning_time": 0.012735,
                    "create_size": 119
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.492729,
                    "execution_time": 0.179463,
                    "compile_time": 0.179178,
                    "planning_time": 0.071623,
                    "create_size": 119
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_4\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales  psum     nsum\n0                  2002      1              96.70      96.70  None      NaN\n1          anti    2001      1             715.47     550.23  None   467.01\n2          anti    2001      1             715.47     550.23  None   372.57\n3          anti    2001      1             715.47     550.23  None   305.83\n4          anti    2001      1             715.47     550.23  None   261.59\n5          anti    2001      1             715.47     550.23  None   376.50\n6          anti    2001      1             715.47     550.23  None   503.76\n7          anti    2001      1             715.47     550.23  None   656.78\n8          anti    2001      1             715.47     550.23  None   476.51\n9          anti    2001      1             715.47     550.23  None   366.89\n10         anti    2001      1             715.47     550.23  None   250.04\n11         anti    2001      1             715.47     550.23  None   127.69\n12         anti    2001      1             715.47     550.23  None   423.52\n13         anti    2001      1             715.47     550.23  None  1020.52\n14         anti    2001      1             715.47     550.23  None   802.42\n15         anti    2001      1             715.47     550.23  None  1436.16\n16         anti    2001      1             715.47     550.23  None  2312.74\n17         anti    2001      1             715.47     550.23  None   110.60\n18         anti    2001      1             715.47     550.23  None   652.86\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017597,
                    "execution_time": 0.00716,
                    "compile_time": 4.8e-05,
                    "planning_time": 0.003988
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.055682,
                    "execution_time": 0.007407,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.039837
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_3\".\"RN\" = 1",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_4\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales  psum     nsum\n0                  2002      1              96.70      96.70  None      NaN\n1          anti    2001      1             715.47     550.23  None   467.01\n2          anti    2001      1             715.47     550.23  None   372.57\n3          anti    2001      1             715.47     550.23  None   305.83\n4          anti    2001      1             715.47     550.23  None   261.59\n5          anti    2001      1             715.47     550.23  None   376.50\n6          anti    2001      1             715.47     550.23  None   503.76\n7          anti    2001      1             715.47     550.23  None   656.78\n8          anti    2001      1             715.47     550.23  None   476.51\n9          anti    2001      1             715.47     550.23  None   366.89\n10         anti    2001      1             715.47     550.23  None   250.04\n11         anti    2001      1             715.47     550.23  None   127.69\n12         anti    2001      1             715.47     550.23  None   423.52\n13         anti    2001      1             715.47     550.23  None  1020.52\n14         anti    2001      1             715.47     550.23  None   802.42\n15         anti    2001      1             715.47     550.23  None  1436.16\n16         anti    2001      1             715.47     550.23  None  2312.74\n17         anti    2001      1             715.47     550.23  None   110.60\n18         anti    2001      1             715.47     550.23  None   652.86\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.d_year = v1_lag.d_year and\n       v1.d_year = v1_lead.d_year and\n       v1.d_moy = v1_lag.d_moy + 1 and\n       v1.d_moy = v1_lead.d_moy - 1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.D_YEAR = V1_LAG.D_YEAR AND V1.D_YEAR = V1_LEAD.D_YEAR AND V1.D_MOY = V1_LAG.D_MOY + 1 AND V1.D_MOY = V1_LEAD.D_MOY - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      4           11843.10    7043.85    6108.81    6995.49\n1                  2001      8           11843.10   14970.26    7677.08   13856.30\n2                  2001      9           11843.10   13856.30   14970.26   16952.59\n3                  2001      7           11843.10    7677.08    6925.74   14970.26\n4                  2001     11           11843.10   22802.75   16952.59   25338.63\n5                  2001      5           11843.10    6995.49    7043.85    6925.74\n6                  2001      3           11843.10    6108.81    6537.07    7043.85\n7                  2001      6           11843.10    6925.74    6995.49    7677.08\n8                  2001      2           11843.10    6537.07    6908.66    6108.81\n9                  2001     10           11843.10   16952.59   13856.30   22802.75\n10          ese    2001      8          259306.66  341085.37  150221.19  333972.44\n11          ese    2001     11          259306.66  498152.40  358358.79  534298.58\n12          ese    2001      3          259306.66  148553.59  138537.53  143466.79\n13          ese    2001      6          259306.66  148528.54  153479.97  150221.19\n14          ese    2001      4          259306.66  143466.79  148553.59  153479.97\n15          ese    2001      9          259306.66  333972.44  341085.37  358358.79\n16          ese    2001     10          259306.66  358358.79  333972.44  498152.40\n17          ese    2001      5          259306.66  153479.97  143466.79  148528.54\n18          ese    2001      7          259306.66  150221.19  148528.54  341085.37\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 43.857456,
                    "execution_time": 43.346992,
                    "compile_time": 0.001074,
                    "planning_time": 22.055824
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 43.505565,
                    "execution_time": 42.921727,
                    "compile_time": 0.009606,
                    "planning_time": 22.059074
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      4           11843.10    7043.85    6108.81    6995.49\n1                  2001      8           11843.10   14970.26    7677.08   13856.30\n2                  2001      9           11843.10   13856.30   14970.26   16952.59\n3                  2001      7           11843.10    7677.08    6925.74   14970.26\n4                  2001     11           11843.10   22802.75   16952.59   25338.63\n5                  2001      5           11843.10    6995.49    7043.85    6925.74\n6                  2001      3           11843.10    6108.81    6537.07    7043.85\n7                  2001      6           11843.10    6925.74    6995.49    7677.08\n8                  2001      2           11843.10    6537.07    6908.66    6108.81\n9                  2001     10           11843.10   16952.59   13856.30   22802.75\n10          ese    2001      8          259306.66  341085.37  150221.19  333972.44\n11          ese    2001     11          259306.66  498152.40  358358.79  534298.58\n12          ese    2001      3          259306.66  148553.59  138537.53  143466.79\n13          ese    2001      6          259306.66  148528.54  153479.97  150221.19\n14          ese    2001      4          259306.66  143466.79  148553.59  153479.97\n15          ese    2001      9          259306.66  333972.44  341085.37  358358.79\n16          ese    2001     10          259306.66  358358.79  333972.44  498152.40\n17          ese    2001      5          259306.66  153479.97  143466.79  148528.54\n18          ese    2001      7          259306.66  150221.19  148528.54  341085.37\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1\n join v1 as v1_lag on v1.i_category = v1_lag.i_category and\n                      v1.i_brand = v1_lag.i_brand and\n                      v1.s_store_name = v1_lag.s_store_name and\n                      v1.d_year = v1_lag.d_year - 1\n join v1 as v1_lead on v1.i_category = v1_lead.i_category and\n                       v1.i_brand = v1_lead.i_brand and\n                       v1.s_store_name = v1_lead.s_store_name and\n                       v1.d_year = v1_lead.d_year + 1\nwhere v1.d_moy between 1 and 12\n/*CURSOR_IDENTIFIER*/\n) \nselect * from v2;",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" - 1 AND \"V1\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" + 1 AND \"V1\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"V1\".\"D_MOY\" <= 12 AND \"V1\".\"D_MOY\" >= 1"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_BRAND\" AS \"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.444331,
                    "execution_time": 0.092977,
                    "compile_time": 0.000369,
                    "planning_time": 0.003793,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.70202,
                    "execution_time": 0.091923,
                    "compile_time": 0.18917,
                    "planning_time": 0.062107,
                    "create_size": 1280
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_5\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_5\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" - 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" + 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" <= 12 AND \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" >= 1",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.704552,
                    "execution_time": 0.139397,
                    "compile_time": 0.016987,
                    "planning_time": 0.011712,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 4.039164,
                    "execution_time": 0.139739,
                    "compile_time": 3.289327,
                    "planning_time": 0.070493,
                    "create_size": 1280
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_6\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_6\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_6\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          anti    2001     10             630.44    1124.52   414.86  1338.26\n1          anti    2001      9             630.44    1024.34   414.86  1338.26\n2          anti    2001      7             630.44     186.48   414.86  1338.26\n3          anti    2001      1             630.44     586.98   414.86  1338.26\n4          able    2001      5            4597.80    3371.35  2206.99  9959.06\n5          able    2001      3            4597.80    3033.37  2206.99  9959.06\n6          able    2001      6            4597.80    2280.62  2206.99  9959.06\n7          able    2001      2            4597.80    2078.68  2206.99  9959.06\n8          able    2001      1            4597.80    3494.73  2206.99  9959.06\n9          able    2001      8            4597.80    7133.31  2206.99  9959.06\n10         able    2001      7            4597.80    2635.95  2206.99  9959.06\n11         able    2001      4            4597.80    2799.10  2206.99  9959.06\n12         able    2001     10            4597.80    6417.30  2206.99  9959.06\n13         able    2001      9            4597.80    5094.02  2206.99  9959.06\n14         able    2001     12            4597.80    8424.50  2206.99  9959.06\n15         able    2001     11            4597.80    8410.68  2206.99  9959.06\n16         anti    2001      2            2233.24    1131.40  1157.29  3968.20\n17         anti    2001      1            2233.24     888.40  1157.29  3968.20\n18         anti    2001      3            2233.24    1161.38  1157.29  3968.20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018005,
                    "execution_time": 0.007496,
                    "compile_time": 4.8e-05,
                    "planning_time": 0.004261
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.056175,
                    "execution_time": 0.008553,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.039359
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_5\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_5\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" - 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" + 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" <= 12 AND \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" >= 1",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_6\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_6\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_6\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          anti    2001     10             630.44    1124.52   414.86  1338.26\n1          anti    2001      9             630.44    1024.34   414.86  1338.26\n2          anti    2001      7             630.44     186.48   414.86  1338.26\n3          anti    2001      1             630.44     586.98   414.86  1338.26\n4          able    2001      5            4597.80    3371.35  2206.99  9959.06\n5          able    2001      3            4597.80    3033.37  2206.99  9959.06\n6          able    2001      6            4597.80    2280.62  2206.99  9959.06\n7          able    2001      2            4597.80    2078.68  2206.99  9959.06\n8          able    2001      1            4597.80    3494.73  2206.99  9959.06\n9          able    2001      8            4597.80    7133.31  2206.99  9959.06\n10         able    2001      7            4597.80    2635.95  2206.99  9959.06\n11         able    2001      4            4597.80    2799.10  2206.99  9959.06\n12         able    2001     10            4597.80    6417.30  2206.99  9959.06\n13         able    2001      9            4597.80    5094.02  2206.99  9959.06\n14         able    2001     12            4597.80    8424.50  2206.99  9959.06\n15         able    2001     11            4597.80    8410.68  2206.99  9959.06\n16         anti    2001      2            2233.24    1131.40  1157.29  3968.20\n17         anti    2001      1            2233.24     888.40  1157.29  3968.20\n18         anti    2001      3            2233.24    1161.38  1157.29  3968.20\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy = 12) or\n         ( d_year = 2001+1 and d_moy = 1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1, v1 as v1_lag, v1 as v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      1           11918.52    7839.12   24834.68    6290.75\n1                  2001      2           11918.52    6290.75    7839.12    6638.66\n2                  2001      3           11918.52    6638.66    6290.75    5577.47\n3                  2001      4           11918.52    5577.47    6638.66    6841.77\n4                  2001      5           11918.52    6841.77    5577.47    5802.33\n5                  2001      6           11918.52    5802.33    6841.77    6911.17\n6                  2001      7           11918.52    6911.17    5802.33   16921.81\n7                  2001      8           11918.52   16921.81    6911.17   14419.18\n8                  2001      9           11918.52   14419.18   16921.81   17156.13\n9                  2001     10           11918.52   17156.13   14419.18   23353.56\n10                 2001     11           11918.52   23353.56   17156.13   25270.32\n11                 2001     12           11918.52   25270.32   23353.56    8873.87\n12         able    2001      1          262529.83  169615.94  544269.43  139879.84\n13         able    2001      2          262529.83  139879.84  169615.94  149972.22\n14         able    2001      3          262529.83  149972.22  139879.84  152150.28\n15         able    2001      4          262529.83  152150.28  149972.22  151250.18\n16         able    2001      5          262529.83  151250.18  152150.28  151978.92\n17         able    2001      6          262529.83  151978.92  151250.18  149998.74\n18         able    2001      7          262529.83  149998.74  151978.92  343896.25\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 37.129088,
                    "execution_time": 36.70022,
                    "compile_time": 0.001057,
                    "planning_time": 18.63977
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 38.511443,
                    "execution_time": 38.003122,
                    "compile_time": 0.014473,
                    "planning_time": 20.057301
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      1           11918.52    7839.12   24834.68    6290.75\n1                  2001      2           11918.52    6290.75    7839.12    6638.66\n2                  2001      3           11918.52    6638.66    6290.75    5577.47\n3                  2001      4           11918.52    5577.47    6638.66    6841.77\n4                  2001      5           11918.52    6841.77    5577.47    5802.33\n5                  2001      6           11918.52    5802.33    6841.77    6911.17\n6                  2001      7           11918.52    6911.17    5802.33   16921.81\n7                  2001      8           11918.52   16921.81    6911.17   14419.18\n8                  2001      9           11918.52   14419.18   16921.81   17156.13\n9                  2001     10           11918.52   17156.13   14419.18   23353.56\n10                 2001     11           11918.52   23353.56   17156.13   25270.32\n11                 2001     12           11918.52   25270.32   23353.56    8873.87\n12         able    2001      1          262529.83  169615.94  544269.43  139879.84\n13         able    2001      2          262529.83  139879.84  169615.94  149972.22\n14         able    2001      3          262529.83  149972.22  139879.84  152150.28\n15         able    2001      4          262529.83  152150.28  149972.22  151250.18\n16         able    2001      5          262529.83  151250.18  152150.28  151978.92\n17         able    2001      6          262529.83  151978.92  151250.18  149998.74\n18         able    2001      7          262529.83  149998.74  151978.92  343896.25\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2000 and d_moy =12) or\n         ( d_year = 2002 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name,\n        v1.d_year, v1.d_moy,\n        v1.avg_monthly_sales,\n        v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1\n join v1 as v1_lag on v1.i_category = v1_lag.i_category and\n                      v1.i_brand = v1_lag.i_brand and\n                      v1.s_store_name = v1_lag.s_store_name and\n                      v1.s_company_name = v1_lag.s_company_name and\n                      v1.rn = v1_lag.rn + 1\n join v1 as v1_lead on v1.i_category = v1_lead.i_category and\n                       v1.i_brand = v1_lead.i_brand and\n                       v1.s_store_name = v1_lead.s_store_name and\n                       v1.s_company_name = v1_lead.s_company_name and\n                       v1.rn = v1_lead.rn - 1\n)\nselect *\nfrom v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 AND \"V1\".\"S_COMPANY_NAME\" = \"V1_LAG\".\"S_COMPANY_NAME\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"V1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 AND \"V1\".\"S_COMPANY_NAME\" = \"V1_LEAD\".\"S_COMPANY_NAME\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 20.564944,
                    "execution_time": 20.100602,
                    "compile_time": 0.000759,
                    "planning_time": 0.062201,
                    "create_size": 1536
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 19.760727,
                    "execution_time": 19.217035,
                    "compile_time": 0.005328,
                    "planning_time": 0.138262,
                    "create_size": 1536
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_7\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_7\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LAG\".\"RN\" + 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LAG\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LEAD\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.474741,
                    "execution_time": 0.110184,
                    "compile_time": 0.00042,
                    "planning_time": 0.011576,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.835629,
                    "execution_time": 0.231229,
                    "compile_time": 0.171605,
                    "planning_time": 0.071708,
                    "create_size": 1280
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_8\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_8\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0           bar    2001      9            1497.80    1390.70  2041.05  1724.67\n1           bar    2001     10            1497.80    1724.67  1390.70  2739.47\n2           bar    2001     11            1497.80    2739.47  1724.67  2799.15\n3           bar    2001     12            1497.80    2799.15  2739.47  1176.73\n4           ese    2001      1            1405.14    1045.78  2294.21   782.76\n5           ese    2001      2            1405.14     782.76  1045.78   614.14\n6           ese    2001      3            1405.14     614.14   782.76   824.04\n7           ese    2001      4            1405.14     824.04   614.14   418.41\n8           ese    2001      5            1405.14     418.41   824.04  1011.74\n9           ese    2001      6            1405.14    1011.74   418.41  1379.93\n10          ese    2001      7            1405.14    1379.93  1011.74  2131.39\n11          ese    2001      8            1405.14    2131.39  1379.93  1528.25\n12          ese    2001      9            1405.14    1528.25  2131.39  2069.83\n13          ese    2001     10            1405.14    2069.83  1528.25  1961.67\n14          ese    2001     11            1405.14    1961.67  2069.83  3093.77\n15          ese    2001     12            1405.14    3093.77  1961.67   921.01\n16        cally    2001      2            1352.43     900.31   603.07   863.67\n17        cally    2001      3            1352.43     863.67   900.31   612.98\n18        cally    2001      4            1352.43     612.98   863.67   721.94\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018074,
                    "execution_time": 0.007794,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.003988
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.055578,
                    "execution_time": 0.008213,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.039779
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_7\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_7\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LAG\".\"RN\" + 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LAG\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LEAD\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_8\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_8\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0           bar    2001      9            1497.80    1390.70  2041.05  1724.67\n1           bar    2001     10            1497.80    1724.67  1390.70  2739.47\n2           bar    2001     11            1497.80    2739.47  1724.67  2799.15\n3           bar    2001     12            1497.80    2799.15  2739.47  1176.73\n4           ese    2001      1            1405.14    1045.78  2294.21   782.76\n5           ese    2001      2            1405.14     782.76  1045.78   614.14\n6           ese    2001      3            1405.14     614.14   782.76   824.04\n7           ese    2001      4            1405.14     824.04   614.14   418.41\n8           ese    2001      5            1405.14     418.41   824.04  1011.74\n9           ese    2001      6            1405.14    1011.74   418.41  1379.93\n10          ese    2001      7            1405.14    1379.93  1011.74  2131.39\n11          ese    2001      8            1405.14    2131.39  1379.93  1528.25\n12          ese    2001      9            1405.14    1528.25  2131.39  2069.83\n13          ese    2001     10            1405.14    2069.83  1528.25  1961.67\n14          ese    2001     11            1405.14    1961.67  2069.83  3093.77\n15          ese    2001     12            1405.14    3093.77  1961.67   921.01\n16        cally    2001      2            1352.43     900.31   603.07   863.67\n17        cally    2001      3            1352.43     863.67   900.31   612.98\n18        cally    2001      4            1352.43     612.98   863.67   721.94\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select * from v2\n\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      1           11918.52    7839.12   24834.68    6290.75\n1                  2001      2           11918.52    6290.75    7839.12    6638.66\n2                  2001      3           11918.52    6638.66    6290.75    5577.47\n3                  2001      4           11918.52    5577.47    6638.66    6841.77\n4                  2001      5           11918.52    6841.77    5577.47    5802.33\n5                  2001      6           11918.52    5802.33    6841.77    6911.17\n6                  2001      7           11918.52    6911.17    5802.33   16921.81\n7                  2001      8           11918.52   16921.81    6911.17   14419.18\n8                  2001      9           11918.52   14419.18   16921.81   17156.13\n9                  2001     10           11918.52   17156.13   14419.18   23353.56\n10                 2001     11           11918.52   23353.56   17156.13   25270.32\n11                 2001     12           11918.52   25270.32   23353.56    8873.87\n12         able    2001      1          262529.83  169615.94  544269.43  139879.84\n13         able    2001      2          262529.83  139879.84  169615.94  149972.22\n14         able    2001      3          262529.83  149972.22  139879.84  152150.28\n15         able    2001      4          262529.83  152150.28  149972.22  151250.18\n16         able    2001      5          262529.83  151250.18  152150.28  151978.92\n17         able    2001      6          262529.83  151978.92  151250.18  149998.74\n18         able    2001      7          262529.83  149998.74  151978.92  343896.25\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 37.279485,
                    "execution_time": 36.85109,
                    "compile_time": 0.001052,
                    "planning_time": 17.832664
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 39.503409,
                    "execution_time": 39.072964,
                    "compile_time": 0.001066,
                    "planning_time": 19.632652
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      1           11918.52    7839.12   24834.68    6290.75\n1                  2001      2           11918.52    6290.75    7839.12    6638.66\n2                  2001      3           11918.52    6638.66    6290.75    5577.47\n3                  2001      4           11918.52    5577.47    6638.66    6841.77\n4                  2001      5           11918.52    6841.77    5577.47    5802.33\n5                  2001      6           11918.52    5802.33    6841.77    6911.17\n6                  2001      7           11918.52    6911.17    5802.33   16921.81\n7                  2001      8           11918.52   16921.81    6911.17   14419.18\n8                  2001      9           11918.52   14419.18   16921.81   17156.13\n9                  2001     10           11918.52   17156.13   14419.18   23353.56\n10                 2001     11           11918.52   23353.56   17156.13   25270.32\n11                 2001     12           11918.52   25270.32   23353.56    8873.87\n12         able    2001      1          262529.83  169615.94  544269.43  139879.84\n13         able    2001      2          262529.83  139879.84  169615.94  149972.22\n14         able    2001      3          262529.83  149972.22  139879.84  152150.28\n15         able    2001      4          262529.83  152150.28  149972.22  151250.18\n16         able    2001      5          262529.83  151250.18  152150.28  151978.92\n17         able    2001      6          262529.83  151978.92  151250.18  149998.74\n18         able    2001      7          262529.83  149998.74  151978.92  343896.25\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      1           11918.52    7839.12   24834.68    6290.75\n1                  2001      2           11918.52    6290.75    7839.12    6638.66\n2                  2001      3           11918.52    6638.66    6290.75    5577.47\n3                  2001      4           11918.52    5577.47    6638.66    6841.77\n4                  2001      5           11918.52    6841.77    5577.47    5802.33\n5                  2001      6           11918.52    5802.33    6841.77    6911.17\n6                  2001      7           11918.52    6911.17    5802.33   16921.81\n7                  2001      8           11918.52   16921.81    6911.17   14419.18\n8                  2001      9           11918.52   14419.18   16921.81   17156.13\n9                  2001     10           11918.52   17156.13   14419.18   23353.56\n10                 2001     11           11918.52   23353.56   17156.13   25270.32\n11                 2001     12           11918.52   25270.32   23353.56    8873.87\n12         able    2001      1          262529.83  169615.94  544269.43  139879.84\n13         able    2001      2          262529.83  139879.84  169615.94  149972.22\n14         able    2001      3          262529.83  149972.22  139879.84  152150.28\n15         able    2001      4          262529.83  152150.28  149972.22  151250.18\n16         able    2001      5          262529.83  151250.18  152150.28  151978.92\n17         able    2001      6          262529.83  151978.92  151250.18  149998.74\n18         able    2001      7          262529.83  149998.74  151978.92  343896.25\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 37.343573,
                    "execution_time": 36.912784,
                    "compile_time": 0.001077,
                    "planning_time": 18.089156
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 37.151468,
                    "execution_time": 36.708615,
                    "compile_time": 0.001077,
                    "planning_time": 17.740638
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      1           11918.52    7839.12   24834.68    6290.75\n1                  2001      2           11918.52    6290.75    7839.12    6638.66\n2                  2001      3           11918.52    6638.66    6290.75    5577.47\n3                  2001      4           11918.52    5577.47    6638.66    6841.77\n4                  2001      5           11918.52    6841.77    5577.47    5802.33\n5                  2001      6           11918.52    5802.33    6841.77    6911.17\n6                  2001      7           11918.52    6911.17    5802.33   16921.81\n7                  2001      8           11918.52   16921.81    6911.17   14419.18\n8                  2001      9           11918.52   14419.18   16921.81   17156.13\n9                  2001     10           11918.52   17156.13   14419.18   23353.56\n10                 2001     11           11918.52   23353.56   17156.13   25270.32\n11                 2001     12           11918.52   25270.32   23353.56    8873.87\n12         able    2001      1          262529.83  169615.94  544269.43  139879.84\n13         able    2001      2          262529.83  139879.84  169615.94  149972.22\n14         able    2001      3          262529.83  149972.22  139879.84  152150.28\n15         able    2001      4          262529.83  152150.28  149972.22  151250.18\n16         able    2001      5          262529.83  151250.18  152150.28  151978.92\n17         able    2001      6          262529.83  151978.92  151250.18  149998.74\n18         able    2001      7          262529.83  149998.74  151978.92  343896.25\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          able    2001      1            1376.15     743.16  2524.80   791.61\n1          able    2001      2            1376.15     791.61   743.16   837.95\n2          able    2001      3            1376.15     837.95   791.61   711.94\n3          able    2001      4            1376.15     711.94   837.95   639.32\n4          able    2001      5            1376.15     639.32   711.94   559.20\n5          able    2001      6            1376.15     559.20   639.32   861.28\n6          able    2001      7            1376.15     861.28   559.20  1920.61\n7          able    2001      8            1376.15    1920.61   861.28  1968.49\n8          able    2001      9            1376.15    1968.49  1920.61  2314.84\n9          able    2001     10            1376.15    2314.84  1968.49  3132.07\n10         able    2001     11            1376.15    3132.07  2314.84  2033.41\n11         anti    2001      1             625.83     102.20  1857.05   332.04\n12         anti    2001      2             625.83     332.04   102.20   216.21\n13         anti    2001      3             625.83     216.21   332.04   303.89\n14         anti    2001      4             625.83     303.89   216.21   280.67\n15         anti    2001      5             625.83     280.67   303.89   464.56\n16         anti    2001      6             625.83     464.56   280.67   457.13\n17         anti    2001      7             625.83     457.13   464.56   778.69\n18         anti    2001      8             625.83     778.69   457.13  1177.57\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 41.717668,
                    "execution_time": 41.282724,
                    "compile_time": 0.001201,
                    "planning_time": 20.496124
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 38.477823,
                    "execution_time": 37.972692,
                    "compile_time": 0.007192,
                    "planning_time": 17.982428
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          able    2001      1            1376.15     743.16  2524.80   791.61\n1          able    2001      2            1376.15     791.61   743.16   837.95\n2          able    2001      3            1376.15     837.95   791.61   711.94\n3          able    2001      4            1376.15     711.94   837.95   639.32\n4          able    2001      5            1376.15     639.32   711.94   559.20\n5          able    2001      6            1376.15     559.20   639.32   861.28\n6          able    2001      7            1376.15     861.28   559.20  1920.61\n7          able    2001      8            1376.15    1920.61   861.28  1968.49\n8          able    2001      9            1376.15    1968.49  1920.61  2314.84\n9          able    2001     10            1376.15    2314.84  1968.49  3132.07\n10         able    2001     11            1376.15    3132.07  2314.84  2033.41\n11         anti    2001      1             625.83     102.20  1857.05   332.04\n12         anti    2001      2             625.83     332.04   102.20   216.21\n13         anti    2001      3             625.83     216.21   332.04   303.89\n14         anti    2001      4             625.83     303.89   216.21   280.67\n15         anti    2001      5             625.83     280.67   303.89   464.56\n16         anti    2001      6             625.83     464.56   280.67   457.13\n17         anti    2001      7             625.83     457.13   464.56   778.69\n18         anti    2001      8             625.83     778.69   457.13  1177.57\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n/*CURSOR_IDENTIFIER*/\n1=1\n",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND 1 = 1 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      1           11918.52    7839.12   24834.68    6290.75\n1                  2001      2           11918.52    6290.75    7839.12    6638.66\n2                  2001      3           11918.52    6638.66    6290.75    5577.47\n3                  2001      4           11918.52    5577.47    6638.66    6841.77\n4                  2001      5           11918.52    6841.77    5577.47    5802.33\n5                  2001      6           11918.52    5802.33    6841.77    6911.17\n6                  2001      7           11918.52    6911.17    5802.33   16921.81\n7                  2001      8           11918.52   16921.81    6911.17   14419.18\n8                  2001      9           11918.52   14419.18   16921.81   17156.13\n9                  2001     10           11918.52   17156.13   14419.18   23353.56\n10                 2001     11           11918.52   23353.56   17156.13   25270.32\n11                 2001     12           11918.52   25270.32   23353.56    8873.87\n12         able    2001      1          262529.83  169615.94  544269.43  139879.84\n13         able    2001      2          262529.83  139879.84  169615.94  149972.22\n14         able    2001      3          262529.83  149972.22  139879.84  152150.28\n15         able    2001      4          262529.83  152150.28  149972.22  151250.18\n16         able    2001      5          262529.83  151250.18  152150.28  151978.92\n17         able    2001      6          262529.83  151978.92  151250.18  149998.74\n18         able    2001      7          262529.83  149998.74  151978.92  343896.25\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 47.121856,
                    "execution_time": 46.691177,
                    "compile_time": 0.001188,
                    "planning_time": 23.764727
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 47.297147,
                    "execution_time": 46.793736,
                    "compile_time": 0.002995,
                    "planning_time": 21.578679
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      1           11918.52    7839.12   24834.68    6290.75\n1                  2001      2           11918.52    6290.75    7839.12    6638.66\n2                  2001      3           11918.52    6638.66    6290.75    5577.47\n3                  2001      4           11918.52    5577.47    6638.66    6841.77\n4                  2001      5           11918.52    6841.77    5577.47    5802.33\n5                  2001      6           11918.52    5802.33    6841.77    6911.17\n6                  2001      7           11918.52    6911.17    5802.33   16921.81\n7                  2001      8           11918.52   16921.81    6911.17   14419.18\n8                  2001      9           11918.52   14419.18   16921.81   17156.13\n9                  2001     10           11918.52   17156.13   14419.18   23353.56\n10                 2001     11           11918.52   23353.56   17156.13   25270.32\n11                 2001     12           11918.52   25270.32   23353.56    8873.87\n12         able    2001      1          262529.83  169615.94  544269.43  139879.84\n13         able    2001      2          262529.83  139879.84  169615.94  149972.22\n14         able    2001      3          262529.83  149972.22  139879.84  152150.28\n15         able    2001      4          262529.83  152150.28  149972.22  151250.18\n16         able    2001      5          262529.83  151250.18  152150.28  151978.92\n17         able    2001      6          262529.83  151978.92  151250.18  149998.74\n18         able    2001      7          262529.83  149998.74  151978.92  343896.25\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      1           11918.52    7839.12   24834.68    6290.75\n1                  2001      2           11918.52    6290.75    7839.12    6638.66\n2                  2001      3           11918.52    6638.66    6290.75    5577.47\n3                  2001      4           11918.52    5577.47    6638.66    6841.77\n4                  2001      5           11918.52    6841.77    5577.47    5802.33\n5                  2001      6           11918.52    5802.33    6841.77    6911.17\n6                  2001      7           11918.52    6911.17    5802.33   16921.81\n7                  2001      8           11918.52   16921.81    6911.17   14419.18\n8                  2001      9           11918.52   14419.18   16921.81   17156.13\n9                  2001     10           11918.52   17156.13   14419.18   23353.56\n10                 2001     11           11918.52   23353.56   17156.13   25270.32\n11                 2001     12           11918.52   25270.32   23353.56    8873.87\n12         able    2001      1          262529.83  169615.94  544269.43  139879.84\n13         able    2001      2          262529.83  139879.84  169615.94  149972.22\n14         able    2001      3          262529.83  149972.22  139879.84  152150.28\n15         able    2001      4          262529.83  152150.28  149972.22  151250.18\n16         able    2001      5          262529.83  151250.18  152150.28  151978.92\n17         able    2001      6          262529.83  151978.92  151250.18  149998.74\n18         able    2001      7          262529.83  149998.74  151978.92  343896.25\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 42.614233,
                    "execution_time": 42.165266,
                    "compile_time": 0.001219,
                    "planning_time": 21.09346
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 45.659659,
                    "execution_time": 45.148144,
                    "compile_time": 0.002544,
                    "planning_time": 22.406738
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0                  2001      1           11918.52    7839.12   24834.68    6290.75\n1                  2001      2           11918.52    6290.75    7839.12    6638.66\n2                  2001      3           11918.52    6638.66    6290.75    5577.47\n3                  2001      4           11918.52    5577.47    6638.66    6841.77\n4                  2001      5           11918.52    6841.77    5577.47    5802.33\n5                  2001      6           11918.52    5802.33    6841.77    6911.17\n6                  2001      7           11918.52    6911.17    5802.33   16921.81\n7                  2001      8           11918.52   16921.81    6911.17   14419.18\n8                  2001      9           11918.52   14419.18   16921.81   17156.13\n9                  2001     10           11918.52   17156.13   14419.18   23353.56\n10                 2001     11           11918.52   23353.56   17156.13   25270.32\n11                 2001     12           11918.52   25270.32   23353.56    8873.87\n12         able    2001      1          262529.83  169615.94  544269.43  139879.84\n13         able    2001      2          262529.83  139879.84  169615.94  149972.22\n14         able    2001      3          262529.83  149972.22  139879.84  152150.28\n15         able    2001      4          262529.83  152150.28  149972.22  151250.18\n16         able    2001      5          262529.83  151250.18  152150.28  151978.92\n17         able    2001      6          262529.83  151978.92  151250.18  149998.74\n18         able    2001      7          262529.83  149998.74  151978.92  343896.25\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, sum_sales\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , SUM_SALES NULLS FIRST LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales   sum_sales        psum        nsum\n0          able    2001      2         5714487.21  3061177.33  3664614.24  3291388.25\n1           bar    2001      2         5723359.13  3076970.76  3634492.28  3288001.64\n2          able    2001      2         5659645.56  3018476.95  3604881.11  3215853.81\n3          able    2001      2         5635630.30  2998844.50  3609677.91  3249226.91\n4          able    2001      2         5626165.62  2991341.60  3579842.81  3212566.76\n5           bar    2001      2         5628312.12  2994303.37  3593377.37  3233465.51\n6           ese    2001      2         5636901.41  3003565.52  3585861.68  3229226.94\n7          able    2001      2         5680492.33  3048207.88  3626737.10  3296896.19\n8           bar    2001      2         5631599.91  3006558.75  3613627.69  3253744.11\n9          able    2001      2         5666786.87  3043376.88  3608564.69  3237346.28\n10         eing    2001      2         5586262.37  2964186.81  3576617.58  3208960.59\n11          bar    2001      2         5665263.96  3043838.15  3624987.63  3259728.32\n12         able    2001      2         5639181.32  3018184.58  3590367.08  3234546.81\n13         eing    2001      2         5637266.58  3017419.85  3569524.17  3234108.58\n14         able    2001      2         5627377.53  3014795.22  3617167.19  3217447.39\n15          bar    2001      2         5666648.04  3056207.40  3607520.63  3219716.68\n16          ese    2001      2         5575823.46  2967855.73  3554488.76  3206425.50\n17         eing    2001      2         5576638.91  2969698.53  3563410.57  3202366.61\n18          bar    2001      2         5642972.70  3036830.09  3613734.06  3232879.92\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 47.611236,
                    "execution_time": 47.1738,
                    "compile_time": 0.001146,
                    "planning_time": 23.38661
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 46.894625,
                    "execution_time": 46.383965,
                    "compile_time": 0.006027,
                    "planning_time": 22.571376
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales   sum_sales        psum        nsum\n0          able    2001      2         5714487.21  3061177.33  3664614.24  3291388.25\n1           bar    2001      2         5723359.13  3076970.76  3634492.28  3288001.64\n2          able    2001      2         5659645.56  3018476.95  3604881.11  3215853.81\n3          able    2001      2         5635630.30  2998844.50  3609677.91  3249226.91\n4          able    2001      2         5626165.62  2991341.60  3579842.81  3212566.76\n5           bar    2001      2         5628312.12  2994303.37  3593377.37  3233465.51\n6           ese    2001      2         5636901.41  3003565.52  3585861.68  3229226.94\n7          able    2001      2         5680492.33  3048207.88  3626737.10  3296896.19\n8           bar    2001      2         5631599.91  3006558.75  3613627.69  3253744.11\n9          able    2001      2         5666786.87  3043376.88  3608564.69  3237346.28\n10         eing    2001      2         5586262.37  2964186.81  3576617.58  3208960.59\n11          bar    2001      2         5665263.96  3043838.15  3624987.63  3259728.32\n12         able    2001      2         5639181.32  3018184.58  3590367.08  3234546.81\n13         eing    2001      2         5637266.58  3017419.85  3569524.17  3234108.58\n14         able    2001      2         5627377.53  3014795.22  3617167.19  3217447.39\n15          bar    2001      2         5666648.04  3056207.40  3607520.63  3219716.68\n16          ese    2001      2         5575823.46  2967855.73  3554488.76  3206425.50\n17         eing    2001      2         5576638.91  2969698.53  3563410.57  3202366.61\n18          bar    2001      2         5642972.70  3036830.09  3613734.06  3232879.92\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, sum_sales\n limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , SUM_SALES NULLS FIRST LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales   sum_sales        psum        nsum\n0          able    2001      2         5714487.21  3061177.33  3664614.24  3291388.25\n1           bar    2001      2         5723359.13  3076970.76  3634492.28  3288001.64\n2          able    2001      2         5659645.56  3018476.95  3604881.11  3215853.81\n3          able    2001      2         5635630.30  2998844.50  3609677.91  3249226.91\n4          able    2001      2         5626165.62  2991341.60  3579842.81  3212566.76\n5           bar    2001      2         5628312.12  2994303.37  3593377.37  3233465.51\n6           ese    2001      2         5636901.41  3003565.52  3585861.68  3229226.94\n7          able    2001      2         5680492.33  3048207.88  3626737.10  3296896.19\n8           bar    2001      2         5631599.91  3006558.75  3613627.69  3253744.11\n9          able    2001      2         5666786.87  3043376.88  3608564.69  3237346.28\n10         eing    2001      2         5586262.37  2964186.81  3576617.58  3208960.59\n11          bar    2001      2         5665263.96  3043838.15  3624987.63  3259728.32\n12         able    2001      2         5639181.32  3018184.58  3590367.08  3234546.81\n13         eing    2001      2         5637266.58  3017419.85  3569524.17  3234108.58\n14         able    2001      2         5627377.53  3014795.22  3617167.19  3217447.39\n15          bar    2001      2         5666648.04  3056207.40  3607520.63  3219716.68\n16          ese    2001      2         5575823.46  2967855.73  3554488.76  3206425.50\n17         eing    2001      2         5576638.91  2969698.53  3563410.57  3202366.61\n18          bar    2001      2         5642972.70  3036830.09  3613734.06  3232879.92\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 42.817134,
                    "execution_time": 42.377551,
                    "compile_time": 0.001129,
                    "planning_time": 20.788117
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 46.409009,
                    "execution_time": 45.968641,
                    "compile_time": 0.001132,
                    "planning_time": 23.490876
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales   sum_sales        psum        nsum\n0          able    2001      2         5714487.21  3061177.33  3664614.24  3291388.25\n1           bar    2001      2         5723359.13  3076970.76  3634492.28  3288001.64\n2          able    2001      2         5659645.56  3018476.95  3604881.11  3215853.81\n3          able    2001      2         5635630.30  2998844.50  3609677.91  3249226.91\n4          able    2001      2         5626165.62  2991341.60  3579842.81  3212566.76\n5           bar    2001      2         5628312.12  2994303.37  3593377.37  3233465.51\n6           ese    2001      2         5636901.41  3003565.52  3585861.68  3229226.94\n7          able    2001      2         5680492.33  3048207.88  3626737.10  3296896.19\n8           bar    2001      2         5631599.91  3006558.75  3613627.69  3253744.11\n9          able    2001      2         5666786.87  3043376.88  3608564.69  3237346.28\n10         eing    2001      2         5586262.37  2964186.81  3576617.58  3208960.59\n11          bar    2001      2         5665263.96  3043838.15  3624987.63  3259728.32\n12         able    2001      2         5639181.32  3018184.58  3590367.08  3234546.81\n13         eing    2001      2         5637266.58  3017419.85  3569524.17  3234108.58\n14         able    2001      2         5627377.53  3014795.22  3617167.19  3217447.39\n15          bar    2001      2         5666648.04  3056207.40  3607520.63  3219716.68\n16          ese    2001      2         5575823.46  2967855.73  3554488.76  3206425.50\n17         eing    2001      2         5576638.91  2969698.53  3563410.57  3202366.61\n18          bar    2001      2         5642972.70  3036830.09  3613734.06  3232879.92\n...*/"
    }
]