[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n/*CURSOR_IDENTIFIER*/) SELECT * FROM results_rollup",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.444113,
                    "execution_time": 3.354034,
                    "compile_time": 0.000469,
                    "planning_time": 0.053696,
                    "create_size": 64
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 5.961163,
                    "execution_time": 5.649333,
                    "compile_time": 0.137189,
                    "planning_time": 0.135267,
                    "create_size": 64
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" GROUP BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.084424,
                    "execution_time": 0.049825,
                    "compile_time": 0.000402,
                    "planning_time": 0.007728,
                    "create_size": 9
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.13388,
                    "execution_time": 0.049465,
                    "compile_time": 0.006791,
                    "planning_time": 0.049456,
                    "create_size": 9
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category         i_class  t_category  t_class  lochierarchy\n0        -0.4687                    maternity           0        0             0\n1        -0.4332        Books            None           0        1             1\n2        -0.4524                    glassware           0        0             0\n3        -0.4330  Electronics      automotive           0        0             0\n4        -0.4476                         rock           0        0             0\n5        -0.4380                      newborn           0        0             0\n6        -0.4332        Books       computers           0        0             0\n7        -0.4343  Electronics        monitors           0        0             0\n8        -0.4364                          pop           0        0             0\n9        -0.4482                     portable           0        0             0\n10       -0.4416                       shirts           0        0             0\n11       -0.4334        Books          travel           0        0             0\n12       -0.4932                  televisions           0        0             0\n13       -0.4332        Books         romance           0        0             0\n14       -0.4340       Sports  athletic shoes           0        0             0\n15       -0.4121                       tennis           0        0             0\n16       -0.4345  Electronics        scanners           0        0             0\n17       -0.4323         Home           paint           0        0             0\n18       -0.4334      Jewelry            gold           0        0             0\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017992,
                    "execution_time": 0.007241,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.004202
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.056383,
                    "execution_time": 0.007317,
                    "compile_time": 0.001122,
                    "planning_time": 0.039668
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\""
            }
        ],
        "preview": "\n/*    gross_margin   i_category         i_class  t_category  t_class  lochierarchy\n0        -0.4687                    maternity           0        0             0\n1        -0.4332        Books            None           0        1             1\n2        -0.4524                    glassware           0        0             0\n3        -0.4330  Electronics      automotive           0        0             0\n4        -0.4476                         rock           0        0             0\n5        -0.4380                      newborn           0        0             0\n6        -0.4332        Books       computers           0        0             0\n7        -0.4343  Electronics        monitors           0        0             0\n8        -0.4364                          pop           0        0             0\n9        -0.4482                     portable           0        0             0\n10       -0.4416                       shirts           0        0             0\n11       -0.4334        Books          travel           0        0             0\n12       -0.4932                  televisions           0        0             0\n13       -0.4332        Books         romance           0        0             0\n14       -0.4340       Sports  athletic shoes           0        0             0\n15       -0.4121                       tennis           0        0             0\n16       -0.4345  Electronics        scanners           0        0             0\n17       -0.4323         Home           paint           0        0             0\n18       -0.4334      Jewelry            gold           0        0             0\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category, NULL AS i_class, 1 as t_category, 0 as t_class, 2 as lochierarchy from results\n)\nselect * from results_rollup\norder by lochierarchy, i_category, i_class\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" NULLS LAST , \"RESULTS_ROLLUP\".\"I_CATEGORY\" NULLS LAST , \"RESULTS_ROLLUP\".\"I_CLASS\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" GROUP BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.102679,
                    "execution_time": 0.05917,
                    "compile_time": 0.000496,
                    "planning_time": 0.0106,
                    "create_size": 9
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.14587,
                    "execution_time": 0.057253,
                    "compile_time": 0.003111,
                    "planning_time": 0.052699,
                    "create_size": 9
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ORDER BY \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  t_category  t_class  lochierarchy\n0        -0.4312                                       0        0             0\n1        -0.4390                 accessories           0        0             0\n2        -0.4718                     archery           0        0             0\n3        -0.4565                        arts           0        0             0\n4        -0.4258                    athletic           0        0             0\n5        -0.4268              athletic shoes           0        0             0\n6        -0.4402                       audio           0        0             0\n7        -0.4239                  automotive           0        0             0\n8        -0.5068                  basketball           0        0             0\n9        -0.3981                      birdal           0        0             0\n10       -0.4485                   bracelets           0        0             0\n11       -0.4162                  camcorders           0        0             0\n12       -0.4414                     camping           0        0             0\n13       -0.4114                   classical           0        0             0\n14       -0.4503                   computers           0        0             0\n15       -0.3951                 consignment           0        0             0\n16       -0.4388                     costume           0        0             0\n17       -0.4241                     country           0        0             0\n18       -0.4553             curtains/drapes           0        0             0\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018925,
                    "execution_time": 0.008496,
                    "compile_time": 7.4e-05,
                    "planning_time": 0.00419
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.224339,
                    "execution_time": 0.008025,
                    "compile_time": 0.169024,
                    "planning_time": 0.039992
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ORDER BY \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ORDER BY \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  t_category  t_class  lochierarchy\n0        -0.4312                                       0        0             0\n1        -0.4390                 accessories           0        0             0\n2        -0.4718                     archery           0        0             0\n3        -0.4565                        arts           0        0             0\n4        -0.4258                    athletic           0        0             0\n5        -0.4268              athletic shoes           0        0             0\n6        -0.4402                       audio           0        0             0\n7        -0.4239                  automotive           0        0             0\n8        -0.5068                  basketball           0        0             0\n9        -0.3981                      birdal           0        0             0\n10       -0.4485                   bracelets           0        0             0\n11       -0.4162                  camcorders           0        0             0\n12       -0.4414                     camping           0        0             0\n13       -0.4114                   classical           0        0             0\n14       -0.4503                   computers           0        0             0\n15       -0.3951                 consignment           0        0             0\n16       -0.4388                     costume           0        0             0\n17       -0.4241                     country           0        0             0\n18       -0.4553             curtains/drapes           0        0             0\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n/*CURSOR_IDENTIFIER*/ select * from results_rollup",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" GROUP BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.101561,
                    "execution_time": 0.057604,
                    "compile_time": 0.000487,
                    "planning_time": 0.010549,
                    "create_size": 9
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.261597,
                    "execution_time": 0.057942,
                    "compile_time": 0.118431,
                    "planning_time": 0.052235,
                    "create_size": 9
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category         i_class  t_category  t_class  lochierarchy\n0        -0.4345  Electronics        scanners           0        0             0\n1        -0.4323         Home           paint           0        0             0\n2        -0.4334      Jewelry            gold           0        0             0\n3        -0.4429                      earings           0        0             0\n4        -0.4333         Home            None           0        1             1\n5        -0.4687                    maternity           0        0             0\n6        -0.4332        Books            None           0        1             1\n7        -0.4332        Books       computers           0        0             0\n8        -0.4343  Electronics        monitors           0        0             0\n9        -0.4364                          pop           0        0             0\n10       -0.4482                     portable           0        0             0\n11       -0.4416                       shirts           0        0             0\n12       -0.4524                    glassware           0        0             0\n13       -0.4330  Electronics      automotive           0        0             0\n14       -0.4476                         rock           0        0             0\n15       -0.4334        Books          travel           0        0             0\n16       -0.4932                  televisions           0        0             0\n17       -0.4332        Books         romance           0        0             0\n18       -0.4340       Sports  athletic shoes           0        0             0\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017687,
                    "execution_time": 0.00769,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.00379
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.053472,
                    "execution_time": 0.007251,
                    "compile_time": 4.8e-05,
                    "planning_time": 0.03953
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    gross_margin   i_category         i_class  t_category  t_class  lochierarchy\n0        -0.4345  Electronics        scanners           0        0             0\n1        -0.4323         Home           paint           0        0             0\n2        -0.4334      Jewelry            gold           0        0             0\n3        -0.4429                      earings           0        0             0\n4        -0.4333         Home            None           0        1             1\n5        -0.4687                    maternity           0        0             0\n6        -0.4332        Books            None           0        1             1\n7        -0.4332        Books       computers           0        0             0\n8        -0.4343  Electronics        monitors           0        0             0\n9        -0.4364                          pop           0        0             0\n10       -0.4482                     portable           0        0             0\n11       -0.4416                       shirts           0        0             0\n12       -0.4524                    glassware           0        0             0\n13       -0.4330  Electronics      automotive           0        0             0\n14       -0.4476                         rock           0        0             0\n15       -0.4334        Books          travel           0        0             0\n16       -0.4932                  televisions           0        0             0\n17       -0.4332        Books         romance           0        0             0\n18       -0.4340       Sports  athletic shoes           0        0             0\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select * from results_rollup\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category         i_class  t_category  t_class  lochierarchy\n0        -0.4345  Electronics        scanners           0        0             0\n1        -0.4323         Home           paint           0        0             0\n2        -0.4334      Jewelry            gold           0        0             0\n3        -0.4429                      earings           0        0             0\n4        -0.4333         Home            None           0        1             1\n5        -0.4687                    maternity           0        0             0\n6        -0.4332        Books            None           0        1             1\n7        -0.4332        Books       computers           0        0             0\n8        -0.4343  Electronics        monitors           0        0             0\n9        -0.4364                          pop           0        0             0\n10       -0.4482                     portable           0        0             0\n11       -0.4416                       shirts           0        0             0\n12       -0.4524                    glassware           0        0             0\n13       -0.4330  Electronics      automotive           0        0             0\n14       -0.4476                         rock           0        0             0\n15       -0.4334        Books          travel           0        0             0\n16       -0.4932                  televisions           0        0             0\n17       -0.4332        Books         romance           0        0             0\n18       -0.4340       Sports  athletic shoes           0        0             0\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018188,
                    "execution_time": 0.007851,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.003803
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.018491,
                    "execution_time": 0.007944,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.004012
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    gross_margin   i_category         i_class  t_category  t_class  lochierarchy\n0        -0.4345  Electronics        scanners           0        0             0\n1        -0.4323         Home           paint           0        0             0\n2        -0.4334      Jewelry            gold           0        0             0\n3        -0.4429                      earings           0        0             0\n4        -0.4333         Home            None           0        1             1\n5        -0.4687                    maternity           0        0             0\n6        -0.4332        Books            None           0        1             1\n7        -0.4332        Books       computers           0        0             0\n8        -0.4343  Electronics        monitors           0        0             0\n9        -0.4364                          pop           0        0             0\n10       -0.4482                     portable           0        0             0\n11       -0.4416                       shirts           0        0             0\n12       -0.4524                    glassware           0        0             0\n13       -0.4330  Electronics      automotive           0        0             0\n14       -0.4476                         rock           0        0             0\n15       -0.4334        Books          travel           0        0             0\n16       -0.4932                  televisions           0        0             0\n17       -0.4332        Books         romance           0        0             0\n18       -0.4340       Sports  athletic shoes           0        0             0\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over () as rank_value\n/*CURSOR_IDENTIFIER*/ from results_rollup order by lochierarchy, i_category, i_class",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" , \"I_CATEGORY\" , \"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.4312                                         0           1\n1        -0.4390                 accessories             0           1\n2        -0.4718                     archery             0           1\n3        -0.4565                        arts             0           1\n4        -0.4258                    athletic             0           1\n5        -0.4268              athletic shoes             0           1\n6        -0.4402                       audio             0           1\n7        -0.4239                  automotive             0           1\n8        -0.5068                  basketball             0           1\n9        -0.3981                      birdal             0           1\n10       -0.4485                   bracelets             0           1\n11       -0.4162                  camcorders             0           1\n12       -0.4414                     camping             0           1\n13       -0.4114                   classical             0           1\n14       -0.4503                   computers             0           1\n15       -0.3951                 consignment             0           1\n16       -0.4388                     costume             0           1\n17       -0.4241                     country             0           1\n18       -0.4553             curtains/drapes             0           1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.021435,
                    "execution_time": 0.009408,
                    "compile_time": 8.9e-05,
                    "planning_time": 0.004646
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.06132,
                    "execution_time": 0.009742,
                    "compile_time": 0.002496,
                    "planning_time": 0.040726
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.4312                                         0           1\n1        -0.4390                 accessories             0           1\n2        -0.4718                     archery             0           1\n3        -0.4565                        arts             0           1\n4        -0.4258                    athletic             0           1\n5        -0.4268              athletic shoes             0           1\n6        -0.4402                       audio             0           1\n7        -0.4239                  automotive             0           1\n8        -0.5068                  basketball             0           1\n9        -0.3981                      birdal             0           1\n10       -0.4485                   bracelets             0           1\n11       -0.4162                  camcorders             0           1\n12       -0.4414                     camping             0           1\n13       -0.4114                   classical             0           1\n14       -0.4503                   computers             0           1\n15       -0.3951                 consignment             0           1\n16       -0.4388                     costume             0           1\n17       -0.4241                     country             0           1\n18       -0.4553             curtains/drapes             0           1\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end) as rank_value\n/*CURSOR_IDENTIFIER*/ from results_rollup order by lochierarchy, i_category, i_class",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" , \"I_CATEGORY\" , \"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.4312                                         0           1\n1        -0.4390                 accessories             0           1\n2        -0.4718                     archery             0           1\n3        -0.4565                        arts             0           1\n4        -0.4258                    athletic             0           1\n5        -0.4268              athletic shoes             0           1\n6        -0.4402                       audio             0           1\n7        -0.4239                  automotive             0           1\n8        -0.5068                  basketball             0           1\n9        -0.3981                      birdal             0           1\n10       -0.4485                   bracelets             0           1\n11       -0.4162                  camcorders             0           1\n12       -0.4414                     camping             0           1\n13       -0.4114                   classical             0           1\n14       -0.4503                   computers             0           1\n15       -0.3951                 consignment             0           1\n16       -0.4388                     costume             0           1\n17       -0.4241                     country             0           1\n18       -0.4553             curtains/drapes             0           1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.02386,
                    "execution_time": 0.010805,
                    "compile_time": 0.000126,
                    "planning_time": 0.005115
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.062899,
                    "execution_time": 0.0107,
                    "compile_time": 0.003654,
                    "planning_time": 0.04058
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.4312                                         0           1\n1        -0.4390                 accessories             0           1\n2        -0.4718                     archery             0           1\n3        -0.4565                        arts             0           1\n4        -0.4258                    athletic             0           1\n5        -0.4268              athletic shoes             0           1\n6        -0.4402                       audio             0           1\n7        -0.4239                  automotive             0           1\n8        -0.5068                  basketball             0           1\n9        -0.3981                      birdal             0           1\n10       -0.4485                   bracelets             0           1\n11       -0.4162                  camcorders             0           1\n12       -0.4414                     camping             0           1\n13       -0.4114                   classical             0           1\n14       -0.4503                   computers             0           1\n15       -0.3951                 consignment             0           1\n16       -0.4388                     costume             0           1\n17       -0.4241                     country             0           1\n18       -0.4553             curtains/drapes             0           1\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_within_parent\n0        -0.5068                  basketball             0                   1\n1        -0.4932                 televisions             0                   2\n2        -0.4841                       pools             0                   3\n3        -0.4838                    flatware             0                   4\n4        -0.4718                     archery             0                   5\n5        -0.4687                   maternity             0                   6\n6        -0.4649                womens watch             0                   7\n7        -0.4597                      womens             0                   8\n8        -0.4588                      estate             0                   9\n9        -0.4565                        arts             0                  10\n10       -0.4557                      karoke             0                  11\n11       -0.4554              sports-apparel             0                  12\n12       -0.4553             curtains/drapes             0                  13\n13       -0.4548             dvd/vcr players             0                  14\n14       -0.4533                    lighting             0                  15\n15       -0.4524                   glassware             0                  16\n16       -0.4503                   computers             0                  17\n17       -0.4500                       pants             0                  18\n18       -0.4485                   bracelets             0                  19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.021869,
                    "execution_time": 0.009325,
                    "compile_time": 9.5e-05,
                    "planning_time": 0.004892
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.059435,
                    "execution_time": 0.00933,
                    "compile_time": 0.001859,
                    "planning_time": 0.040347
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_within_parent\n0        -0.5068                  basketball             0                   1\n1        -0.4932                 televisions             0                   2\n2        -0.4841                       pools             0                   3\n3        -0.4838                    flatware             0                   4\n4        -0.4718                     archery             0                   5\n5        -0.4687                   maternity             0                   6\n6        -0.4649                womens watch             0                   7\n7        -0.4597                      womens             0                   8\n8        -0.4588                      estate             0                   9\n9        -0.4565                        arts             0                  10\n10       -0.4557                      karoke             0                  11\n11       -0.4554              sports-apparel             0                  12\n12       -0.4553             curtains/drapes             0                  13\n13       -0.4548             dvd/vcr players             0                  14\n14       -0.4533                    lighting             0                  15\n15       -0.4524                   glassware             0                  16\n16       -0.4503                   computers             0                  17\n17       -0.4500                       pants             0                  18\n18       -0.4485                   bracelets             0                  19\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by lochierarchy, i_category, i_class\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" , \"I_CATEGORY\" , \"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4312                                         0                  40\n1        -0.4390                 accessories             0                  33\n2        -0.4718                     archery             0                   5\n3        -0.4565                        arts             0                  10\n4        -0.4258                    athletic             0                  51\n5        -0.4268              athletic shoes             0                  49\n6        -0.4402                       audio             0                  31\n7        -0.4239                  automotive             0                  55\n8        -0.5068                  basketball             0                   1\n9        -0.3981                      birdal             0                  70\n10       -0.4485                   bracelets             0                  19\n11       -0.4162                  camcorders             0                  64\n12       -0.4414                     camping             0                  29\n13       -0.4114                   classical             0                  67\n14       -0.4503                   computers             0                  17\n15       -0.3951                 consignment             0                  71\n16       -0.4388                     costume             0                  35\n17       -0.4241                     country             0                  53\n18       -0.4553             curtains/drapes             0                  13\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.024116,
                    "execution_time": 0.01077,
                    "compile_time": 0.000121,
                    "planning_time": 0.005308
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.163407,
                    "execution_time": 0.010242,
                    "compile_time": 0.110677,
                    "planning_time": 0.040957
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4312                                         0                  40\n1        -0.4390                 accessories             0                  33\n2        -0.4718                     archery             0                   5\n3        -0.4565                        arts             0                  10\n4        -0.4258                    athletic             0                  51\n5        -0.4268              athletic shoes             0                  49\n6        -0.4402                       audio             0                  31\n7        -0.4239                  automotive             0                  55\n8        -0.5068                  basketball             0                   1\n9        -0.3981                      birdal             0                  70\n10       -0.4485                   bracelets             0                  19\n11       -0.4162                  camcorders             0                  64\n12       -0.4414                     camping             0                  29\n13       -0.4114                   classical             0                  67\n14       -0.4503                   computers             0                  17\n15       -0.3951                 consignment             0                  71\n16       -0.4388                     costume             0                  35\n17       -0.4241                     country             0                  53\n18       -0.4553             curtains/drapes             0                  13\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC LIMIT 21",
                "preview": "\n/*    gross_margin   i_category     i_class  lochierarchy  rank_within_parent\n0        -0.4334         None        None             2                   1\n1        -0.4336  Electronics        None             1                   2\n2        -0.4336       Sports        None             1                   2\n3        -0.4335     Children        None             1                   4\n4        -0.4335        Shoes        None             1                   4\n5        -0.4335          Men        None             1                   4\n6        -0.4333         Home        None             1                   7\n7        -0.4333        Women        None             1                   7\n8        -0.4332        Books        None             1                   9\n9        -0.4332                     None             1                   9\n10       -0.4331        Music        None             1                  11\n11       -0.4337      Jewelry        None             1                   1\n12       -0.4334        Women     dresses             0                   3\n13       -0.4354         Home        rugs             0                   2\n14       -0.4330        Women  fragrances             0                   4\n15       -0.4345         Home        kids             0                   3\n16       -0.4329        Women   maternity             0                   5\n17       -0.4340         Home      tables             0                   4\n18       -0.4339        Women    swimwear             0                   2\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.02394,
                    "execution_time": 0.010813,
                    "compile_time": 0.000131,
                    "planning_time": 0.005095
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.060649,
                    "execution_time": 0.011085,
                    "compile_time": 0.000958,
                    "planning_time": 0.040729
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST"
            }
        ],
        "preview": "\n/*    gross_margin   i_category     i_class  lochierarchy  rank_within_parent\n0        -0.4334         None        None             2                   1\n1        -0.4336  Electronics        None             1                   2\n2        -0.4336       Sports        None             1                   2\n3        -0.4335     Children        None             1                   4\n4        -0.4335        Shoes        None             1                   4\n5        -0.4335          Men        None             1                   4\n6        -0.4333         Home        None             1                   7\n7        -0.4333        Women        None             1                   7\n8        -0.4332        Books        None             1                   9\n9        -0.4332                     None             1                   9\n10       -0.4331        Music        None             1                  11\n11       -0.4337      Jewelry        None             1                   1\n12       -0.4334        Women     dresses             0                   3\n13       -0.4354         Home        rugs             0                   2\n14       -0.4330        Women  fragrances             0                   4\n15       -0.4345         Home        kids             0                   3\n16       -0.4329        Women   maternity             0                   5\n17       -0.4340         Home      tables             0                   4\n18       -0.4339        Women    swimwear             0                   2\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END LIMIT 21",
                "preview": "\n/*    gross_margin   i_category       i_class  lochierarchy  rank_within_parent\n0        -0.4334         None          None             2                   1\n1        -0.4336  Electronics          None             1                   2\n2        -0.4336       Sports          None             1                   2\n3        -0.4335     Children          None             1                   4\n4        -0.4335        Shoes          None             1                   4\n5        -0.4335          Men          None             1                   4\n6        -0.4333         Home          None             1                   7\n7        -0.4333        Women          None             1                   7\n8        -0.4332        Books          None             1                   9\n9        -0.4332                       None             1                   9\n10       -0.4331        Music          None             1                  11\n11       -0.4337      Jewelry          None             1                   1\n12       -0.4932                televisions             0                   2\n13       -0.4841                      pools             0                   3\n14       -0.4838                   flatware             0                   4\n15       -0.4718                    archery             0                   5\n16       -0.4687                  maternity             0                   6\n17       -0.4649               womens watch             0                   7\n18       -0.4597                     womens             0                   8\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.024746,
                    "execution_time": 0.010461,
                    "compile_time": 0.000133,
                    "planning_time": 0.005646
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.062581,
                    "execution_time": 0.010351,
                    "compile_time": 0.003676,
                    "planning_time": 0.040886
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin   i_category       i_class  lochierarchy  rank_within_parent\n0        -0.4334         None          None             2                   1\n1        -0.4336  Electronics          None             1                   2\n2        -0.4336       Sports          None             1                   2\n3        -0.4335     Children          None             1                   4\n4        -0.4335        Shoes          None             1                   4\n5        -0.4335          Men          None             1                   4\n6        -0.4333         Home          None             1                   7\n7        -0.4333        Women          None             1                   7\n8        -0.4332        Books          None             1                   9\n9        -0.4332                       None             1                   9\n10       -0.4331        Music          None             1                  11\n11       -0.4337      Jewelry          None             1                   1\n12       -0.4932                televisions             0                   2\n13       -0.4841                      pools             0                   3\n14       -0.4838                   flatware             0                   4\n15       -0.4718                    archery             0                   5\n16       -0.4687                  maternity             0                   6\n17       -0.4649               womens watch             0                   7\n18       -0.4597                     womens             0                   8\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n  ,rank_within_parent\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END , \"RANK_WITHIN_PARENT\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category       i_class  lochierarchy  rank_within_parent\n0        -0.4334         None          None             2                   1\n1        -0.4337      Jewelry          None             1                   1\n2        -0.4336  Electronics          None             1                   2\n3        -0.4336       Sports          None             1                   2\n4        -0.4335     Children          None             1                   4\n5        -0.4335        Shoes          None             1                   4\n6        -0.4335          Men          None             1                   4\n7        -0.4333         Home          None             1                   7\n8        -0.4333        Women          None             1                   7\n9        -0.4332                       None             1                   9\n10       -0.4332        Books          None             1                   9\n11       -0.4331        Music          None             1                  11\n12       -0.5068                 basketball             0                   1\n13       -0.4932                televisions             0                   2\n14       -0.4841                      pools             0                   3\n15       -0.4838                   flatware             0                   4\n16       -0.4718                    archery             0                   5\n17       -0.4687                  maternity             0                   6\n18       -0.4649               womens watch             0                   7\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.025194,
                    "execution_time": 0.010572,
                    "compile_time": 0.000129,
                    "planning_time": 0.006243
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.220099,
                    "execution_time": 0.01046,
                    "compile_time": 0.166132,
                    "planning_time": 0.041581
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin   i_category       i_class  lochierarchy  rank_within_parent\n0        -0.4334         None          None             2                   1\n1        -0.4337      Jewelry          None             1                   1\n2        -0.4336  Electronics          None             1                   2\n3        -0.4336       Sports          None             1                   2\n4        -0.4335     Children          None             1                   4\n5        -0.4335        Shoes          None             1                   4\n6        -0.4335          Men          None             1                   4\n7        -0.4333         Home          None             1                   7\n8        -0.4333        Women          None             1                   7\n9        -0.4332                       None             1                   9\n10       -0.4332        Books          None             1                   9\n11       -0.4331        Music          None             1                  11\n12       -0.5068                 basketball             0                   1\n13       -0.4932                televisions             0                   2\n14       -0.4841                      pools             0                   3\n15       -0.4838                   flatware             0                   4\n16       -0.4718                    archery             0                   5\n17       -0.4687                  maternity             0                   6\n18       -0.4649               womens watch             0                   7\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n  ,rank_within_parent\n  limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END , \"RANK_WITHIN_PARENT\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category       i_class  lochierarchy  rank_within_parent\n0        -0.4334         None          None             2                   1\n1        -0.4337      Jewelry          None             1                   1\n2        -0.4336  Electronics          None             1                   2\n3        -0.4336       Sports          None             1                   2\n4        -0.4335     Children          None             1                   4\n5        -0.4335        Shoes          None             1                   4\n6        -0.4335          Men          None             1                   4\n7        -0.4333         Home          None             1                   7\n8        -0.4333        Women          None             1                   7\n9        -0.4332                       None             1                   9\n10       -0.4332        Books          None             1                   9\n11       -0.4331        Music          None             1                  11\n12       -0.5068                 basketball             0                   1\n13       -0.4932                televisions             0                   2\n14       -0.4841                      pools             0                   3\n15       -0.4838                   flatware             0                   4\n16       -0.4718                    archery             0                   5\n17       -0.4687                  maternity             0                   6\n18       -0.4649               womens watch             0                   7\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.024402,
                    "execution_time": 0.010273,
                    "compile_time": 0.00013,
                    "planning_time": 0.005957
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.029409,
                    "execution_time": 0.015226,
                    "compile_time": 0.000137,
                    "planning_time": 0.005788
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100"
            }
        ],
        "preview": "\n/*    gross_margin   i_category       i_class  lochierarchy  rank_within_parent\n0        -0.4334         None          None             2                   1\n1        -0.4337      Jewelry          None             1                   1\n2        -0.4336  Electronics          None             1                   2\n3        -0.4336       Sports          None             1                   2\n4        -0.4335     Children          None             1                   4\n5        -0.4335        Shoes          None             1                   4\n6        -0.4335          Men          None             1                   4\n7        -0.4333         Home          None             1                   7\n8        -0.4333        Women          None             1                   7\n9        -0.4332                       None             1                   9\n10       -0.4332        Books          None             1                   9\n11       -0.4331        Music          None             1                  11\n12       -0.5068                 basketball             0                   1\n13       -0.4932                televisions             0                   2\n14       -0.4841                      pools             0                   3\n15       -0.4838                   flatware             0                   4\n16       -0.4718                    archery             0                   5\n17       -0.4687                  maternity             0                   6\n18       -0.4649               womens watch             0                   7\n...*/"
    }
]