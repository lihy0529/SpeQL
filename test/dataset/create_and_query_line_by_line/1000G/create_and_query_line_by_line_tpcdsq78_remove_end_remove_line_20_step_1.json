[
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) AS ws_qty,\n    sum(ws_wholesale_cost) AS ws_wc,\n    sum(ws_sales_price) AS ws_sp\n   from web_sales\n   left join web_returns on WR_ORDER_NUMBER=WS_ORDER_NUMBER and WS_ITEM_SK=WR_ITEM_SK\n   join date_dim on WS_SOLD_DATE_SK = D_DATE_SK\n   where WR_ORDER_NUMBER is null\n   group by d_year, WS_ITEM_SK, WS_BILL_CUSTOMER_SK\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk AS cs_customer_sk,\n    sum(cs_quantity) AS cs_qty,\n    sum(cs_wholesale_cost) AS cs_wc,\n    sum(cs_sales_price) AS cs_sp\n   from catalog_sales\n   left join catalog_returns on CR_ORDER_NUMBER=CS_ORDER_NUMBER and CS_ITEM_SK=CR_ITEM_SK\n   join date_dim on CS_SOLD_DATE_SK = D_DATE_SK\n   where CR_ORDER_NUMBER is null\n   group by d_year, CS_ITEM_SK, CS_BILL_CUSTOMER_SK\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) AS ss_qty,\n    sum(ss_wholesale_cost) AS ss_wc,\n    sum(ss_sales_price) AS ss_sp\n   from store_sales\n   left join store_returns on SR_TICKET_NUMBER=SS_TICKET_NUMBER and SS_ITEM_SK=SR_ITEM_SK\n   join date_dim on SS_SOLD_DATE_SK = D_DATE_SK\n   where SR_TICKET_NUMBER is null\n   group by d_year, SS_ITEM_SK, SS_CUSTOMER_SK\n/*CURSOR_IDENTIFIER*/\n  )\nselect * from ws\nunion all\nselect * from cs\nunion all\nselect * from ss;",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" FROM \"WS\" AS \"WS\" UNION ALL SELECT \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" FROM \"CS\" AS \"CS\" UNION ALL SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.106696,
                    "execution_time": 0.039999,
                    "compile_time": 0.000236,
                    "planning_time": 0.026769,
                    "create_size": 480
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.157922,
                    "execution_time": 0.086783,
                    "compile_time": 0.000247,
                    "planning_time": 0.029225,
                    "create_size": 480
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" FROM \"WS\" AS \"WS\" UNION ALL SELECT \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" FROM \"CS\" AS \"CS\" UNION ALL SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" FROM \"WS\" AS \"WS\" UNION ALL SELECT \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" FROM \"CS\" AS \"CS\" UNION ALL SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\"",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" FROM \"WS\" AS \"WS\" UNION ALL SELECT \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" FROM \"CS\" AS \"CS\" UNION ALL SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\""
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) AS ws_qty,\n    sum(ws_wholesale_cost) AS ws_wc,\n    sum(ws_sales_price) AS ws_sp\n   from web_sales\n   left join web_returns on ws_order_number=wr_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk AS cs_customer_sk,\n    sum(cs_quantity) AS cs_qty,\n    sum(cs_wholesale_cost) AS cs_wc,\n    sum(cs_sales_price) AS cs_sp\n   from catalog_sales\n   left join catalog_returns on cs_order_number=cr_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) AS ss_qty,\n    sum(ss_wholesale_cost) AS ss_wc,\n    sum(ss_sales_price) AS ss_sp\n   from store_sales\n   left join store_returns on ss_ticket_number=sr_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\nselect * from ws\nunion all\nselect * from cs\nunion all\nselect * from ss\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\"",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\""
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select * \n/*CURSOR_IDENTIFIER*/ from ws \n  full outer join cs on cs.cs_item_sk = ws.ws_item_sk \n  and cs.cs_customer_sk = ws.ws_customer_sk \n  and cs.cs_sold_year = ws.ws_sold_year \n  full outer join ss on ss.ss_item_sk = ws.ws_item_sk \n  and ss.ss_customer_sk = ws.ws_customer_sk \n  and ss.ss_sold_year = ws.ws_sold_year\n",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" , \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" , \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"WS\" AS \"WS\" FULL JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" FULL JOIN \"SS\" AS \"SS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" , \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" , \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"WS\" AS \"WS\" FULL JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" FULL JOIN \"SS\" AS \"SS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" , \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" , \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"WS\" AS \"WS\" FULL JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" FULL JOIN \"SS\" AS \"SS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\"",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" , \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" , \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"WS\" AS \"WS\" FULL JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" FULL JOIN \"SS\" AS \"SS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
            }
        ],
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk as ws_customer_sk,\n    sum(ws_quantity) as ws_qty,\n    sum(ws_wholesale_cost) as ws_wc,\n    sum(ws_sales_price) as ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk as cs_customer_sk,\n    sum(cs_quantity) as cs_qty,\n    sum(cs_wholesale_cost) as cs_wc,\n    sum(cs_sales_price) as cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) as ss_qty,\n    sum(ss_wholesale_cost) as ss_wc,\n    sum(ss_sales_price) as ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) as ratio,\nss_qty as store_qty, ss_wc as store_wholesale_cost, ss_sp as store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) as other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) as other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) as other_chan_sales_price\nfrom ss\nleft join ws on ss.ss_item_sk = ws.ws_item_sk\nleft join cs on ss.ss_item_sk = cs.cs_item_sk\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\"",
                "rewrite": "WITH WS AS ( SELECT \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\""
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk AS cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk) \nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\"",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\"",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) )"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) )",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) )"
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \nss_customer_sk /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk, \n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST"
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC , \"OTHER_CHAN_QTY\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST"
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select D_YEAR AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on WR_ORDER_NUMBER=WS_ORDER_NUMBER and ws_item_sk=WR_ITEM_SK\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where WR_ORDER_NUMBER is null\n   group by D_YEAR, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select D_YEAR AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on CR_ORDER_NUMBER=CS_ORDER_NUMBER and cs_item_sk=CR_ITEM_SK\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where CR_ORDER_NUMBER is null\n   group by D_YEAR, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select D_YEAR AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on SR_TICKET_NUMBER=SS_TICKET_NUMBER and ss_item_sk=SR_ITEM_SK\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where SR_TICKET_NUMBER is null\n   group by D_YEAR, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST"
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" , \"OTHER_CHAN_SALES_PRICE\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST"
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price,\n  ratio\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" , \"OTHER_CHAN_SALES_PRICE\" , \"RATIO\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST"
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price,\n  ratio\nlimit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST LIMIT 100"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" , \"OTHER_CHAN_SALES_PRICE\" , \"RATIO\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST LIMIT 100",
                "rewrite": "WITH WS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST LIMIT 100"
            }
        ],
        "preview": null
    }
]