[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(CS_QUANTITY*CS_LIST_PRICE) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n        group by c_last_name,c_first_name) as sales_summary\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALES_SUMMARY\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SALES_SUMMARY AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SALES_SUMMARY AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\"",
                "rewrite": "WITH SALES_SUMMARY AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\""
            }
        ],
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc, i_item_sk item_sk, d_date solddate, count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1999,2000,2001)\n  group by substring(i_item_desc,1,30), i_item_sk, d_date\n  having count(*) > 4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select ss_customer_sk c_customer_sk, sum(ss_quantity * ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1999,2000,2001)\n        group by ss_customer_sk)),\n best_ss_customer as\n (select ss_customer_sk c_customer_sk, sum(ss_quantity * ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by ss_customer_sk\n  having sum(ss_quantity * ss_sales_price) > (95/100.0) * (select tpcds_cmax from max_store_sales))\n  select c_last_name, c_first_name, sales\n from (select c_last_name, c_first_name, sum(cs_net_paid) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n/*CURSOR_IDENTIFIER*/\n         group by c_last_name, c_first_name) as customer_sales",
        "optimize": [
            "WITH \"CUSTOMER_SALES\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH CUSTOMER_SALES AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH CUSTOMER_SALES AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\"",
                "rewrite": "WITH CUSTOMER_SALES AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\""
            }
        ],
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_sales_price*cs_quantity) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         group by c_last_name,c_first_name)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" * \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.39525,
                    "execution_time": 0.305312,
                    "compile_time": 0.000269,
                    "planning_time": 0.02207,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.453498,
                    "execution_time": 0.298508,
                    "compile_time": 0.00025,
                    "planning_time": 0.083141,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 22.289035,
                    "execution_time": 22.071953,
                    "compile_time": 0.000423,
                    "planning_time": 0.035337,
                    "create_size": 640
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 23.039245,
                    "execution_time": 22.752825,
                    "compile_time": 0.000433,
                    "planning_time": 0.103576,
                    "create_size": 640
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_SALES_PRICE * CS_QUANTITY ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n        group by c_last_name,c_first_name) /* Added GROUP BY for c_last_name and c_first_name */ \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c.c_last_name, c.c_first_name, sum(ws_quantity*ws_list_price) sales\n       from web_sales\n            , customer c\n where ws_sold_date_sk in (select d_date_sk from date_dim where d_year = 1998 and d_moy = 4)\n     and ws_bill_customer_sk = c.c_customer_sk\n     and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n group by c_last_name,c_first_name) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_U_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"DATE_DIM\".\"D_DATE_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"C\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"C\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_3\" AS \"_U_3\" ON \"_U_3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"C\" ON \"C\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" WHERE NOT \"_U_3\".\"D_DATE_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"C\".\"C_LAST_NAME\" , \"C\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C.C_LAST_NAME , C.C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER AS C WHERE WS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 ) AND WS_BILL_CUSTOMER_SK = C.C_CUSTOMER_SK AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) > 4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(CS_QUANTITY*CS_LIST_PRICE) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(WS_QUANTITY*WS_LIST_PRICE) sales\n       from web_sales\n           ,customer\n           ,date_dim\n       where ws_bill_customer_sk = c_customer_sk\n         and ws_sold_date_sk = d_date_sk\n         and d_year = 1998\n         and ws_item_sk in (select item_sk from frequent_ss_items)\n       group by c_last_name,c_first_name\n) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1998 AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select ss_item_sk item_sk,count(*) cnt\n  from store_sales\n  where ss_sold_date_sk in (select d_date_sk from date_dim where d_year in (1998,1998 + 1,1998 + 2,1998 + 3))\n  group by ss_item_sk\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select ss_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n        where ss_sold_date_sk in (select d_date_sk from date_dim where d_year in (1998,1998+1,1998+2,1998+3))\n        group by ss_customer_sk)),\n best_ss_customer as\n (select ss_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n  where ss_customer_sk is not null\n  group by ss_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select tpcds_cmax from max_store_sales))\n select c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_sales_price) sales\n       from catalog_sales\n           ,customer\n       where cs_sold_date_sk in (select d_date_sk from date_dim where d_year = 1998 and d_moy = 4)\n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name\n     union all\n     select c_last_name,c_first_name,sum(ws_quantity*ws_sales_price) sales\n      from web_sales\n          ,customer\n      where ws_sold_date_sk in (select d_date_sk from date_dim where d_year = 1998 and d_moy = 4)\n        and ws_item_sk in (select item_sk from frequent_ss_items)\n        and ws_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n        and ws_bill_customer_sk = c_customer_sk\n     group by c_last_name,c_first_name\n ) as full_sales\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"_U_0\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"DATE_DIM\".\"D_DATE_SK\" ) , \"FREQUENT_SS_ITEMS\" AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"_U_0\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_ITEM_SK\" HAVING COUNT ( * ) > 4 ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"_U_0\" AS \"_U_1\" ON \"_U_1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"_U_1\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" WHERE NOT \"STORE_SALES\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"DATE_DIM\".\"D_DATE_SK\" ) , \"_U_4\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_5\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"FULL_SALES\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_3\" AS \"_U_3\" ON \"_U_3\".\"D_DATE_SK\" = \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" LEFT JOIN \"_U_4\" AS \"_U_4\" ON \"_U_4\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_5\" AS \"_U_5\" ON \"_U_5\".\"SS_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" WHERE NOT \"_U_3\".\"D_DATE_SK\" IS NULL AND NOT \"_U_4\".\"ITEM_SK\" IS NULL AND NOT \"_U_5\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_3\" AS \"_U_6\" ON \"_U_6\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"_U_4\" AS \"_U_7\" ON \"_U_7\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_5\" AS \"_U_8\" ON \"_U_8\".\"SS_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" WHERE NOT \"_U_6\".\"D_DATE_SK\" IS NULL AND NOT \"_U_7\".\"ITEM_SK\" IS NULL AND NOT \"_U_8\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"FULL_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"FULL_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"FULL_SALES\".\"SALES\" AS \"SALES\" FROM \"FULL_SALES\" AS \"FULL_SALES\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"DATE_DIM\".\"D_DATE_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.080703,
                    "execution_time": 0.030347,
                    "compile_time": 0.000259,
                    "planning_time": 0.024701,
                    "create_size": 16
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.386374,
                    "execution_time": 0.031658,
                    "compile_time": 0.238209,
                    "planning_time": 0.087122,
                    "create_size": 16
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_3\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_ITEM_SK\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 4.989874,
                    "execution_time": 4.887361,
                    "compile_time": 0.000371,
                    "planning_time": 0.026844,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 14.112996,
                    "execution_time": 10.851808,
                    "compile_time": 3.092419,
                    "planning_time": 0.086767,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"_U_1\" ON \"_U_1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"_U_1\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 17.502063,
                    "execution_time": 17.288061,
                    "compile_time": 0.000357,
                    "planning_time": 0.032166,
                    "create_size": 640
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 18.505595,
                    "execution_time": 18.237764,
                    "compile_time": 0.000357,
                    "planning_time": 0.088768,
                    "create_size": 640
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SS_ITEM_SK AS ITEM_SK , COUNT ( * ) AS CNT FROM STORE_SALES WHERE SS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) ) GROUP BY SS_ITEM_SK HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES WHERE SS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) ) GROUP BY SS_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES WHERE NOT SS_CUSTOMER_SK IS NULL GROUP BY SS_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT TPCDS_CMAX FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_SALES_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER WHERE CS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 ) AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_SALES_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER WHERE WS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 ) AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) AS FULL_SALES LIMIT 21",
                "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 48.073483,
                    "execution_time": 47.716338,
                    "compile_time": 0.002077,
                    "planning_time": 47.954364
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 52.383297,
                    "execution_time": 46.943582,
                    "compile_time": 5.000525,
                    "planning_time": 47.647046
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/"
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select ss_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by ss_customer_sk)),\n best_ss_customer as\n (select ss_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by ss_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select tpcds_cmax from max_store_sales))\nselect c_last_name, c_first_name, sales\nfrom (select c_last_name, c_first_name, sum(cs_quantity*cs_list_price) sales\n       from catalog_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n        and d_moy = 4 \n        and cs_sold_date_sk = d_date_sk \n        and cs_item_sk in (select item_sk from frequent_ss_items)\n        and cs_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n        and cs_bill_customer_sk = c_customer_sk \n      group by c_last_name, c_first_name\n     union all\n     select c_last_name, c_first_name, sum(ws_quantity*ws_list_price) sales\n      from web_sales\n          ,customer\n          ,date_dim \n      where d_year = 1998 \n        and d_moy = 4 \n        and ws_sold_date_sk = d_date_sk\n        and ws_item_sk in (select item_sk from frequent_ss_items)\n        and ws_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n        and ws_bill_customer_sk = c_customer_sk \n      group by c_last_name, c_first_name)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"SS_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"SS_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 21.969574,
                    "execution_time": 21.736491,
                    "compile_time": 0.000446,
                    "planning_time": 0.045866,
                    "create_size": 640
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 22.177013,
                    "execution_time": 21.873419,
                    "compile_time": 0.000447,
                    "planning_time": 0.103764,
                    "create_size": 640
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SS_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY SS_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT TPCDS_CMAX FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n/*CURSOR_IDENTIFIER*/\n         and ws_sold_date_sk = d_date_sk \n         group by c_last_name,c_first_name)",
        "optimize": [
            "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\", \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\", SUM(\"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\") AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\", \"CUSTOMER\".\"C_FIRST_NAME\"",
                "rewrite": "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\""
            }
        ],
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date_sk solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date_sk\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(CS_QUANTITY*CS_LIST_PRICE) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(WS_QUANTITY*WS_LIST_PRICE) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      ) as sales_summary\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) ) , \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE_SK\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"SALES_SUMMARY\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_2\" AS \"_U_3\" ON \"_U_3\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.080495,
                    "execution_time": 0.031124,
                    "compile_time": 0.00024,
                    "planning_time": 0.024816,
                    "create_size": 20
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.289556,
                    "execution_time": 0.031228,
                    "compile_time": 0.144271,
                    "planning_time": 0.086875,
                    "create_size": 20
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE_SK\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 21.657766,
                    "execution_time": 21.436863,
                    "compile_time": 0.000447,
                    "planning_time": 0.02864,
                    "create_size": 640
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 22.039734,
                    "execution_time": 21.748945,
                    "compile_time": 0.000456,
                    "planning_time": 0.089724,
                    "create_size": 640
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE_SK AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE_SK HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) AS SALES_SUMMARY LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name, c_first_name\n) as sales_data\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"SALES_DATA\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_DATA\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_DATA\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_DATA\".\"SALES\" AS \"SALES\" FROM \"SALES_DATA\" AS \"SALES_DATA\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) AS SALES_DATA LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n/*CURSOR_IDENTIFIER*/\n       group by c_last_name,c_first_name)\n",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n     order by c_last_name,c_first_name,sales\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\" ORDER BY \"C_LAST_NAME\" NULLS LAST , \"C_FIRST_NAME\" NULLS LAST , \"SALES\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) ORDER BY C_LAST_NAME NULLS FIRST , C_FIRST_NAME NULLS FIRST , SALES NULLS FIRST LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n     order by c_last_name,c_first_name,sales\n  limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\" ORDER BY \"C_LAST_NAME\" NULLS LAST , \"C_FIRST_NAME\" NULLS LAST , \"SALES\" NULLS LAST LIMIT 100"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) ORDER BY C_LAST_NAME NULLS FIRST , C_FIRST_NAME NULLS FIRST , SALES NULLS FIRST LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    }
]