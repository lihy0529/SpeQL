[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) as sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) as rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1\n left join v1 as v1_lag on v1.rn = v1_lag.rn + 1\n left join v1 as v1_lead on v1.rn = v1_lead.rn - 1\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category \n/*CURSOR_IDENTIFIER*/)\nselect * from v2;",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"CALL_CENTER\".\"CC_NAME\" AS \"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"ITEM\" AS \"ITEM\" JOIN \"CATALOG_SALES\" AS \"CATALOG_SALES\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" JOIN \"CALL_CENTER\" AS \"CALL_CENTER\" ON \"CALL_CENTER\".\"CC_CALL_CENTER_SK\" = \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"CC_NAME\" AS \"CC_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" LEFT JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 LEFT JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 WHERE \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"CALL_CENTER\".\"CC_NAME\" AS \"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"ITEM\" AS \"ITEM\" JOIN \"CATALOG_SALES\" AS \"CATALOG_SALES\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" JOIN \"CALL_CENTER\" AS \"CALL_CENTER\" ON \"CALL_CENTER\".\"CC_CALL_CENTER_SK\" = \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 7.196926,
                    "execution_time": 6.652028,
                    "compile_time": 0.000748,
                    "planning_time": 0.061611,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 16.22922,
                    "execution_time": 9.573155,
                    "compile_time": 6.023856,
                    "planning_time": 0.146933,
                    "create_size": 1280
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 WHERE \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 60,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_1\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 WHERE \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" LIMIT 21",
                "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum    nsum\n0            NY Metro_3    2001      1             335.72     167.79  145936.98  262.96\n1              NY Metro    2001      1             330.13     188.29  145936.98  262.96\n2       North Midwest_1    2001      1             374.32     249.28  145936.98  262.96\n3         Hawaii/Alaska    2001      1             358.41     222.56  145936.98  262.96\n4       North Midwest_2    2001      1             450.22     242.66  145936.98  262.96\n5            California    2001      1             279.88     338.13  145936.98  262.96\n6            NY Metro_2    2001      1             303.53     192.11  145936.98  262.96\n7          California_2    2001      1             378.53     264.73  145936.98  262.96\n8            California    2001      1             440.86     106.63  145936.98  262.96\n9       North Midwest_2    2001      1             396.52     456.46  145936.98  262.96\n10        Hawaii/Alaska    2001      1             399.04     276.96  145936.98  262.96\n11         California_1    2001      1             317.04     511.20  145936.98  262.96\n12      North Midwest_3    2002      1             101.72     101.72  145936.98  262.96\n13           NY Metro_1    2002      1             251.96     251.96  145936.98  262.96\n14  Pacific Northwest_2    2001      1             339.00     167.44  145936.98  262.96\n15    Pacific Northwest    2001      1             364.41      93.09  145936.98  262.96\n16      North Midwest_2    2001      2             355.19     257.82  145936.98  262.96\n17      North Midwest_1    2001      2             251.30     129.60  145936.98  262.96\n18  Pacific Northwest_1    2001      1             475.38     208.66  145936.98  262.96\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 17.211639,
                    "execution_time": 17.187319,
                    "compile_time": 0.000201,
                    "planning_time": 0.011507
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 17.101778,
                    "execution_time": 17.030958,
                    "compile_time": 0.004101,
                    "planning_time": 0.047717
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_1\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 WHERE \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_1\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 WHERE \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\""
            }
        ],
        "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum    nsum\n0            NY Metro_3    2001      1             335.72     167.79  145936.98  262.96\n1              NY Metro    2001      1             330.13     188.29  145936.98  262.96\n2       North Midwest_1    2001      1             374.32     249.28  145936.98  262.96\n3         Hawaii/Alaska    2001      1             358.41     222.56  145936.98  262.96\n4       North Midwest_2    2001      1             450.22     242.66  145936.98  262.96\n5            California    2001      1             279.88     338.13  145936.98  262.96\n6            NY Metro_2    2001      1             303.53     192.11  145936.98  262.96\n7          California_2    2001      1             378.53     264.73  145936.98  262.96\n8            California    2001      1             440.86     106.63  145936.98  262.96\n9       North Midwest_2    2001      1             396.52     456.46  145936.98  262.96\n10        Hawaii/Alaska    2001      1             399.04     276.96  145936.98  262.96\n11         California_1    2001      1             317.04     511.20  145936.98  262.96\n12      North Midwest_3    2002      1             101.72     101.72  145936.98  262.96\n13           NY Metro_1    2002      1             251.96     251.96  145936.98  262.96\n14  Pacific Northwest_2    2001      1             339.00     167.44  145936.98  262.96\n15    Pacific Northwest    2001      1             364.41      93.09  145936.98  262.96\n16      North Midwest_2    2001      2             355.19     257.82  145936.98  262.96\n17      North Midwest_1    2001      2             251.30     129.60  145936.98  262.96\n18  Pacific Northwest_1    2001      1             475.38     208.66  145936.98  262.96\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) as sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) as rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk = cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2000 and d_moy = 12) or\n         ( d_year = 2002 and d_moy = 1)\n       )\n group by i_category, i_brand,\n          cc_name, d_year, d_moy),\n v2 as(\n select v1.cc_name,\n        v1.d_year, v1.d_moy,\n        v1.avg_monthly_sales,\n        v1.sum_sales,\n        lag(v1.sum_sales) over (partition by v1.i_category, v1.i_brand, v1.cc_name order by v1.d_year, v1.d_moy) as psum,\n        lead(v1.sum_sales) over (partition by v1.i_category, v1.i_brand, v1.cc_name order by v1.d_year, v1.d_moy) as nsum\n from v1\n)\nselect * from v2\nwhere /*CURSOR_IDENTIFIER*/ 1 = 1",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" AS \"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"CATALOG_SALES\" AS \"CATALOG_SALES\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" JOIN \"CALL_CENTER\" AS \"CALL_CENTER\" ON \"CALL_CENTER\".\"CC_CALL_CENTER_SK\" = \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) , \"V2\" AS ( SELECT \"V1\".\"CC_NAME\" AS \"CC_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , LAG ( \"V1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"V1\".\"I_CATEGORY\" , \"V1\".\"I_BRAND\" , \"V1\".\"CC_NAME\" ORDER BY \"V1\".\"D_YEAR\" NULLS LAST , \"V1\".\"D_MOY\" NULLS LAST ) AS \"PSUM\" , LEAD ( \"V1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"V1\".\"I_CATEGORY\" , \"V1\".\"I_BRAND\" , \"V1\".\"CC_NAME\" ORDER BY \"V1\".\"D_YEAR\" NULLS LAST , \"V1\".\"D_MOY\" NULLS LAST ) AS \"NSUM\" FROM \"V1\" AS \"V1\" ) SELECT \"V2\".\"CC_NAME\" AS \"CC_NAME\" , \"V2\".\"D_YEAR\" AS \"D_YEAR\" , \"V2\".\"D_MOY\" AS \"D_MOY\" , \"V2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V2\".\"PSUM\" AS \"PSUM\" , \"V2\".\"NSUM\" AS \"NSUM\" FROM \"V2\" AS \"V2\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" AS \"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"CATALOG_SALES\" AS \"CATALOG_SALES\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" JOIN \"CALL_CENTER\" AS \"CALL_CENTER\" ON \"CALL_CENTER\".\"CC_CALL_CENTER_SK\" = \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 7.383157,
                    "execution_time": 6.796111,
                    "compile_time": 0.000695,
                    "planning_time": 0.060738,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 13.65309,
                    "execution_time": 7.289271,
                    "compile_time": 5.717311,
                    "planning_time": 0.142223,
                    "create_size": 1280
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"SPEQLITE_TEMP_TABLE_2\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , LAG ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_2\".\"CC_NAME\" ORDER BY \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" NULLS LAST ) AS \"PSUM\" , LEAD ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_2\".\"CC_NAME\" ORDER BY \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" NULLS LAST ) AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.776365,
                    "execution_time": 0.1531,
                    "compile_time": 0.000493,
                    "planning_time": 0.005702,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.852918,
                    "execution_time": 0.152738,
                    "compile_time": 0.005263,
                    "planning_time": 0.065362,
                    "create_size": 1280
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_3\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" LIMIT 21",
                "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0          NY Metro    2001      9           57614.83   76369.33   77969.54   78368.43\n1          NY Metro    2001     10           57614.83   78368.43   76369.33  112677.45\n2          NY Metro    2001     11           57614.83  112677.45   78368.43  116555.76\n3          NY Metro    2001     12           57614.83  116555.76  112677.45   30855.83\n4          NY Metro    2002      1           30855.83   30855.83  116555.76        NaN\n5     North Midwest    2000     12          114846.51  114846.51        NaN   32101.01\n6     North Midwest    2001      1           57135.15   32101.01  114846.51   29151.83\n7     North Midwest    2001      2           57135.15   29151.83   32101.01   35881.89\n8     North Midwest    2001      3           57135.15   35881.89   29151.83   30694.91\n9     North Midwest    2001      4           57135.15   30694.91   35881.89   36647.53\n10    North Midwest    2001      5           57135.15   36647.53   30694.91   32307.37\n11    North Midwest    2001      6           57135.15   32307.37   36647.53   33043.51\n12    North Midwest    2001      7           57135.15   33043.51   32307.37   78112.67\n13    North Midwest    2001      8           57135.15   78112.67   33043.51   77718.20\n14    North Midwest    2001      9           57135.15   77718.20   78112.67   75304.78\n15    North Midwest    2001     10           57135.15   75304.78   77718.20  109771.52\n16    North Midwest    2001     11           57135.15  109771.52   75304.78  114886.61\n17    North Midwest    2001     12           57135.15  114886.61  109771.52   31487.68\n18    North Midwest    2002      1           31487.68   31487.68  114886.61        NaN\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018408,
                    "execution_time": 0.007883,
                    "compile_time": 4.8e-05,
                    "planning_time": 0.004054
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.056349,
                    "execution_time": 0.008105,
                    "compile_time": 5e-05,
                    "planning_time": 0.039627
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_3\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_3\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\""
            }
        ],
        "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0          NY Metro    2001      9           57614.83   76369.33   77969.54   78368.43\n1          NY Metro    2001     10           57614.83   78368.43   76369.33  112677.45\n2          NY Metro    2001     11           57614.83  112677.45   78368.43  116555.76\n3          NY Metro    2001     12           57614.83  116555.76  112677.45   30855.83\n4          NY Metro    2002      1           30855.83   30855.83  116555.76        NaN\n5     North Midwest    2000     12          114846.51  114846.51        NaN   32101.01\n6     North Midwest    2001      1           57135.15   32101.01  114846.51   29151.83\n7     North Midwest    2001      2           57135.15   29151.83   32101.01   35881.89\n8     North Midwest    2001      3           57135.15   35881.89   29151.83   30694.91\n9     North Midwest    2001      4           57135.15   30694.91   35881.89   36647.53\n10    North Midwest    2001      5           57135.15   36647.53   30694.91   32307.37\n11    North Midwest    2001      6           57135.15   32307.37   36647.53   33043.51\n12    North Midwest    2001      7           57135.15   33043.51   32307.37   78112.67\n13    North Midwest    2001      8           57135.15   78112.67   33043.51   77718.20\n14    North Midwest    2001      9           57135.15   77718.20   78112.67   75304.78\n15    North Midwest    2001     10           57135.15   75304.78   77718.20  109771.52\n16    North Midwest    2001     11           57135.15  109771.52   75304.78  114886.61\n17    North Midwest    2001     12           57135.15  114886.61  109771.52   31487.68\n18    North Midwest    2002      1           31487.68   31487.68  114886.61        NaN\n...*/"
    },
    {
        "input": "with /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) as sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) as rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk = cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2000 and d_moy = 12) or\n         ( d_year = 2002 and d_moy = 1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name,\n        v1.d_year, v1.d_moy,\n        v1.avg_monthly_sales,\n        v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1\n left join v1 as v1_lag\n on v1.i_category = v1_lag.i_category\n and v1.i_brand = v1_lag.i_brand\n and v1.d_year = v1_lag.d_year\n and v1.d_moy = v1_lag.d_moy + 1\n left join v1 as v1_lead\n on v1.i_category = v1_lead.i_category\n and v1.i_brand = v1_lead.i_brand\n and v1.d_year = v1_lead.d_year\n and v1.d_moy = v1_lead.d_moy - 1\n/*CURSOR_IDENTIFIER*/\n)\nselect *\nfrom v2\nwhere (psum is null or sum_sales > psum)\nand (nsum is null or sum_sales > nsum);",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" AS \"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"CATALOG_SALES\" AS \"CATALOG_SALES\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" JOIN \"CALL_CENTER\" AS \"CALL_CENTER\" ON \"CALL_CENTER\".\"CC_CALL_CENTER_SK\" = \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"CC_NAME\" AS \"CC_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" LEFT JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"V1\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"V1\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" LEFT JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"V1\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"V1\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" WHERE ( \"V1\".\"SUM_SALES\" > \"V1_LAG\".\"SUM_SALES\" OR \"V1_LAG\".\"SUM_SALES\" IS NULL ) AND ( \"V1\".\"SUM_SALES\" > \"V1_LEAD\".\"SUM_SALES\" OR \"V1_LEAD\".\"SUM_SALES\" IS NULL )"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"SPEQLITE_TEMP_TABLE_2\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" WHERE ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" > \"V1_LAG\".\"SUM_SALES\" OR \"V1_LAG\".\"SUM_SALES\" IS NULL ) AND ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" > \"V1_LEAD\".\"SUM_SALES\" OR \"V1_LEAD\".\"SUM_SALES\" IS NULL )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.141508,
                    "execution_time": 1.424698,
                    "compile_time": 0.000523,
                    "planning_time": 0.014157,
                    "create_size": 2560
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 2.230387,
                    "execution_time": 1.431247,
                    "compile_time": 0.005791,
                    "planning_time": 0.072024,
                    "create_size": 2560
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_4\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*           cc_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0   Mid Atlantic_2    2001      9             427.75     645.18  370.65  457.78\n1   Mid Atlantic_2    2001      9             427.75     645.18  370.65  432.26\n2   Mid Atlantic_2    2001      9             427.75     645.18  370.65  355.08\n3   Mid Atlantic_2    2001      9             427.75     645.18  370.65  481.71\n4   Mid Atlantic_2    2001      9             427.75     645.18  370.65  542.64\n5   Mid Atlantic_2    2001      9             427.75     645.18  370.65  229.83\n6   Mid Atlantic_2    2001      9             427.75     645.18  622.03  326.13\n7   Mid Atlantic_2    2001      9             427.75     645.18  622.03  644.18\n8   Mid Atlantic_2    2001      9             427.75     645.18  622.03  380.37\n9   Mid Atlantic_2    2001      9             427.75     645.18  622.03  297.21\n10  Mid Atlantic_2    2001      9             427.75     645.18  622.03  109.84\n11  Mid Atlantic_2    2001      9             427.75     645.18  622.03  311.25\n12  Mid Atlantic_2    2001      9             427.75     645.18  622.03  310.57\n13  Mid Atlantic_2    2001      9             427.75     645.18  622.03  356.79\n14  Mid Atlantic_2    2001      9             427.75     645.18  622.03  605.08\n15  Mid Atlantic_2    2001      9             427.75     645.18  622.03  457.78\n16  Mid Atlantic_2    2001      9             427.75     645.18  622.03  432.26\n17  Mid Atlantic_2    2001      9             427.75     645.18  622.03  355.08\n18  Mid Atlantic_2    2001      9             427.75     645.18  622.03  481.71\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.01798,
                    "execution_time": 0.007879,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.00394
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.055961,
                    "execution_time": 0.008062,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.039327
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" WHERE ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" > \"V1_LAG\".\"SUM_SALES\" OR \"V1_LAG\".\"SUM_SALES\" IS NULL ) AND ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" > \"V1_LEAD\".\"SUM_SALES\" OR \"V1_LEAD\".\"SUM_SALES\" IS NULL )",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_4\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*           cc_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0   Mid Atlantic_2    2001      9             427.75     645.18  370.65  457.78\n1   Mid Atlantic_2    2001      9             427.75     645.18  370.65  432.26\n2   Mid Atlantic_2    2001      9             427.75     645.18  370.65  355.08\n3   Mid Atlantic_2    2001      9             427.75     645.18  370.65  481.71\n4   Mid Atlantic_2    2001      9             427.75     645.18  370.65  542.64\n5   Mid Atlantic_2    2001      9             427.75     645.18  370.65  229.83\n6   Mid Atlantic_2    2001      9             427.75     645.18  622.03  326.13\n7   Mid Atlantic_2    2001      9             427.75     645.18  622.03  644.18\n8   Mid Atlantic_2    2001      9             427.75     645.18  622.03  380.37\n9   Mid Atlantic_2    2001      9             427.75     645.18  622.03  297.21\n10  Mid Atlantic_2    2001      9             427.75     645.18  622.03  109.84\n11  Mid Atlantic_2    2001      9             427.75     645.18  622.03  311.25\n12  Mid Atlantic_2    2001      9             427.75     645.18  622.03  310.57\n13  Mid Atlantic_2    2001      9             427.75     645.18  622.03  356.79\n14  Mid Atlantic_2    2001      9             427.75     645.18  622.03  605.08\n15  Mid Atlantic_2    2001      9             427.75     645.18  622.03  457.78\n16  Mid Atlantic_2    2001      9             427.75     645.18  622.03  432.26\n17  Mid Atlantic_2    2001      9             427.75     645.18  622.03  355.08\n18  Mid Atlantic_2    2001      9             427.75     645.18  622.03  481.71\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) as sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) as rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1, v1 as v1_lag, v1 as v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.cc_name = v1_lag.cc_name and\n       v1.cc_name = v1_lead.cc_name and\n       v1.d_year = v1_lag.d_year + 1 and\n       v1.d_year = v1_lead.d_year - 1\n/*CURSOR_IDENTIFIER*/\n)\nselect * from v2;",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.D_YEAR = V1_LAG.D_YEAR + 1 AND V1.D_YEAR = V1_LEAD.D_YEAR - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum    nsum\n0       North Midwest_2    2001      1            2597.66    1568.92  3716.22  575.34\n1       North Midwest_2    2001      2            2597.66    1048.66  3716.22  575.34\n2       North Midwest_2    2001      4            2597.66    1286.25  3716.22  575.34\n3       North Midwest_2    2001      8            2597.66    4072.95  3716.22  575.34\n4       North Midwest_2    2001      3            2597.66    1315.17  3716.22  575.34\n5       North Midwest_2    2001      7            2597.66    1488.40  3716.22  575.34\n6       North Midwest_2    2001      5            2597.66     995.06  3716.22  575.34\n7       North Midwest_2    2001      6            2597.66    2208.42  3716.22  575.34\n8       North Midwest_2    2001     11            2597.66    4854.89  3716.22  575.34\n9       North Midwest_2    2001      9            2597.66    2230.33  3716.22  575.34\n10      North Midwest_2    2001     10            2597.66    3949.35  3716.22  575.34\n11      North Midwest_2    2001     12            2597.66    6153.53  3716.22  575.34\n12  Pacific Northwest_1    2001      4            2429.23    1479.23  3395.81  617.19\n13  Pacific Northwest_1    2001      8            2429.23    2816.37  3395.81  617.19\n14  Pacific Northwest_1    2001      6            2429.23    1672.51  3395.81  617.19\n15  Pacific Northwest_1    2001     11            2429.23    4071.81  3395.81  617.19\n16  Pacific Northwest_1    2001     12            2429.23    5098.74  3395.81  617.19\n17  Pacific Northwest_1    2001      9            2429.23    3276.42  3395.81  617.19\n18  Pacific Northwest_1    2001     10            2429.23    2516.46  3395.81  617.19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 13.591162,
                    "execution_time": 12.971159,
                    "compile_time": 0.001132,
                    "planning_time": 6.926343
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 25.915427,
                    "execution_time": 13.103416,
                    "compile_time": 12.131071,
                    "planning_time": 12.635416
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum    nsum\n0       North Midwest_2    2001      1            2597.66    1568.92  3716.22  575.34\n1       North Midwest_2    2001      2            2597.66    1048.66  3716.22  575.34\n2       North Midwest_2    2001      4            2597.66    1286.25  3716.22  575.34\n3       North Midwest_2    2001      8            2597.66    4072.95  3716.22  575.34\n4       North Midwest_2    2001      3            2597.66    1315.17  3716.22  575.34\n5       North Midwest_2    2001      7            2597.66    1488.40  3716.22  575.34\n6       North Midwest_2    2001      5            2597.66     995.06  3716.22  575.34\n7       North Midwest_2    2001      6            2597.66    2208.42  3716.22  575.34\n8       North Midwest_2    2001     11            2597.66    4854.89  3716.22  575.34\n9       North Midwest_2    2001      9            2597.66    2230.33  3716.22  575.34\n10      North Midwest_2    2001     10            2597.66    3949.35  3716.22  575.34\n11      North Midwest_2    2001     12            2597.66    6153.53  3716.22  575.34\n12  Pacific Northwest_1    2001      4            2429.23    1479.23  3395.81  617.19\n13  Pacific Northwest_1    2001      8            2429.23    2816.37  3395.81  617.19\n14  Pacific Northwest_1    2001      6            2429.23    1672.51  3395.81  617.19\n15  Pacific Northwest_1    2001     11            2429.23    4071.81  3395.81  617.19\n16  Pacific Northwest_1    2001     12            2429.23    5098.74  3395.81  617.19\n17  Pacific Northwest_1    2001      9            2429.23    3276.42  3395.81  617.19\n18  Pacific Northwest_1    2001     10            2429.23    2516.46  3395.81  617.19\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n/*CURSOR_IDENTIFIER*/\nselect *\nfrom v2",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*         cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0     California    2001      1           67993.60   45087.74  146747.42   37744.31\n1     California    2001      2           67993.60   37744.31   45087.74   37363.29\n2     California    2001      3           67993.60   37363.29   37744.31   40350.20\n3     California    2001      4           67993.60   40350.20   37363.29   39885.62\n4     California    2001      5           67993.60   39885.62   40350.20   37909.80\n5     California    2001      6           67993.60   37909.80   39885.62   40301.01\n6     California    2001      7           67993.60   40301.01   37909.80   93774.70\n7     California    2001      8           67993.60   93774.70   40301.01   84975.11\n8     California    2001      9           67993.60   84975.11   93774.70   93941.50\n9     California    2001     10           67993.60   93941.50   84975.11  130975.83\n10    California    2001     11           67993.60  130975.83   93941.50  133614.09\n11    California    2001     12           67993.60  133614.09  130975.83   41227.51\n12  California_1    2001      1           67420.25   40140.14  141510.46   34946.67\n13  California_1    2001      2           67420.25   34946.67   40140.14   41330.60\n14  California_1    2001      3           67420.25   41330.60   34946.67   38159.44\n15  California_1    2001      4           67420.25   38159.44   41330.60   42424.89\n16  California_1    2001      5           67420.25   42424.89   38159.44   39592.13\n17  California_1    2001      6           67420.25   39592.13   42424.89   37996.83\n18  California_1    2001      7           67420.25   37996.83   39592.13   82981.07\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 13.748443,
                    "execution_time": 13.147104,
                    "compile_time": 0.08436,
                    "planning_time": 7.070398
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 22.695022,
                    "execution_time": 13.153618,
                    "compile_time": 8.953547,
                    "planning_time": 16.024864
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*         cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0     California    2001      1           67993.60   45087.74  146747.42   37744.31\n1     California    2001      2           67993.60   37744.31   45087.74   37363.29\n2     California    2001      3           67993.60   37363.29   37744.31   40350.20\n3     California    2001      4           67993.60   40350.20   37363.29   39885.62\n4     California    2001      5           67993.60   39885.62   40350.20   37909.80\n5     California    2001      6           67993.60   37909.80   39885.62   40301.01\n6     California    2001      7           67993.60   40301.01   37909.80   93774.70\n7     California    2001      8           67993.60   93774.70   40301.01   84975.11\n8     California    2001      9           67993.60   84975.11   93774.70   93941.50\n9     California    2001     10           67993.60   93941.50   84975.11  130975.83\n10    California    2001     11           67993.60  130975.83   93941.50  133614.09\n11    California    2001     12           67993.60  133614.09  130975.83   41227.51\n12  California_1    2001      1           67420.25   40140.14  141510.46   34946.67\n13  California_1    2001      2           67420.25   34946.67   40140.14   41330.60\n14  California_1    2001      3           67420.25   41330.60   34946.67   38159.44\n15  California_1    2001      4           67420.25   38159.44   41330.60   42424.89\n16  California_1    2001      5           67420.25   42424.89   38159.44   39592.13\n17  California_1    2001      6           67420.25   39592.13   42424.89   37996.83\n18  California_1    2001      7           67420.25   37996.83   39592.13   82981.07\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0      California_2    2001      1           67667.31   39775.06  145936.98   35750.46\n1      California_2    2001      2           67667.31   35750.46   39775.06   40076.95\n2      California_2    2001      3           67667.31   40076.95   35750.46   38498.89\n3      California_2    2001      4           67667.31   38498.89   40076.95   40359.76\n4      California_2    2001      5           67667.31   40359.76   38498.89   38044.74\n5      California_2    2001      6           67667.31   38044.74   40359.76   42869.14\n6      California_2    2001      7           67667.31   42869.14   38044.74   87653.41\n7      California_2    2001      8           67667.31   87653.41   42869.14   88930.09\n8      California_2    2001      9           67667.31   88930.09   87653.41   89810.14\n9      California_2    2001     10           67667.31   89810.14   88930.09  131424.18\n10     California_2    2001     11           67667.31  131424.18   89810.14  138814.97\n11     California_2    2001     12           67667.31  138814.97  131424.18   39481.66\n12  Hawaii/Alaska_1    2001      1           66717.02   38987.04  145606.49   34858.25\n13  Hawaii/Alaska_1    2001      2           66717.02   34858.25   38987.04   37561.98\n14  Hawaii/Alaska_1    2001      3           66717.02   37561.98   34858.25   38143.98\n15  Hawaii/Alaska_1    2001      4           66717.02   38143.98   37561.98   39486.09\n16  Hawaii/Alaska_1    2001      5           66717.02   39486.09   38143.98   40563.59\n17  Hawaii/Alaska_1    2001      6           66717.02   40563.59   39486.09   37399.76\n18  Hawaii/Alaska_1    2001      7           66717.02   37399.76   40563.59   91111.95\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 13.633132,
                    "execution_time": 13.105755,
                    "compile_time": 0.001181,
                    "planning_time": 6.935502
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.622823,
                    "execution_time": 13.103515,
                    "compile_time": 0.001195,
                    "planning_time": 6.961421
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0      California_2    2001      1           67667.31   39775.06  145936.98   35750.46\n1      California_2    2001      2           67667.31   35750.46   39775.06   40076.95\n2      California_2    2001      3           67667.31   40076.95   35750.46   38498.89\n3      California_2    2001      4           67667.31   38498.89   40076.95   40359.76\n4      California_2    2001      5           67667.31   40359.76   38498.89   38044.74\n5      California_2    2001      6           67667.31   38044.74   40359.76   42869.14\n6      California_2    2001      7           67667.31   42869.14   38044.74   87653.41\n7      California_2    2001      8           67667.31   87653.41   42869.14   88930.09\n8      California_2    2001      9           67667.31   88930.09   87653.41   89810.14\n9      California_2    2001     10           67667.31   89810.14   88930.09  131424.18\n10     California_2    2001     11           67667.31  131424.18   89810.14  138814.97\n11     California_2    2001     12           67667.31  138814.97  131424.18   39481.66\n12  Hawaii/Alaska_1    2001      1           66717.02   38987.04  145606.49   34858.25\n13  Hawaii/Alaska_1    2001      2           66717.02   34858.25   38987.04   37561.98\n14  Hawaii/Alaska_1    2001      3           66717.02   37561.98   34858.25   38143.98\n15  Hawaii/Alaska_1    2001      4           66717.02   38143.98   37561.98   39486.09\n16  Hawaii/Alaska_1    2001      5           66717.02   39486.09   38143.98   40563.59\n17  Hawaii/Alaska_1    2001      6           66717.02   40563.59   39486.09   37399.76\n18  Hawaii/Alaska_1    2001      7           66717.02   37399.76   40563.59   91111.95\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0      California_2    2001      1           67667.31   39775.06  145936.98   35750.46\n1      California_2    2001      2           67667.31   35750.46   39775.06   40076.95\n2      California_2    2001      3           67667.31   40076.95   35750.46   38498.89\n3      California_2    2001      4           67667.31   38498.89   40076.95   40359.76\n4      California_2    2001      5           67667.31   40359.76   38498.89   38044.74\n5      California_2    2001      6           67667.31   38044.74   40359.76   42869.14\n6      California_2    2001      7           67667.31   42869.14   38044.74   87653.41\n7      California_2    2001      8           67667.31   87653.41   42869.14   88930.09\n8      California_2    2001      9           67667.31   88930.09   87653.41   89810.14\n9      California_2    2001     10           67667.31   89810.14   88930.09  131424.18\n10     California_2    2001     11           67667.31  131424.18   89810.14  138814.97\n11     California_2    2001     12           67667.31  138814.97  131424.18   39481.66\n12  Hawaii/Alaska_1    2001      1           66717.02   38987.04  145606.49   34858.25\n13  Hawaii/Alaska_1    2001      2           66717.02   34858.25   38987.04   37561.98\n14  Hawaii/Alaska_1    2001      3           66717.02   37561.98   34858.25   38143.98\n15  Hawaii/Alaska_1    2001      4           66717.02   38143.98   37561.98   39486.09\n16  Hawaii/Alaska_1    2001      5           66717.02   39486.09   38143.98   40563.59\n17  Hawaii/Alaska_1    2001      6           66717.02   40563.59   39486.09   37399.76\n18  Hawaii/Alaska_1    2001      7           66717.02   37399.76   40563.59   91111.95\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 13.39353,
                    "execution_time": 12.864692,
                    "compile_time": 0.00123,
                    "planning_time": 6.695294
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.666398,
                    "execution_time": 13.13696,
                    "compile_time": 0.001201,
                    "planning_time": 6.972179
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0      California_2    2001      1           67667.31   39775.06  145936.98   35750.46\n1      California_2    2001      2           67667.31   35750.46   39775.06   40076.95\n2      California_2    2001      3           67667.31   40076.95   35750.46   38498.89\n3      California_2    2001      4           67667.31   38498.89   40076.95   40359.76\n4      California_2    2001      5           67667.31   40359.76   38498.89   38044.74\n5      California_2    2001      6           67667.31   38044.74   40359.76   42869.14\n6      California_2    2001      7           67667.31   42869.14   38044.74   87653.41\n7      California_2    2001      8           67667.31   87653.41   42869.14   88930.09\n8      California_2    2001      9           67667.31   88930.09   87653.41   89810.14\n9      California_2    2001     10           67667.31   89810.14   88930.09  131424.18\n10     California_2    2001     11           67667.31  131424.18   89810.14  138814.97\n11     California_2    2001     12           67667.31  138814.97  131424.18   39481.66\n12  Hawaii/Alaska_1    2001      1           66717.02   38987.04  145606.49   34858.25\n13  Hawaii/Alaska_1    2001      2           66717.02   34858.25   38987.04   37561.98\n14  Hawaii/Alaska_1    2001      3           66717.02   37561.98   34858.25   38143.98\n15  Hawaii/Alaska_1    2001      4           66717.02   38143.98   37561.98   39486.09\n16  Hawaii/Alaska_1    2001      5           66717.02   39486.09   38143.98   40563.59\n17  Hawaii/Alaska_1    2001      6           66717.02   40563.59   39486.09   37399.76\n18  Hawaii/Alaska_1    2001      7           66717.02   37399.76   40563.59   91111.95\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 LIMIT 21",
                "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0      California_2    2001      1           67667.31   39775.06  145936.98   35750.46\n1      California_2    2001      2           67667.31   35750.46   39775.06   40076.95\n2      California_2    2001      3           67667.31   40076.95   35750.46   38498.89\n3      California_2    2001      4           67667.31   38498.89   40076.95   40359.76\n4      California_2    2001      5           67667.31   40359.76   38498.89   38044.74\n5      California_2    2001      6           67667.31   38044.74   40359.76   42869.14\n6      California_2    2001      7           67667.31   42869.14   38044.74   87653.41\n7      California_2    2001      8           67667.31   87653.41   42869.14   88930.09\n8      California_2    2001      9           67667.31   88930.09   87653.41   89810.14\n9      California_2    2001     10           67667.31   89810.14   88930.09  131424.18\n10     California_2    2001     11           67667.31  131424.18   89810.14  138814.97\n11     California_2    2001     12           67667.31  138814.97  131424.18   39481.66\n12  Hawaii/Alaska_1    2001      1           66717.02   38987.04  145606.49   34858.25\n13  Hawaii/Alaska_1    2001      2           66717.02   34858.25   38987.04   37561.98\n14  Hawaii/Alaska_1    2001      3           66717.02   37561.98   34858.25   38143.98\n15  Hawaii/Alaska_1    2001      4           66717.02   38143.98   37561.98   39486.09\n16  Hawaii/Alaska_1    2001      5           66717.02   39486.09   38143.98   40563.59\n17  Hawaii/Alaska_1    2001      6           66717.02   40563.59   39486.09   37399.76\n18  Hawaii/Alaska_1    2001      7           66717.02   37399.76   40563.59   91111.95\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 13.388207,
                    "execution_time": 12.867921,
                    "compile_time": 0.001323,
                    "planning_time": 6.7412
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.486619,
                    "execution_time": 12.890646,
                    "compile_time": 0.007056,
                    "planning_time": 6.812904
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0      California_2    2001      1           67667.31   39775.06  145936.98   35750.46\n1      California_2    2001      2           67667.31   35750.46   39775.06   40076.95\n2      California_2    2001      3           67667.31   40076.95   35750.46   38498.89\n3      California_2    2001      4           67667.31   38498.89   40076.95   40359.76\n4      California_2    2001      5           67667.31   40359.76   38498.89   38044.74\n5      California_2    2001      6           67667.31   38044.74   40359.76   42869.14\n6      California_2    2001      7           67667.31   42869.14   38044.74   87653.41\n7      California_2    2001      8           67667.31   87653.41   42869.14   88930.09\n8      California_2    2001      9           67667.31   88930.09   87653.41   89810.14\n9      California_2    2001     10           67667.31   89810.14   88930.09  131424.18\n10     California_2    2001     11           67667.31  131424.18   89810.14  138814.97\n11     California_2    2001     12           67667.31  138814.97  131424.18   39481.66\n12  Hawaii/Alaska_1    2001      1           66717.02   38987.04  145606.49   34858.25\n13  Hawaii/Alaska_1    2001      2           66717.02   34858.25   38987.04   37561.98\n14  Hawaii/Alaska_1    2001      3           66717.02   37561.98   34858.25   38143.98\n15  Hawaii/Alaska_1    2001      4           66717.02   38143.98   37561.98   39486.09\n16  Hawaii/Alaska_1    2001      5           66717.02   39486.09   38143.98   40563.59\n17  Hawaii/Alaska_1    2001      6           66717.02   40563.59   39486.09   37399.76\n18  Hawaii/Alaska_1    2001      7           66717.02   37399.76   40563.59   91111.95\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and\n        avg_monthly_sales > 0 /*CURSOR_IDENTIFIER*/\n",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 LIMIT 21",
                "preview": "\n/*           cc_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum    nsum\n0       California    2001      1             330.86     252.01  1045.75    2.79\n1       California    2001      2             330.86       2.79   252.01  229.96\n2       California    2001      3             330.86     229.96     2.79  193.92\n3       California    2001      4             330.86     193.92   229.96  336.84\n4       California    2001      5             330.86     336.84   193.92  131.04\n5       California    2001      6             330.86     131.04   336.84  175.89\n6       California    2001      7             330.86     175.89   131.04  455.90\n7       California    2001      8             330.86     455.90   175.89  206.05\n8       California    2001      9             330.86     206.05   455.90  708.90\n9       California    2001     10             330.86     708.90   206.05  489.93\n10      California    2001     11             330.86     489.93   708.90  787.13\n11  Mid Atlantic_3    2001      9             434.49     728.25   605.41  371.33\n12  Mid Atlantic_3    2001     10             434.49     371.33   728.25  927.16\n13  Mid Atlantic_3    2001     11             434.49     927.16   371.33  461.98\n14        NY Metro    2001      1             416.81     437.29   800.57   49.43\n15        NY Metro    2001      2             416.81      49.43   437.29  120.64\n16        NY Metro    2001      3             416.81     120.64    49.43  288.43\n17        NY Metro    2001      4             416.81     288.43   120.64  245.97\n18        NY Metro    2001      5             416.81     245.97   288.43  132.33\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 13.522892,
                    "execution_time": 13.000611,
                    "compile_time": 0.001313,
                    "planning_time": 6.831458
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.510776,
                    "execution_time": 12.919484,
                    "compile_time": 0.00246,
                    "planning_time": 6.844202
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*           cc_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum    nsum\n0       California    2001      1             330.86     252.01  1045.75    2.79\n1       California    2001      2             330.86       2.79   252.01  229.96\n2       California    2001      3             330.86     229.96     2.79  193.92\n3       California    2001      4             330.86     193.92   229.96  336.84\n4       California    2001      5             330.86     336.84   193.92  131.04\n5       California    2001      6             330.86     131.04   336.84  175.89\n6       California    2001      7             330.86     175.89   131.04  455.90\n7       California    2001      8             330.86     455.90   175.89  206.05\n8       California    2001      9             330.86     206.05   455.90  708.90\n9       California    2001     10             330.86     708.90   206.05  489.93\n10      California    2001     11             330.86     489.93   708.90  787.13\n11  Mid Atlantic_3    2001      9             434.49     728.25   605.41  371.33\n12  Mid Atlantic_3    2001     10             434.49     371.33   728.25  927.16\n13  Mid Atlantic_3    2001     11             434.49     927.16   371.33  461.98\n14        NY Metro    2001      1             416.81     437.29   800.57   49.43\n15        NY Metro    2001      2             416.81      49.43   437.29  120.64\n16        NY Metro    2001      3             416.81     120.64    49.43  288.43\n17        NY Metro    2001      4             416.81     288.43   120.64  245.97\n18        NY Metro    2001      5             416.81     245.97   288.43  132.33\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and\n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 LIMIT 21",
                "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0   Hawaii/Alaska_2    2001      1            2242.56    1561.76  2582.39   917.15\n1   Hawaii/Alaska_2    2001      2            2242.56     917.15  1561.76   898.90\n2   Hawaii/Alaska_2    2001      3            2242.56     898.90   917.15  1183.33\n3   Hawaii/Alaska_2    2001      4            2242.56    1183.33   898.90  1454.72\n4   Hawaii/Alaska_2    2001      5            2242.56    1454.72  1183.33  1300.60\n5   Hawaii/Alaska_2    2001      6            2242.56    1300.60  1454.72  1808.63\n6   Hawaii/Alaska_2    2001      7            2242.56    1808.63  1300.60  3321.54\n7   Hawaii/Alaska_2    2001      8            2242.56    3321.54  1808.63  2344.60\n8   Hawaii/Alaska_2    2001     10            2242.56    3648.05  2344.60  3906.31\n9   Hawaii/Alaska_2    2001     11            2242.56    3906.31  3648.05  4565.18\n10  Hawaii/Alaska_2    2001     12            2242.56    4565.18  3906.31   754.68\n11     Mid Atlantic    2001      1            2160.40    1505.54  2579.32  1040.25\n12     Mid Atlantic    2001      2            2160.40    1040.25  1505.54  1306.40\n13     Mid Atlantic    2001      3            2160.40    1306.40  1040.25  1191.94\n14     Mid Atlantic    2001      4            2160.40    1191.94  1306.40  1042.31\n15     Mid Atlantic    2001      5            2160.40    1042.31  1191.94   914.61\n16     Mid Atlantic    2001      6            2160.40     914.61  1042.31   859.29\n17     Mid Atlantic    2001      7            2160.40     859.29   914.61  3014.48\n18     Mid Atlantic    2001      8            2160.40    3014.48   859.29  2463.32\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 13.499055,
                    "execution_time": 12.978302,
                    "compile_time": 0.001267,
                    "planning_time": 6.83998
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.600681,
                    "execution_time": 12.973237,
                    "compile_time": 0.002791,
                    "planning_time": 6.945838
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0   Hawaii/Alaska_2    2001      1            2242.56    1561.76  2582.39   917.15\n1   Hawaii/Alaska_2    2001      2            2242.56     917.15  1561.76   898.90\n2   Hawaii/Alaska_2    2001      3            2242.56     898.90   917.15  1183.33\n3   Hawaii/Alaska_2    2001      4            2242.56    1183.33   898.90  1454.72\n4   Hawaii/Alaska_2    2001      5            2242.56    1454.72  1183.33  1300.60\n5   Hawaii/Alaska_2    2001      6            2242.56    1300.60  1454.72  1808.63\n6   Hawaii/Alaska_2    2001      7            2242.56    1808.63  1300.60  3321.54\n7   Hawaii/Alaska_2    2001      8            2242.56    3321.54  1808.63  2344.60\n8   Hawaii/Alaska_2    2001     10            2242.56    3648.05  2344.60  3906.31\n9   Hawaii/Alaska_2    2001     11            2242.56    3906.31  3648.05  4565.18\n10  Hawaii/Alaska_2    2001     12            2242.56    4565.18  3906.31   754.68\n11     Mid Atlantic    2001      1            2160.40    1505.54  2579.32  1040.25\n12     Mid Atlantic    2001      2            2160.40    1040.25  1505.54  1306.40\n13     Mid Atlantic    2001      3            2160.40    1306.40  1040.25  1191.94\n14     Mid Atlantic    2001      4            2160.40    1191.94  1306.40  1042.31\n15     Mid Atlantic    2001      5            2160.40    1042.31  1191.94   914.61\n16     Mid Atlantic    2001      6            2160.40     914.61  1042.31   859.29\n17     Mid Atlantic    2001      7            2160.40     859.29   914.61  3014.48\n18     Mid Atlantic    2001      8            2160.40    3014.48   859.29  2463.32\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and\n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, psum\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , PSUM NULLS FIRST LIMIT 21",
                "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0        Mid Atlantic_3    2001      2         1460433.73  764505.02  868368.62  851924.25\n1        Mid Atlantic_2    2001      2         1461946.87  771957.29  853368.73  827903.16\n2        Mid Atlantic_1    2001      2         1456762.60  767737.53  854486.24  856667.10\n3       Hawaii/Alaska_1    2001      2         1448871.38  760064.57  853760.33  836497.41\n4            NY Metro_2    2001      2         1445398.96  756955.71  856747.14  840466.61\n5          Mid Atlantic    2001      2         1458180.10  769779.78  860621.05  834300.15\n6       North Midwest_1    2001      2         1457619.63  769572.08  847756.79  835881.70\n7   Pacific Northwest_1    2001      2         1444874.53  756849.98  865644.40  831898.54\n8     Pacific Northwest    2001      2         1447371.05  759970.27  849473.60  835758.52\n9            NY Metro_2    2001      2         1458136.49  771413.24  866302.91  837608.49\n10        North Midwest    2001      2         1463559.95  776849.32  849642.24  842954.65\n11           NY Metro_1    2001      2         1454699.53  768008.89  847684.78  845727.81\n12      North Midwest_1    2001      2         1441413.19  754915.32  853892.90  819424.53\n13  Pacific Northwest_2    2001      2         1451836.60  765872.34  875128.82  817996.35\n14       Mid Atlantic_2    2001      2         1449110.33  763444.56  861259.49  820893.10\n15    Pacific Northwest    2001      2         1460114.17  774736.09  868434.03  824560.15\n16           NY Metro_3    2001      2         1439563.85  754590.75  868110.97  824139.87\n17      North Midwest_3    2001      2         1447353.42  763813.89  860105.75  835003.80\n18       Mid Atlantic_1    2001      2         1443203.34  759672.39  852527.80  833372.35\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 13.515702,
                    "execution_time": 12.99302,
                    "compile_time": 0.001221,
                    "planning_time": 6.831633
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.499223,
                    "execution_time": 12.905057,
                    "compile_time": 0.005377,
                    "planning_time": 6.819843
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0        Mid Atlantic_3    2001      2         1460433.73  764505.02  868368.62  851924.25\n1        Mid Atlantic_2    2001      2         1461946.87  771957.29  853368.73  827903.16\n2        Mid Atlantic_1    2001      2         1456762.60  767737.53  854486.24  856667.10\n3       Hawaii/Alaska_1    2001      2         1448871.38  760064.57  853760.33  836497.41\n4            NY Metro_2    2001      2         1445398.96  756955.71  856747.14  840466.61\n5          Mid Atlantic    2001      2         1458180.10  769779.78  860621.05  834300.15\n6       North Midwest_1    2001      2         1457619.63  769572.08  847756.79  835881.70\n7   Pacific Northwest_1    2001      2         1444874.53  756849.98  865644.40  831898.54\n8     Pacific Northwest    2001      2         1447371.05  759970.27  849473.60  835758.52\n9            NY Metro_2    2001      2         1458136.49  771413.24  866302.91  837608.49\n10        North Midwest    2001      2         1463559.95  776849.32  849642.24  842954.65\n11           NY Metro_1    2001      2         1454699.53  768008.89  847684.78  845727.81\n12      North Midwest_1    2001      2         1441413.19  754915.32  853892.90  819424.53\n13  Pacific Northwest_2    2001      2         1451836.60  765872.34  875128.82  817996.35\n14       Mid Atlantic_2    2001      2         1449110.33  763444.56  861259.49  820893.10\n15    Pacific Northwest    2001      2         1460114.17  774736.09  868434.03  824560.15\n16           NY Metro_3    2001      2         1439563.85  754590.75  868110.97  824139.87\n17      North Midwest_3    2001      2         1447353.42  763813.89  860105.75  835003.80\n18       Mid Atlantic_1    2001      2         1443203.34  759672.39  852527.80  833372.35\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and\n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, psum\n limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , PSUM NULLS FIRST LIMIT 21",
                "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0        Mid Atlantic_3    2001      2         1460433.73  764505.02  868368.62  851924.25\n1        Mid Atlantic_2    2001      2         1461946.87  771957.29  853368.73  827903.16\n2        Mid Atlantic_1    2001      2         1456762.60  767737.53  854486.24  856667.10\n3       Hawaii/Alaska_1    2001      2         1448871.38  760064.57  853760.33  836497.41\n4            NY Metro_2    2001      2         1445398.96  756955.71  856747.14  840466.61\n5          Mid Atlantic    2001      2         1458180.10  769779.78  860621.05  834300.15\n6       North Midwest_1    2001      2         1457619.63  769572.08  847756.79  835881.70\n7   Pacific Northwest_1    2001      2         1444874.53  756849.98  865644.40  831898.54\n8     Pacific Northwest    2001      2         1447371.05  759970.27  849473.60  835758.52\n9            NY Metro_2    2001      2         1458136.49  771413.24  866302.91  837608.49\n10        North Midwest    2001      2         1463559.95  776849.32  849642.24  842954.65\n11           NY Metro_1    2001      2         1454699.53  768008.89  847684.78  845727.81\n12      North Midwest_1    2001      2         1441413.19  754915.32  853892.90  819424.53\n13  Pacific Northwest_2    2001      2         1451836.60  765872.34  875128.82  817996.35\n14       Mid Atlantic_2    2001      2         1449110.33  763444.56  861259.49  820893.10\n15    Pacific Northwest    2001      2         1460114.17  774736.09  868434.03  824560.15\n16           NY Metro_3    2001      2         1439563.85  754590.75  868110.97  824139.87\n17      North Midwest_3    2001      2         1447353.42  763813.89  860105.75  835003.80\n18       Mid Atlantic_1    2001      2         1443203.34  759672.39  852527.80  833372.35\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 13.479242,
                    "execution_time": 12.956129,
                    "compile_time": 0.001279,
                    "planning_time": 6.778575
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.599035,
                    "execution_time": 13.058766,
                    "compile_time": 0.001224,
                    "planning_time": 6.92065
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0        Mid Atlantic_3    2001      2         1460433.73  764505.02  868368.62  851924.25\n1        Mid Atlantic_2    2001      2         1461946.87  771957.29  853368.73  827903.16\n2        Mid Atlantic_1    2001      2         1456762.60  767737.53  854486.24  856667.10\n3       Hawaii/Alaska_1    2001      2         1448871.38  760064.57  853760.33  836497.41\n4            NY Metro_2    2001      2         1445398.96  756955.71  856747.14  840466.61\n5          Mid Atlantic    2001      2         1458180.10  769779.78  860621.05  834300.15\n6       North Midwest_1    2001      2         1457619.63  769572.08  847756.79  835881.70\n7   Pacific Northwest_1    2001      2         1444874.53  756849.98  865644.40  831898.54\n8     Pacific Northwest    2001      2         1447371.05  759970.27  849473.60  835758.52\n9            NY Metro_2    2001      2         1458136.49  771413.24  866302.91  837608.49\n10        North Midwest    2001      2         1463559.95  776849.32  849642.24  842954.65\n11           NY Metro_1    2001      2         1454699.53  768008.89  847684.78  845727.81\n12      North Midwest_1    2001      2         1441413.19  754915.32  853892.90  819424.53\n13  Pacific Northwest_2    2001      2         1451836.60  765872.34  875128.82  817996.35\n14       Mid Atlantic_2    2001      2         1449110.33  763444.56  861259.49  820893.10\n15    Pacific Northwest    2001      2         1460114.17  774736.09  868434.03  824560.15\n16           NY Metro_3    2001      2         1439563.85  754590.75  868110.97  824139.87\n17      North Midwest_3    2001      2         1447353.42  763813.89  860105.75  835003.80\n18       Mid Atlantic_1    2001      2         1443203.34  759672.39  852527.80  833372.35\n...*/"
    }
]