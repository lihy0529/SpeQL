[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(CS_QUANTITY*CS_LIST_PRICE) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n        group by c_last_name,c_first_name) as sales_summary\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALES_SUMMARY\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SALES_SUMMARY AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SALES_SUMMARY AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\"",
                "rewrite": "WITH SALES_SUMMARY AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\""
            }
        ],
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc, i_item_sk item_sk, d_date solddate, count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1999,2000,2001)\n  group by substring(i_item_desc,1,30), i_item_sk, d_date\n  having count(*) > 4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select ss_customer_sk c_customer_sk, sum(ss_quantity * ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1999,2000,2001)\n        group by ss_customer_sk)),\n best_ss_customer as\n (select ss_customer_sk c_customer_sk, sum(ss_quantity * ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by ss_customer_sk\n  having sum(ss_quantity * ss_sales_price) > (95/100.0) * (select tpcds_cmax from max_store_sales))\n  select c_last_name, c_first_name, sales\n from (select c_last_name, c_first_name, sum(cs_net_paid) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n/*CURSOR_IDENTIFIER*/\n         group by c_last_name, c_first_name) as customer_sales",
        "optimize": [
            "WITH \"CUSTOMER_SALES\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH CUSTOMER_SALES AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH CUSTOMER_SALES AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\"",
                "rewrite": "WITH CUSTOMER_SALES AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\""
            }
        ],
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_sales_price*cs_quantity) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         group by c_last_name,c_first_name)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" * \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 13.613182,
                    "execution_time": 13.489063,
                    "compile_time": 0.000433,
                    "planning_time": 0.042482,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 13.628006,
                    "execution_time": 13.418717,
                    "compile_time": 0.009806,
                    "planning_time": 0.117387,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.302599,
                    "execution_time": 0.201425,
                    "compile_time": 0.000264,
                    "planning_time": 0.03649,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.485115,
                    "execution_time": 0.20127,
                    "compile_time": 0.131759,
                    "planning_time": 0.085743,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.477239,
                    "execution_time": 2.248687,
                    "compile_time": 0.000399,
                    "planning_time": 0.036521,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 4.471069,
                    "execution_time": 4.184241,
                    "compile_time": 0.004535,
                    "planning_time": 0.102537,
                    "create_size": 512
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_SALES_PRICE * CS_QUANTITY ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n        group by c_last_name,c_first_name) /* Added GROUP BY for c_last_name and c_first_name */ \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0        White      Marilyn  54707.13\n1        Brown       Gerald  66407.44\n2                     James  33699.93\n3      Herrera    Petronila  49134.95\n4        Davis      Stephen  32198.04\n5       Glover     Reinaldo  59736.31\n6       Gordon       Esther  62977.89\n7        Noble         Mark  50995.14\n8        White    Thomasine  67918.74\n9      Sanchez       Sylvia  37742.21\n10                    Allen  40926.69\n11        Cady    Christine  31773.92*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 18.55959,
                    "execution_time": 18.40708,
                    "compile_time": 0.000947,
                    "planning_time": 0.108317
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 22.959082,
                    "execution_time": 18.515831,
                    "compile_time": 4.199076,
                    "planning_time": 0.194489
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0        White      Marilyn  54707.13\n1        Brown       Gerald  66407.44\n2                     James  33699.93\n3      Herrera    Petronila  49134.95\n4        Davis      Stephen  32198.04\n5       Glover     Reinaldo  59736.31\n6       Gordon       Esther  62977.89\n7        Noble         Mark  50995.14\n8        White    Thomasine  67918.74\n9      Sanchez       Sylvia  37742.21\n10                    Allen  40926.69\n11        Cady    Christine  31773.92*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0        Noble         Mark  50995.14\n1        White    Thomasine  67918.74\n2      Sanchez       Sylvia  37742.21\n3                     Allen  40926.69\n4         Cady    Christine  31773.92\n5      Herrera    Petronila  49134.95\n6       Glover     Reinaldo  59736.31\n7        Davis      Stephen  32198.04\n8       Gordon       Esther  62977.89\n9                     James  33699.93\n10       White      Marilyn  54707.13\n11       Brown       Gerald  66407.44*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 17.904244,
                    "execution_time": 17.754016,
                    "compile_time": 0.000971,
                    "planning_time": 0.105881
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 18.328343,
                    "execution_time": 18.180291,
                    "compile_time": 0.000939,
                    "planning_time": 0.104429
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0        Noble         Mark  50995.14\n1        White    Thomasine  67918.74\n2      Sanchez       Sylvia  37742.21\n3                     Allen  40926.69\n4         Cady    Christine  31773.92\n5      Herrera    Petronila  49134.95\n6       Glover     Reinaldo  59736.31\n7        Davis      Stephen  32198.04\n8       Gordon       Esther  62977.89\n9                     James  33699.93\n10       White      Marilyn  54707.13\n11       Brown       Gerald  66407.44*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c.c_last_name, c.c_first_name, sum(ws_quantity*ws_list_price) sales\n       from web_sales\n            , customer c\n where ws_sold_date_sk in (select d_date_sk from date_dim where d_year = 1998 and d_moy = 4)\n     and ws_bill_customer_sk = c.c_customer_sk\n     and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n group by c_last_name,c_first_name) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_U_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"DATE_DIM\".\"D_DATE_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"C\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"C\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_3\" AS \"_U_3\" ON \"_U_3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"C\" ON \"C\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" WHERE NOT \"_U_3\".\"D_DATE_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"C\".\"C_LAST_NAME\" , \"C\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C.C_LAST_NAME , C.C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER AS C WHERE WS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 ) AND WS_BILL_CUSTOMER_SK = C.C_CUSTOMER_SK AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0      Herrera    Petronila  49134.95\n1        Davis      Stephen  32198.04\n2       Glover     Reinaldo  59736.31\n3        Noble         Mark  50995.14\n4        White    Thomasine  67918.74\n5      Sanchez       Sylvia  37742.21\n6                     Allen  40926.69\n7         Cady    Christine  31773.92\n8     Carranza       Nathan  56084.30\n9       Gordon       Esther  62977.89\n10     Douglas       Ruthie  79293.27\n11       White      Marilyn  54707.13\n12       Brown       Gerald  66407.44\n13                    James  33699.93*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 17.401494,
                    "execution_time": 17.157708,
                    "compile_time": 0.0015,
                    "planning_time": 4.117804
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 21.773762,
                    "execution_time": 17.050853,
                    "compile_time": 4.390784,
                    "planning_time": 4.149286
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0      Herrera    Petronila  49134.95\n1        Davis      Stephen  32198.04\n2       Glover     Reinaldo  59736.31\n3        Noble         Mark  50995.14\n4        White    Thomasine  67918.74\n5      Sanchez       Sylvia  37742.21\n6                     Allen  40926.69\n7         Cady    Christine  31773.92\n8     Carranza       Nathan  56084.30\n9       Gordon       Esther  62977.89\n10     Douglas       Ruthie  79293.27\n11       White      Marilyn  54707.13\n12       Brown       Gerald  66407.44\n13                    James  33699.93*/"
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) > 4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(CS_QUANTITY*CS_LIST_PRICE) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(WS_QUANTITY*WS_LIST_PRICE) sales\n       from web_sales\n           ,customer\n           ,date_dim\n       where ws_bill_customer_sk = c_customer_sk\n         and ws_sold_date_sk = d_date_sk\n         and d_year = 1998\n         and ws_item_sk in (select item_sk from frequent_ss_items)\n       group by c_last_name,c_first_name\n) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1998 AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name         sales\n0        Noble         Mark  5.099514e+04\n1        White    Thomasine  6.791874e+04\n2                     Allen  4.092669e+04\n3      Sanchez       Sylvia  3.774221e+04\n4         Cady    Christine  3.177392e+04\n5      Rayford      Matthew  5.250822e+04\n6       Duncan        Linda  7.210088e+05\n7                     Larry  4.733011e+06\n8       Mcghee         Gary  5.146427e+04\n9      Ramirez         Earl  2.362308e+05\n10                  Chandra  1.663734e+05\n11      Pierre               1.602301e+05\n12        Hall       Calvin  5.133753e+05\n13       Crain        Roger  1.337165e+05\n14      Hobson       Ronald  1.391928e+05\n15     Dillard         Fern  2.080335e+05\n16       White       Edwina  1.461212e+05\n17        Hill    Nathaniel  1.239959e+05\n18   Macdonald        James  4.981556e+05\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 18.298744,
                    "execution_time": 18.034336,
                    "compile_time": 0.001537,
                    "planning_time": 13.62523
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 26.328178,
                    "execution_time": 18.161332,
                    "compile_time": 7.794355,
                    "planning_time": 13.734887
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name         sales\n0        Noble         Mark  5.099514e+04\n1        White    Thomasine  6.791874e+04\n2                     Allen  4.092669e+04\n3      Sanchez       Sylvia  3.774221e+04\n4         Cady    Christine  3.177392e+04\n5      Rayford      Matthew  5.250822e+04\n6       Duncan        Linda  7.210088e+05\n7                     Larry  4.733011e+06\n8       Mcghee         Gary  5.146427e+04\n9      Ramirez         Earl  2.362308e+05\n10                  Chandra  1.663734e+05\n11      Pierre               1.602301e+05\n12        Hall       Calvin  5.133753e+05\n13       Crain        Roger  1.337165e+05\n14      Hobson       Ronald  1.391928e+05\n15     Dillard         Fern  2.080335e+05\n16       White       Edwina  1.461212e+05\n17        Hill    Nathaniel  1.239959e+05\n18   Macdonald        James  4.981556e+05\n...*/"
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select ss_item_sk item_sk,count(*) cnt\n  from store_sales\n  where ss_sold_date_sk in (select d_date_sk from date_dim where d_year in (1998,1998 + 1,1998 + 2,1998 + 3))\n  group by ss_item_sk\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select ss_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n        where ss_sold_date_sk in (select d_date_sk from date_dim where d_year in (1998,1998+1,1998+2,1998+3))\n        group by ss_customer_sk)),\n best_ss_customer as\n (select ss_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n  where ss_customer_sk is not null\n  group by ss_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select tpcds_cmax from max_store_sales))\n select c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_sales_price) sales\n       from catalog_sales\n           ,customer\n       where cs_sold_date_sk in (select d_date_sk from date_dim where d_year = 1998 and d_moy = 4)\n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name\n     union all\n     select c_last_name,c_first_name,sum(ws_quantity*ws_sales_price) sales\n      from web_sales\n          ,customer\n      where ws_sold_date_sk in (select d_date_sk from date_dim where d_year = 1998 and d_moy = 4)\n        and ws_item_sk in (select item_sk from frequent_ss_items)\n        and ws_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n        and ws_bill_customer_sk = c_customer_sk\n     group by c_last_name,c_first_name\n ) as full_sales\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"_U_0\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"DATE_DIM\".\"D_DATE_SK\" ) , \"FREQUENT_SS_ITEMS\" AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"_U_0\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_ITEM_SK\" HAVING COUNT ( * ) > 4 ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"_U_0\" AS \"_U_1\" ON \"_U_1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"_U_1\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" WHERE NOT \"STORE_SALES\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"DATE_DIM\".\"D_DATE_SK\" ) , \"_U_4\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_5\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"FULL_SALES\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_3\" AS \"_U_3\" ON \"_U_3\".\"D_DATE_SK\" = \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" LEFT JOIN \"_U_4\" AS \"_U_4\" ON \"_U_4\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_5\" AS \"_U_5\" ON \"_U_5\".\"SS_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" WHERE NOT \"_U_3\".\"D_DATE_SK\" IS NULL AND NOT \"_U_4\".\"ITEM_SK\" IS NULL AND NOT \"_U_5\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_3\" AS \"_U_6\" ON \"_U_6\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"_U_4\" AS \"_U_7\" ON \"_U_7\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_5\" AS \"_U_8\" ON \"_U_8\".\"SS_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" WHERE NOT \"_U_6\".\"D_DATE_SK\" IS NULL AND NOT \"_U_7\".\"ITEM_SK\" IS NULL AND NOT \"_U_8\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"FULL_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"FULL_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"FULL_SALES\".\"SALES\" AS \"SALES\" FROM \"FULL_SALES\" AS \"FULL_SALES\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"DATE_DIM\".\"D_DATE_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.12978,
                    "execution_time": 0.032639,
                    "compile_time": 0.045701,
                    "planning_time": 0.026591,
                    "create_size": 16
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.648583,
                    "execution_time": 0.031862,
                    "compile_time": 3.49862,
                    "planning_time": 0.090414,
                    "create_size": 16
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ON \"SPEQLITE_TEMP_TABLE_4\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_4\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_ITEM_SK\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.954787,
                    "execution_time": 0.764696,
                    "compile_time": 0.093431,
                    "planning_time": 0.029614,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 10.209679,
                    "execution_time": 6.712388,
                    "compile_time": 3.323721,
                    "planning_time": 0.091668,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"_U_1\" ON \"_U_1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"_U_1\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.982724,
                    "execution_time": 1.693083,
                    "compile_time": 0.078899,
                    "planning_time": 0.031249,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 14.197512,
                    "execution_time": 10.611518,
                    "compile_time": 3.301763,
                    "planning_time": 0.093374,
                    "create_size": 512
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SS_ITEM_SK AS ITEM_SK , COUNT ( * ) AS CNT FROM STORE_SALES WHERE SS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) ) GROUP BY SS_ITEM_SK HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES WHERE SS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) ) GROUP BY SS_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES WHERE NOT SS_CUSTOMER_SK IS NULL GROUP BY SS_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT TPCDS_CMAX FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_SALES_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER WHERE CS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 ) AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_SALES_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER WHERE WS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 ) AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) AS FULL_SALES LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select ss_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by ss_customer_sk)),\n best_ss_customer as\n (select ss_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by ss_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select tpcds_cmax from max_store_sales))\nselect c_last_name, c_first_name, sales\nfrom (select c_last_name, c_first_name, sum(cs_quantity*cs_list_price) sales\n       from catalog_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n        and d_moy = 4 \n        and cs_sold_date_sk = d_date_sk \n        and cs_item_sk in (select item_sk from frequent_ss_items)\n        and cs_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n        and cs_bill_customer_sk = c_customer_sk \n      group by c_last_name, c_first_name\n     union all\n     select c_last_name, c_first_name, sum(ws_quantity*ws_list_price) sales\n      from web_sales\n          ,customer\n          ,date_dim \n      where d_year = 1998 \n        and d_moy = 4 \n        and ws_sold_date_sk = d_date_sk\n        and ws_item_sk in (select item_sk from frequent_ss_items)\n        and ws_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n        and ws_bill_customer_sk = c_customer_sk \n      group by c_last_name, c_first_name)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"SS_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"SS_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.549896,
                    "execution_time": 2.256366,
                    "compile_time": 0.081095,
                    "planning_time": 0.036056,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 18.631227,
                    "execution_time": 14.953356,
                    "compile_time": 3.34453,
                    "planning_time": 0.128191,
                    "create_size": 512
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SS_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY SS_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT TPCDS_CMAX FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n/*CURSOR_IDENTIFIER*/\n         and ws_sold_date_sk = d_date_sk \n         group by c_last_name,c_first_name)",
        "optimize": [
            "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\", \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\", SUM(\"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\") AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\", \"CUSTOMER\".\"C_FIRST_NAME\"",
                "rewrite": "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\""
            }
        ],
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date_sk solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date_sk\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(CS_QUANTITY*CS_LIST_PRICE) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(WS_QUANTITY*WS_LIST_PRICE) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      ) as sales_summary\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) ) , \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE_SK\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"SALES_SUMMARY\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_2\" AS \"_U_3\" ON \"_U_3\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.140565,
                    "execution_time": 0.031618,
                    "compile_time": 0.059603,
                    "planning_time": 0.025641,
                    "create_size": 20
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.467953,
                    "execution_time": 0.031572,
                    "compile_time": 3.320191,
                    "planning_time": 0.089626,
                    "create_size": 20
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE_SK\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 13.340765,
                    "execution_time": 13.215436,
                    "compile_time": 0.00043,
                    "planning_time": 0.034096,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 18.524835,
                    "execution_time": 13.732198,
                    "compile_time": 4.605065,
                    "planning_time": 0.102858,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_10\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.425575,
                    "execution_time": 2.220073,
                    "compile_time": 0.000424,
                    "planning_time": 0.028024,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.639347,
                    "execution_time": 2.238289,
                    "compile_time": 4.128097,
                    "planning_time": 0.090195,
                    "create_size": 512
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE_SK AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE_SK HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) AS SALES_SUMMARY LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0      Douglas       Ruthie  79293.27\n1        Noble         Mark  50995.14\n2        White    Thomasine  67918.74\n3      Sanchez       Sylvia  37742.21\n4                     Allen  40926.69\n5         Cady    Christine  31773.92\n6        White      Marilyn  54707.13\n7        Brown       Gerald  66407.44\n8                     James  33699.93\n9      Herrera    Petronila  49134.95\n10       Davis      Stephen  32198.04\n11      Glover     Reinaldo  59736.31\n12      Gordon       Esther  62977.89\n13    Carranza       Nathan  56084.30*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 18.024748,
                    "execution_time": 17.791378,
                    "compile_time": 0.001463,
                    "planning_time": 4.891936
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 25.146517,
                    "execution_time": 20.363206,
                    "compile_time": 4.455448,
                    "planning_time": 5.064199
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0      Douglas       Ruthie  79293.27\n1        Noble         Mark  50995.14\n2        White    Thomasine  67918.74\n3      Sanchez       Sylvia  37742.21\n4                     Allen  40926.69\n5         Cady    Christine  31773.92\n6        White      Marilyn  54707.13\n7        Brown       Gerald  66407.44\n8                     James  33699.93\n9      Herrera    Petronila  49134.95\n10       Davis      Stephen  32198.04\n11      Glover     Reinaldo  59736.31\n12      Gordon       Esther  62977.89\n13    Carranza       Nathan  56084.30*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name, c_first_name\n) as sales_data\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"SALES_DATA\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_DATA\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_DATA\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_DATA\".\"SALES\" AS \"SALES\" FROM \"SALES_DATA\" AS \"SALES_DATA\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) AS SALES_DATA LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0        Noble         Mark  50995.14\n1        White    Thomasine  67918.74\n2      Sanchez       Sylvia  37742.21\n3                     Allen  40926.69\n4         Cady    Christine  31773.92\n5      Herrera    Petronila  49134.95\n6        Davis      Stephen  32198.04\n7       Glover     Reinaldo  59736.31\n8      Douglas       Ruthie  79293.27\n9                     James  33699.93\n10       White      Marilyn  54707.13\n11       Brown       Gerald  66407.44\n12      Gordon       Esther  62977.89\n13    Carranza       Nathan  56084.30*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 18.606664,
                    "execution_time": 18.262776,
                    "compile_time": 0.001878,
                    "planning_time": 18.477841
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 19.093702,
                    "execution_time": 18.47199,
                    "compile_time": 0.176155,
                    "planning_time": 18.790224
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0        Noble         Mark  50995.14\n1        White    Thomasine  67918.74\n2      Sanchez       Sylvia  37742.21\n3                     Allen  40926.69\n4         Cady    Christine  31773.92\n5      Herrera    Petronila  49134.95\n6        Davis      Stephen  32198.04\n7       Glover     Reinaldo  59736.31\n8      Douglas       Ruthie  79293.27\n9                     James  33699.93\n10       White      Marilyn  54707.13\n11       Brown       Gerald  66407.44\n12      Gordon       Esther  62977.89\n13    Carranza       Nathan  56084.30*/"
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0      Herrera    Petronila  49134.95\n1        Davis      Stephen  32198.04\n2       Glover     Reinaldo  59736.31\n3        Noble         Mark  50995.14\n4        White    Thomasine  67918.74\n5         Cady    Christine  31773.92\n6                     Allen  40926.69\n7      Sanchez       Sylvia  37742.21\n8     Carranza       Nathan  56084.30\n9       Gordon       Esther  62977.89\n10     Douglas       Ruthie  79293.27\n11                    James  33699.93\n12       White      Marilyn  54707.13\n13       Brown       Gerald  66407.44*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 18.394553,
                    "execution_time": 18.048981,
                    "compile_time": 0.00177,
                    "planning_time": 18.268553
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 18.607086,
                    "execution_time": 18.175345,
                    "compile_time": 0.001783,
                    "planning_time": 18.477791
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0      Herrera    Petronila  49134.95\n1        Davis      Stephen  32198.04\n2       Glover     Reinaldo  59736.31\n3        Noble         Mark  50995.14\n4        White    Thomasine  67918.74\n5         Cady    Christine  31773.92\n6                     Allen  40926.69\n7      Sanchez       Sylvia  37742.21\n8     Carranza       Nathan  56084.30\n9       Gordon       Esther  62977.89\n10     Douglas       Ruthie  79293.27\n11                    James  33699.93\n12       White      Marilyn  54707.13\n13       Brown       Gerald  66407.44*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n/*CURSOR_IDENTIFIER*/\n       group by c_last_name,c_first_name)\n",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0        White    Thomasine  67918.74\n1        Noble         Mark  50995.14\n2         Cady    Christine  31773.92\n3                     Allen  40926.69\n4      Sanchez       Sylvia  37742.21\n5      Herrera    Petronila  49134.95\n6        Davis      Stephen  32198.04\n7       Glover     Reinaldo  59736.31\n8      Douglas       Ruthie  79293.27\n9        White      Marilyn  54707.13\n10       Brown       Gerald  66407.44\n11                    James  33699.93\n12      Gordon       Esther  62977.89\n13    Carranza       Nathan  56084.30*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 18.046522,
                    "execution_time": 17.709183,
                    "compile_time": 0.001841,
                    "planning_time": 17.918568
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 18.290496,
                    "execution_time": 17.956227,
                    "compile_time": 0.001861,
                    "planning_time": 18.165042
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0        White    Thomasine  67918.74\n1        Noble         Mark  50995.14\n2         Cady    Christine  31773.92\n3                     Allen  40926.69\n4      Sanchez       Sylvia  37742.21\n5      Herrera    Petronila  49134.95\n6        Davis      Stephen  32198.04\n7       Glover     Reinaldo  59736.31\n8      Douglas       Ruthie  79293.27\n9        White      Marilyn  54707.13\n10       Brown       Gerald  66407.44\n11                    James  33699.93\n12      Gordon       Esther  62977.89\n13    Carranza       Nathan  56084.30*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0        Noble         Mark  50995.14\n1        White    Thomasine  67918.74\n2      Sanchez       Sylvia  37742.21\n3                     Allen  40926.69\n4         Cady    Christine  31773.92\n5      Herrera    Petronila  49134.95\n6        Davis      Stephen  32198.04\n7       Glover     Reinaldo  59736.31\n8                     James  33699.93\n9        White      Marilyn  54707.13\n10       Brown       Gerald  66407.44\n11     Douglas       Ruthie  79293.27\n12      Gordon       Esther  62977.89\n13    Carranza       Nathan  56084.30*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 18.171833,
                    "execution_time": 17.833246,
                    "compile_time": 0.001828,
                    "planning_time": 18.044783
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 18.489293,
                    "execution_time": 18.154656,
                    "compile_time": 0.001825,
                    "planning_time": 18.362793
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0        Noble         Mark  50995.14\n1        White    Thomasine  67918.74\n2      Sanchez       Sylvia  37742.21\n3                     Allen  40926.69\n4         Cady    Christine  31773.92\n5      Herrera    Petronila  49134.95\n6        Davis      Stephen  32198.04\n7       Glover     Reinaldo  59736.31\n8                     James  33699.93\n9        White      Marilyn  54707.13\n10       Brown       Gerald  66407.44\n11     Douglas       Ruthie  79293.27\n12      Gordon       Esther  62977.89\n13    Carranza       Nathan  56084.30*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n     order by c_last_name,c_first_name,sales\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\" ORDER BY \"C_LAST_NAME\" NULLS LAST , \"C_FIRST_NAME\" NULLS LAST , \"SALES\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) ORDER BY C_LAST_NAME NULLS FIRST , C_FIRST_NAME NULLS FIRST , SALES NULLS FIRST LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0                     Allen  40926.69\n1                     James  33699.93\n2        Brown       Gerald  66407.44\n3         Cady    Christine  31773.92\n4     Carranza       Nathan  56084.30\n5        Davis      Stephen  32198.04\n6      Douglas       Ruthie  79293.27\n7       Glover     Reinaldo  59736.31\n8       Gordon       Esther  62977.89\n9      Herrera    Petronila  49134.95\n10       Noble         Mark  50995.14\n11     Sanchez       Sylvia  37742.21\n12       White      Marilyn  54707.13\n13       White    Thomasine  67918.74*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 18.490435,
                    "execution_time": 18.039404,
                    "compile_time": 0.099089,
                    "planning_time": 18.264059
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 27.746456,
                    "execution_time": 18.308127,
                    "compile_time": 9.015881,
                    "planning_time": 18.600302
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0                     Allen  40926.69\n1                     James  33699.93\n2        Brown       Gerald  66407.44\n3         Cady    Christine  31773.92\n4     Carranza       Nathan  56084.30\n5        Davis      Stephen  32198.04\n6      Douglas       Ruthie  79293.27\n7       Glover     Reinaldo  59736.31\n8       Gordon       Esther  62977.89\n9      Herrera    Petronila  49134.95\n10       Noble         Mark  50995.14\n11     Sanchez       Sylvia  37742.21\n12       White      Marilyn  54707.13\n13       White    Thomasine  67918.74*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n     order by c_last_name,c_first_name,sales\n  limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\" ORDER BY \"C_LAST_NAME\" NULLS LAST , \"C_FIRST_NAME\" NULLS LAST , \"SALES\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) ORDER BY C_LAST_NAME NULLS FIRST , C_FIRST_NAME NULLS FIRST , SALES NULLS FIRST LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0                     Allen  40926.69\n1                     James  33699.93\n2        Brown       Gerald  66407.44\n3         Cady    Christine  31773.92\n4     Carranza       Nathan  56084.30\n5        Davis      Stephen  32198.04\n6      Douglas       Ruthie  79293.27\n7       Glover     Reinaldo  59736.31\n8       Gordon       Esther  62977.89\n9      Herrera    Petronila  49134.95\n10       Noble         Mark  50995.14\n11     Sanchez       Sylvia  37742.21\n12       White      Marilyn  54707.13\n13       White    Thomasine  67918.74*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 18.39583,
                    "execution_time": 18.005377,
                    "compile_time": 0.053421,
                    "planning_time": 18.211902
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 18.401946,
                    "execution_time": 17.96849,
                    "compile_time": 0.103933,
                    "planning_time": 18.170712
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0                     Allen  40926.69\n1                     James  33699.93\n2        Brown       Gerald  66407.44\n3         Cady    Christine  31773.92\n4     Carranza       Nathan  56084.30\n5        Davis      Stephen  32198.04\n6      Douglas       Ruthie  79293.27\n7       Glover     Reinaldo  59736.31\n8       Gordon       Esther  62977.89\n9      Herrera    Petronila  49134.95\n10       Noble         Mark  50995.14\n11     Sanchez       Sylvia  37742.21\n12       White      Marilyn  54707.13\n13       White    Thomasine  67918.74*/"
    }
]