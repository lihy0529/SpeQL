[
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales\n      , date_dim\n      , store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns\n      , date_dim\n      , store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales\n      , date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns\n      , date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales\n      , date_dim\n      , web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns\n      , date_dim\n      , web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n/*CURSOR_IDENTIFIER*/\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , ws.sales\n        , coalesce(wr.returns, 0) as returns\n        , (ws.profit - coalesce(wr.profit_loss, 0)) as profit\n from ws\n left join wr\n   on ws.wp_web_page_sk = wr.wp_web_page_sk\n)\n group by channel, id\n)\nselect channel\n      , id\n      , sales\n      , returns\n      , profit\n from results",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , WS.SALES , COALESCE ( WR.RETURNS , 0 ) AS RETURNS , ( WS.PROFIT - COALESCE ( WR.PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS LIMIT 21",
                "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   292  56608558.64  1450939.98 -25551578.26\n1   store channel   140  54887773.74  1388852.68 -24300601.05\n2   store channel    94  56769940.48  1368784.89 -25184304.56\n3   store channel   398  55991416.84  1357776.93 -24518189.68\n4   store channel   370  57231348.99  1425261.01 -25716208.54\n5   store channel    44  57387704.45  1548125.95 -26400887.90\n6     web channel  1220   4117307.19   126542.17   -428895.62\n7     web channel   269   4102877.72    74309.59   -539711.12\n8     web channel   878   3788911.83    89817.58   -536170.37\n9     web channel   971   4175154.75    50309.96   -371531.19\n10    web channel   890   3833794.14    92042.79   -535876.07\n11    web channel  1567   4162894.04   117860.34   -350014.14\n12    web channel  1979   3935158.65    46477.31   -370451.57\n13    web channel  1070   4193740.97   135998.56   -412710.05\n14    web channel   391   3732297.93   126778.76   -638104.95\n15    web channel   847   3956334.38   127574.35   -327575.44\n16    web channel   913   3962091.37   137915.81   -567962.57\n17    web channel   356   3887733.44   177304.77   -529587.28\n18    web channel  1981   3991685.90    83633.61   -634510.44\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.390827,
                    "execution_time": 0.144461,
                    "compile_time": 0.054969,
                    "planning_time": 0.142208
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 11.490225,
                    "execution_time": 4.910761,
                    "compile_time": 6.416982,
                    "planning_time": 0.144107
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   292  56608558.64  1450939.98 -25551578.26\n1   store channel   140  54887773.74  1388852.68 -24300601.05\n2   store channel    94  56769940.48  1368784.89 -25184304.56\n3   store channel   398  55991416.84  1357776.93 -24518189.68\n4   store channel   370  57231348.99  1425261.01 -25716208.54\n5   store channel    44  57387704.45  1548125.95 -26400887.90\n6     web channel  1220   4117307.19   126542.17   -428895.62\n7     web channel   269   4102877.72    74309.59   -539711.12\n8     web channel   878   3788911.83    89817.58   -536170.37\n9     web channel   971   4175154.75    50309.96   -371531.19\n10    web channel   890   3833794.14    92042.79   -535876.07\n11    web channel  1567   4162894.04   117860.34   -350014.14\n12    web channel  1979   3935158.65    46477.31   -370451.57\n13    web channel  1070   4193740.97   135998.56   -412710.05\n14    web channel   391   3732297.93   126778.76   -638104.95\n15    web channel   847   3956334.38   127574.35   -327575.44\n16    web channel   913   3962091.37   137915.81   -567962.57\n17    web channel   356   3887733.44   177304.77   -529587.28\n18    web channel  1981   3991685.90    83633.61   -634510.44\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       join cr\n       on cs.cs_call_center_sk = cr.cr_call_center_sk\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from  ws left join wr\n        on ws.wp_web_page_sk = wr.wp_web_page_sk\n )\n group by channel, id\n )\n select * from results;\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" AS \"CR_CALL_CENTER_SK\" , SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" JOIN \"CR\" AS \"CR\" ON \"CR\".\"CR_CALL_CENTER_SK\" = \"CS\".\"CS_CALL_CENTER_SK\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS JOIN CR ON CS.CS_CALL_CENTER_SK = CR.CR_CALL_CENTER_SK UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   398  55991416.84  1357776.93 -24518189.68\n1   store channel   140  54887773.74  1388852.68 -24300601.05\n2   store channel    94  56769940.48  1368784.89 -25184304.56\n3   store channel   292  56608558.64  1450939.98 -25551578.26\n4   store channel    44  57387704.45  1548125.95 -26400887.90\n5   store channel   370  57231348.99  1425261.01 -25716208.54\n6     web channel  1817   4290803.96    38987.08   -424886.95\n7     web channel   391   3732297.93   126778.76   -638104.95\n8     web channel   356   3887733.44   177304.77   -529587.28\n9     web channel   575   3995327.32    57567.08   -374153.28\n10    web channel  1769   4001051.02    48078.20   -410121.18\n11    web channel   713   4143846.01    67017.34   -411671.78\n12    web channel   353   3991040.06    74946.40   -398423.94\n13    web channel  1220   4117307.19   126542.17   -428895.62\n14    web channel  1427   4188303.34    42586.44   -456976.71\n15    web channel  1979   3935158.65    46477.31   -370451.57\n16    web channel   781   3874186.74   138954.07   -434522.91\n17    web channel  1157   4122711.93    46062.54   -322649.56\n18    web channel   248   3876352.52    76149.06   -643987.32\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.595514,
                    "execution_time": 0.34028,
                    "compile_time": 0.05517,
                    "planning_time": 0.149074
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 7.25486,
                    "execution_time": 0.337799,
                    "compile_time": 6.589001,
                    "planning_time": 0.265962
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   398  55991416.84  1357776.93 -24518189.68\n1   store channel   140  54887773.74  1388852.68 -24300601.05\n2   store channel    94  56769940.48  1368784.89 -25184304.56\n3   store channel   292  56608558.64  1450939.98 -25551578.26\n4   store channel    44  57387704.45  1548125.95 -26400887.90\n5   store channel   370  57231348.99  1425261.01 -25716208.54\n6     web channel  1817   4290803.96    38987.08   -424886.95\n7     web channel   391   3732297.93   126778.76   -638104.95\n8     web channel   356   3887733.44   177304.77   -529587.28\n9     web channel   575   3995327.32    57567.08   -374153.28\n10    web channel  1769   4001051.02    48078.20   -410121.18\n11    web channel   713   4143846.01    67017.34   -411671.78\n12    web channel   353   3991040.06    74946.40   -398423.94\n13    web channel  1220   4117307.19   126542.17   -428895.62\n14    web channel  1427   4188303.34    42586.44   -456976.71\n15    web channel  1979   3935158.65    46477.31   -370451.57\n16    web channel   781   3874186.74   138954.07   -434522.91\n17    web channel  1157   4122711.93    46062.54   -322649.56\n18    web channel   248   3876352.52    76149.06   -643987.32\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n (select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       join cr on cs.cs_call_center_sk = cr.cr_call_center_sk\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , ws.sales\n        , coalesce(wr.returns, 0) as returns\n        , (ws.profit - coalesce(wr.profit_loss, 0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n )\n group by channel, id\n )\nselect *\nfrom results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" AS \"CR_CALL_CENTER_SK\" , SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" JOIN \"CR\" AS \"CR\" ON \"CR\".\"CR_CALL_CENTER_SK\" = \"CS\".\"CS_CALL_CENTER_SK\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS JOIN CR ON CS.CS_CALL_CENTER_SK = CR.CR_CALL_CENTER_SK UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , WS.SALES , COALESCE ( WR.RETURNS , 0 ) AS RETURNS , ( WS.PROFIT - COALESCE ( WR.PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   229  57666701.05  1387949.26 -26281345.52\n1   store channel   350  56589840.27  1363441.77 -25451628.03\n2   store channel    28  56218650.59  1315162.61 -25286651.18\n3     web channel  1658   3979496.48   113927.30   -551340.70\n4     web channel   926   3980074.04   110327.68   -497155.49\n5     web channel   308   4005328.16   136436.65   -493788.86\n6     web channel  1784   3906776.20   139915.48   -608665.18\n7     web channel  1898   4235477.09   171180.96   -358189.34\n8     web channel   247   3980857.01   146143.74   -547320.77\n9     web channel   359   3842664.52    62863.39   -506321.80\n10    web channel   607   3783569.81   124522.35   -696151.17\n11    web channel  1361   3804829.77    72671.35   -504961.00\n12    web channel   530   3862519.53   140872.59   -802783.18\n13    web channel     5   4075069.47    34881.70   -339672.82\n14    web channel   608   4011641.98   125632.58   -445672.96\n15    web channel   127   3755065.43   144008.19   -470107.46\n16    web channel  1628   3950222.19   132322.29   -563194.54\n17  store channel   292  56608558.64  1450939.98 -25551578.26\n18  store channel   370  57231348.99  1425261.01 -25716208.54\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.394379,
                    "execution_time": 0.148685,
                    "compile_time": 0.048512,
                    "planning_time": 0.146576
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.648584,
                    "execution_time": 0.337259,
                    "compile_time": 0.001091,
                    "planning_time": 0.25883
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   229  57666701.05  1387949.26 -26281345.52\n1   store channel   350  56589840.27  1363441.77 -25451628.03\n2   store channel    28  56218650.59  1315162.61 -25286651.18\n3     web channel  1658   3979496.48   113927.30   -551340.70\n4     web channel   926   3980074.04   110327.68   -497155.49\n5     web channel   308   4005328.16   136436.65   -493788.86\n6     web channel  1784   3906776.20   139915.48   -608665.18\n7     web channel  1898   4235477.09   171180.96   -358189.34\n8     web channel   247   3980857.01   146143.74   -547320.77\n9     web channel   359   3842664.52    62863.39   -506321.80\n10    web channel   607   3783569.81   124522.35   -696151.17\n11    web channel  1361   3804829.77    72671.35   -504961.00\n12    web channel   530   3862519.53   140872.59   -802783.18\n13    web channel     5   4075069.47    34881.70   -339672.82\n14    web channel   608   4011641.98   125632.58   -445672.96\n15    web channel   127   3755065.43   144008.19   -470107.46\n16    web channel  1628   3950222.19   132322.29   -563194.54\n17  store channel   292  56608558.64  1450939.98 -25551578.26\n18  store channel   370  57231348.99  1425261.01 -25716208.54\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n )\n group by channel, id\n )\nselect *\nfrom results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel      id         sales       returns        profit\n0     store channel   217.0  5.540999e+07  1.480019e+06 -2.469882e+07\n1   catalog channel     NaN  2.165163e+08  2.060232e+08 -1.595672e+08\n2       web channel   710.0  3.950641e+06  1.622775e+05 -4.854233e+05\n3       web channel   533.0  4.030831e+06  3.906503e+04 -3.959995e+05\n4       web channel   908.0  4.216786e+06  1.192430e+05 -5.373867e+05\n5       web channel   884.0  4.076136e+06  1.600255e+05 -3.102416e+05\n6       web channel   469.0  4.091637e+06  1.646645e+05 -4.144319e+05\n7       web channel   757.0  4.113696e+06  1.266003e+05 -3.681724e+05\n8       web channel   485.0  4.051345e+06  7.053738e+04 -3.060570e+05\n9       web channel  1754.0  4.050969e+06  1.138955e+05 -4.395342e+05\n10      web channel   931.0  3.891094e+06  1.244435e+05 -3.641668e+05\n11      web channel  1106.0  3.805007e+06  1.703638e+05 -6.276239e+05\n12      web channel  1019.0  3.916127e+06  4.181253e+04 -5.370942e+05\n13      web channel  1285.0  3.680364e+06  1.480503e+05 -5.452117e+05\n14    store channel   304.0  5.650659e+07  1.293894e+06 -2.538309e+07\n15    store channel   175.0  5.747401e+07  1.381905e+06 -2.563173e+07\n16    store channel   145.0  5.569462e+07  1.315675e+06 -2.471026e+07\n17    store channel   340.0  5.483983e+07  1.355709e+06 -2.486659e+07\n18    store channel    14.0  5.605025e+07  1.494419e+06 -2.556552e+07\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.346933,
                    "execution_time": 0.147869,
                    "compile_time": 0.001008,
                    "planning_time": 0.147892
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.451975,
                    "execution_time": 0.139917,
                    "compile_time": 0.001041,
                    "planning_time": 0.260024
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel      id         sales       returns        profit\n0     store channel   217.0  5.540999e+07  1.480019e+06 -2.469882e+07\n1   catalog channel     NaN  2.165163e+08  2.060232e+08 -1.595672e+08\n2       web channel   710.0  3.950641e+06  1.622775e+05 -4.854233e+05\n3       web channel   533.0  4.030831e+06  3.906503e+04 -3.959995e+05\n4       web channel   908.0  4.216786e+06  1.192430e+05 -5.373867e+05\n5       web channel   884.0  4.076136e+06  1.600255e+05 -3.102416e+05\n6       web channel   469.0  4.091637e+06  1.646645e+05 -4.144319e+05\n7       web channel   757.0  4.113696e+06  1.266003e+05 -3.681724e+05\n8       web channel   485.0  4.051345e+06  7.053738e+04 -3.060570e+05\n9       web channel  1754.0  4.050969e+06  1.138955e+05 -4.395342e+05\n10      web channel   931.0  3.891094e+06  1.244435e+05 -3.641668e+05\n11      web channel  1106.0  3.805007e+06  1.703638e+05 -6.276239e+05\n12      web channel  1019.0  3.916127e+06  4.181253e+04 -5.370942e+05\n13      web channel  1285.0  3.680364e+06  1.480503e+05 -5.452117e+05\n14    store channel   304.0  5.650659e+07  1.293894e+06 -2.538309e+07\n15    store channel   175.0  5.747401e+07  1.381905e+06 -2.563173e+07\n16    store channel   145.0  5.569462e+07  1.315675e+06 -2.471026e+07\n17    store channel   340.0  5.483983e+07  1.355709e+06 -2.486659e+07\n18    store channel    14.0  5.605025e+07  1.494419e+06 -2.556552e+07\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , coalesce(profit_loss, 0) as profit_loss\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n )\n group by channel, id\n )\nselect *\nfrom results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT_LOSS\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , COALESCE ( PROFIT_LOSS , 0 ) AS PROFIT_LOSS FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   373  58594669.59  1441170.85 -26027902.00\n1   store channel   331  55261304.36  1299986.72 -24635243.03\n2   store channel   376  56475159.03  1385202.36 -25189200.15\n3     web channel   146   3981561.88   149543.62     94768.83\n4     web channel  1862   3772866.89   175233.87     99012.93\n5     web channel  1255   4039234.72   117243.55     78146.47\n6     web channel  1657   4109167.65   146658.08     73658.69\n7     web channel   377   4004194.23    49812.18     27278.31\n8     web channel  1705   4126110.54   117479.90     79402.41\n9     web channel    67   3637405.36   132637.06     75197.84\n10    web channel    56   3846607.14   185877.44    104188.23\n11    web channel  1964   4091218.01   122396.98     72655.96\n12    web channel   271   3805080.97   134779.99     69187.27\n13    web channel    68   3870653.87   155818.39     81221.72\n14    web channel   980   4117946.66   139032.70     80818.95\n15    web channel  1597   4172289.44   163522.29     93514.68\n16    web channel  1640   4098459.82    89866.00     51996.93\n17    web channel    44   4277842.77   112395.28     69997.16\n18    web channel  1711   4027746.90   105951.62     75998.61\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.422365,
                    "execution_time": 0.144015,
                    "compile_time": 0.085791,
                    "planning_time": 0.141537
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 6.976583,
                    "execution_time": 0.232711,
                    "compile_time": 6.430156,
                    "planning_time": 0.254015
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   373  58594669.59  1441170.85 -26027902.00\n1   store channel   331  55261304.36  1299986.72 -24635243.03\n2   store channel   376  56475159.03  1385202.36 -25189200.15\n3     web channel   146   3981561.88   149543.62     94768.83\n4     web channel  1862   3772866.89   175233.87     99012.93\n5     web channel  1255   4039234.72   117243.55     78146.47\n6     web channel  1657   4109167.65   146658.08     73658.69\n7     web channel   377   4004194.23    49812.18     27278.31\n8     web channel  1705   4126110.54   117479.90     79402.41\n9     web channel    67   3637405.36   132637.06     75197.84\n10    web channel    56   3846607.14   185877.44    104188.23\n11    web channel  1964   4091218.01   122396.98     72655.96\n12    web channel   271   3805080.97   134779.99     69187.27\n13    web channel    68   3870653.87   155818.39     81221.72\n14    web channel   980   4117946.66   139032.70     80818.95\n15    web channel  1597   4172289.44   163522.29     93514.68\n16    web channel  1640   4098459.82    89866.00     51996.93\n17    web channel    44   4277842.77   112395.28     69997.16\n18    web channel  1711   4027746.90   105951.62     75998.61\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss, 0)) as profit\n from   cs left join cr\n        on  cs.cs_call_center_sk = cr.cr_call_center_sk\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) as c\n group by channel, id\n )\n select * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" AS \"CR_CALL_CENTER_SK\" , SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"C\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , COALESCE ( \"CR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"CS\".\"PROFIT\" - COALESCE ( \"CR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"CS\" AS \"CS\" LEFT JOIN \"CR\" AS \"CR\" ON \"CR\".\"CR_CALL_CENTER_SK\" = \"CS\".\"CS_CALL_CENTER_SK\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"C\".\"CHANNEL\" AS \"CHANNEL\" , \"C\".\"ID\" AS \"ID\" , SUM ( \"C\".\"SALES\" ) AS \"SALES\" , SUM ( \"C\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"C\".\"PROFIT\" ) AS \"PROFIT\" FROM \"C\" AS \"C\" GROUP BY \"C\".\"CHANNEL\" , \"C\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM CS LEFT JOIN CR ON CS.CS_CALL_CENTER_SK = CR.CR_CALL_CENTER_SK UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS C GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   214  55214680.08  1285323.84 -24734052.87\n1   store channel    70  56975721.10  1263242.77 -24922241.89\n2   store channel    58  54855338.78  1338527.26 -24429341.48\n3     web channel  1741   4134607.93   135131.44   -352434.56\n4     web channel   577   4057731.08   126258.70   -369390.73\n5     web channel  1199   3870536.89    45401.98   -460778.08\n6     web channel  1508   4213911.57   159355.94   -505454.76\n7     web channel  1100   3751532.05   147269.07   -694051.99\n8     web channel   481   3799956.13   169745.86   -549418.35\n9     web channel   895   4100304.83   136188.59   -295278.96\n10    web channel   199   3959543.61   106055.70   -648712.81\n11    web channel  1487   4037301.12    49878.95   -385477.37\n12    web channel  1967   3985865.96    53692.61   -469292.61\n13    web channel   407   3866499.38    73891.39   -533902.38\n14    web channel  1982   4009007.82   138763.17   -377229.42\n15    web channel  1789   4392768.21   139017.65   -311713.54\n16    web channel  1424   3814997.91   161487.72   -507933.17\n17    web channel  1883   3842293.72    42573.86   -473856.35\n18    web channel   493   4014003.52    97837.66   -479649.02\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.35438,
                    "execution_time": 0.140196,
                    "compile_time": 0.015995,
                    "planning_time": 0.146941
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.84491,
                    "execution_time": 0.140848,
                    "compile_time": 3.38871,
                    "planning_time": 0.25928
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   214  55214680.08  1285323.84 -24734052.87\n1   store channel    70  56975721.10  1263242.77 -24922241.89\n2   store channel    58  54855338.78  1338527.26 -24429341.48\n3     web channel  1741   4134607.93   135131.44   -352434.56\n4     web channel   577   4057731.08   126258.70   -369390.73\n5     web channel  1199   3870536.89    45401.98   -460778.08\n6     web channel  1508   4213911.57   159355.94   -505454.76\n7     web channel  1100   3751532.05   147269.07   -694051.99\n8     web channel   481   3799956.13   169745.86   -549418.35\n9     web channel   895   4100304.83   136188.59   -295278.96\n10    web channel   199   3959543.61   106055.70   -648712.81\n11    web channel  1487   4037301.12    49878.95   -385477.37\n12    web channel  1967   3985865.96    53692.61   -469292.61\n13    web channel   407   3866499.38    73891.39   -533902.38\n14    web channel  1982   4009007.82   138763.17   -377229.42\n15    web channel  1789   4392768.21   139017.65   -311713.54\n16    web channel  1424   3814997.91   161487.72   -507933.17\n17    web channel  1883   3842293.72    42573.86   -473856.35\n18    web channel   493   4014003.52    97837.66   -479649.02\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id \n)\nselect * from results\n\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel      id         sales       returns        profit\n0     store channel   217.0  5.540999e+07  1.480019e+06 -2.469882e+07\n1   catalog channel     NaN  2.165163e+08  2.060232e+08 -1.595672e+08\n2       web channel   485.0  4.051345e+06  7.053738e+04 -3.060570e+05\n3       web channel  1754.0  4.050969e+06  1.138955e+05 -4.395342e+05\n4       web channel   884.0  4.076136e+06  1.600255e+05 -3.102416e+05\n5       web channel   469.0  4.091637e+06  1.646645e+05 -4.144319e+05\n6       web channel   710.0  3.950641e+06  1.622775e+05 -4.854233e+05\n7       web channel  1019.0  3.916127e+06  4.181253e+04 -5.370942e+05\n8       web channel   533.0  4.030831e+06  3.906503e+04 -3.959995e+05\n9       web channel   757.0  4.113696e+06  1.266003e+05 -3.681724e+05\n10      web channel   931.0  3.891094e+06  1.244435e+05 -3.641668e+05\n11      web channel  1285.0  3.680364e+06  1.480503e+05 -5.452117e+05\n12      web channel   908.0  4.216786e+06  1.192430e+05 -5.373867e+05\n13      web channel  1106.0  3.805007e+06  1.703638e+05 -6.276239e+05\n14    store channel   130.0  5.539818e+07  1.449920e+06 -2.510280e+07\n15    store channel   148.0  5.438682e+07  1.294885e+06 -2.453198e+07\n16    store channel    14.0  5.605025e+07  1.494419e+06 -2.556552e+07\n17    store channel   304.0  5.650659e+07  1.293894e+06 -2.538309e+07\n18    store channel   104.0  5.397036e+07  1.388381e+06 -2.415492e+07\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.336184,
                    "execution_time": 0.144787,
                    "compile_time": 0.001006,
                    "planning_time": 0.141304
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.447891,
                    "execution_time": 0.141606,
                    "compile_time": 0.001022,
                    "planning_time": 0.25531
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel      id         sales       returns        profit\n0     store channel   217.0  5.540999e+07  1.480019e+06 -2.469882e+07\n1   catalog channel     NaN  2.165163e+08  2.060232e+08 -1.595672e+08\n2       web channel   485.0  4.051345e+06  7.053738e+04 -3.060570e+05\n3       web channel  1754.0  4.050969e+06  1.138955e+05 -4.395342e+05\n4       web channel   884.0  4.076136e+06  1.600255e+05 -3.102416e+05\n5       web channel   469.0  4.091637e+06  1.646645e+05 -4.144319e+05\n6       web channel   710.0  3.950641e+06  1.622775e+05 -4.854233e+05\n7       web channel  1019.0  3.916127e+06  4.181253e+04 -5.370942e+05\n8       web channel   533.0  4.030831e+06  3.906503e+04 -3.959995e+05\n9       web channel   757.0  4.113696e+06  1.266003e+05 -3.681724e+05\n10      web channel   931.0  3.891094e+06  1.244435e+05 -3.641668e+05\n11      web channel  1285.0  3.680364e+06  1.480503e+05 -5.452117e+05\n12      web channel   908.0  4.216786e+06  1.192430e+05 -5.373867e+05\n13      web channel  1106.0  3.805007e+06  1.703638e+05 -6.276239e+05\n14    store channel   130.0  5.539818e+07  1.449920e+06 -2.510280e+07\n15    store channel   148.0  5.438682e+07  1.294885e+06 -2.453198e+07\n16    store channel    14.0  5.605025e+07  1.494419e+06 -2.556552e+07\n17    store channel   304.0  5.650659e+07  1.293894e+06 -2.538309e+07\n18    store channel   104.0  5.397036e+07  1.388381e+06 -2.415492e+07\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel    id         sales       returns        profit\n0     store channel   202  5.729738e+07  1.347013e+06 -2.537142e+07\n1     store channel   248  5.715123e+07  1.352491e+06 -2.595791e+07\n2     store channel   356  5.889611e+07  1.371694e+06 -2.682096e+07\n3     store channel   391  5.796919e+07  1.344722e+06 -2.556376e+07\n4   catalog channel    23  1.151814e+10  2.060232e+08 -1.286935e+09\n5       web channel  1369  3.879055e+06  1.099085e+05 -2.693581e+05\n6       web channel   475  3.774907e+06  2.030303e+05 -3.871877e+05\n7       web channel  1085  4.061742e+06  5.489680e+04 -4.000097e+05\n8       web channel  1795  3.879937e+06  1.418839e+05 -5.758407e+05\n9       web channel  1445  4.159320e+06  6.333882e+04 -5.494720e+05\n10      web channel  1873  4.234912e+06  1.602769e+05 -4.398585e+05\n11      web channel  1813  4.054183e+06  1.687742e+05 -3.930031e+05\n12      web channel   962  3.625225e+06  1.396849e+05 -5.272927e+05\n13      web channel   944  3.941273e+06  1.249156e+05 -5.112965e+05\n14      web channel  1406  3.978846e+06  1.054479e+05 -4.649176e+05\n15      web channel  1165  3.952424e+06  1.471777e+05 -4.657421e+05\n16      web channel   812  4.134215e+06  1.452035e+05 -4.517943e+05\n17      web channel  1136  3.905659e+06  1.595601e+05 -5.081825e+05\n18      web channel  1309  3.956266e+06  1.371789e+05 -5.270382e+05\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.338736,
                    "execution_time": 0.143831,
                    "compile_time": 0.001053,
                    "planning_time": 0.143972
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.336445,
                    "execution_time": 0.140824,
                    "compile_time": 0.001021,
                    "planning_time": 0.142961
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel    id         sales       returns        profit\n0     store channel   202  5.729738e+07  1.347013e+06 -2.537142e+07\n1     store channel   248  5.715123e+07  1.352491e+06 -2.595791e+07\n2     store channel   356  5.889611e+07  1.371694e+06 -2.682096e+07\n3     store channel   391  5.796919e+07  1.344722e+06 -2.556376e+07\n4   catalog channel    23  1.151814e+10  2.060232e+08 -1.286935e+09\n5       web channel  1369  3.879055e+06  1.099085e+05 -2.693581e+05\n6       web channel   475  3.774907e+06  2.030303e+05 -3.871877e+05\n7       web channel  1085  4.061742e+06  5.489680e+04 -4.000097e+05\n8       web channel  1795  3.879937e+06  1.418839e+05 -5.758407e+05\n9       web channel  1445  4.159320e+06  6.333882e+04 -5.494720e+05\n10      web channel  1873  4.234912e+06  1.602769e+05 -4.398585e+05\n11      web channel  1813  4.054183e+06  1.687742e+05 -3.930031e+05\n12      web channel   962  3.625225e+06  1.396849e+05 -5.272927e+05\n13      web channel   944  3.941273e+06  1.249156e+05 -5.112965e+05\n14      web channel  1406  3.978846e+06  1.054479e+05 -4.649176e+05\n15      web channel  1165  3.952424e+06  1.471777e+05 -4.657421e+05\n16      web channel   812  4.134215e+06  1.452035e+05 -4.517943e+05\n17      web channel  1136  3.905659e+06  1.595601e+05 -5.081825e+05\n18      web channel  1309  3.956266e+06  1.371789e+05 -5.270382e+05\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales\n join date_dim on ss_sold_date_sk = d_date_sk\n join store on ss_store_sk = s_store_sk\n where d_date between cast('2000-08-02' as date) \n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by s_store_sk)\n ,\n sr as\n (select sr_store_sk as s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns\n join date_dim on sr_returned_date_sk = d_date_sk\n where d_date between cast('2000-08-02' as date)\n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by sr_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales\n join date_dim on cs_sold_date_sk = d_date_sk\n where d_date between cast('2000-08-02' as date)\n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns\n join date_dim on cr_returned_date_sk = d_date_sk\n where d_date between cast('2000-08-02' as date)\n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales\n join date_dim on ws_sold_date_sk = d_date_sk\n join web_page on ws_web_page_sk = wp_web_page_sk\n where d_date between cast('2000-08-02' as date)\n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns\n join date_dim on wr_returned_date_sk = d_date_sk\n join web_page on wr_web_page_sk = wp_web_page_sk\n where d_date between cast('2000-08-02' as date)\n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       left join cr on cs.cs_call_center_sk = cr.cr_call_center_sk\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" GROUP BY \"STORE_RETURNS\".\"SR_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" AS \"CR_CALL_CENTER_SK\" , SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" LEFT JOIN \"CR\" AS \"CR\" ON \"CR\".\"CR_CALL_CENTER_SK\" = \"CS\".\"CS_CALL_CENTER_SK\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES JOIN DATE_DIM ON SS_SOLD_DATE_SK = D_DATE_SK JOIN STORE ON SS_STORE_SK = S_STORE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY S_STORE_SK ) , SR AS ( SELECT SR_STORE_SK AS S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS JOIN DATE_DIM ON SR_RETURNED_DATE_SK = D_DATE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY SR_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES JOIN DATE_DIM ON CS_SOLD_DATE_SK = D_DATE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS JOIN DATE_DIM ON CR_RETURNED_DATE_SK = D_DATE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES JOIN DATE_DIM ON WS_SOLD_DATE_SK = D_DATE_SK JOIN WEB_PAGE ON WS_WEB_PAGE_SK = WP_WEB_PAGE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS JOIN DATE_DIM ON WR_RETURNED_DATE_SK = D_DATE_SK JOIN WEB_PAGE ON WR_WEB_PAGE_SK = WP_WEB_PAGE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS LEFT JOIN CR ON CS.CS_CALL_CENTER_SK = CR.CR_CALL_CENTER_SK UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel    id         sales      returns       profit\n0       web channel   770  4.180963e+06    140791.56   -452601.76\n1       web channel    44  4.277843e+06    112395.28   -363108.69\n2       web channel   740  4.061408e+06    124706.91   -576282.93\n3       web channel  1711  4.027747e+06    105951.62   -377331.54\n4       web channel  1753  4.195737e+06    125460.26   -348540.21\n5       web channel   395  3.993715e+06     68141.90   -493856.64\n6       web channel  1160  3.882311e+06    127836.41   -610973.68\n7       web channel   811  3.940869e+06    174198.58   -633551.48\n8       web channel  1808  4.233350e+06    140735.34   -487276.92\n9     store channel   379  5.554586e+07   1507488.55 -25110873.28\n10    store channel   124  5.531716e+07   1410144.06 -24977815.27\n11    store channel   172  5.630561e+07   1279799.46 -25492340.06\n12    store channel   286  5.603380e+07   1365105.08 -25063586.80\n13  catalog channel    20  5.371163e+08  13514106.90 -62231494.79\n14      web channel   685  3.987081e+06    142526.09   -454599.93\n15      web channel   263  4.074491e+06     42271.59   -448376.63\n16      web channel  1691  4.037964e+06     49148.61   -531434.62\n17      web channel  1265  4.135410e+06     90365.22   -517735.13\n18      web channel    20  3.945433e+06    221188.05   -600880.09\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.361922,
                    "execution_time": 0.134477,
                    "compile_time": 0.0158,
                    "planning_time": 0.163069
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.625427,
                    "execution_time": 0.138197,
                    "compile_time": 3.157955,
                    "planning_time": 0.274583
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel    id         sales      returns       profit\n0       web channel   770  4.180963e+06    140791.56   -452601.76\n1       web channel    44  4.277843e+06    112395.28   -363108.69\n2       web channel   740  4.061408e+06    124706.91   -576282.93\n3       web channel  1711  4.027747e+06    105951.62   -377331.54\n4       web channel  1753  4.195737e+06    125460.26   -348540.21\n5       web channel   395  3.993715e+06     68141.90   -493856.64\n6       web channel  1160  3.882311e+06    127836.41   -610973.68\n7       web channel   811  3.940869e+06    174198.58   -633551.48\n8       web channel  1808  4.233350e+06    140735.34   -487276.92\n9     store channel   379  5.554586e+07   1507488.55 -25110873.28\n10    store channel   124  5.531716e+07   1410144.06 -24977815.27\n11    store channel   172  5.630561e+07   1279799.46 -25492340.06\n12    store channel   286  5.603380e+07   1365105.08 -25063586.80\n13  catalog channel    20  5.371163e+08  13514106.90 -62231494.79\n14      web channel   685  3.987081e+06    142526.09   -454599.93\n15      web channel   263  4.074491e+06     42271.59   -448376.63\n16      web channel  1691  4.037964e+06     49148.61   -531434.62\n17      web channel  1265  4.135410e+06     90365.22   -517735.13\n18      web channel    20  3.945433e+06    221188.05   -600880.09\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results) \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS ) LIMIT 21",
                "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   292  56608558.64  1450939.98 -25551578.26\n1   store channel   140  54887773.74  1388852.68 -24300601.05\n2   store channel    94  56769940.48  1368784.89 -25184304.56\n3   store channel   398  55991416.84  1357776.93 -24518189.68\n4   store channel   370  57231348.99  1425261.01 -25716208.54\n5   store channel    44  57387704.45  1548125.95 -26400887.90\n6     web channel   391   3732297.93   126778.76   -638104.95\n7     web channel  1567   4162894.04   117860.34   -350014.14\n8     web channel   878   3788911.83    89817.58   -536170.37\n9     web channel  1609   4078270.39   129311.85   -477722.36\n10    web channel   890   3833794.14    92042.79   -535876.07\n11    web channel   248   3876352.52    76149.06   -643987.32\n12    web channel   713   4143846.01    67017.34   -411671.78\n13    web channel  1001   3956770.94    50385.67   -392674.77\n14    web channel  1958   4130097.20   115707.98   -411943.72\n15    web channel  1769   4001051.02    48078.20   -410121.18\n16    web channel   269   4102877.72    74309.59   -539711.12\n17    web channel  1427   4188303.34    42586.44   -456976.71\n18    web channel  1157   4122711.93    46062.54   -322649.56\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.354287,
                    "execution_time": 0.142795,
                    "compile_time": 0.001123,
                    "planning_time": 0.157374
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.456189,
                    "execution_time": 0.140987,
                    "compile_time": 0.001021,
                    "planning_time": 0.264472
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   292  56608558.64  1450939.98 -25551578.26\n1   store channel   140  54887773.74  1388852.68 -24300601.05\n2   store channel    94  56769940.48  1368784.89 -25184304.56\n3   store channel   398  55991416.84  1357776.93 -24518189.68\n4   store channel   370  57231348.99  1425261.01 -25716208.54\n5   store channel    44  57387704.45  1548125.95 -26400887.90\n6     web channel   391   3732297.93   126778.76   -638104.95\n7     web channel  1567   4162894.04   117860.34   -350014.14\n8     web channel   878   3788911.83    89817.58   -536170.37\n9     web channel  1609   4078270.39   129311.85   -477722.36\n10    web channel   890   3833794.14    92042.79   -535876.07\n11    web channel   248   3876352.52    76149.06   -643987.32\n12    web channel   713   4143846.01    67017.34   -411671.78\n13    web channel  1001   3956770.94    50385.67   -392674.77\n14    web channel  1958   4130097.20   115707.98   -411943.72\n15    web channel  1769   4001051.02    48078.20   -410121.18\n16    web channel   269   4102877.72    74309.59   -539711.12\n17    web channel  1427   4188303.34    42586.44   -456976.71\n18    web channel  1157   4122711.93    46062.54   -322649.56\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from results\n )\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS ) LIMIT 21",
                "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel    94  56769940.48  1368784.89 -25184304.56\n1   store channel   370  57231348.99  1425261.01 -25716208.54\n2   store channel   140  54887773.74  1388852.68 -24300601.05\n3   store channel    44  57387704.45  1548125.95 -26400887.90\n4   store channel   398  55991416.84  1357776.93 -24518189.68\n5   store channel   292  56608558.64  1450939.98 -25551578.26\n6     web channel  1817   4290803.96    38987.08   -424886.95\n7     web channel   391   3732297.93   126778.76   -638104.95\n8     web channel   356   3887733.44   177304.77   -529587.28\n9     web channel   575   3995327.32    57567.08   -374153.28\n10    web channel  1769   4001051.02    48078.20   -410121.18\n11    web channel   713   4143846.01    67017.34   -411671.78\n12    web channel   353   3991040.06    74946.40   -398423.94\n13    web channel  1220   4117307.19   126542.17   -428895.62\n14    web channel  1427   4188303.34    42586.44   -456976.71\n15    web channel  1979   3935158.65    46477.31   -370451.57\n16    web channel   781   3874186.74   138954.07   -434522.91\n17    web channel  1157   4122711.93    46062.54   -322649.56\n18    web channel   248   3876352.52    76149.06   -643987.32\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.348159,
                    "execution_time": 0.146539,
                    "compile_time": 0.001023,
                    "planning_time": 0.150631
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.345334,
                    "execution_time": 0.140235,
                    "compile_time": 0.001055,
                    "planning_time": 0.153549
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel    94  56769940.48  1368784.89 -25184304.56\n1   store channel   370  57231348.99  1425261.01 -25716208.54\n2   store channel   140  54887773.74  1388852.68 -24300601.05\n3   store channel    44  57387704.45  1548125.95 -26400887.90\n4   store channel   398  55991416.84  1357776.93 -24518189.68\n5   store channel   292  56608558.64  1450939.98 -25551578.26\n6     web channel  1817   4290803.96    38987.08   -424886.95\n7     web channel   391   3732297.93   126778.76   -638104.95\n8     web channel   356   3887733.44   177304.77   -529587.28\n9     web channel   575   3995327.32    57567.08   -374153.28\n10    web channel  1769   4001051.02    48078.20   -410121.18\n11    web channel   713   4143846.01    67017.34   -411671.78\n12    web channel   353   3991040.06    74946.40   -398423.94\n13    web channel  1220   4117307.19   126542.17   -428895.62\n14    web channel  1427   4188303.34    42586.44   -456976.71\n15    web channel  1979   3935158.65    46477.31   -370451.57\n16    web channel   781   3874186.74   138954.07   -434522.91\n17    web channel  1157   4122711.93    46062.54   -322649.56\n18    web channel   248   3876352.52    76149.06   -643987.32\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  * \n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel )\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"_Q_0\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"RETURNS\" AS \"RETURNS\" , \"_Q_0\".\"PROFIT\" AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL ) LIMIT 21",
                "preview": "\n/*            channel    id         sales       returns        profit\n0       web channel  1733  4.126702e+06  4.460535e+04 -3.717771e+05\n1       web channel   809  3.983790e+06  6.799311e+04 -4.191123e+05\n2     store channel   124  5.531716e+07  1.410144e+06 -2.497782e+07\n3       web channel    71  4.114012e+06  7.740710e+04 -3.713525e+05\n4     store channel   262  5.703814e+07  1.386439e+06 -2.561405e+07\n5       web channel   215  4.164620e+06  5.597679e+04 -3.863920e+05\n6       web channel  1571  3.703091e+06  9.294772e+04 -4.704723e+05\n7       web channel   818  4.033004e+06  1.354089e+05 -5.079116e+05\n8       web channel  1325  3.626346e+06  4.309969e+04 -5.300821e+05\n9       web channel   914  4.077517e+06  1.355839e+05 -4.610251e+05\n10      web channel  1513  4.056877e+06  1.594058e+05 -5.070438e+05\n11  catalog channel    17  1.144678e+10  2.060232e+08 -1.279106e+09\n12    store channel    76  5.527515e+07  1.394493e+06 -2.488403e+07\n13    store channel   274  5.765175e+07  1.431130e+06 -2.576407e+07\n14      web channel  1910  3.952158e+06  1.280705e+05 -3.640021e+05\n15      web channel  1700  3.883871e+06  1.289255e+05 -5.502747e+05\n16      web channel   403  3.928038e+06  1.447977e+05 -6.275852e+05\n17      web channel   943  4.070417e+06  1.174000e+05 -3.099911e+05\n18    store channel    26  5.490836e+07  1.323590e+06 -2.506101e+07\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.205454,
                    "execution_time": 0.481364,
                    "compile_time": 0.152632,
                    "planning_time": 1.005993
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 16.284211,
                    "execution_time": 0.486352,
                    "compile_time": 15.137608,
                    "planning_time": 7.450741
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel    id         sales       returns        profit\n0       web channel  1733  4.126702e+06  4.460535e+04 -3.717771e+05\n1       web channel   809  3.983790e+06  6.799311e+04 -4.191123e+05\n2     store channel   124  5.531716e+07  1.410144e+06 -2.497782e+07\n3       web channel    71  4.114012e+06  7.740710e+04 -3.713525e+05\n4     store channel   262  5.703814e+07  1.386439e+06 -2.561405e+07\n5       web channel   215  4.164620e+06  5.597679e+04 -3.863920e+05\n6       web channel  1571  3.703091e+06  9.294772e+04 -4.704723e+05\n7       web channel   818  4.033004e+06  1.354089e+05 -5.079116e+05\n8       web channel  1325  3.626346e+06  4.309969e+04 -5.300821e+05\n9       web channel   914  4.077517e+06  1.355839e+05 -4.610251e+05\n10      web channel  1513  4.056877e+06  1.594058e+05 -5.070438e+05\n11  catalog channel    17  1.144678e+10  2.060232e+08 -1.279106e+09\n12    store channel    76  5.527515e+07  1.394493e+06 -2.488403e+07\n13    store channel   274  5.765175e+07  1.431130e+06 -2.576407e+07\n14      web channel  1910  3.952158e+06  1.280705e+05 -3.640021e+05\n15      web channel  1700  3.883871e+06  1.289255e+05 -5.502747e+05\n16      web channel   403  3.928038e+06  1.447977e+05 -6.275852e+05\n17      web channel   943  4.070417e+06  1.174000e+05 -3.099911e+05\n18    store channel    26  5.490836e+07  1.323590e+06 -2.506101e+07\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select 'total' as channel, NULL as id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from results\n) /*CURSOR_IDENTIFIER*/\n",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"_Q_0\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT 'total' AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"RETURNS\" AS \"RETURNS\" , \"_Q_0\".\"PROFIT\" AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT 'total' AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) LIMIT 21",
                "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   292  56608558.64  1450939.98 -25551578.26\n1   store channel   140  54887773.74  1388852.68 -24300601.05\n2     web channel   890   3833794.14    92042.79   -535876.07\n3     web channel   248   3876352.52    76149.06   -643987.32\n4   store channel    97  57122966.24  1377687.16 -24855015.35\n5   store channel    68  56318178.82  1337202.91 -25078048.20\n6   store channel   278  57706063.71  1435371.80 -26035058.72\n7     web channel  1790   4226173.56   134241.56   -476896.73\n8     web channel  1727   3858989.58    73825.61   -486761.29\n9     web channel   362   3887730.73   122725.31   -491333.45\n10    web channel   320   3928700.84   181821.52   -613356.55\n11    web channel  1094   3944656.63   155232.33   -486520.27\n12    web channel   104   4085379.60   120085.43   -449717.21\n13    web channel  1651   4099068.40    98261.94   -480266.42\n14    web channel   607   3783569.81   124522.35   -696151.17\n15    web channel  1658   3979496.48   113927.30   -551340.70\n16    web channel   308   4005328.16   136436.65   -493788.86\n17    web channel   407   3866499.38    73891.39   -533902.38\n18    web channel  1424   3814997.91   161487.72   -507933.17\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.436585,
                    "execution_time": 0.579911,
                    "compile_time": 0.109391,
                    "planning_time": 1.144613
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 7.522739,
                    "execution_time": 0.564191,
                    "compile_time": 6.070536,
                    "planning_time": 1.266356
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel    id        sales     returns       profit\n0   store channel   292  56608558.64  1450939.98 -25551578.26\n1   store channel   140  54887773.74  1388852.68 -24300601.05\n2     web channel   890   3833794.14    92042.79   -535876.07\n3     web channel   248   3876352.52    76149.06   -643987.32\n4   store channel    97  57122966.24  1377687.16 -24855015.35\n5   store channel    68  56318178.82  1337202.91 -25078048.20\n6   store channel   278  57706063.71  1435371.80 -26035058.72\n7     web channel  1790   4226173.56   134241.56   -476896.73\n8     web channel  1727   3858989.58    73825.61   -486761.29\n9     web channel   362   3887730.73   122725.31   -491333.45\n10    web channel   320   3928700.84   181821.52   -613356.55\n11    web channel  1094   3944656.63   155232.33   -486520.27\n12    web channel   104   4085379.60   120085.43   -449717.21\n13    web channel  1651   4099068.40    98261.94   -480266.42\n14    web channel   607   3783569.81   124522.35   -696151.17\n15    web channel  1658   3979496.48   113927.30   -551340.70\n16    web channel   308   4005328.16   136436.65   -493788.86\n17    web channel   407   3866499.38    73891.39   -533902.38\n18    web channel  1424   3814997.91   161487.72   -507933.17\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select NULL AS channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results )\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"_Q_0\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"RETURNS\" AS \"RETURNS\" , \"_Q_0\".\"PROFIT\" AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) LIMIT 21",
                "preview": "\n/*          channel    id        sales     returns       profit\n0     web channel  1999   4086240.73   103401.17   -573026.90\n1     web channel  1064   3935727.77   125005.28   -528251.17\n2     web channel   944   3941272.67   124915.55   -511296.55\n3     web channel   955   4272251.12   132234.48   -444948.51\n4     web channel  1676   3885511.58   143925.52   -580811.18\n5     web channel  1813   4054183.27   168774.23   -393003.09\n6     web channel    89   4028121.73    41940.10   -352919.51\n7     web channel   875   3917601.33    31804.09   -502011.32\n8   store channel   190  54092937.66  1450171.10 -23922639.79\n9     web channel  1313   4003451.63    41383.82   -376975.11\n10  store channel   362  56716174.90  1509539.83 -25625460.15\n11    web channel  1483   4126378.59   164553.53   -538794.27\n12    web channel   125   4229606.83    35393.73   -368959.87\n13    web channel   637   4052483.42   126469.40   -505882.91\n14    web channel   272   3984113.93   127635.92   -491870.89\n15    web channel  1952   4190269.61   127575.99   -451557.58\n16    web channel   295   4165845.67   113515.05   -622526.42\n17    web channel    59   4008546.83    36964.74   -360560.63\n18    web channel   107   4158909.08    71663.24   -325608.10\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.449568,
                    "execution_time": 0.566173,
                    "compile_time": 0.126724,
                    "planning_time": 1.133233
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.517518,
                    "execution_time": 0.566255,
                    "compile_time": 3.079676,
                    "planning_time": 1.239332
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel    id        sales     returns       profit\n0     web channel  1999   4086240.73   103401.17   -573026.90\n1     web channel  1064   3935727.77   125005.28   -528251.17\n2     web channel   944   3941272.67   124915.55   -511296.55\n3     web channel   955   4272251.12   132234.48   -444948.51\n4     web channel  1676   3885511.58   143925.52   -580811.18\n5     web channel  1813   4054183.27   168774.23   -393003.09\n6     web channel    89   4028121.73    41940.10   -352919.51\n7     web channel   875   3917601.33    31804.09   -502011.32\n8   store channel   190  54092937.66  1450171.10 -23922639.79\n9     web channel  1313   4003451.63    41383.82   -376975.11\n10  store channel   362  56716174.90  1509539.83 -25625460.15\n11    web channel  1483   4126378.59   164553.53   -538794.27\n12    web channel   125   4229606.83    35393.73   -368959.87\n13    web channel   637   4052483.42   126469.40   -505882.91\n14    web channel   272   3984113.93   127635.92   -491870.89\n15    web channel  1952   4190269.61   127575.99   -451557.58\n16    web channel   295   4165845.67   113515.05   -622526.42\n17    web channel    59   4008546.83    36964.74   -360560.63\n18    web channel   107   4158909.08    71663.24   -325608.10\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select NULL AS channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results\n) foo\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) AS FOO LIMIT 21",
                "preview": "\n/*            channel    id         sales       returns        profit\n0     store channel   379  5.554586e+07  1.507489e+06 -2.511087e+07\n1       web channel    20  3.945433e+06  2.211880e+05 -6.008801e+05\n2       web channel   263  4.074491e+06  4.227159e+04 -4.483766e+05\n3       web channel  1777  3.950165e+06  1.099838e+05 -4.676992e+05\n4       web channel  1640  4.098460e+06  8.986600e+04 -5.541546e+05\n5       web channel   377  4.004194e+06  4.981218e+04 -4.977536e+05\n6     store channel   194  5.485204e+07  1.376550e+06 -2.477450e+07\n7       web channel   203  3.992765e+06  7.311920e+04 -4.249523e+05\n8       web channel  1351  3.902408e+06  1.350980e+05 -4.885827e+05\n9   catalog channel    25  1.122905e+10  2.060232e+08 -1.223842e+09\n10      web channel   827  4.025665e+06  4.054490e+04 -4.331212e+05\n11      web channel  1052  4.130514e+06  1.569769e+05 -4.418173e+05\n12      web channel  2024  4.202821e+06  1.163660e+05 -4.304637e+05\n13      web channel  1243  3.980223e+06  1.324975e+05 -5.726891e+05\n14      web channel  1729  3.832745e+06  1.269562e+05 -5.188393e+05\n15  catalog channel     2  1.142616e+10  2.060232e+08 -1.254771e+09\n16      web channel   947  4.076385e+06  6.839601e+04 -5.156956e+05\n17  catalog channel     1  1.140812e+10  2.060232e+08 -1.242683e+09\n18      web channel    61  3.678816e+06  1.328020e+05 -6.742785e+05\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.31149,
                    "execution_time": 0.560966,
                    "compile_time": 0.003716,
                    "planning_time": 1.115802
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.405655,
                    "execution_time": 0.564962,
                    "compile_time": 0.003718,
                    "planning_time": 1.211789
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel    id         sales       returns        profit\n0     store channel   379  5.554586e+07  1.507489e+06 -2.511087e+07\n1       web channel    20  3.945433e+06  2.211880e+05 -6.008801e+05\n2       web channel   263  4.074491e+06  4.227159e+04 -4.483766e+05\n3       web channel  1777  3.950165e+06  1.099838e+05 -4.676992e+05\n4       web channel  1640  4.098460e+06  8.986600e+04 -5.541546e+05\n5       web channel   377  4.004194e+06  4.981218e+04 -4.977536e+05\n6     store channel   194  5.485204e+07  1.376550e+06 -2.477450e+07\n7       web channel   203  3.992765e+06  7.311920e+04 -4.249523e+05\n8       web channel  1351  3.902408e+06  1.350980e+05 -4.885827e+05\n9   catalog channel    25  1.122905e+10  2.060232e+08 -1.223842e+09\n10      web channel   827  4.025665e+06  4.054490e+04 -4.331212e+05\n11      web channel  1052  4.130514e+06  1.569769e+05 -4.418173e+05\n12      web channel  2024  4.202821e+06  1.163660e+05 -4.304637e+05\n13      web channel  1243  3.980223e+06  1.324975e+05 -5.726891e+05\n14      web channel  1729  3.832745e+06  1.269562e+05 -5.188393e+05\n15  catalog channel     2  1.142616e+10  2.060232e+08 -1.254771e+09\n16      web channel   947  4.076385e+06  6.839601e+04 -5.156956e+05\n17  catalog channel     1  1.140812e+10  2.060232e+08 -1.242683e+09\n18      web channel    61  3.678816e+06  1.328020e+05 -6.742785e+05\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select NULL AS channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results\n) foo\norder by channel, id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\" ORDER BY \"FOO\".\"CHANNEL\" NULLS LAST , \"FOO\".\"ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) AS FOO ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
                "preview": "\n/*            channel    id         sales       returns        profit\n0              None   NaN  1.860249e+11  3.689247e+09 -2.465104e+10\n1   catalog channel   NaN  1.706159e+11  3.296372e+09 -1.910064e+10\n2   catalog channel   NaN  2.165163e+08  2.060232e+08 -1.595672e+08\n3   catalog channel   1.0  1.140812e+10  2.060232e+08 -1.242683e+09\n4   catalog channel   2.0  1.142616e+10  2.060232e+08 -1.254771e+09\n5   catalog channel   5.0  1.131507e+10  2.060232e+08 -1.285398e+09\n6   catalog channel   7.0  1.141958e+10  2.060232e+08 -1.283212e+09\n7   catalog channel   8.0  1.128032e+10  2.060232e+08 -1.215831e+09\n8   catalog channel  11.0  1.136757e+10  2.060232e+08 -1.274928e+09\n9   catalog channel  13.0  1.141213e+10  2.060232e+08 -1.226713e+09\n10  catalog channel  14.0  1.136732e+10  2.060232e+08 -1.258618e+09\n11  catalog channel  17.0  1.144678e+10  2.060232e+08 -1.279106e+09\n12  catalog channel  19.0  1.124498e+10  2.060232e+08 -1.314562e+09\n13  catalog channel  20.0  1.127944e+10  2.060232e+08 -1.259642e+09\n14  catalog channel  23.0  1.151814e+10  2.060232e+08 -1.286935e+09\n15  catalog channel  25.0  1.122905e+10  2.060232e+08 -1.223842e+09\n16  catalog channel  26.0  1.135109e+10  2.060232e+08 -1.244561e+09\n17  catalog channel  29.0  1.133363e+10  2.060232e+08 -1.290272e+09\n18    store channel   NaN  1.131796e+10  2.797332e+08 -5.070342e+09\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.384329,
                    "execution_time": 0.569713,
                    "compile_time": 0.049003,
                    "planning_time": 1.145784
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 8.045262,
                    "execution_time": 0.572197,
                    "compile_time": 6.631882,
                    "planning_time": 1.228905
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel    id         sales       returns        profit\n0              None   NaN  1.860249e+11  3.689247e+09 -2.465104e+10\n1   catalog channel   NaN  1.706159e+11  3.296372e+09 -1.910064e+10\n2   catalog channel   NaN  2.165163e+08  2.060232e+08 -1.595672e+08\n3   catalog channel   1.0  1.140812e+10  2.060232e+08 -1.242683e+09\n4   catalog channel   2.0  1.142616e+10  2.060232e+08 -1.254771e+09\n5   catalog channel   5.0  1.131507e+10  2.060232e+08 -1.285398e+09\n6   catalog channel   7.0  1.141958e+10  2.060232e+08 -1.283212e+09\n7   catalog channel   8.0  1.128032e+10  2.060232e+08 -1.215831e+09\n8   catalog channel  11.0  1.136757e+10  2.060232e+08 -1.274928e+09\n9   catalog channel  13.0  1.141213e+10  2.060232e+08 -1.226713e+09\n10  catalog channel  14.0  1.136732e+10  2.060232e+08 -1.258618e+09\n11  catalog channel  17.0  1.144678e+10  2.060232e+08 -1.279106e+09\n12  catalog channel  19.0  1.124498e+10  2.060232e+08 -1.314562e+09\n13  catalog channel  20.0  1.127944e+10  2.060232e+08 -1.259642e+09\n14  catalog channel  23.0  1.151814e+10  2.060232e+08 -1.286935e+09\n15  catalog channel  25.0  1.122905e+10  2.060232e+08 -1.223842e+09\n16  catalog channel  26.0  1.135109e+10  2.060232e+08 -1.244561e+09\n17  catalog channel  29.0  1.133363e+10  2.060232e+08 -1.290272e+09\n18    store channel   NaN  1.131796e+10  2.797332e+08 -5.070342e+09\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select NULL AS channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results\n) foo\norder by channel, id\n limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\" ORDER BY \"FOO\".\"CHANNEL\" NULLS LAST , \"FOO\".\"ID\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) AS FOO ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
                "preview": "\n/*            channel    id         sales       returns        profit\n0              None   NaN  1.860249e+11  3.689247e+09 -2.465104e+10\n1   catalog channel   NaN  1.706159e+11  3.296372e+09 -1.910064e+10\n2   catalog channel   NaN  2.165163e+08  2.060232e+08 -1.595672e+08\n3   catalog channel   1.0  1.140812e+10  2.060232e+08 -1.242683e+09\n4   catalog channel   2.0  1.142616e+10  2.060232e+08 -1.254771e+09\n5   catalog channel   5.0  1.131507e+10  2.060232e+08 -1.285398e+09\n6   catalog channel   7.0  1.141958e+10  2.060232e+08 -1.283212e+09\n7   catalog channel   8.0  1.128032e+10  2.060232e+08 -1.215831e+09\n8   catalog channel  11.0  1.136757e+10  2.060232e+08 -1.274928e+09\n9   catalog channel  13.0  1.141213e+10  2.060232e+08 -1.226713e+09\n10  catalog channel  14.0  1.136732e+10  2.060232e+08 -1.258618e+09\n11  catalog channel  17.0  1.144678e+10  2.060232e+08 -1.279106e+09\n12  catalog channel  19.0  1.124498e+10  2.060232e+08 -1.314562e+09\n13  catalog channel  20.0  1.127944e+10  2.060232e+08 -1.259642e+09\n14  catalog channel  23.0  1.151814e+10  2.060232e+08 -1.286935e+09\n15  catalog channel  25.0  1.122905e+10  2.060232e+08 -1.223842e+09\n16  catalog channel  26.0  1.135109e+10  2.060232e+08 -1.244561e+09\n17  catalog channel  29.0  1.133363e+10  2.060232e+08 -1.290272e+09\n18    store channel   NaN  1.131796e+10  2.797332e+08 -5.070342e+09\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.351737,
                    "execution_time": 0.562818,
                    "compile_time": 0.004086,
                    "planning_time": 1.152612
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.330213,
                    "execution_time": 0.567952,
                    "compile_time": 0.00398,
                    "planning_time": 1.125951
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel    id         sales       returns        profit\n0              None   NaN  1.860249e+11  3.689247e+09 -2.465104e+10\n1   catalog channel   NaN  1.706159e+11  3.296372e+09 -1.910064e+10\n2   catalog channel   NaN  2.165163e+08  2.060232e+08 -1.595672e+08\n3   catalog channel   1.0  1.140812e+10  2.060232e+08 -1.242683e+09\n4   catalog channel   2.0  1.142616e+10  2.060232e+08 -1.254771e+09\n5   catalog channel   5.0  1.131507e+10  2.060232e+08 -1.285398e+09\n6   catalog channel   7.0  1.141958e+10  2.060232e+08 -1.283212e+09\n7   catalog channel   8.0  1.128032e+10  2.060232e+08 -1.215831e+09\n8   catalog channel  11.0  1.136757e+10  2.060232e+08 -1.274928e+09\n9   catalog channel  13.0  1.141213e+10  2.060232e+08 -1.226713e+09\n10  catalog channel  14.0  1.136732e+10  2.060232e+08 -1.258618e+09\n11  catalog channel  17.0  1.144678e+10  2.060232e+08 -1.279106e+09\n12  catalog channel  19.0  1.124498e+10  2.060232e+08 -1.314562e+09\n13  catalog channel  20.0  1.127944e+10  2.060232e+08 -1.259642e+09\n14  catalog channel  23.0  1.151814e+10  2.060232e+08 -1.286935e+09\n15  catalog channel  25.0  1.122905e+10  2.060232e+08 -1.223842e+09\n16  catalog channel  26.0  1.135109e+10  2.060232e+08 -1.244561e+09\n17  catalog channel  29.0  1.133363e+10  2.060232e+08 -1.290272e+09\n18    store channel   NaN  1.131796e+10  2.797332e+08 -5.070342e+09\n...*/"
    }
]