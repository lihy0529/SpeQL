[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name,\n        v1.d_year, v1.d_moy,\n        v1.avg_monthly_sales,\n        v1.sum_sales, lag(v1.sum_sales) over \n          (partition by v1.i_category, v1.i_brand, v1.s_store_name, v1.s_company_name order by v1.d_year, v1.d_moy) psum, \n        lead(v1.sum_sales) over \n          (partition by v1.i_category, v1.i_brand, v1.s_store_name, v1.s_company_name order by v1.d_year, v1.d_moy) nsum\n from v1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) , \"V2\" AS ( SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , LAG ( \"V1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"V1\".\"I_CATEGORY\" , \"V1\".\"I_BRAND\" , \"V1\".\"S_STORE_NAME\" , \"V1\".\"S_COMPANY_NAME\" ORDER BY \"V1\".\"D_YEAR\" NULLS LAST , \"V1\".\"D_MOY\" NULLS LAST ) AS \"PSUM\" , LEAD ( \"V1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"V1\".\"I_CATEGORY\" , \"V1\".\"I_BRAND\" , \"V1\".\"S_STORE_NAME\" , \"V1\".\"S_COMPANY_NAME\" ORDER BY \"V1\".\"D_YEAR\" NULLS LAST , \"V1\".\"D_MOY\" NULLS LAST ) AS \"NSUM\" FROM \"V1\" AS \"V1\" ) SELECT \"V2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V2\".\"D_YEAR\" AS \"D_YEAR\" , \"V2\".\"D_MOY\" AS \"D_MOY\" , \"V2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V2\".\"PSUM\" AS \"PSUM\" , \"V2\".\"NSUM\" AS \"NSUM\" FROM \"V2\" AS \"V2\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.058837,
                    "execution_time": 2.439798,
                    "compile_time": 0.324115,
                    "planning_time": 0.05521,
                    "create_size": 1408
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 14.727274,
                    "execution_time": 2.730374,
                    "compile_time": 13.978136,
                    "planning_time": 0.131412,
                    "create_size": 1408
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , LAG ( \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_COMPANY_NAME\" ORDER BY \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" NULLS LAST ) AS \"PSUM\" , LEAD ( \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_COMPANY_NAME\" ORDER BY \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" NULLS LAST ) AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.871448,
                    "execution_time": 0.12781,
                    "compile_time": 0.390931,
                    "planning_time": 0.005988,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 13.967401,
                    "execution_time": 0.19842,
                    "compile_time": 13.40384,
                    "planning_time": 0.061691,
                    "create_size": 1280
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_2\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          anti    2001      8            5806.34    8006.01   4072.48   8243.85\n1          anti    2001      9            5806.34    8243.85   8006.01   7371.62\n2          anti    2001     10            5806.34    7371.62   8243.85   9849.35\n3          anti    2001     11            5806.34    9849.35   7371.62  10544.37\n4          anti    2001     12            5806.34   10544.37   9849.35   3162.65\n5          anti    2002      1            3162.65    3162.65  10544.37       NaN\n6           ese    2000     12             424.85     424.85       NaN    401.63\n7           ese    2001      1             466.07     401.63    424.85    241.16\n8           ese    2001      2             466.07     241.16    401.63    411.75\n9           ese    2001      3             466.07     411.75    241.16    356.88\n10          ese    2001      4             466.07     356.88    411.75    152.82\n11          ese    2001      5             466.07     152.82    356.88    494.11\n12          ese    2001      6             466.07     494.11    152.82    139.23\n13          ese    2001      7             466.07     139.23    494.11    312.63\n14          ese    2001      8             466.07     312.63    139.23    739.49\n15          ese    2001      9             466.07     739.49    312.63    614.66\n16          ese    2001     10             466.07     614.66    739.49    911.58\n17          ese    2001     11             466.07     911.58    614.66    817.00\n18          ese    2001     12             466.07     817.00    911.58    307.06\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.063135,
                    "execution_time": 0.007674,
                    "compile_time": 0.045324,
                    "planning_time": 0.003827
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.330792,
                    "execution_time": 0.008086,
                    "compile_time": 3.272569,
                    "planning_time": 0.039386
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_2\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_2\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          anti    2001      8            5806.34    8006.01   4072.48   8243.85\n1          anti    2001      9            5806.34    8243.85   8006.01   7371.62\n2          anti    2001     10            5806.34    7371.62   8243.85   9849.35\n3          anti    2001     11            5806.34    9849.35   7371.62  10544.37\n4          anti    2001     12            5806.34   10544.37   9849.35   3162.65\n5          anti    2002      1            3162.65    3162.65  10544.37       NaN\n6           ese    2000     12             424.85     424.85       NaN    401.63\n7           ese    2001      1             466.07     401.63    424.85    241.16\n8           ese    2001      2             466.07     241.16    401.63    411.75\n9           ese    2001      3             466.07     411.75    241.16    356.88\n10          ese    2001      4             466.07     356.88    411.75    152.82\n11          ese    2001      5             466.07     152.82    356.88    494.11\n12          ese    2001      6             466.07     494.11    152.82    139.23\n13          ese    2001      7             466.07     139.23    494.11    312.63\n14          ese    2001      8             466.07     312.63    139.23    739.49\n15          ese    2001      9             466.07     739.49    312.63    614.66\n16          ese    2001     10             466.07     614.66    739.49    911.58\n17          ese    2001     11             466.07     911.58    614.66    817.00\n18          ese    2001     12             466.07     817.00    911.58    307.06\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\nwhere v1.s_store_name = v1_lag.s_store_name\nand v1.s_store_name = v1_lead.s_store_name\nand v1_lag.d_year = v1.d_year\nand v1_lead.d_year = v1.d_year\nand v1_lag.d_moy = v1.d_moy - 1\nand v1_lead.d_moy = v1.d_moy + 1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1_LAG.D_YEAR = V1.D_YEAR AND V1_LEAD.D_YEAR = V1.D_YEAR AND V1_LAG.D_MOY = V1.D_MOY - 1 AND V1_LEAD.D_MOY = V1.D_MOY + 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0                  2001      8              785.6    1047.99  117.99  588.89\n1                  2001      8              785.6    1047.99  716.94  588.89\n2                  2001      8              785.6    1047.99  658.09  588.89\n3                  2001      8              785.6    1047.99  506.08  588.89\n4                  2001      8              785.6    1047.99  123.53  588.89\n5                  2001      8              785.6    1047.99  774.96  588.89\n6                  2001      8              785.6    1047.99  369.41  588.89\n7                  2001      8              785.6    1047.99    7.46  588.89\n8                  2001      8              785.6    1047.99   29.79  588.89\n9                  2001      8              785.6    1047.99   46.93  588.89\n10                 2001      8              785.6    1047.99  182.22  588.89\n11                 2001      8              785.6    1047.99  290.85  588.89\n12                 2001      8              785.6    1047.99   83.04  588.89\n13                 2001      8              785.6    1047.99   74.57  588.89\n14                 2001      8              785.6    1047.99  416.87  588.89\n15                 2001      8              785.6    1047.99  142.73  588.89\n16                 2001      8              785.6    1047.99  232.12  588.89\n17                 2001      8              785.6    1047.99  339.33  588.89\n18                 2001      8              785.6    1047.99  178.42  588.89\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 5.811365,
                    "execution_time": 5.466721,
                    "compile_time": 0.000986,
                    "planning_time": 2.137925
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 23.250446,
                    "execution_time": 5.326831,
                    "compile_time": 17.500107,
                    "planning_time": 11.48354
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0                  2001      8              785.6    1047.99  117.99  588.89\n1                  2001      8              785.6    1047.99  716.94  588.89\n2                  2001      8              785.6    1047.99  658.09  588.89\n3                  2001      8              785.6    1047.99  506.08  588.89\n4                  2001      8              785.6    1047.99  123.53  588.89\n5                  2001      8              785.6    1047.99  774.96  588.89\n6                  2001      8              785.6    1047.99  369.41  588.89\n7                  2001      8              785.6    1047.99    7.46  588.89\n8                  2001      8              785.6    1047.99   29.79  588.89\n9                  2001      8              785.6    1047.99   46.93  588.89\n10                 2001      8              785.6    1047.99  182.22  588.89\n11                 2001      8              785.6    1047.99  290.85  588.89\n12                 2001      8              785.6    1047.99   83.04  588.89\n13                 2001      8              785.6    1047.99   74.57  588.89\n14                 2001      8              785.6    1047.99  416.87  588.89\n15                 2001      8              785.6    1047.99  142.73  588.89\n16                 2001      8              785.6    1047.99  232.12  588.89\n17                 2001      8              785.6    1047.99  339.33  588.89\n18                 2001      8              785.6    1047.99  178.42  588.89\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n/*CURSOR_IDENTIFIER*/ v1.i_brand = v1_lag.i_brand\n and v1.s_store_name = v1_lag.s_store_name\n and v1.s_company_name = v1_lag.s_company_name\n and v1.d_year = v1_lag.d_year + 1\n and v1.i_category = v1_lead.i_category\n and v1.i_brand = v1_lead.i_brand\n and v1.s_store_name = v1_lead.s_store_name\n and v1.s_company_name = v1_lead.s_company_name\n and v1.d_year + 1 = v1_lead.d_year\n and v1.d_moy = 12\n) \nselect * from v2\norder by s_store_name, d_year, d_moy;",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.D_YEAR = V1_LAG.D_YEAR + 1 AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.D_YEAR + 1 = V1_LEAD.D_YEAR AND V1.D_MOY = 12 ) SELECT * FROM V2 ORDER BY S_STORE_NAME NULLS FIRST , D_YEAR NULLS FIRST , D_MOY NULLS FIRST LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0                  2001     12             839.36    2287.03   1806.62    535.30\n1                  2001     12             888.51    2133.89   1444.86    991.61\n2                  2001     12             396.40     528.04    655.68    238.78\n3                  2001     12            1023.97    2327.28   1117.74    318.52\n4                  2001     12             272.16     665.65    609.36    178.00\n5                  2001     12             933.78    1741.62   1963.86    489.53\n6                  2001     12            1177.16    1947.74   1792.69    572.66\n7                  2001     12             308.32     173.84   1152.77    257.45\n8                  2001     12             267.17     536.48    392.61     58.44\n9                  2001     12            1464.87    2461.22   2027.28    771.65\n10                 2001     12            1139.63    2336.58   1230.94    301.98\n11                 2001     12             932.87    1239.60   1608.59    247.48\n12                 2001     12           20757.43   42802.63  25042.55  10001.33\n13                 2001     12             217.74     415.32    511.33    110.54\n14                 2001     12           20863.60   38955.30  30024.22   9400.50\n15                 2001     12             338.52     850.49    622.05    316.04\n16                 2001     12           20695.66   42902.99  29781.20  10481.73\n17                 2001     12            1479.71    2269.76   1790.55    494.29\n18                 2001     12             219.58     178.15    323.12    114.10\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.337645,
                    "execution_time": 3.823044,
                    "compile_time": 0.068274,
                    "planning_time": 2.379843
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 19.481822,
                    "execution_time": 3.945734,
                    "compile_time": 16.923496,
                    "planning_time": 10.901653
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0                  2001     12             839.36    2287.03   1806.62    535.30\n1                  2001     12             888.51    2133.89   1444.86    991.61\n2                  2001     12             396.40     528.04    655.68    238.78\n3                  2001     12            1023.97    2327.28   1117.74    318.52\n4                  2001     12             272.16     665.65    609.36    178.00\n5                  2001     12             933.78    1741.62   1963.86    489.53\n6                  2001     12            1177.16    1947.74   1792.69    572.66\n7                  2001     12             308.32     173.84   1152.77    257.45\n8                  2001     12             267.17     536.48    392.61     58.44\n9                  2001     12            1464.87    2461.22   2027.28    771.65\n10                 2001     12            1139.63    2336.58   1230.94    301.98\n11                 2001     12             932.87    1239.60   1608.59    247.48\n12                 2001     12           20757.43   42802.63  25042.55  10001.33\n13                 2001     12             217.74     415.32    511.33    110.54\n14                 2001     12           20863.60   38955.30  30024.22   9400.50\n15                 2001     12             338.52     850.49    622.05    316.04\n16                 2001     12           20695.66   42902.99  29781.20  10481.73\n17                 2001     12            1479.71    2269.76   1790.55    494.29\n18                 2001     12             219.58     178.15    323.12    114.10\n...*/"
    },
    {
        "input": "with /* TPC-DS query47.tpl 0.42 */ v1 as (\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from store_sales, item, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy\n),\nv2 as (\n  select v1.s_store_name, v1.d_year, v1.d_moy,\n         v1.avg_monthly_sales, v1.sum_sales, \n         v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n  from v1\n  left join v1 v1_lag \n    on v1.i_category = v1_lag.i_category \n    and v1.s_store_name = v1_lag.s_store_name\n    and v1.d_year = v1_lag.d_year \n    and v1.d_moy = v1_lag.d_moy + 1\n  left join v1 v1_lead \n    on v1.i_category = v1_lead.i_category \n    and v1.s_store_name = v1_lead.s_store_name\n    and v1.d_year = v1_lead.d_year \n    and v1.d_moy = v1_lead.d_moy - 1\n  where v1.rn = 1\n)\nselect * from v2;\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" LEFT JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"V1\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" LEFT JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"V1\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"V1\".\"RN\" = 1"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.854743,
                    "execution_time": 2.391107,
                    "compile_time": 0.10823,
                    "planning_time": 0.057251,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 15.950968,
                    "execution_time": 2.422932,
                    "compile_time": 15.371473,
                    "planning_time": 0.137456,
                    "create_size": 1280
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_3\".\"RN\" = 1",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.647739,
                    "execution_time": 0.311782,
                    "compile_time": 0.255601,
                    "planning_time": 0.012822,
                    "create_size": 110
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 13.242139,
                    "execution_time": 0.310214,
                    "compile_time": 12.77816,
                    "planning_time": 0.09119,
                    "create_size": 110
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_4\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0                  2001      7              61.32      61.32  122.19   62.64\n1                  2001      7              61.32      61.32  122.19  129.67\n2                  2001      7              61.32      61.32  122.19   91.29\n3                  2001      7              61.32      61.32  122.19   18.69\n4                  2001      7              61.32      61.32  122.19  158.30\n5                  2001      7              61.32      61.32  122.19   23.95\n6                  2001      7              61.32      61.32  122.19   10.25\n7                  2001      7              61.32      61.32  122.19   23.33\n8                  2001      7              61.32      61.32  122.19   34.00\n9                  2001      7              61.32      61.32  122.19   24.63\n10                 2001      7              61.32      61.32  122.19    7.13\n11                 2001      7              61.32      61.32  122.19    9.70\n12                 2001      7              61.32      61.32  122.19   33.70\n13                 2001      7              61.32      61.32  122.19   73.98\n14                 2001      7              61.32      61.32  122.19   13.65\n15                 2001      7              61.32      61.32  122.19   20.06\n16                 2001      7              61.32      61.32  122.19   59.16\n17                 2001      7              61.32      61.32  122.19   30.21\n18                 2001      7              61.32      61.32  122.19   19.70\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017324,
                    "execution_time": 0.007316,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.003833
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.1531,
                    "execution_time": 0.007833,
                    "compile_time": 0.097705,
                    "planning_time": 0.038991
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_3\".\"RN\" = 1",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_4\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0                  2001      7              61.32      61.32  122.19   62.64\n1                  2001      7              61.32      61.32  122.19  129.67\n2                  2001      7              61.32      61.32  122.19   91.29\n3                  2001      7              61.32      61.32  122.19   18.69\n4                  2001      7              61.32      61.32  122.19  158.30\n5                  2001      7              61.32      61.32  122.19   23.95\n6                  2001      7              61.32      61.32  122.19   10.25\n7                  2001      7              61.32      61.32  122.19   23.33\n8                  2001      7              61.32      61.32  122.19   34.00\n9                  2001      7              61.32      61.32  122.19   24.63\n10                 2001      7              61.32      61.32  122.19    7.13\n11                 2001      7              61.32      61.32  122.19    9.70\n12                 2001      7              61.32      61.32  122.19   33.70\n13                 2001      7              61.32      61.32  122.19   73.98\n14                 2001      7              61.32      61.32  122.19   13.65\n15                 2001      7              61.32      61.32  122.19   20.06\n16                 2001      7              61.32      61.32  122.19   59.16\n17                 2001      7              61.32      61.32  122.19   30.21\n18                 2001      7              61.32      61.32  122.19   19.70\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.d_year = v1_lag.d_year and\n       v1.d_year = v1_lead.d_year and\n       v1.d_moy = v1_lag.d_moy + 1 and\n       v1.d_moy = v1_lead.d_moy - 1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.D_YEAR = V1_LAG.D_YEAR AND V1.D_YEAR = V1_LEAD.D_YEAR AND V1.D_MOY = V1_LAG.D_MOY + 1 AND V1.D_MOY = V1_LEAD.D_MOY - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0                  2001      5             785.60     452.88    529.93    291.23\n1                  2001      6             785.60     291.23    452.88    673.79\n2                  2001      8             785.60    1047.99    673.79    940.01\n3                  2001     11             785.60    1464.51    908.96   1368.09\n4                  2001      3             785.60     819.45    370.14    529.93\n5                  2001      7             785.60     673.79    291.23   1047.99\n6                  2001      9             785.60     940.01   1047.99    908.96\n7                  2001     10             785.60     908.96    940.01   1464.51\n8                  2001      4             785.60     529.93    819.45    452.88\n9                  2001      2             785.60     370.14    560.31    819.45\n10          ese    2001      2           23896.91   12177.53  14523.24  15927.68\n11          ese    2001      3           23896.91   15927.68  12177.53  12386.70\n12          ese    2001      5           23896.91   14592.43  12386.70  12346.38\n13          ese    2001      8           23896.91   32323.89  12214.35  31748.31\n14          ese    2001     10           23896.91   32526.95  31748.31  46304.24\n15          ese    2001      6           23896.91   12346.38  14592.43  12214.35\n16          ese    2001      4           23896.91   12386.70  15927.68  14592.43\n17          ese    2001      7           23896.91   12214.35  12346.38  32323.89\n18          ese    2001      9           23896.91   31748.31  32323.89  32526.95\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 5.045106,
                    "execution_time": 4.366636,
                    "compile_time": 0.203408,
                    "planning_time": 2.862493
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 23.892512,
                    "execution_time": 10.767552,
                    "compile_time": 12.614976,
                    "planning_time": 15.445878
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0                  2001      5             785.60     452.88    529.93    291.23\n1                  2001      6             785.60     291.23    452.88    673.79\n2                  2001      8             785.60    1047.99    673.79    940.01\n3                  2001     11             785.60    1464.51    908.96   1368.09\n4                  2001      3             785.60     819.45    370.14    529.93\n5                  2001      7             785.60     673.79    291.23   1047.99\n6                  2001      9             785.60     940.01   1047.99    908.96\n7                  2001     10             785.60     908.96    940.01   1464.51\n8                  2001      4             785.60     529.93    819.45    452.88\n9                  2001      2             785.60     370.14    560.31    819.45\n10          ese    2001      2           23896.91   12177.53  14523.24  15927.68\n11          ese    2001      3           23896.91   15927.68  12177.53  12386.70\n12          ese    2001      5           23896.91   14592.43  12386.70  12346.38\n13          ese    2001      8           23896.91   32323.89  12214.35  31748.31\n14          ese    2001     10           23896.91   32526.95  31748.31  46304.24\n15          ese    2001      6           23896.91   12346.38  14592.43  12214.35\n16          ese    2001      4           23896.91   12386.70  15927.68  14592.43\n17          ese    2001      7           23896.91   12214.35  12346.38  32323.89\n18          ese    2001      9           23896.91   31748.31  32323.89  32526.95\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1\n join v1 as v1_lag on v1.i_category = v1_lag.i_category and\n                      v1.i_brand = v1_lag.i_brand and\n                      v1.s_store_name = v1_lag.s_store_name and\n                      v1.d_year = v1_lag.d_year - 1\n join v1 as v1_lead on v1.i_category = v1_lead.i_category and\n                       v1.i_brand = v1_lead.i_brand and\n                       v1.s_store_name = v1_lead.s_store_name and\n                       v1.d_year = v1_lead.d_year + 1\nwhere v1.d_moy between 1 and 12\n/*CURSOR_IDENTIFIER*/\n) \nselect * from v2;",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" - 1 AND \"V1\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" + 1 AND \"V1\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"V1\".\"D_MOY\" <= 12 AND \"V1\".\"D_MOY\" >= 1"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_BRAND\" AS \"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.601363,
                    "execution_time": 0.097743,
                    "compile_time": 0.186812,
                    "planning_time": 0.00418,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 7.351258,
                    "execution_time": 0.100686,
                    "compile_time": 6.871486,
                    "planning_time": 0.059929,
                    "create_size": 1280
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_5\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_5\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" - 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" + 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" <= 12 AND \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" >= 1",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.716372,
                    "execution_time": 0.133478,
                    "compile_time": 0.188043,
                    "planning_time": 0.011511,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 10.470868,
                    "execution_time": 0.162211,
                    "compile_time": 9.859833,
                    "planning_time": 0.069129,
                    "create_size": 1280
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_6\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_6\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_6\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum      nsum\n0           ese    2001     10             842.59     988.88   572.78  43272.95\n1           ese    2001     10             842.59     988.88   572.78   1475.36\n2           ese    2001      3             842.59     411.66   572.78  43272.95\n3           ese    2001      3             842.59     411.66   572.78   1475.36\n4          n st    2001     12           15061.25   31978.44  7910.60  21044.34\n5          n st    2001     11           15061.25   29450.91  7910.60  21044.34\n6          n st    2001     10           15061.25   19611.49  7910.60  21044.34\n7          n st    2001      6           15061.25    9616.68  7910.60  21044.34\n8          n st    2001      9           15061.25   19153.94  7910.60  21044.34\n9          n st    2001      8           15061.25   18828.32  7910.60  21044.34\n10         n st    2001      7           15061.25    8513.49  7910.60  21044.34\n11         n st    2001      5           15061.25    8360.62  7910.60  21044.34\n12         n st    2001      2           15061.25    9054.03  7910.60  21044.34\n13         n st    2001      4           15061.25    9158.31  7910.60  21044.34\n14         n st    2001      3           15061.25    7206.00  7910.60  21044.34\n15         n st    2001      1           15061.25    9802.83  7910.60  21044.34\n16        ation    2001     12           14450.13   27898.00  7457.16  20806.71\n17        ation    2001      6           14450.13    8331.27  7457.16  20806.71\n18        ation    2001     11           14450.13   28322.91  7457.16  20806.71\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017943,
                    "execution_time": 0.007566,
                    "compile_time": 5.2e-05,
                    "planning_time": 0.003968
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.056192,
                    "execution_time": 0.008131,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.039427
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_5\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_5\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" - 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" + 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" <= 12 AND \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" >= 1",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_6\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_6\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_6\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum      nsum\n0           ese    2001     10             842.59     988.88   572.78  43272.95\n1           ese    2001     10             842.59     988.88   572.78   1475.36\n2           ese    2001      3             842.59     411.66   572.78  43272.95\n3           ese    2001      3             842.59     411.66   572.78   1475.36\n4          n st    2001     12           15061.25   31978.44  7910.60  21044.34\n5          n st    2001     11           15061.25   29450.91  7910.60  21044.34\n6          n st    2001     10           15061.25   19611.49  7910.60  21044.34\n7          n st    2001      6           15061.25    9616.68  7910.60  21044.34\n8          n st    2001      9           15061.25   19153.94  7910.60  21044.34\n9          n st    2001      8           15061.25   18828.32  7910.60  21044.34\n10         n st    2001      7           15061.25    8513.49  7910.60  21044.34\n11         n st    2001      5           15061.25    8360.62  7910.60  21044.34\n12         n st    2001      2           15061.25    9054.03  7910.60  21044.34\n13         n st    2001      4           15061.25    9158.31  7910.60  21044.34\n14         n st    2001      3           15061.25    7206.00  7910.60  21044.34\n15         n st    2001      1           15061.25    9802.83  7910.60  21044.34\n16        ation    2001     12           14450.13   27898.00  7457.16  20806.71\n17        ation    2001      6           14450.13    8331.27  7457.16  20806.71\n18        ation    2001     11           14450.13   28322.91  7457.16  20806.71\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy = 12) or\n         ( d_year = 2001+1 and d_moy = 1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1, v1 as v1_lag, v1 as v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0          n st    2001      1              91.65      79.35  127.49   12.02\n1          n st    2001      2              91.65      12.02   79.35  105.05\n2          n st    2001      3              91.65     105.05   12.02    2.69\n3          n st    2001      4              91.65       2.69  105.05  116.37\n4          n st    2001      7              91.65     116.37    2.69   82.34\n5          n st    2001      8              91.65      82.34  116.37  133.62\n6          n st    2001      9              91.65     133.62   82.34   18.90\n7          n st    2001     10              91.65      18.90  133.62  208.03\n8          n st    2001     11              91.65     208.03   18.90  158.19\n9         ought    2001      1             104.86      65.14  318.36  143.39\n10        ought    2001      3             104.86     143.39   65.14    0.89\n11        ought    2001      4             104.86       0.89  143.39   81.29\n12        ought    2001      5             104.86      81.29    0.89  129.83\n13        ought    2001      6             104.86     129.83   81.29   29.82\n14        ought    2001      7             104.86      29.82  129.83   97.66\n15        ought    2001      8             104.86      97.66   29.82  159.36\n16        ought    2001      9             104.86     159.36   97.66  289.39\n17        ought    2001     10             104.86     289.39  159.36   33.00\n18        ought    2001     11             104.86      33.00  289.39  123.78\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.914332,
                    "execution_time": 4.456934,
                    "compile_time": 0.063769,
                    "planning_time": 2.643059
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 21.143385,
                    "execution_time": 4.437231,
                    "compile_time": 18.388548,
                    "planning_time": 11.723359
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0          n st    2001      1              91.65      79.35  127.49   12.02\n1          n st    2001      2              91.65      12.02   79.35  105.05\n2          n st    2001      3              91.65     105.05   12.02    2.69\n3          n st    2001      4              91.65       2.69  105.05  116.37\n4          n st    2001      7              91.65     116.37    2.69   82.34\n5          n st    2001      8              91.65      82.34  116.37  133.62\n6          n st    2001      9              91.65     133.62   82.34   18.90\n7          n st    2001     10              91.65      18.90  133.62  208.03\n8          n st    2001     11              91.65     208.03   18.90  158.19\n9         ought    2001      1             104.86      65.14  318.36  143.39\n10        ought    2001      3             104.86     143.39   65.14    0.89\n11        ought    2001      4             104.86       0.89  143.39   81.29\n12        ought    2001      5             104.86      81.29    0.89  129.83\n13        ought    2001      6             104.86     129.83   81.29   29.82\n14        ought    2001      7             104.86      29.82  129.83   97.66\n15        ought    2001      8             104.86      97.66   29.82  159.36\n16        ought    2001      9             104.86     159.36   97.66  289.39\n17        ought    2001     10             104.86     289.39  159.36   33.00\n18        ought    2001     11             104.86      33.00  289.39  123.78\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2000 and d_moy =12) or\n         ( d_year = 2002 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name,\n        v1.d_year, v1.d_moy,\n        v1.avg_monthly_sales,\n        v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1\n join v1 as v1_lag on v1.i_category = v1_lag.i_category and\n                      v1.i_brand = v1_lag.i_brand and\n                      v1.s_store_name = v1_lag.s_store_name and\n                      v1.s_company_name = v1_lag.s_company_name and\n                      v1.rn = v1_lag.rn + 1\n join v1 as v1_lead on v1.i_category = v1_lead.i_category and\n                       v1.i_brand = v1_lead.i_brand and\n                       v1.s_store_name = v1_lead.s_store_name and\n                       v1.s_company_name = v1_lead.s_company_name and\n                       v1.rn = v1_lead.rn - 1\n)\nselect *\nfrom v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 AND \"V1\".\"S_COMPANY_NAME\" = \"V1_LAG\".\"S_COMPANY_NAME\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"V1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 AND \"V1\".\"S_COMPANY_NAME\" = \"V1_LEAD\".\"S_COMPANY_NAME\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.139895,
                    "execution_time": 2.739428,
                    "compile_time": 0.000706,
                    "planning_time": 0.058418,
                    "create_size": 1536
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 7.768862,
                    "execution_time": 2.831179,
                    "compile_time": 4.53572,
                    "planning_time": 0.133922,
                    "create_size": 1536
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_7\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_7\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LAG\".\"RN\" + 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LAG\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LEAD\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.697519,
                    "execution_time": 0.111076,
                    "compile_time": 0.282762,
                    "planning_time": 0.01108,
                    "create_size": 1260
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 12.8113,
                    "execution_time": 0.152372,
                    "compile_time": 12.296682,
                    "planning_time": 0.06763,
                    "create_size": 1240
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_8\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_8\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          able    2001      2           29730.55   14730.98  18545.58  15890.10\n1          able    2001      3           29730.55   15890.10  14730.98  16923.53\n2          able    2001      4           29730.55   16923.53  15890.10  16587.96\n3          able    2001      5           29730.55   16587.96  16923.53  16703.53\n4          able    2001      6           29730.55   16703.53  16587.96  18532.37\n5          able    2001      7           29730.55   18532.37  16703.53  39053.96\n6          able    2001      8           29730.55   39053.96  18532.37  38387.27\n7          able    2001      9           29730.55   38387.27  39053.96  40770.90\n8          able    2001     10           29730.55   40770.90  38387.27  57722.19\n9          able    2001     11           29730.55   57722.19  40770.90  62918.33\n10         able    2001     12           29730.55   62918.33  57722.19  12850.64\n11         anti    2001      1           14289.52    8750.14  19620.40   7180.09\n12         anti    2001      2           14289.52    7180.09   8750.14   7474.10\n13         anti    2001      3           14289.52    7474.10   7180.09   6713.86\n14         anti    2001      4           14289.52    6713.86   7474.10   6965.95\n15         anti    2001      5           14289.52    6965.95   6713.86   8317.64\n16         anti    2001      6           14289.52    8317.64   6965.95   8472.79\n17         anti    2001      7           14289.52    8472.79   8317.64  20316.58\n18         anti    2001      8           14289.52   20316.58   8472.79  21230.10\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017698,
                    "execution_time": 0.007879,
                    "compile_time": 4.5e-05,
                    "planning_time": 0.003733
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.054564,
                    "execution_time": 0.00819,
                    "compile_time": 4.8e-05,
                    "planning_time": 0.0389
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_7\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_7\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LAG\".\"RN\" + 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LAG\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LEAD\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_8\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_8\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          able    2001      2           29730.55   14730.98  18545.58  15890.10\n1          able    2001      3           29730.55   15890.10  14730.98  16923.53\n2          able    2001      4           29730.55   16923.53  15890.10  16587.96\n3          able    2001      5           29730.55   16587.96  16923.53  16703.53\n4          able    2001      6           29730.55   16703.53  16587.96  18532.37\n5          able    2001      7           29730.55   18532.37  16703.53  39053.96\n6          able    2001      8           29730.55   39053.96  18532.37  38387.27\n7          able    2001      9           29730.55   38387.27  39053.96  40770.90\n8          able    2001     10           29730.55   40770.90  38387.27  57722.19\n9          able    2001     11           29730.55   57722.19  40770.90  62918.33\n10         able    2001     12           29730.55   62918.33  57722.19  12850.64\n11         anti    2001      1           14289.52    8750.14  19620.40   7180.09\n12         anti    2001      2           14289.52    7180.09   8750.14   7474.10\n13         anti    2001      3           14289.52    7474.10   7180.09   6713.86\n14         anti    2001      4           14289.52    6713.86   7474.10   6965.95\n15         anti    2001      5           14289.52    6965.95   6713.86   8317.64\n16         anti    2001      6           14289.52    8317.64   6965.95   8472.79\n17         anti    2001      7           14289.52    8472.79   8317.64  20316.58\n18         anti    2001      8           14289.52   20316.58   8472.79  21230.10\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select * from v2\n\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0          n st    2001      1              91.65      79.35  127.49   12.02\n1          n st    2001      2              91.65      12.02   79.35  105.05\n2          n st    2001      3              91.65     105.05   12.02    2.69\n3          n st    2001      4              91.65       2.69  105.05  116.37\n4          n st    2001      7              91.65     116.37    2.69   82.34\n5          n st    2001      8              91.65      82.34  116.37  133.62\n6          n st    2001      9              91.65     133.62   82.34   18.90\n7          n st    2001     10              91.65      18.90  133.62  208.03\n8          n st    2001     11              91.65     208.03   18.90  158.19\n9         ought    2001      1             104.86      65.14  318.36  143.39\n10        ought    2001      3             104.86     143.39   65.14    0.89\n11        ought    2001      4             104.86       0.89  143.39   81.29\n12        ought    2001      5             104.86      81.29    0.89  129.83\n13        ought    2001      6             104.86     129.83   81.29   29.82\n14        ought    2001      7             104.86      29.82  129.83   97.66\n15        ought    2001      8             104.86      97.66   29.82  159.36\n16        ought    2001      9             104.86     159.36   97.66  289.39\n17        ought    2001     10             104.86     289.39  159.36   33.00\n18        ought    2001     11             104.86      33.00  289.39  123.78\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.331738,
                    "execution_time": 3.939566,
                    "compile_time": 0.001051,
                    "planning_time": 2.304351
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.317058,
                    "execution_time": 3.926351,
                    "compile_time": 0.001073,
                    "planning_time": 2.354135
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0          n st    2001      1              91.65      79.35  127.49   12.02\n1          n st    2001      2              91.65      12.02   79.35  105.05\n2          n st    2001      3              91.65     105.05   12.02    2.69\n3          n st    2001      4              91.65       2.69  105.05  116.37\n4          n st    2001      7              91.65     116.37    2.69   82.34\n5          n st    2001      8              91.65      82.34  116.37  133.62\n6          n st    2001      9              91.65     133.62   82.34   18.90\n7          n st    2001     10              91.65      18.90  133.62  208.03\n8          n st    2001     11              91.65     208.03   18.90  158.19\n9         ought    2001      1             104.86      65.14  318.36  143.39\n10        ought    2001      3             104.86     143.39   65.14    0.89\n11        ought    2001      4             104.86       0.89  143.39   81.29\n12        ought    2001      5             104.86      81.29    0.89  129.83\n13        ought    2001      6             104.86     129.83   81.29   29.82\n14        ought    2001      7             104.86      29.82  129.83   97.66\n15        ought    2001      8             104.86      97.66   29.82  159.36\n16        ought    2001      9             104.86     159.36   97.66  289.39\n17        ought    2001     10             104.86     289.39  159.36   33.00\n18        ought    2001     11             104.86      33.00  289.39  123.78\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          able    2001      1           23904.51   15226.73  54621.09  11084.19\n1          able    2001      2           23904.51   11084.19  15226.73  13333.81\n2          able    2001      3           23904.51   13333.81  11084.19  14591.55\n3          able    2001      4           23904.51   14591.55  13333.81  14099.78\n4          able    2001      5           23904.51   14099.78  14591.55  13745.80\n5          able    2001      6           23904.51   13745.80  14099.78  13411.02\n6          able    2001      7           23904.51   13411.02  13745.80  31165.06\n7          able    2001      8           23904.51   31165.06  13411.02  33597.90\n8          able    2001      9           23904.51   33597.90  31165.06  34063.04\n9          able    2001     10           23904.51   34063.04  33597.90  43990.36\n10         able    2001     11           23904.51   43990.36  34063.04  48544.91\n11         able    2001     12           23904.51   48544.91  43990.36  15960.96\n12        cally    2001      1           22282.37   14245.71  52044.55  11749.33\n13        cally    2001      2           22282.37   11749.33  14245.71  13059.59\n14        cally    2001      3           22282.37   13059.59  11749.33  12541.03\n15        cally    2001      4           22282.37   12541.03  13059.59  13128.34\n16        cally    2001      5           22282.37   13128.34  12541.03  14466.59\n17        cally    2001      6           22282.37   14466.59  13128.34  13500.19\n18        cally    2001      7           22282.37   13500.19  14466.59  28860.50\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.38997,
                    "execution_time": 3.990204,
                    "compile_time": 0.001093,
                    "planning_time": 2.34611
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.275334,
                    "execution_time": 3.886642,
                    "compile_time": 0.00106,
                    "planning_time": 2.264968
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          able    2001      1           23904.51   15226.73  54621.09  11084.19\n1          able    2001      2           23904.51   11084.19  15226.73  13333.81\n2          able    2001      3           23904.51   13333.81  11084.19  14591.55\n3          able    2001      4           23904.51   14591.55  13333.81  14099.78\n4          able    2001      5           23904.51   14099.78  14591.55  13745.80\n5          able    2001      6           23904.51   13745.80  14099.78  13411.02\n6          able    2001      7           23904.51   13411.02  13745.80  31165.06\n7          able    2001      8           23904.51   31165.06  13411.02  33597.90\n8          able    2001      9           23904.51   33597.90  31165.06  34063.04\n9          able    2001     10           23904.51   34063.04  33597.90  43990.36\n10         able    2001     11           23904.51   43990.36  34063.04  48544.91\n11         able    2001     12           23904.51   48544.91  43990.36  15960.96\n12        cally    2001      1           22282.37   14245.71  52044.55  11749.33\n13        cally    2001      2           22282.37   11749.33  14245.71  13059.59\n14        cally    2001      3           22282.37   13059.59  11749.33  12541.03\n15        cally    2001      4           22282.37   12541.03  13059.59  13128.34\n16        cally    2001      5           22282.37   13128.34  12541.03  14466.59\n17        cally    2001      6           22282.37   14466.59  13128.34  13500.19\n18        cally    2001      7           22282.37   13500.19  14466.59  28860.50\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0          anti    2001      3             141.11      49.04  161.34   45.62\n1          anti    2001      4             141.11      45.62   49.04   81.36\n2          anti    2001      5             141.11      81.36   45.62   95.63\n3          anti    2001      6             141.11      95.63   81.36   44.13\n4          anti    2001      7             141.11      44.13   95.63  235.89\n5          anti    2001      8             141.11     235.89   44.13  261.59\n6          anti    2001      9             141.11     261.59  235.89  120.85\n7          anti    2001     10             141.11     120.85  261.59   74.70\n8          anti    2001     11             141.11      74.70  120.85  382.16\n9          anti    2001     12             141.11     382.16   74.70   54.58\n10          ese    2001      2             249.33      76.35   43.96  248.27\n11          ese    2001      3             249.33     248.27   76.35  179.60\n12          ese    2001      4             249.33     179.60  248.27   97.42\n13          ese    2001      5             249.33      97.42  179.60   96.38\n14          ese    2001      6             249.33      96.38   97.42  203.11\n15          ese    2001      7             249.33     203.11   96.38  392.75\n16          ese    2001      8             249.33     392.75  203.11  519.74\n17          ese    2001      9             249.33     519.74  392.75  202.53\n18          ese    2001     10             249.33     202.53  519.74  593.39\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 5.31845,
                    "execution_time": 4.769316,
                    "compile_time": 0.16335,
                    "planning_time": 2.729964
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.867756,
                    "execution_time": 4.089396,
                    "compile_time": 9.310193,
                    "planning_time": 2.427174
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0          anti    2001      3             141.11      49.04  161.34   45.62\n1          anti    2001      4             141.11      45.62   49.04   81.36\n2          anti    2001      5             141.11      81.36   45.62   95.63\n3          anti    2001      6             141.11      95.63   81.36   44.13\n4          anti    2001      7             141.11      44.13   95.63  235.89\n5          anti    2001      8             141.11     235.89   44.13  261.59\n6          anti    2001      9             141.11     261.59  235.89  120.85\n7          anti    2001     10             141.11     120.85  261.59   74.70\n8          anti    2001     11             141.11      74.70  120.85  382.16\n9          anti    2001     12             141.11     382.16   74.70   54.58\n10          ese    2001      2             249.33      76.35   43.96  248.27\n11          ese    2001      3             249.33     248.27   76.35  179.60\n12          ese    2001      4             249.33     179.60  248.27   97.42\n13          ese    2001      5             249.33      97.42  179.60   96.38\n14          ese    2001      6             249.33      96.38   97.42  203.11\n15          ese    2001      7             249.33     203.11   96.38  392.75\n16          ese    2001      8             249.33     392.75  203.11  519.74\n17          ese    2001      9             249.33     519.74  392.75  202.53\n18          ese    2001     10             249.33     202.53  519.74  593.39\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n/*CURSOR_IDENTIFIER*/\n1=1\n",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND 1 = 1 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          anti    2001      1             308.70     271.52   507.78   379.12\n1          anti    2001      2             308.70     379.12   271.52   119.04\n2          anti    2001      3             308.70     119.04   379.12    27.81\n3          anti    2001      4             308.70      27.81   119.04   164.25\n4          anti    2001      5             308.70     164.25    27.81    98.85\n5          anti    2001      6             308.70      98.85   164.25   165.46\n6          anti    2001      7             308.70     165.46    98.85   258.97\n7          anti    2001      8             308.70     258.97   165.46   825.59\n8          anti    2001      9             308.70     825.59   258.97   383.96\n9          anti    2001     10             308.70     383.96   825.59   438.23\n10         anti    2001     11             308.70     438.23   383.96   571.64\n11         anti    2001     12             308.70     571.64   438.23    85.44\n12         eing    2001      1             642.19     146.48   867.16   359.70\n13         eing    2001      2             642.19     359.70   146.48   320.06\n14         eing    2001      3             642.19     320.06   359.70   570.62\n15         eing    2001      4             642.19     570.62   320.06   275.26\n16         eing    2001      5             642.19     275.26   570.62   381.45\n17         eing    2001      6             642.19     381.45   275.26   416.18\n18         eing    2001      7             642.19     416.18   381.45  1105.54\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.447673,
                    "execution_time": 4.05002,
                    "compile_time": 0.001235,
                    "planning_time": 2.360614
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 7.155771,
                    "execution_time": 4.22832,
                    "compile_time": 2.47077,
                    "planning_time": 2.517803
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          anti    2001      1             308.70     271.52   507.78   379.12\n1          anti    2001      2             308.70     379.12   271.52   119.04\n2          anti    2001      3             308.70     119.04   379.12    27.81\n3          anti    2001      4             308.70      27.81   119.04   164.25\n4          anti    2001      5             308.70     164.25    27.81    98.85\n5          anti    2001      6             308.70      98.85   164.25   165.46\n6          anti    2001      7             308.70     165.46    98.85   258.97\n7          anti    2001      8             308.70     258.97   165.46   825.59\n8          anti    2001      9             308.70     825.59   258.97   383.96\n9          anti    2001     10             308.70     383.96   825.59   438.23\n10         anti    2001     11             308.70     438.23   383.96   571.64\n11         anti    2001     12             308.70     571.64   438.23    85.44\n12         eing    2001      1             642.19     146.48   867.16   359.70\n13         eing    2001      2             642.19     359.70   146.48   320.06\n14         eing    2001      3             642.19     320.06   359.70   570.62\n15         eing    2001      4             642.19     570.62   320.06   275.26\n16         eing    2001      5             642.19     275.26   570.62   381.45\n17         eing    2001      6             642.19     381.45   275.26   416.18\n18         eing    2001      7             642.19     416.18   381.45  1105.54\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          able    2001      1           23904.51   15226.73  54621.09  11084.19\n1          able    2001      2           23904.51   11084.19  15226.73  13333.81\n2          able    2001      3           23904.51   13333.81  11084.19  14591.55\n3          able    2001      4           23904.51   14591.55  13333.81  14099.78\n4          able    2001      5           23904.51   14099.78  14591.55  13745.80\n5          able    2001      6           23904.51   13745.80  14099.78  13411.02\n6          able    2001      7           23904.51   13411.02  13745.80  31165.06\n7          able    2001      8           23904.51   31165.06  13411.02  33597.90\n8          able    2001      9           23904.51   33597.90  31165.06  34063.04\n9          able    2001     10           23904.51   34063.04  33597.90  43990.36\n10         able    2001     11           23904.51   43990.36  34063.04  48544.91\n11         able    2001     12           23904.51   48544.91  43990.36  15960.96\n12        cally    2001      1           22282.37   14245.71  52044.55  11749.33\n13        cally    2001      2           22282.37   11749.33  14245.71  13059.59\n14        cally    2001      3           22282.37   13059.59  11749.33  12541.03\n15        cally    2001      4           22282.37   12541.03  13059.59  13128.34\n16        cally    2001      5           22282.37   13128.34  12541.03  14466.59\n17        cally    2001      6           22282.37   14466.59  13128.34  13500.19\n18        cally    2001      7           22282.37   13500.19  14466.59  28860.50\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.489179,
                    "execution_time": 4.037864,
                    "compile_time": 0.06332,
                    "planning_time": 2.432111
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 7.551096,
                    "execution_time": 4.040641,
                    "compile_time": 3.038076,
                    "planning_time": 2.498704
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          able    2001      1           23904.51   15226.73  54621.09  11084.19\n1          able    2001      2           23904.51   11084.19  15226.73  13333.81\n2          able    2001      3           23904.51   13333.81  11084.19  14591.55\n3          able    2001      4           23904.51   14591.55  13333.81  14099.78\n4          able    2001      5           23904.51   14099.78  14591.55  13745.80\n5          able    2001      6           23904.51   13745.80  14099.78  13411.02\n6          able    2001      7           23904.51   13411.02  13745.80  31165.06\n7          able    2001      8           23904.51   31165.06  13411.02  33597.90\n8          able    2001      9           23904.51   33597.90  31165.06  34063.04\n9          able    2001     10           23904.51   34063.04  33597.90  43990.36\n10         able    2001     11           23904.51   43990.36  34063.04  48544.91\n11         able    2001     12           23904.51   48544.91  43990.36  15960.96\n12        cally    2001      1           22282.37   14245.71  52044.55  11749.33\n13        cally    2001      2           22282.37   11749.33  14245.71  13059.59\n14        cally    2001      3           22282.37   13059.59  11749.33  12541.03\n15        cally    2001      4           22282.37   12541.03  13059.59  13128.34\n16        cally    2001      5           22282.37   13128.34  12541.03  14466.59\n17        cally    2001      6           22282.37   14466.59  13128.34  13500.19\n18        cally    2001      7           22282.37   13500.19  14466.59  28860.50\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, sum_sales\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , SUM_SALES NULLS FIRST LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0           bar    2001      2          570487.02  294284.04  369180.32  326952.61\n1           bar    2001      2          580302.65  305548.57  380724.71  336397.73\n2          eing    2001      2          582564.53  309509.50  355335.26  338902.44\n3          able    2001      2          580341.03  309054.37  371685.41  329906.21\n4           bar    2001      2          572126.31  301690.76  371659.70  333368.52\n5          able    2001      2          570628.86  301820.24  357343.34  320231.74\n6           bar    2001      2          562626.20  295384.94  358211.82  325352.25\n7           bar    2001      2          556830.45  289816.35  362881.07  321463.44\n8          eing    2001      2          571126.70  304312.88  355494.75  323267.13\n9           bar    2001      2          561916.51  295180.72  363520.40  322866.87\n10          bar    2001      2          565240.50  298824.82  361230.91  321276.70\n11         able    2001      2          564032.38  298387.75  367604.30  318619.41\n12         eing    2001      2          558565.56  293358.20  354235.03  316085.53\n13         able    2001      2          561085.07  296506.74  360325.31  324160.52\n14         eing    2001      2          571754.17  307674.66  358156.67  323777.15\n15         able    2001      2          561977.11  298119.58  361474.84  320396.97\n16          bar    2001      2          561878.08  298037.02  366130.06  329939.31\n17         able    2001      2          567293.08  303472.56  365649.59  321414.37\n18         able    2001      2          568231.46  304588.38  360794.29  321921.72\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.413851,
                    "execution_time": 4.007539,
                    "compile_time": 0.001169,
                    "planning_time": 2.321664
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 10.601889,
                    "execution_time": 4.037757,
                    "compile_time": 6.11092,
                    "planning_time": 2.472195
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0           bar    2001      2          570487.02  294284.04  369180.32  326952.61\n1           bar    2001      2          580302.65  305548.57  380724.71  336397.73\n2          eing    2001      2          582564.53  309509.50  355335.26  338902.44\n3          able    2001      2          580341.03  309054.37  371685.41  329906.21\n4           bar    2001      2          572126.31  301690.76  371659.70  333368.52\n5          able    2001      2          570628.86  301820.24  357343.34  320231.74\n6           bar    2001      2          562626.20  295384.94  358211.82  325352.25\n7           bar    2001      2          556830.45  289816.35  362881.07  321463.44\n8          eing    2001      2          571126.70  304312.88  355494.75  323267.13\n9           bar    2001      2          561916.51  295180.72  363520.40  322866.87\n10          bar    2001      2          565240.50  298824.82  361230.91  321276.70\n11         able    2001      2          564032.38  298387.75  367604.30  318619.41\n12         eing    2001      2          558565.56  293358.20  354235.03  316085.53\n13         able    2001      2          561085.07  296506.74  360325.31  324160.52\n14         eing    2001      2          571754.17  307674.66  358156.67  323777.15\n15         able    2001      2          561977.11  298119.58  361474.84  320396.97\n16          bar    2001      2          561878.08  298037.02  366130.06  329939.31\n17         able    2001      2          567293.08  303472.56  365649.59  321414.37\n18         able    2001      2          568231.46  304588.38  360794.29  321921.72\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, sum_sales\n limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , SUM_SALES NULLS FIRST LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0           bar    2001      2          570487.02  294284.04  369180.32  326952.61\n1           bar    2001      2          580302.65  305548.57  380724.71  336397.73\n2          eing    2001      2          582564.53  309509.50  355335.26  338902.44\n3          able    2001      2          580341.03  309054.37  371685.41  329906.21\n4           bar    2001      2          572126.31  301690.76  371659.70  333368.52\n5          able    2001      2          570628.86  301820.24  357343.34  320231.74\n6           bar    2001      2          562626.20  295384.94  358211.82  325352.25\n7           bar    2001      2          556830.45  289816.35  362881.07  321463.44\n8          eing    2001      2          571126.70  304312.88  355494.75  323267.13\n9           bar    2001      2          561916.51  295180.72  363520.40  322866.87\n10          bar    2001      2          565240.50  298824.82  361230.91  321276.70\n11         able    2001      2          564032.38  298387.75  367604.30  318619.41\n12         eing    2001      2          558565.56  293358.20  354235.03  316085.53\n13         able    2001      2          561085.07  296506.74  360325.31  324160.52\n14         eing    2001      2          571754.17  307674.66  358156.67  323777.15\n15         able    2001      2          561977.11  298119.58  361474.84  320396.97\n16          bar    2001      2          561878.08  298037.02  366130.06  329939.31\n17         able    2001      2          567293.08  303472.56  365649.59  321414.37\n18         able    2001      2          568231.46  304588.38  360794.29  321921.72\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.328691,
                    "execution_time": 3.925771,
                    "compile_time": 0.001151,
                    "planning_time": 2.328192
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.502774,
                    "execution_time": 4.097261,
                    "compile_time": 0.001154,
                    "planning_time": 2.451948
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0           bar    2001      2          570487.02  294284.04  369180.32  326952.61\n1           bar    2001      2          580302.65  305548.57  380724.71  336397.73\n2          eing    2001      2          582564.53  309509.50  355335.26  338902.44\n3          able    2001      2          580341.03  309054.37  371685.41  329906.21\n4           bar    2001      2          572126.31  301690.76  371659.70  333368.52\n5          able    2001      2          570628.86  301820.24  357343.34  320231.74\n6           bar    2001      2          562626.20  295384.94  358211.82  325352.25\n7           bar    2001      2          556830.45  289816.35  362881.07  321463.44\n8          eing    2001      2          571126.70  304312.88  355494.75  323267.13\n9           bar    2001      2          561916.51  295180.72  363520.40  322866.87\n10          bar    2001      2          565240.50  298824.82  361230.91  321276.70\n11         able    2001      2          564032.38  298387.75  367604.30  318619.41\n12         eing    2001      2          558565.56  293358.20  354235.03  316085.53\n13         able    2001      2          561085.07  296506.74  360325.31  324160.52\n14         eing    2001      2          571754.17  307674.66  358156.67  323777.15\n15         able    2001      2          561977.11  298119.58  361474.84  320396.97\n16          bar    2001      2          561878.08  298037.02  366130.06  329939.31\n17         able    2001      2          567293.08  303472.56  365649.59  321414.37\n18         able    2001      2          568231.46  304588.38  360794.29  321921.72\n...*/"
    }
]