[
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) AS ws_qty,\n    sum(ws_wholesale_cost) AS ws_wc,\n    sum(ws_sales_price) AS ws_sp\n   from web_sales\n   left join web_returns on WR_ORDER_NUMBER=WS_ORDER_NUMBER and WS_ITEM_SK=WR_ITEM_SK\n   join date_dim on WS_SOLD_DATE_SK = D_DATE_SK\n   where WR_ORDER_NUMBER is null\n   group by d_year, WS_ITEM_SK, WS_BILL_CUSTOMER_SK\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk AS cs_customer_sk,\n    sum(cs_quantity) AS cs_qty,\n    sum(cs_wholesale_cost) AS cs_wc,\n    sum(cs_sales_price) AS cs_sp\n   from catalog_sales\n   left join catalog_returns on CR_ORDER_NUMBER=CS_ORDER_NUMBER and CS_ITEM_SK=CR_ITEM_SK\n   join date_dim on CS_SOLD_DATE_SK = D_DATE_SK\n   where CR_ORDER_NUMBER is null\n   group by d_year, CS_ITEM_SK, CS_BILL_CUSTOMER_SK\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) AS ss_qty,\n    sum(ss_wholesale_cost) AS ss_wc,\n    sum(ss_sales_price) AS ss_sp\n   from store_sales\n   left join store_returns on SR_TICKET_NUMBER=SS_TICKET_NUMBER and SS_ITEM_SK=SR_ITEM_SK\n   join date_dim on SS_SOLD_DATE_SK = D_DATE_SK\n   where SR_TICKET_NUMBER is null\n   group by d_year, SS_ITEM_SK, SS_CUSTOMER_SK\n/*CURSOR_IDENTIFIER*/\n  )\nselect * from ws\nunion all\nselect * from cs\nunion all\nselect * from ss;",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" FROM \"WS\" AS \"WS\" UNION ALL SELECT \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" FROM \"CS\" AS \"CS\" UNION ALL SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.105899,
                    "execution_time": 0.040912,
                    "compile_time": 0.000248,
                    "planning_time": 0.024576,
                    "create_size": 480
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.111417,
                    "execution_time": 0.045513,
                    "compile_time": 0.000236,
                    "planning_time": 0.024853,
                    "create_size": 480
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 6.035832,
                    "execution_time": 5.486503,
                    "compile_time": 0.000578,
                    "planning_time": 0.046816,
                    "create_size": 3712
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 15.115559,
                    "execution_time": 9.398014,
                    "compile_time": 5.090277,
                    "planning_time": 0.11633,
                    "create_size": 3712
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" UNION ALL SELECT \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" FROM \"CS\" AS \"CS\" UNION ALL SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\" LIMIT 21",
                "preview": "\n/*    ws_sold_year  ws_item_sk  ws_customer_sk  ws_qty  ws_wc   ws_sp\n0           1998       76430         1025244      80  89.34  167.05\n1           1998       16666         1025244      50  28.00   28.79\n2           1998      103534          306018      18  64.22   62.91\n3           1998        9217         1753312      85  32.22   21.03\n4           1998       49999          271564      19  48.73   86.99\n5           1998       54844          248796       4  49.14   32.13\n6           1998       35290         1070342      45  67.50  124.24\n7           1998      139784          458627      67  63.62   51.92\n8           1998      189436         1070342      98  15.32    2.17\n9           1998      170425          836222      49  79.21  101.23\n10          1998      123802         1609165      75  21.47   22.41\n11          1998       86054           18971      44  43.35   13.59\n12          1998       71623           18971      83  41.75    1.75\n13          1998       42625         1609165      46  15.92    5.95\n14          1998       49558         1384560       9  82.54    1.48\n15          1998      144844          310300      11  27.69   20.24\n16          1998      132523          584873      16  77.54   83.47\n17          1998        7939          584873       3  64.35   51.86\n18          1998       79706          508539      70  76.31  162.08\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 17.957658,
                    "execution_time": 17.852927,
                    "compile_time": 0.00052,
                    "planning_time": 0.078768
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 24.958531,
                    "execution_time": 19.377528,
                    "compile_time": 5.469862,
                    "planning_time": 0.186813
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" UNION ALL SELECT \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" FROM \"CS\" AS \"CS\" UNION ALL SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\"",
                "rewrite": "WITH CS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" UNION ALL SELECT \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" FROM \"CS\" AS \"CS\" UNION ALL SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\""
            }
        ],
        "preview": "\n/*    ws_sold_year  ws_item_sk  ws_customer_sk  ws_qty  ws_wc   ws_sp\n0           1998       76430         1025244      80  89.34  167.05\n1           1998       16666         1025244      50  28.00   28.79\n2           1998      103534          306018      18  64.22   62.91\n3           1998        9217         1753312      85  32.22   21.03\n4           1998       49999          271564      19  48.73   86.99\n5           1998       54844          248796       4  49.14   32.13\n6           1998       35290         1070342      45  67.50  124.24\n7           1998      139784          458627      67  63.62   51.92\n8           1998      189436         1070342      98  15.32    2.17\n9           1998      170425          836222      49  79.21  101.23\n10          1998      123802         1609165      75  21.47   22.41\n11          1998       86054           18971      44  43.35   13.59\n12          1998       71623           18971      83  41.75    1.75\n13          1998       42625         1609165      46  15.92    5.95\n14          1998       49558         1384560       9  82.54    1.48\n15          1998      144844          310300      11  27.69   20.24\n16          1998      132523          584873      16  77.54   83.47\n17          1998        7939          584873       3  64.35   51.86\n18          1998       79706          508539      70  76.31  162.08\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) AS ws_qty,\n    sum(ws_wholesale_cost) AS ws_wc,\n    sum(ws_sales_price) AS ws_sp\n   from web_sales\n   left join web_returns on ws_order_number=wr_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk AS cs_customer_sk,\n    sum(cs_quantity) AS cs_qty,\n    sum(cs_wholesale_cost) AS cs_wc,\n    sum(cs_sales_price) AS cs_sp\n   from catalog_sales\n   left join catalog_returns on cs_order_number=cr_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) AS ss_qty,\n    sum(ss_wholesale_cost) AS ss_wc,\n    sum(ss_sales_price) AS ss_sp\n   from store_sales\n   left join store_returns on ss_ticket_number=sr_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\nselect * from ws\nunion all\nselect * from cs\nunion all\nselect * from ss\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\" LIMIT 21",
                "preview": "\n/*    ss_sold_year  ss_item_sk  ss_customer_sk  ss_qty  ss_wc   ss_sp\n0           1998       41731         1327432     NaN  54.38   21.48\n1           2001      104427         1682071    70.0  46.48   28.10\n2           2002      108597         1812870    26.0  51.30   79.77\n3           2002      120360         1088507    66.0  42.96   47.99\n4           1998       18868          623698    37.0  26.07   34.34\n5           2000       50573         1692268    61.0  53.33   64.48\n6           1999      194174         1577240    13.0  39.62   30.90\n7           2000      140581         1089460    41.0  18.80   16.07\n8           2000      196873         1465359    28.0  80.77   75.16\n9           2001      165143          523236    18.0  43.07    9.64\n10          2001       93763         1189513    89.0  78.71   99.23\n11          2001      141987         1658580     8.0  95.46   48.35\n12          2000      156848         1773399     9.0  27.35   21.98\n13          2001      105747         1570468    78.0  94.52  132.72\n14          2002      104167          559604    92.0  86.01  156.05\n15          1998      178771         1059922    81.0  80.41   33.09\n16          1999       22255         1030493     8.0  85.30   27.63\n17          1998      125572          490925    57.0  10.73    8.17\n18          1998       81386         1494029    20.0  50.17   20.06\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 12.028624,
                    "execution_time": 11.970849,
                    "compile_time": 0.000225,
                    "planning_time": 0.042204
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 15.352608,
                    "execution_time": 12.176623,
                    "compile_time": 3.049269,
                    "planning_time": 0.106956
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\"",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\""
            }
        ],
        "preview": "\n/*    ss_sold_year  ss_item_sk  ss_customer_sk  ss_qty  ss_wc   ss_sp\n0           1998       41731         1327432     NaN  54.38   21.48\n1           2001      104427         1682071    70.0  46.48   28.10\n2           2002      108597         1812870    26.0  51.30   79.77\n3           2002      120360         1088507    66.0  42.96   47.99\n4           1998       18868          623698    37.0  26.07   34.34\n5           2000       50573         1692268    61.0  53.33   64.48\n6           1999      194174         1577240    13.0  39.62   30.90\n7           2000      140581         1089460    41.0  18.80   16.07\n8           2000      196873         1465359    28.0  80.77   75.16\n9           2001      165143          523236    18.0  43.07    9.64\n10          2001       93763         1189513    89.0  78.71   99.23\n11          2001      141987         1658580     8.0  95.46   48.35\n12          2000      156848         1773399     9.0  27.35   21.98\n13          2001      105747         1570468    78.0  94.52  132.72\n14          2002      104167          559604    92.0  86.01  156.05\n15          1998      178771         1059922    81.0  80.41   33.09\n16          1999       22255         1030493     8.0  85.30   27.63\n17          1998      125572          490925    57.0  10.73    8.17\n18          1998       81386         1494029    20.0  50.17   20.06\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select * \n/*CURSOR_IDENTIFIER*/ from ws \n  full outer join cs on cs.cs_item_sk = ws.ws_item_sk \n  and cs.cs_customer_sk = ws.ws_customer_sk \n  and cs.cs_sold_year = ws.ws_sold_year \n  full outer join ss on ss.ss_item_sk = ws.ws_item_sk \n  and ss.ss_customer_sk = ws.ws_customer_sk \n  and ss.ss_sold_year = ws.ws_sold_year\n",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" , \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" , \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"WS\" AS \"WS\" FULL JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" FULL JOIN \"SS\" AS \"SS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 11.956031,
                    "execution_time": 11.437308,
                    "compile_time": 0.000561,
                    "planning_time": 0.042917,
                    "create_size": 7168
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 11.703342,
                    "execution_time": 11.17554,
                    "compile_time": 0.000591,
                    "planning_time": 0.043161,
                    "create_size": 7168
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" , \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" FULL JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" FULL JOIN \"SS\" AS \"SS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" , \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" FULL JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" FULL JOIN \"SS\" AS \"SS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\"",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" , \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" FULL JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" FULL JOIN \"SS\" AS \"SS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\""
            }
        ],
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk as ws_customer_sk,\n    sum(ws_quantity) as ws_qty,\n    sum(ws_wholesale_cost) as ws_wc,\n    sum(ws_sales_price) as ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk as cs_customer_sk,\n    sum(cs_quantity) as cs_qty,\n    sum(cs_wholesale_cost) as cs_wc,\n    sum(cs_sales_price) as cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) as ss_qty,\n    sum(ss_wholesale_cost) as ss_wc,\n    sum(ss_sales_price) as ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) as ratio,\nss_qty as store_qty, ss_wc as store_wholesale_cost, ss_sp as store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) as other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) as other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) as other_chan_sales_price\nfrom ss\nleft join ws on ss.ss_item_sk = ws.ws_item_sk\nleft join cs on ss.ss_item_sk = cs.cs_item_sk\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.247638,
                    "execution_time": 1.753479,
                    "compile_time": 0.102571,
                    "planning_time": 0.003661,
                    "create_size": 3200
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 9.212649,
                    "execution_time": 5.30067,
                    "compile_time": 3.437232,
                    "planning_time": 0.059673,
                    "create_size": 3200
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.68302,
                    "execution_time": 3.300292,
                    "compile_time": 0.000264,
                    "planning_time": 0.003349,
                    "create_size": 6144
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 5.976508,
                    "execution_time": 5.527805,
                    "compile_time": 0.000264,
                    "planning_time": 0.058924,
                    "create_size": 6144
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ON \"SPEQLITE_TEMP_TABLE_5\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ON \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"WS_ITEM_SK\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ON \"SPEQLITE_TEMP_TABLE_5\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ON \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"WS_ITEM_SK\"",
                "rewrite": "WITH SS AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_4\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ON \"SPEQLITE_TEMP_TABLE_5\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ON \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"WS_ITEM_SK\""
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk AS cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk) \nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\"",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\""
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\"",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\""
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) )"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0           528269      1         27                  4.30               1.31              21                      19.59                   29.70\n1           594922      0         11                 76.56              31.16              50                       3.29                    7.37\n2          1080509      0         12                  1.93               1.43              47                      38.68                   21.65\n3           861119      0         42                  7.16               4.66              73                      45.02                   19.73\n4            16298      0         44                 82.59              99.87              94                      60.32                   11.49\n5          1560664      0         49                 97.90             123.45              92                      13.84                   30.48\n6          1119791      5         98                 83.30             134.94              18                      22.42                   23.21\n7           787191      2         98                 47.45              10.85              35                      95.18                  136.71\n8           471981      0         41                 81.40              41.02              54                      14.96                   10.01\n9           671910      0         33                  6.12               2.62              71                      72.30                   45.28\n10          432842      9         97                 92.09             135.36              10                      59.26                   15.40\n11          942430      0          1                   NaN              52.69              89                      24.31                   10.79\n12          213581      0         33                 54.92              19.63              78                      36.66                   28.59\n13         1875911      0         23                  3.80               1.59              96                      89.94                   11.46\n14         1516754      2         74                 35.73              50.17              28                      33.34                   34.60\n15          122393      0          9                 19.45               9.85              57                      46.40                  119.75\n16         1761872      1         30                  2.53               1.52              23                      92.52                  119.27\n17          823980      1         13                 63.38              74.48              13                      67.82                   94.07\n18          801209     10         65                 94.73              16.57               6                       1.93                    1.50\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.637756,
                    "execution_time": 4.540796,
                    "compile_time": 0.000429,
                    "planning_time": 0.073635
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 18.180099,
                    "execution_time": 10.17031,
                    "compile_time": 7.858211,
                    "planning_time": 0.120839
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) )",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) )"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0           528269      1         27                  4.30               1.31              21                      19.59                   29.70\n1           594922      0         11                 76.56              31.16              50                       3.29                    7.37\n2          1080509      0         12                  1.93               1.43              47                      38.68                   21.65\n3           861119      0         42                  7.16               4.66              73                      45.02                   19.73\n4            16298      0         44                 82.59              99.87              94                      60.32                   11.49\n5          1560664      0         49                 97.90             123.45              92                      13.84                   30.48\n6          1119791      5         98                 83.30             134.94              18                      22.42                   23.21\n7           787191      2         98                 47.45              10.85              35                      95.18                  136.71\n8           471981      0         41                 81.40              41.02              54                      14.96                   10.01\n9           671910      0         33                  6.12               2.62              71                      72.30                   45.28\n10          432842      9         97                 92.09             135.36              10                      59.26                   15.40\n11          942430      0          1                   NaN              52.69              89                      24.31                   10.79\n12          213581      0         33                 54.92              19.63              78                      36.66                   28.59\n13         1875911      0         23                  3.80               1.59              96                      89.94                   11.46\n14         1516754      2         74                 35.73              50.17              28                      33.34                   34.60\n15          122393      0          9                 19.45               9.85              57                      46.40                  119.75\n16         1761872      1         30                  2.53               1.52              23                      92.52                  119.27\n17          823980      1         13                 63.38              74.48              13                      67.82                   94.07\n18          801209     10         65                 94.73              16.57               6                       1.93                    1.50\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \nss_customer_sk /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.57703,
                    "execution_time": 4.496372,
                    "compile_time": 0.000443,
                    "planning_time": 0.057906
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 10.97607,
                    "execution_time": 7.752589,
                    "compile_time": 3.131149,
                    "planning_time": 0.12373
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.751505,
                    "execution_time": 4.6701,
                    "compile_time": 0.000473,
                    "planning_time": 0.057449
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 8.266986,
                    "execution_time": 8.186798,
                    "compile_time": 0.000445,
                    "planning_time": 0.057363
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk, \n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.799978,
                    "execution_time": 4.718864,
                    "compile_time": 0.000463,
                    "planning_time": 0.057444
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 11.60938,
                    "execution_time": 8.159445,
                    "compile_time": 5.946271,
                    "planning_time": 0.123356
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC , \"OTHER_CHAN_QTY\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.642276,
                    "execution_time": 4.316487,
                    "compile_time": 0.000467,
                    "planning_time": 0.060415
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 11.584207,
                    "execution_time": 8.168388,
                    "compile_time": 5.929555,
                    "planning_time": 0.129797
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select D_YEAR AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on WR_ORDER_NUMBER=WS_ORDER_NUMBER and ws_item_sk=WR_ITEM_SK\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where WR_ORDER_NUMBER is null\n   group by D_YEAR, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select D_YEAR AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on CR_ORDER_NUMBER=CS_ORDER_NUMBER and cs_item_sk=CR_ITEM_SK\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where CR_ORDER_NUMBER is null\n   group by D_YEAR, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select D_YEAR AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on SR_TICKET_NUMBER=SS_TICKET_NUMBER and ss_item_sk=SR_ITEM_SK\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where SR_TICKET_NUMBER is null\n   group by D_YEAR, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.686599,
                    "execution_time": 4.604215,
                    "compile_time": 0.000445,
                    "planning_time": 0.058393
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 11.404818,
                    "execution_time": 8.21,
                    "compile_time": 5.499619,
                    "planning_time": 0.119404
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" , \"OTHER_CHAN_SALES_PRICE\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.643358,
                    "execution_time": 4.56147,
                    "compile_time": 0.000435,
                    "planning_time": 0.058596
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 10.943315,
                    "execution_time": 7.70962,
                    "compile_time": 5.511265,
                    "planning_time": 0.121038
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price,\n  ratio\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" , \"OTHER_CHAN_SALES_PRICE\" , \"RATIO\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.653242,
                    "execution_time": 4.568806,
                    "compile_time": 0.000453,
                    "planning_time": 0.059997
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 11.277453,
                    "execution_time": 7.619628,
                    "compile_time": 6.141662,
                    "planning_time": 0.121647
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price,\n  ratio\nlimit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST LIMIT 100"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" DESC , \"SS\".\"SS_WC\" DESC , \"SS\".\"SS_SP\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" , \"OTHER_CHAN_SALES_PRICE\" , \"RATIO\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 4.717847,
                    "execution_time": 4.635297,
                    "compile_time": 0.000432,
                    "planning_time": 0.059369
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 8.030976,
                    "execution_time": 7.947003,
                    "compile_time": 0.000443,
                    "planning_time": 0.05995
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST LIMIT 100",
                "rewrite": "WITH SS AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST LIMIT 100"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0              171    6.0       44.0                 76.61              20.82               7                      84.68                   22.55\n1              181    1.0        8.0                 69.16              34.61               8                      69.41                   12.11\n2              322    2.0       91.0                 87.15              47.10              45                      34.43                   40.42\n3              417    4.0       73.0                 64.79              96.15              17                       2.45                    2.33\n4              564    1.0       68.0                 78.83              44.88              41                      57.52                   33.63\n5              652    1.0       96.0                 38.34              46.77              78                       2.95                    1.95\n6              764    8.0       42.0                 62.06               9.42               5                       2.56                    3.89\n7              975    1.0       59.0                 61.33              19.74              35                      70.31                  173.91\n8              981    1.0       78.0                 97.24               2.48              68                      95.77                    5.93\n9             1024    0.0       63.0                 23.09               3.15              95                      99.22                  144.06\n10            1295    1.0       35.0                 97.01             117.86              19                      60.05                   48.99\n11            1353    0.0       34.0                 64.39              28.47              55                      37.66                   15.96\n12            1361    0.0       82.0                 45.63              57.18             100                      88.01                  176.49\n13            1766    0.0       25.0                 15.20               3.69              36                      73.57                  147.57\n14            1884    0.0        8.0                 70.18             107.52              18                      26.87                   31.85\n15            2166    1.0       73.0                 62.29              70.02              54                      76.30                  180.55\n16            2478   10.0       60.0                 14.87              17.08               6                      33.45                    0.74\n17            2639    NaN        NaN                   NaN                NaN              35                      21.65                    8.89\n18            2788    1.0       56.0                 26.77               2.40              53                      50.93                    3.20\n...*/"
    }
]