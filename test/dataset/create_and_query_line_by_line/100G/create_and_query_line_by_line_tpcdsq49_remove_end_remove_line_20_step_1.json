[
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0\n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by sts.ss_item_sk\n \t) in_store\n ) store\n where \n (\n store.return_rank <= 10\n or\n store.currency_rank <= 10\n )\n) /*CURSOR_IDENTIFIER*/ as final_selection",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"FINAL_SELECTION\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"FINAL_SELECTION\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_SELECTION\".\"ITEM\" AS \"ITEM\" , \"FINAL_SELECTION\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"FINAL_SELECTION\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"FINAL_SELECTION\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"FINAL_SELECTION\" AS \"FINAL_SELECTION\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.07784,
                    "execution_time": 0.030753,
                    "compile_time": 0.000244,
                    "planning_time": 0.023693,
                    "create_size": 6
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.143449,
                    "execution_time": 0.031817,
                    "compile_time": 0.000247,
                    "planning_time": 0.086249,
                    "create_size": 6
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 GROUP BY \"WS\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.165763,
                    "execution_time": 0.087179,
                    "compile_time": 0.00042,
                    "planning_time": 0.043979,
                    "create_size": 768
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 13.164995,
                    "execution_time": 4.848897,
                    "compile_time": 8.227246,
                    "planning_time": 0.044211,
                    "create_size": 768
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"SPEQLITE_TEMP_TABLE_2\".\"ITEM\" AS \"ITEM\" , \"SPEQLITE_TEMP_TABLE_2\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_2\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_2\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.492945,
                    "execution_time": 0.041692,
                    "compile_time": 0.420613,
                    "planning_time": 0.003935,
                    "create_size": 28
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 11.534957,
                    "execution_time": 0.04534,
                    "compile_time": 11.400027,
                    "planning_time": 0.060377,
                    "create_size": 28
                }
            }
        ],
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) AS FINAL_SELECTION LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web  134593     0.455556           36              4\n1       web    7705     0.478723           38              7\n2       web  106519     0.483871           40              9\n3       web  107080     0.494118           41             10\n4       web  122455        0E-16            1            472\n5       web   30391        0E-16            1           1096\n6       web  111512        0E-16            1           1352\n7       web   31448        0E-16            1           1401\n8   catalog  132536          0.4           27              1\n9   catalog   51814         0.44           29              3\n10  catalog  173131        0E-16            1            566\n11  catalog  133000        0E-16            1            649\n12    store   71548     0.606383           28              3\n13    store  128284     0.628866           31              5\n14    store   56468        0E-16            1            297\n15    store  111592        0E-16            1            492\n16    store   58729        0E-16            1            838\n17    store  106286        0E-16            1           1069\n18    store  108320        0E-16            1           1208\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.51388,
                    "execution_time": 0.1576,
                    "compile_time": 0.181715,
                    "planning_time": 0.12573
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 16.328361,
                    "execution_time": 1.747955,
                    "compile_time": 14.394984,
                    "planning_time": 0.126037
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web  134593     0.455556           36              4\n1       web    7705     0.478723           38              7\n2       web  106519     0.483871           40              9\n3       web  107080     0.494118           41             10\n4       web  122455        0E-16            1            472\n5       web   30391        0E-16            1           1096\n6       web  111512        0E-16            1           1352\n7       web   31448        0E-16            1           1401\n8   catalog  132536          0.4           27              1\n9   catalog   51814         0.44           29              3\n10  catalog  173131        0E-16            1            566\n11  catalog  133000        0E-16            1            649\n12    store   71548     0.606383           28              3\n13    store  128284     0.628866           31              5\n14    store   56468        0E-16            1            297\n15    store  111592        0E-16            1            492\n16    store   58729        0E-16            1            838\n17    store  106286        0E-16            1           1069\n18    store  108320        0E-16            1           1208\n...*/"
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n(select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.WR_RETURN_QUANTITY,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.WR_RETURN_AMT,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.WR_ORDER_NUMBER and \n \t\t\tws.ws_item_sk = wr.WR_ITEM_SK)\n                 ,date_dim\n \t\twhere \n \t\t\twr.WR_RETURN_AMT > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.CR_RETURN_QUANTITY,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.CR_RETURN_AMOUNT,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.CR_ORDER_NUMBER and \n \t\t\tcs.cs_item_sk = cr.CR_ITEM_SK)\n                ,date_dim\n \t\twhere \n \t\t\tcr.CR_RETURN_AMOUNT > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.SR_RETURN_QUANTITY,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.SR_RETURN_AMT,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.SR_TICKET_NUMBER and sts.ss_item_sk = sr.SR_ITEM_SK)\n                ,date_dim\n \t\twhere \n \t\t\tsr.SR_RETURN_AMT > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0\n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by sts.ss_item_sk\n \t) in_store\n ) store\n where \n (\n store.return_rank <= 10\n or\n store.currency_rank <=10\n )\n) as final_result\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"FINAL_RESULT\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"FINAL_RESULT\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_RESULT\".\"ITEM\" AS \"ITEM\" , \"FINAL_RESULT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"FINAL_RESULT\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"FINAL_RESULT\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"FINAL_RESULT\" AS \"FINAL_RESULT\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.158885,
                    "execution_time": 0.08305,
                    "compile_time": 0.000403,
                    "planning_time": 0.042394,
                    "create_size": 768
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.45581,
                    "execution_time": 0.098426,
                    "compile_time": 6.206575,
                    "planning_time": 0.109199,
                    "create_size": 768
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"SPEQLITE_TEMP_TABLE_4\".\"ITEM\" AS \"ITEM\" , \"SPEQLITE_TEMP_TABLE_4\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.072515,
                    "execution_time": 0.04214,
                    "compile_time": 0.00033,
                    "planning_time": 0.004042,
                    "create_size": 28
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.131564,
                    "execution_time": 0.040989,
                    "compile_time": 0.000318,
                    "planning_time": 0.059158,
                    "create_size": 28
                }
            }
        ],
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) AS FINAL_RESULT LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web  191581        0E-16            1            585\n1   catalog   51380        0E-16            1            499\n2   catalog  152296        0E-16            1           1366\n3     store  132991     0.646465           36              9\n4     store  122596     0.655172           37             10\n5     store  172990        0E-16            1            175\n6     store  106724        0E-16            1            340\n7     store   48646        0E-16            1            776\n8     store  130936        0E-16            1            940\n9     store   77276        0E-16            1           1083\n10      web  134593     0.455556           36              4\n11      web    7705     0.478723           38              7\n12      web  106519     0.483871           40              9\n13      web  107080     0.494118           41             10\n14      web  122455        0E-16            1            472\n15      web   30391        0E-16            1           1096\n16      web  111512        0E-16            1           1352\n17      web   31448        0E-16            1           1401\n18  catalog  132536          0.4           27              1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.331741,
                    "execution_time": 0.15919,
                    "compile_time": 0.00106,
                    "planning_time": 0.125011
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.462861,
                    "execution_time": 0.158645,
                    "compile_time": 0.038681,
                    "planning_time": 0.218326
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web  191581        0E-16            1            585\n1   catalog   51380        0E-16            1            499\n2   catalog  152296        0E-16            1           1366\n3     store  132991     0.646465           36              9\n4     store  122596     0.655172           37             10\n5     store  172990        0E-16            1            175\n6     store  106724        0E-16            1            340\n7     store   48646        0E-16            1            776\n8     store  130936        0E-16            1            940\n9     store   77276        0E-16            1           1083\n10      web  134593     0.455556           36              4\n11      web    7705     0.478723           38              7\n12      web  106519     0.483871           40              9\n13      web  107080     0.494118           41             10\n14      web  122455        0E-16            1            472\n15      web   30391        0E-16            1           1096\n16      web  111512        0E-16            1           1352\n17      web   31448        0E-16            1           1401\n18  catalog  132536          0.4           27              1\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws.ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs.cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and sts.ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n ) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"_Q_0\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ITEM\" AS \"ITEM\" , \"_Q_0\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"_Q_0\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"_Q_0\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"SPEQLITE_TEMP_TABLE_4\".\"ITEM\" AS \"ITEM\" , \"SPEQLITE_TEMP_TABLE_4\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"CURRENCY_RATIO\" AS \"CURRENCY_RATIO\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.087465,
                    "execution_time": 0.047838,
                    "compile_time": 0.012816,
                    "planning_time": 0.003202,
                    "create_size": 768
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.629895,
                    "execution_time": 0.049025,
                    "compile_time": 3.493336,
                    "planning_time": 0.058489,
                    "create_size": 768
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"SPEQLITE_TEMP_TABLE_6\".\"ITEM\" AS \"ITEM\" , \"SPEQLITE_TEMP_TABLE_6\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_6\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_6\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.072737,
                    "execution_time": 0.041213,
                    "compile_time": 0.000324,
                    "planning_time": 0.004214,
                    "create_size": 28
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.128993,
                    "execution_time": 0.042101,
                    "compile_time": 0.000324,
                    "planning_time": 0.059775,
                    "create_size": 28
                }
            }
        ],
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS.WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS.CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND STS.SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web  134593     0.455556           36              4\n1       web    7705     0.478723           38              7\n2       web  106519     0.483871           40              9\n3       web  107080     0.494118           41             10\n4       web  122455        0E-16            1            472\n5       web   30391        0E-16            1           1096\n6       web  111512        0E-16            1           1352\n7       web   31448        0E-16            1           1401\n8   catalog  132536          0.4           27              1\n9   catalog   51814         0.44           29              3\n10  catalog  173131        0E-16            1            566\n11  catalog  133000        0E-16            1            649\n12    store   71548     0.606383           28              3\n13    store  128284     0.628866           31              5\n14    store   56468        0E-16            1            297\n15    store  111592        0E-16            1            492\n16    store   58729        0E-16            1            838\n17    store  106286        0E-16            1           1069\n18    store  108320        0E-16            1           1208\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.329767,
                    "execution_time": 0.158486,
                    "compile_time": 0.001081,
                    "planning_time": 0.12379
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.433196,
                    "execution_time": 0.163741,
                    "compile_time": 0.001058,
                    "planning_time": 0.222117
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web  134593     0.455556           36              4\n1       web    7705     0.478723           38              7\n2       web  106519     0.483871           40              9\n3       web  107080     0.494118           41             10\n4       web  122455        0E-16            1            472\n5       web   30391        0E-16            1           1096\n6       web  111512        0E-16            1           1352\n7       web   31448        0E-16            1           1401\n8   catalog  132536          0.4           27              1\n9   catalog   51814         0.44           29              3\n10  catalog  173131        0E-16            1            566\n11  catalog  133000        0E-16            1            649\n12    store   71548     0.606383           28              3\n13    store  128284     0.628866           31              5\n14    store   56468        0E-16            1            297\n15    store  111592        0E-16            1            492\n16    store   58729        0E-16            1            838\n17    store  106286        0E-16            1           1069\n18    store  108320        0E-16            1           1208\n...*/"
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws.ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs.cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and sts.ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n) /* Added missing parenthesis here for the main query structure */\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"_Q_0\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ITEM\" AS \"ITEM\" , \"_Q_0\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"_Q_0\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"_Q_0\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS.WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS.CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND STS.SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web  191581        0E-16            1            585\n1   catalog   51380        0E-16            1            499\n2   catalog  152296        0E-16            1           1366\n3     store  132991     0.646465           36              9\n4     store  122596     0.655172           37             10\n5     store  172990        0E-16            1            175\n6     store  106724        0E-16            1            340\n7     store   48646        0E-16            1            776\n8     store  130936        0E-16            1            940\n9     store   77276        0E-16            1           1083\n10      web  109928     0.454545           35              3\n11      web   77918        0E-16            1            299\n12      web  177266        0E-16            1            841\n13      web   84680        0E-16            1           1310\n14      web    7274        0E-16            1           1382\n15  catalog   13430      0.43617           28              2\n16  catalog  160138        0E-16            1            380\n17  catalog  163772        0E-16            1           1423\n18  catalog  152707        0E-16            1           2083\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.336013,
                    "execution_time": 0.16498,
                    "compile_time": 0.001065,
                    "planning_time": 0.12381
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.33154,
                    "execution_time": 0.157335,
                    "compile_time": 0.0011,
                    "planning_time": 0.124547
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web  191581        0E-16            1            585\n1   catalog   51380        0E-16            1            499\n2   catalog  152296        0E-16            1           1366\n3     store  132991     0.646465           36              9\n4     store  122596     0.655172           37             10\n5     store  172990        0E-16            1            175\n6     store  106724        0E-16            1            340\n7     store   48646        0E-16            1            776\n8     store  130936        0E-16            1            940\n9     store   77276        0E-16            1           1083\n10      web  109928     0.454545           35              3\n11      web   77918        0E-16            1            299\n12      web  177266        0E-16            1            841\n13      web   84680        0E-16            1           1310\n14      web    7274        0E-16            1           1382\n15  catalog   13430      0.43617           28              2\n16  catalog  160138        0E-16            1            380\n17  catalog  163772        0E-16            1           1423\n18  catalog  152707        0E-16            1           2083\n...*/"
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n )\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"_Q_0\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ITEM\" AS \"ITEM\" , \"_Q_0\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"_Q_0\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"_Q_0\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web  159829        0E-16            1            344\n1       web  169112        0E-16            1            455\n2       web  125524        0E-16            1            864\n3       web  120247        0E-16            1           1056\n4   catalog  137119     0.462366           33              6\n5   catalog   79759     0.464646           35              8\n6   catalog   57848        0E-16            1            228\n7     store  113312        0E-16            1            496\n8     store   71536        0E-16            1            795\n9     store  111439        0E-16            1            857\n10      web  134593     0.455556           36              4\n11      web    7705     0.478723           38              7\n12      web  106519     0.483871           40              9\n13      web  107080     0.494118           41             10\n14      web  122455        0E-16            1            472\n15      web   30391        0E-16            1           1096\n16      web  111512        0E-16            1           1352\n17      web   31448        0E-16            1           1401\n18  catalog  132536          0.4           27              1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.337254,
                    "execution_time": 0.161268,
                    "compile_time": 0.001057,
                    "planning_time": 0.127621
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.424878,
                    "execution_time": 0.157458,
                    "compile_time": 0.001049,
                    "planning_time": 0.219574
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web  159829        0E-16            1            344\n1       web  169112        0E-16            1            455\n2       web  125524        0E-16            1            864\n3       web  120247        0E-16            1           1056\n4   catalog  137119     0.462366           33              6\n5   catalog   79759     0.464646           35              8\n6   catalog   57848        0E-16            1            228\n7     store  113312        0E-16            1            496\n8     store   71536        0E-16            1            795\n9     store  111439        0E-16            1            857\n10      web  134593     0.455556           36              4\n11      web    7705     0.478723           38              7\n12      web  106519     0.483871           40              9\n13      web  107080     0.494118           41             10\n14      web  122455        0E-16            1            472\n15      web   30391        0E-16            1           1096\n16      web  111512        0E-16            1           1352\n17      web   31448        0E-16            1           1401\n18  catalog  132536          0.4           27              1\n...*/"
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n )\n order by 1,4,5,2\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"_Q_0\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ITEM\" AS \"ITEM\" , \"_Q_0\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"_Q_0\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"_Q_0\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"_Q_0\" AS \"_Q_0\" ORDER BY \"CHANNEL\" NULLS LAST , \"RETURN_RANK\" NULLS LAST , \"CURRENCY_RANK\" NULLS LAST , \"ITEM\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) ORDER BY 1 NULLS FIRST , 4 NULLS FIRST , 5 NULLS FIRST , 2 NULLS FIRST LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog  102205        0E-16            1            176\n1   catalog   57848        0E-16            1            228\n2   catalog    2740        0E-16            1            364\n3   catalog  160138        0E-16            1            380\n4   catalog  203566        0E-16            1            480\n5   catalog   51380        0E-16            1            499\n6   catalog  173131        0E-16            1            566\n7   catalog  133000        0E-16            1            649\n8   catalog   93070        0E-16            1            730\n9   catalog  203017        0E-16            1            875\n10  catalog  149662        0E-16            1            882\n11  catalog  123164        0E-16            1            903\n12  catalog   35392        0E-16            1           1160\n13  catalog  152296        0E-16            1           1366\n14  catalog  163772        0E-16            1           1423\n15  catalog  141722        0E-16            1           1685\n16  catalog   35212        0E-16            1           1938\n17  catalog   16741        0E-16            1           1954\n18  catalog  152707        0E-16            1           2083\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.373913,
                    "execution_time": 0.160797,
                    "compile_time": 0.038135,
                    "planning_time": 0.124778
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 6.676697,
                    "execution_time": 0.162721,
                    "compile_time": 6.239367,
                    "planning_time": 0.219151
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog  102205        0E-16            1            176\n1   catalog   57848        0E-16            1            228\n2   catalog    2740        0E-16            1            364\n3   catalog  160138        0E-16            1            380\n4   catalog  203566        0E-16            1            480\n5   catalog   51380        0E-16            1            499\n6   catalog  173131        0E-16            1            566\n7   catalog  133000        0E-16            1            649\n8   catalog   93070        0E-16            1            730\n9   catalog  203017        0E-16            1            875\n10  catalog  149662        0E-16            1            882\n11  catalog  123164        0E-16            1            903\n12  catalog   35392        0E-16            1           1160\n13  catalog  152296        0E-16            1           1366\n14  catalog  163772        0E-16            1           1423\n15  catalog  141722        0E-16            1           1685\n16  catalog   35212        0E-16            1           1938\n17  catalog   16741        0E-16            1           1954\n18  catalog  152707        0E-16            1           2083\n...*/"
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n )\n order by 1,4,5,2\n limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"_Q_0\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ITEM\" AS \"ITEM\" , \"_Q_0\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"_Q_0\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"_Q_0\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"_Q_0\" AS \"_Q_0\" ORDER BY \"CHANNEL\" NULLS LAST , \"RETURN_RANK\" NULLS LAST , \"CURRENCY_RANK\" NULLS LAST , \"ITEM\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) ORDER BY 1 NULLS FIRST , 4 NULLS FIRST , 5 NULLS FIRST , 2 NULLS FIRST LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog  102205        0E-16            1            176\n1   catalog   57848        0E-16            1            228\n2   catalog    2740        0E-16            1            364\n3   catalog  160138        0E-16            1            380\n4   catalog  203566        0E-16            1            480\n5   catalog   51380        0E-16            1            499\n6   catalog  173131        0E-16            1            566\n7   catalog  133000        0E-16            1            649\n8   catalog   93070        0E-16            1            730\n9   catalog  203017        0E-16            1            875\n10  catalog  149662        0E-16            1            882\n11  catalog  123164        0E-16            1            903\n12  catalog   35392        0E-16            1           1160\n13  catalog  152296        0E-16            1           1366\n14  catalog  163772        0E-16            1           1423\n15  catalog  141722        0E-16            1           1685\n16  catalog   35212        0E-16            1           1938\n17  catalog   16741        0E-16            1           1954\n18  catalog  152707        0E-16            1           2083\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.340726,
                    "execution_time": 0.166167,
                    "compile_time": 0.001184,
                    "planning_time": 0.124296
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.334449,
                    "execution_time": 0.158952,
                    "compile_time": 0.001146,
                    "planning_time": 0.125353
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog  102205        0E-16            1            176\n1   catalog   57848        0E-16            1            228\n2   catalog    2740        0E-16            1            364\n3   catalog  160138        0E-16            1            380\n4   catalog  203566        0E-16            1            480\n5   catalog   51380        0E-16            1            499\n6   catalog  173131        0E-16            1            566\n7   catalog  133000        0E-16            1            649\n8   catalog   93070        0E-16            1            730\n9   catalog  203017        0E-16            1            875\n10  catalog  149662        0E-16            1            882\n11  catalog  123164        0E-16            1            903\n12  catalog   35392        0E-16            1           1160\n13  catalog  152296        0E-16            1           1366\n14  catalog  163772        0E-16            1           1423\n15  catalog  141722        0E-16            1           1685\n16  catalog   35212        0E-16            1           1938\n17  catalog   16741        0E-16            1           1954\n18  catalog  152707        0E-16            1           2083\n...*/"
    }
]