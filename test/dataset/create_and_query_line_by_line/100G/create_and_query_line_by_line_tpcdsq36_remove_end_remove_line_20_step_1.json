[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n/*CURSOR_IDENTIFIER*/) SELECT * FROM results_rollup",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.51953,
                    "execution_time": 0.402523,
                    "compile_time": 0.028628,
                    "planning_time": 0.053047,
                    "create_size": 64
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 16.537361,
                    "execution_time": 0.4539,
                    "compile_time": 15.919643,
                    "planning_time": 0.133499,
                    "create_size": 64
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" GROUP BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.317802,
                    "execution_time": 0.051956,
                    "compile_time": 0.231092,
                    "planning_time": 0.00743,
                    "create_size": 9
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 12.862704,
                    "execution_time": 0.051226,
                    "compile_time": 12.728842,
                    "planning_time": 0.048842,
                    "create_size": 9
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category       i_class  t_category  t_class  lochierarchy\n0        -0.4325  Electronics    camcorders           0        0             0\n1        -0.4303      Jewelry       costume           0        0             0\n2        -0.5077                    earings           0        0             0\n3        -0.4354        Books       romance           0        0             0\n4        -0.4363       Sports          guns           0        0             0\n5        -0.4377  Electronics        memory           0        0             0\n6        -0.4316         Home     glassware           0        0             0\n7        -0.3311                       golf           0        0             0\n8        -0.4293      Jewelry   consignment           0        0             0\n9        -0.4358         Home     furniture           0        0             0\n10       -0.4360  Electronics      monitors           0        0             0\n11       -0.4338        Shoes          mens           0        0             0\n12       -0.3595               loose stones           0        0             0\n13       -0.4325        Books          None           0        1             1\n14       -0.4328        Shoes          None           0        1             1\n15       -0.4342        Books       mystery           0        0             0\n16       -0.4363     Children                         0        0             0\n17       -0.3833                accessories           0        0             0\n18       -0.4316         Home        accent           0        0             0\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.05221,
                    "execution_time": 0.007517,
                    "compile_time": 0.034883,
                    "planning_time": 0.003692
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.162323,
                    "execution_time": 0.007733,
                    "compile_time": 3.103951,
                    "planning_time": 0.039097
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\""
            }
        ],
        "preview": "\n/*    gross_margin   i_category       i_class  t_category  t_class  lochierarchy\n0        -0.4325  Electronics    camcorders           0        0             0\n1        -0.4303      Jewelry       costume           0        0             0\n2        -0.5077                    earings           0        0             0\n3        -0.4354        Books       romance           0        0             0\n4        -0.4363       Sports          guns           0        0             0\n5        -0.4377  Electronics        memory           0        0             0\n6        -0.4316         Home     glassware           0        0             0\n7        -0.3311                       golf           0        0             0\n8        -0.4293      Jewelry   consignment           0        0             0\n9        -0.4358         Home     furniture           0        0             0\n10       -0.4360  Electronics      monitors           0        0             0\n11       -0.4338        Shoes          mens           0        0             0\n12       -0.3595               loose stones           0        0             0\n13       -0.4325        Books          None           0        1             1\n14       -0.4328        Shoes          None           0        1             1\n15       -0.4342        Books       mystery           0        0             0\n16       -0.4363     Children                         0        0             0\n17       -0.3833                accessories           0        0             0\n18       -0.4316         Home        accent           0        0             0\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category, NULL AS i_class, 1 as t_category, 0 as t_class, 2 as lochierarchy from results\n)\nselect * from results_rollup\norder by lochierarchy, i_category, i_class\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" NULLS LAST , \"RESULTS_ROLLUP\".\"I_CATEGORY\" NULLS LAST , \"RESULTS_ROLLUP\".\"I_CLASS\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" GROUP BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.130158,
                    "execution_time": 0.057803,
                    "compile_time": 0.034818,
                    "planning_time": 0.010895,
                    "create_size": 9
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 4.907923,
                    "execution_time": 0.060807,
                    "compile_time": 4.766458,
                    "planning_time": 0.052427,
                    "create_size": 9
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ORDER BY \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  t_category  t_class  lochierarchy\n0        -0.4256                                       0        0             0\n1        -0.3833                 accessories           0        0             0\n2        -0.3750                     archery           0        0             0\n3        -0.4506                    athletic           0        0             0\n4        -0.4849                  basketball           0        0             0\n5        -0.4727                      birdal           0        0             0\n6        -0.3784                   bracelets           0        0             0\n7        -0.4449                  camcorders           0        0             0\n8        -0.4451                     camping           0        0             0\n9        -0.4141                   classical           0        0             0\n10       -0.3788                   computers           0        0             0\n11       -0.3852                     country           0        0             0\n12       -0.5212                      custom           0        0             0\n13       -0.3919                    diamonds           0        0             0\n14       -0.3881                 disk drives           0        0             0\n15       -0.4252                     dresses           0        0             0\n16       -0.5280             dvd/vcr players           0        0             0\n17       -0.5077                     earings           0        0             0\n18       -0.3508                      estate           0        0             0\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.037796,
                    "execution_time": 0.009279,
                    "compile_time": 0.01762,
                    "planning_time": 0.004338
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 5.116763,
                    "execution_time": 0.009615,
                    "compile_time": 5.062121,
                    "planning_time": 0.039907
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ORDER BY \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ORDER BY \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  t_category  t_class  lochierarchy\n0        -0.4256                                       0        0             0\n1        -0.3833                 accessories           0        0             0\n2        -0.3750                     archery           0        0             0\n3        -0.4506                    athletic           0        0             0\n4        -0.4849                  basketball           0        0             0\n5        -0.4727                      birdal           0        0             0\n6        -0.3784                   bracelets           0        0             0\n7        -0.4449                  camcorders           0        0             0\n8        -0.4451                     camping           0        0             0\n9        -0.4141                   classical           0        0             0\n10       -0.3788                   computers           0        0             0\n11       -0.3852                     country           0        0             0\n12       -0.5212                      custom           0        0             0\n13       -0.3919                    diamonds           0        0             0\n14       -0.3881                 disk drives           0        0             0\n15       -0.4252                     dresses           0        0             0\n16       -0.5280             dvd/vcr players           0        0             0\n17       -0.5077                     earings           0        0             0\n18       -0.3508                      estate           0        0             0\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n/*CURSOR_IDENTIFIER*/ select * from results_rollup",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" GROUP BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.122345,
                    "execution_time": 0.061942,
                    "compile_time": 0.015345,
                    "planning_time": 0.011115,
                    "create_size": 9
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.181525,
                    "execution_time": 0.059294,
                    "compile_time": 3.033968,
                    "planning_time": 0.052844,
                    "create_size": 9
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category        i_class  t_category  t_class  lochierarchy\n0        -0.4298        Books        fiction           0        0             0\n1        -0.4415         Home          paint           0        0             0\n2        -0.4342        Music        country           0        0             0\n3        -0.3668        Women                          0        0             0\n4        -0.4300         Home     mattresses           0        0             0\n5        -0.4382  Electronics         stereo           0        0             0\n6        -0.4385      Jewelry  semi-precious           0        0             0\n7        -0.4729                     fitness           0        0             0\n8        -0.4353      Jewelry   womens watch           0        0             0\n9        -0.4352         Home  blinds/shades           0        0             0\n10       -0.4064                      memory           0        0             0\n11       -0.4329  Electronics        cameras           0        0             0\n12       -0.3333                     history           0        0             0\n13       -0.3788                   computers           0        0             0\n14       -0.4355        Books      computers           0        0             0\n15       -0.4336        Music           None           0        1             1\n16       -0.4184        Music                          0        0             0\n17       -0.4325  Electronics     camcorders           0        0             0\n18       -0.4303      Jewelry        costume           0        0             0\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018049,
                    "execution_time": 0.007347,
                    "compile_time": 5.6e-05,
                    "planning_time": 0.003937
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.137339,
                    "execution_time": 0.007551,
                    "compile_time": 0.082369,
                    "planning_time": 0.039507
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    gross_margin   i_category        i_class  t_category  t_class  lochierarchy\n0        -0.4298        Books        fiction           0        0             0\n1        -0.4415         Home          paint           0        0             0\n2        -0.4342        Music        country           0        0             0\n3        -0.3668        Women                          0        0             0\n4        -0.4300         Home     mattresses           0        0             0\n5        -0.4382  Electronics         stereo           0        0             0\n6        -0.4385      Jewelry  semi-precious           0        0             0\n7        -0.4729                     fitness           0        0             0\n8        -0.4353      Jewelry   womens watch           0        0             0\n9        -0.4352         Home  blinds/shades           0        0             0\n10       -0.4064                      memory           0        0             0\n11       -0.4329  Electronics        cameras           0        0             0\n12       -0.3333                     history           0        0             0\n13       -0.3788                   computers           0        0             0\n14       -0.4355        Books      computers           0        0             0\n15       -0.4336        Music           None           0        1             1\n16       -0.4184        Music                          0        0             0\n17       -0.4325  Electronics     camcorders           0        0             0\n18       -0.4303      Jewelry        costume           0        0             0\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select * from results_rollup\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category        i_class  t_category  t_class  lochierarchy\n0        -0.4298        Books        fiction           0        0             0\n1        -0.4415         Home          paint           0        0             0\n2        -0.4342        Music        country           0        0             0\n3        -0.3668        Women                          0        0             0\n4        -0.4300         Home     mattresses           0        0             0\n5        -0.4382  Electronics         stereo           0        0             0\n6        -0.4385      Jewelry  semi-precious           0        0             0\n7        -0.4729                     fitness           0        0             0\n8        -0.4353      Jewelry   womens watch           0        0             0\n9        -0.4352         Home  blinds/shades           0        0             0\n10       -0.4064                      memory           0        0             0\n11       -0.4329  Electronics        cameras           0        0             0\n12       -0.3333                     history           0        0             0\n13       -0.3788                   computers           0        0             0\n14       -0.4355        Books      computers           0        0             0\n15       -0.4336        Music           None           0        1             1\n16       -0.4184        Music                          0        0             0\n17       -0.4325  Electronics     camcorders           0        0             0\n18       -0.4303      Jewelry        costume           0        0             0\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018415,
                    "execution_time": 0.007915,
                    "compile_time": 5.3e-05,
                    "planning_time": 0.003906
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.017605,
                    "execution_time": 0.007193,
                    "compile_time": 5.3e-05,
                    "planning_time": 0.003985
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    gross_margin   i_category        i_class  t_category  t_class  lochierarchy\n0        -0.4298        Books        fiction           0        0             0\n1        -0.4415         Home          paint           0        0             0\n2        -0.4342        Music        country           0        0             0\n3        -0.3668        Women                          0        0             0\n4        -0.4300         Home     mattresses           0        0             0\n5        -0.4382  Electronics         stereo           0        0             0\n6        -0.4385      Jewelry  semi-precious           0        0             0\n7        -0.4729                     fitness           0        0             0\n8        -0.4353      Jewelry   womens watch           0        0             0\n9        -0.4352         Home  blinds/shades           0        0             0\n10       -0.4064                      memory           0        0             0\n11       -0.4329  Electronics        cameras           0        0             0\n12       -0.3333                     history           0        0             0\n13       -0.3788                   computers           0        0             0\n14       -0.4355        Books      computers           0        0             0\n15       -0.4336        Music           None           0        1             1\n16       -0.4184        Music                          0        0             0\n17       -0.4325  Electronics     camcorders           0        0             0\n18       -0.4303      Jewelry        costume           0        0             0\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over () as rank_value\n/*CURSOR_IDENTIFIER*/ from results_rollup order by lochierarchy, i_category, i_class",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" , \"I_CATEGORY\" , \"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.4256                                         0           1\n1        -0.3833                 accessories             0           1\n2        -0.3750                     archery             0           1\n3        -0.4506                    athletic             0           1\n4        -0.4849                  basketball             0           1\n5        -0.4727                      birdal             0           1\n6        -0.3784                   bracelets             0           1\n7        -0.4449                  camcorders             0           1\n8        -0.4451                     camping             0           1\n9        -0.4141                   classical             0           1\n10       -0.3788                   computers             0           1\n11       -0.3852                     country             0           1\n12       -0.5212                      custom             0           1\n13       -0.3919                    diamonds             0           1\n14       -0.3881                 disk drives             0           1\n15       -0.4252                     dresses             0           1\n16       -0.5280             dvd/vcr players             0           1\n17       -0.5077                     earings             0           1\n18       -0.3508                      estate             0           1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.143138,
                    "execution_time": 0.010016,
                    "compile_time": 0.121043,
                    "planning_time": 0.004528
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 5.147406,
                    "execution_time": 0.010496,
                    "compile_time": 5.089455,
                    "planning_time": 0.04097
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.4256                                         0           1\n1        -0.3833                 accessories             0           1\n2        -0.3750                     archery             0           1\n3        -0.4506                    athletic             0           1\n4        -0.4849                  basketball             0           1\n5        -0.4727                      birdal             0           1\n6        -0.3784                   bracelets             0           1\n7        -0.4449                  camcorders             0           1\n8        -0.4451                     camping             0           1\n9        -0.4141                   classical             0           1\n10       -0.3788                   computers             0           1\n11       -0.3852                     country             0           1\n12       -0.5212                      custom             0           1\n13       -0.3919                    diamonds             0           1\n14       -0.3881                 disk drives             0           1\n15       -0.4252                     dresses             0           1\n16       -0.5280             dvd/vcr players             0           1\n17       -0.5077                     earings             0           1\n18       -0.3508                      estate             0           1\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end) as rank_value\n/*CURSOR_IDENTIFIER*/ from results_rollup order by lochierarchy, i_category, i_class",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" , \"I_CATEGORY\" , \"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.4256                                         0           1\n1        -0.3833                 accessories             0           1\n2        -0.3750                     archery             0           1\n3        -0.4506                    athletic             0           1\n4        -0.4849                  basketball             0           1\n5        -0.4727                      birdal             0           1\n6        -0.3784                   bracelets             0           1\n7        -0.4449                  camcorders             0           1\n8        -0.4451                     camping             0           1\n9        -0.4141                   classical             0           1\n10       -0.3788                   computers             0           1\n11       -0.3852                     country             0           1\n12       -0.5212                      custom             0           1\n13       -0.3919                    diamonds             0           1\n14       -0.3881                 disk drives             0           1\n15       -0.4252                     dresses             0           1\n16       -0.5280             dvd/vcr players             0           1\n17       -0.5077                     earings             0           1\n18       -0.3508                      estate             0           1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.150427,
                    "execution_time": 0.010765,
                    "compile_time": 0.133199,
                    "planning_time": 0.005059
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 6.490168,
                    "execution_time": 0.011466,
                    "compile_time": 6.43182,
                    "planning_time": 0.040443
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.4256                                         0           1\n1        -0.3833                 accessories             0           1\n2        -0.3750                     archery             0           1\n3        -0.4506                    athletic             0           1\n4        -0.4849                  basketball             0           1\n5        -0.4727                      birdal             0           1\n6        -0.3784                   bracelets             0           1\n7        -0.4449                  camcorders             0           1\n8        -0.4451                     camping             0           1\n9        -0.4141                   classical             0           1\n10       -0.3788                   computers             0           1\n11       -0.3852                     country             0           1\n12       -0.5212                      custom             0           1\n13       -0.3919                    diamonds             0           1\n14       -0.3881                 disk drives             0           1\n15       -0.4252                     dresses             0           1\n16       -0.5280             dvd/vcr players             0           1\n17       -0.5077                     earings             0           1\n18       -0.3508                      estate             0           1\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category         i_class  lochierarchy  rank_within_parent\n0        -0.4369      Books          sports             0                   1\n1        -0.4368      Books            arts             0                   2\n2        -0.4355      Books       computers             0                   3\n3        -0.4354      Books         romance             0                   4\n4        -0.4342      Books         mystery             0                   5\n5        -0.4342      Books     home repair             0                   5\n6        -0.4332      Books         history             0                   7\n7        -0.4324      Books        business             0                   8\n8        -0.4319      Books       self-help             0                   9\n9        -0.4318      Books          travel             0                  10\n10       -0.4310      Books         science             0                  11\n11       -0.4304      Books  entertainments             0                  12\n12       -0.4303      Books       parenting             0                  13\n13       -0.4298      Books         fiction             0                  14\n14       -0.4283      Books         cooking             0                  15\n15       -0.4281      Books       reference             0                  16\n16       -0.4253      Books                             0                  17\n17       -0.4557    Jewelry                             0                   1\n18       -0.4398    Jewelry          estate             0                   2\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.053589,
                    "execution_time": 0.009716,
                    "compile_time": 0.030914,
                    "planning_time": 0.00498
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.506159,
                    "execution_time": 0.009937,
                    "compile_time": 4.450116,
                    "planning_time": 0.040213
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    gross_margin i_category         i_class  lochierarchy  rank_within_parent\n0        -0.4369      Books          sports             0                   1\n1        -0.4368      Books            arts             0                   2\n2        -0.4355      Books       computers             0                   3\n3        -0.4354      Books         romance             0                   4\n4        -0.4342      Books         mystery             0                   5\n5        -0.4342      Books     home repair             0                   5\n6        -0.4332      Books         history             0                   7\n7        -0.4324      Books        business             0                   8\n8        -0.4319      Books       self-help             0                   9\n9        -0.4318      Books          travel             0                  10\n10       -0.4310      Books         science             0                  11\n11       -0.4304      Books  entertainments             0                  12\n12       -0.4303      Books       parenting             0                  13\n13       -0.4298      Books         fiction             0                  14\n14       -0.4283      Books         cooking             0                  15\n15       -0.4281      Books       reference             0                  16\n16       -0.4253      Books                             0                  17\n17       -0.4557    Jewelry                             0                   1\n18       -0.4398    Jewelry          estate             0                   2\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by lochierarchy, i_category, i_class\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" , \"I_CATEGORY\" , \"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4256                                         0                  30\n1        -0.3833                 accessories             0                  46\n2        -0.3750                     archery             0                  50\n3        -0.4506                    athletic             0                  21\n4        -0.4849                  basketball             0                  11\n5        -0.4727                      birdal             0                  15\n6        -0.3784                   bracelets             0                  49\n7        -0.4449                  camcorders             0                  24\n8        -0.4451                     camping             0                  23\n9        -0.4141                   classical             0                  37\n10       -0.3788                   computers             0                  48\n11       -0.3852                     country             0                  45\n12       -0.5212                      custom             0                   6\n13       -0.3919                    diamonds             0                  42\n14       -0.3881                 disk drives             0                  43\n15       -0.4252                     dresses             0                  32\n16       -0.5280             dvd/vcr players             0                   4\n17       -0.5077                     earings             0                   7\n18       -0.3508                      estate             0                  56\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.035006,
                    "execution_time": 0.011154,
                    "compile_time": 0.017184,
                    "planning_time": 0.005319
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.150307,
                    "execution_time": 0.011365,
                    "compile_time": 3.095604,
                    "planning_time": 0.040704
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4256                                         0                  30\n1        -0.3833                 accessories             0                  46\n2        -0.3750                     archery             0                  50\n3        -0.4506                    athletic             0                  21\n4        -0.4849                  basketball             0                  11\n5        -0.4727                      birdal             0                  15\n6        -0.3784                   bracelets             0                  49\n7        -0.4449                  camcorders             0                  24\n8        -0.4451                     camping             0                  23\n9        -0.4141                   classical             0                  37\n10       -0.3788                   computers             0                  48\n11       -0.3852                     country             0                  45\n12       -0.5212                      custom             0                   6\n13       -0.3919                    diamonds             0                  42\n14       -0.3881                 disk drives             0                  43\n15       -0.4252                     dresses             0                  32\n16       -0.5280             dvd/vcr players             0                   4\n17       -0.5077                     earings             0                   7\n18       -0.3508                      estate             0                  56\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC LIMIT 21",
                "preview": "\n/*    gross_margin   i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4335         None             None             2                   1\n1        -0.4341         Home             None             1                   2\n2        -0.4339  Electronics             None             1                   3\n3        -0.4337        Women             None             1                   4\n4        -0.4336        Music             None             1                   5\n5        -0.4335       Sports             None             1                   6\n6        -0.4335          Men             None             1                   6\n7        -0.4334     Children             None             1                   8\n8        -0.4328        Shoes             None             1                   9\n9        -0.4325        Books             None             1                  10\n10       -0.4275                          None             1                  11\n11       -0.4342      Jewelry             None             1                   1\n12       -0.4334        Women          dresses             0                   3\n13       -0.4380         Home            decor             0                   2\n14       -0.4312        Women       fragrances             0                   4\n15       -0.4377         Home         bathroom             0                   3\n16       -0.3668        Women                              0                   5\n17       -0.4369         Home  curtains/drapes             0                   4\n18       -0.4339        Women        maternity             0                   2\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.047068,
                    "execution_time": 0.010307,
                    "compile_time": 0.030364,
                    "planning_time": 0.005076
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.733826,
                    "execution_time": 0.011957,
                    "compile_time": 4.679221,
                    "planning_time": 0.040203
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST"
            }
        ],
        "preview": "\n/*    gross_margin   i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4335         None             None             2                   1\n1        -0.4341         Home             None             1                   2\n2        -0.4339  Electronics             None             1                   3\n3        -0.4337        Women             None             1                   4\n4        -0.4336        Music             None             1                   5\n5        -0.4335       Sports             None             1                   6\n6        -0.4335          Men             None             1                   6\n7        -0.4334     Children             None             1                   8\n8        -0.4328        Shoes             None             1                   9\n9        -0.4325        Books             None             1                  10\n10       -0.4275                          None             1                  11\n11       -0.4342      Jewelry             None             1                   1\n12       -0.4334        Women          dresses             0                   3\n13       -0.4380         Home            decor             0                   2\n14       -0.4312        Women       fragrances             0                   4\n15       -0.4377         Home         bathroom             0                   3\n16       -0.3668        Women                              0                   5\n17       -0.4369         Home  curtains/drapes             0                   4\n18       -0.4339        Women        maternity             0                   2\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END LIMIT 21",
                "preview": "\n/*    gross_margin   i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4335         None             None             2                   1\n1        -0.4341         Home             None             1                   2\n2        -0.4339  Electronics             None             1                   3\n3        -0.4337        Women             None             1                   4\n4        -0.4336        Music             None             1                   5\n5        -0.4335       Sports             None             1                   6\n6        -0.4335          Men             None             1                   6\n7        -0.4334     Children             None             1                   8\n8        -0.4328        Shoes             None             1                   9\n9        -0.4325        Books             None             1                  10\n10       -0.4275                          None             1                  11\n11       -0.4342      Jewelry             None             1                   1\n12       -0.5514                         pools             0                   2\n13       -0.5281                    fragrances             0                   3\n14       -0.5280               dvd/vcr players             0                   4\n15       -0.5221                     reference             0                   5\n16       -0.5212                        custom             0                   6\n17       -0.5077                       earings             0                   7\n18       -0.5018                       infants             0                   8\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.10134,
                    "execution_time": 0.011006,
                    "compile_time": 0.076024,
                    "planning_time": 0.005598
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 6.161571,
                    "execution_time": 0.011202,
                    "compile_time": 6.103716,
                    "planning_time": 0.040778
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin   i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4335         None             None             2                   1\n1        -0.4341         Home             None             1                   2\n2        -0.4339  Electronics             None             1                   3\n3        -0.4337        Women             None             1                   4\n4        -0.4336        Music             None             1                   5\n5        -0.4335       Sports             None             1                   6\n6        -0.4335          Men             None             1                   6\n7        -0.4334     Children             None             1                   8\n8        -0.4328        Shoes             None             1                   9\n9        -0.4325        Books             None             1                  10\n10       -0.4275                          None             1                  11\n11       -0.4342      Jewelry             None             1                   1\n12       -0.5514                         pools             0                   2\n13       -0.5281                    fragrances             0                   3\n14       -0.5280               dvd/vcr players             0                   4\n15       -0.5221                     reference             0                   5\n16       -0.5212                        custom             0                   6\n17       -0.5077                       earings             0                   7\n18       -0.5018                       infants             0                   8\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n  ,rank_within_parent\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END , \"RANK_WITHIN_PARENT\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4335         None             None             2                   1\n1        -0.4342      Jewelry             None             1                   1\n2        -0.4341         Home             None             1                   2\n3        -0.4339  Electronics             None             1                   3\n4        -0.4337        Women             None             1                   4\n5        -0.4336        Music             None             1                   5\n6        -0.4335          Men             None             1                   6\n7        -0.4335       Sports             None             1                   6\n8        -0.4334     Children             None             1                   8\n9        -0.4328        Shoes             None             1                   9\n10       -0.4325        Books             None             1                  10\n11       -0.4275                          None             1                  11\n12       -0.5617                        womens             0                   1\n13       -0.5514                         pools             0                   2\n14       -0.5281                    fragrances             0                   3\n15       -0.5280               dvd/vcr players             0                   4\n16       -0.5221                     reference             0                   5\n17       -0.5212                        custom             0                   6\n18       -0.5077                       earings             0                   7\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.039553,
                    "execution_time": 0.011316,
                    "compile_time": 0.021032,
                    "planning_time": 0.005884
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.412326,
                    "execution_time": 0.011993,
                    "compile_time": 4.355725,
                    "planning_time": 0.041337
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin   i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4335         None             None             2                   1\n1        -0.4342      Jewelry             None             1                   1\n2        -0.4341         Home             None             1                   2\n3        -0.4339  Electronics             None             1                   3\n4        -0.4337        Women             None             1                   4\n5        -0.4336        Music             None             1                   5\n6        -0.4335          Men             None             1                   6\n7        -0.4335       Sports             None             1                   6\n8        -0.4334     Children             None             1                   8\n9        -0.4328        Shoes             None             1                   9\n10       -0.4325        Books             None             1                  10\n11       -0.4275                          None             1                  11\n12       -0.5617                        womens             0                   1\n13       -0.5514                         pools             0                   2\n14       -0.5281                    fragrances             0                   3\n15       -0.5280               dvd/vcr players             0                   4\n16       -0.5221                     reference             0                   5\n17       -0.5212                        custom             0                   6\n18       -0.5077                       earings             0                   7\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n  ,rank_within_parent\n  limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END , \"RANK_WITHIN_PARENT\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4335         None             None             2                   1\n1        -0.4342      Jewelry             None             1                   1\n2        -0.4341         Home             None             1                   2\n3        -0.4339  Electronics             None             1                   3\n4        -0.4337        Women             None             1                   4\n5        -0.4336        Music             None             1                   5\n6        -0.4335          Men             None             1                   6\n7        -0.4335       Sports             None             1                   6\n8        -0.4334     Children             None             1                   8\n9        -0.4328        Shoes             None             1                   9\n10       -0.4325        Books             None             1                  10\n11       -0.4275                          None             1                  11\n12       -0.5617                        womens             0                   1\n13       -0.5514                         pools             0                   2\n14       -0.5281                    fragrances             0                   3\n15       -0.5280               dvd/vcr players             0                   4\n16       -0.5221                     reference             0                   5\n17       -0.5212                        custom             0                   6\n18       -0.5077                       earings             0                   7\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.024487,
                    "execution_time": 0.010339,
                    "compile_time": 0.000132,
                    "planning_time": 0.005948
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.024677,
                    "execution_time": 0.010308,
                    "compile_time": 0.00013,
                    "planning_time": 0.006057
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100"
            }
        ],
        "preview": "\n/*    gross_margin   i_category          i_class  lochierarchy  rank_within_parent\n0        -0.4335         None             None             2                   1\n1        -0.4342      Jewelry             None             1                   1\n2        -0.4341         Home             None             1                   2\n3        -0.4339  Electronics             None             1                   3\n4        -0.4337        Women             None             1                   4\n5        -0.4336        Music             None             1                   5\n6        -0.4335          Men             None             1                   6\n7        -0.4335       Sports             None             1                   6\n8        -0.4334     Children             None             1                   8\n9        -0.4328        Shoes             None             1                   9\n10       -0.4325        Books             None             1                  10\n11       -0.4275                          None             1                  11\n12       -0.5617                        womens             0                   1\n13       -0.5514                         pools             0                   2\n14       -0.5281                    fragrances             0                   3\n15       -0.5280               dvd/vcr players             0                   4\n16       -0.5221                     reference             0                   5\n17       -0.5212                        custom             0                   6\n18       -0.5077                       earings             0                   7\n...*/"
    }
]