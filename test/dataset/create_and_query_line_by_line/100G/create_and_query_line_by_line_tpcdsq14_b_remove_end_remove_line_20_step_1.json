[
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) AS inter \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) AS sales_data \nGROUP BY channel, i_brand_id, i_class_id, i_category_id\n/*CURSOR_IDENTIFIER*/;",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"INTER\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"INTER\" AS \"INTER\" ON \"INTER\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"INTER\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"INTER\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"SALES_DATA\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"SALES_DATA\".\"CHANNEL\" AS \"CHANNEL\" , \"SALES_DATA\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SALES_DATA\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SALES_DATA\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SALES_DATA\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SALES_DATA\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SALES_DATA\" AS \"SALES_DATA\" GROUP BY \"SALES_DATA\".\"CHANNEL\" , \"SALES_DATA\".\"I_BRAND_ID\" , \"SALES_DATA\".\"I_CLASS_ID\" , \"SALES_DATA\".\"I_CATEGORY_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.251167,
                    "execution_time": 0.053427,
                    "compile_time": 0.000263,
                    "planning_time": 0.025709,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 2.166611,
                    "execution_time": 1.900929,
                    "compile_time": 0.0032,
                    "planning_time": 0.088324,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.694405,
                    "execution_time": 3.559524,
                    "compile_time": 0.000785,
                    "planning_time": 0.081748,
                    "create_size": 144
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 5.849666,
                    "execution_time": 5.580498,
                    "compile_time": 0.008454,
                    "planning_time": 0.206062,
                    "create_size": 144
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.085758,
                    "execution_time": 0.031528,
                    "compile_time": 0.000236,
                    "planning_time": 0.030354,
                    "create_size": 20
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.289774,
                    "execution_time": 0.030686,
                    "compile_time": 0.145346,
                    "planning_time": 0.088295,
                    "create_size": 20
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 4.71042,
                    "execution_time": 4.455255,
                    "compile_time": 0.000516,
                    "planning_time": 0.049678,
                    "create_size": 4352
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 12.890015,
                    "execution_time": 12.525742,
                    "compile_time": 0.005689,
                    "planning_time": 0.154271,
                    "create_size": 4352
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT AVG ( \"SPEQLITE_TEMP_TABLE_4\".\"QUANTITY\" * \"SPEQLITE_TEMP_TABLE_4\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.258173,
                    "execution_time": 0.227135,
                    "compile_time": 0.00035,
                    "planning_time": 0.003607,
                    "create_size": 4
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.317523,
                    "execution_time": 0.225323,
                    "compile_time": 0.004038,
                    "planning_time": 0.06134,
                    "create_size": 4
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.06261,
                    "execution_time": 0.035633,
                    "compile_time": 0.000233,
                    "planning_time": 0.002946,
                    "create_size": 4
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.121157,
                    "execution_time": 0.035251,
                    "compile_time": 0.001148,
                    "planning_time": 0.059591,
                    "create_size": 4
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_2\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_2\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_2\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.120547,
                    "execution_time": 0.057329,
                    "compile_time": 0.00031,
                    "planning_time": 0.006033,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.375443,
                    "execution_time": 0.056595,
                    "compile_time": 0.189235,
                    "planning_time": 0.06335,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.081368,
                    "execution_time": 0.030784,
                    "compile_time": 0.00024,
                    "planning_time": 0.026351,
                    "create_size": 6
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.291791,
                    "execution_time": 0.176595,
                    "compile_time": 0.001392,
                    "planning_time": 0.088483,
                    "create_size": 6
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_6\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.718537,
                    "execution_time": 0.47182,
                    "compile_time": 0.034409,
                    "planning_time": 0.084753,
                    "create_size": 630
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 25.778676,
                    "execution_time": 0.476769,
                    "compile_time": 24.999316,
                    "planning_time": 0.196927,
                    "create_size": 630
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_10\" AS SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.230671,
                    "execution_time": 0.068816,
                    "compile_time": 0.049158,
                    "planning_time": 0.004911,
                    "create_size": 639
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.848985,
                    "execution_time": 0.071466,
                    "compile_time": 3.590241,
                    "planning_time": 0.070703,
                    "create_size": 639
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_10\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0      web    10008012           4              5   76304.73      19\n1      web     8001003           1              9  103038.53      19\n2      web     8012010           5              8  152609.34      35\n3      web     9011005           4              5  174912.02      40\n4      web    10001013           2             10  115198.24      26\n5      web     8015007           6             10   44682.10      15\n6      web     6014007          16             10   90005.53      19\n7      web     7002001          13              9  133140.09      30\n8      web    10015001           3              1   67413.54      14\n9      web    10016005           2              1  103123.15      21\n10     web    10012013           3              5   64889.10      17\n11     web     6009001           2              1   80732.88      20\n12     web     9010010          16              9  223060.92      37\n13     web     9004011           4              9  453692.53      81\n14     web    10012014          12              5   71425.26      18\n15     web     9010009           3              1  104884.80      21\n16     web     6014001          14              4  259943.60      45\n17     web     9012003           1              8  111163.03      26\n18     web     7013007          13              1  115378.77      25\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.045769,
                    "execution_time": 0.007949,
                    "compile_time": 0.027201,
                    "planning_time": 0.003966
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.209805,
                    "execution_time": 0.008083,
                    "compile_time": 3.154228,
                    "planning_time": 0.039113
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_10\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0      web    10008012           4              5   76304.73      19\n1      web     8001003           1              9  103038.53      19\n2      web     8012010           5              8  152609.34      35\n3      web     9011005           4              5  174912.02      40\n4      web    10001013           2             10  115198.24      26\n5      web     8015007           6             10   44682.10      15\n6      web     6014007          16             10   90005.53      19\n7      web     7002001          13              9  133140.09      30\n8      web    10015001           3              1   67413.54      14\n9      web    10016005           2              1  103123.15      21\n10     web    10012013           3              5   64889.10      17\n11     web     6009001           2              1   80732.88      20\n12     web     9010010          16              9  223060.92      37\n13     web     9004011           4              9  453692.53      81\n14     web    10012014          12              5   71425.26      18\n15     web     9010009           3              1  104884.80      21\n16     web     6014001          14              4  259943.60      45\n17     web     9012003           1              8  111163.03      26\n18     web     7013007          13              1  115378.77      25\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) \nGROUP BY channel, i_brand_id, i_class_id, i_category_id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"_Q_1\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0      web    10008012           4              5   76304.73      19\n1      web     8001003           1              9  103038.53      19\n2      web     8012010           5              8  152609.34      35\n3      web     9011005           4              5  174912.02      40\n4      web    10001013           2             10  115198.24      26\n5      web     8015007           6             10   44682.10      15\n6      web     6014007          16             10   90005.53      19\n7      web     7002001          13              9  133140.09      30\n8      web    10015001           3              1   67413.54      14\n9      web    10016005           2              1  103123.15      21\n10     web    10012013           3              5   64889.10      17\n11     web     6009001           2              1   80732.88      20\n12     web     9010010          16              9  223060.92      37\n13     web     9004011           4              9  453692.53      81\n14     web    10012014          12              5   71425.26      18\n15     web     9010009           3              1  104884.80      21\n16     web     6014001          14              4  259943.60      45\n17     web     9012003           1              8  111163.03      26\n18     web     7013007          13              1  115378.77      25\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017401,
                    "execution_time": 0.007286,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.003815
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.052904,
                    "execution_time": 0.007933,
                    "compile_time": 4.8e-05,
                    "planning_time": 0.038675
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0      web    10008012           4              5   76304.73      19\n1      web     8001003           1              9  103038.53      19\n2      web     8012010           5              8  152609.34      35\n3      web     9011005           4              5  174912.02      40\n4      web    10001013           2             10  115198.24      26\n5      web     8015007           6             10   44682.10      15\n6      web     6014007          16             10   90005.53      19\n7      web     7002001          13              9  133140.09      30\n8      web    10015001           3              1   67413.54      14\n9      web    10016005           2              1  103123.15      21\n10     web    10012013           3              5   64889.10      17\n11     web     6009001           2              1   80732.88      20\n12     web     9010010          16              9  223060.92      37\n13     web     9004011           4              9  453692.53      81\n14     web    10012014          12              5   71425.26      18\n15     web     9010009           3              1  104884.80      21\n16     web     6014001          14              4  259943.60      45\n17     web     9012003           1              8  111163.03      26\n18     web     7013007          13              1  115378.77      25\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) \nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id \nORDER BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"_Q_1\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_10\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" ORDER BY \"CHANNEL\" , \"I_BRAND_ID\" , \"I_CLASS_ID\" , \"I_CATEGORY_ID\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     1001001           1              1  10544531.60    2149\n1   catalog     1001001           1              2  13557381.65    2624\n2   catalog     1001001           1              3   9161304.88    1796\n3   catalog     1001001           1              4  11678654.33    2407\n4   catalog     1001001           1              5  10692110.25    2119\n5   catalog     1001001           1              6  10882704.95    2092\n6   catalog     1001001           1              7   9221298.77    1870\n7   catalog     1001001           1              8   9893337.16    1963\n8   catalog     1001001           1              9   8873378.89    1745\n9   catalog     1001001           1             10  12453432.13    2437\n10  catalog     1001001           2              1   3474508.17     660\n11  catalog     1001001           2              2   2443468.57     491\n12  catalog     1001001           2              3    711625.46     138\n13  catalog     1001001           2              4   1864973.46     348\n14  catalog     1001001           2              5   1787817.61     351\n15  catalog     1001001           2              6    330352.72      55\n16  catalog     1001001           2              7    237882.69      52\n17  catalog     1001001           2              8   1509220.03     296\n18  catalog     1001001           2              9    218683.62      44\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.038129,
                    "execution_time": 0.010321,
                    "compile_time": 0.017208,
                    "planning_time": 0.004279
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.515706,
                    "execution_time": 0.010804,
                    "compile_time": 3.464401,
                    "planning_time": 0.039208
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_10\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST"
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     1001001           1              1  10544531.60    2149\n1   catalog     1001001           1              2  13557381.65    2624\n2   catalog     1001001           1              3   9161304.88    1796\n3   catalog     1001001           1              4  11678654.33    2407\n4   catalog     1001001           1              5  10692110.25    2119\n5   catalog     1001001           1              6  10882704.95    2092\n6   catalog     1001001           1              7   9221298.77    1870\n7   catalog     1001001           1              8   9893337.16    1963\n8   catalog     1001001           1              9   8873378.89    1745\n9   catalog     1001001           1             10  12453432.13    2437\n10  catalog     1001001           2              1   3474508.17     660\n11  catalog     1001001           2              2   2443468.57     491\n12  catalog     1001001           2              3    711625.46     138\n13  catalog     1001001           2              4   1864973.46     348\n14  catalog     1001001           2              5   1787817.61     351\n15  catalog     1001001           2              6    330352.72      55\n16  catalog     1001001           2              7    237882.69      52\n17  catalog     1001001           2              8   1509220.03     296\n18  catalog     1001001           2              9    218683.62      44\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) final\n/*CURSOR_IDENTIFIER*/\nGROUP  BY channel, \n          i_brand_id, \n          i_class_id, \n          i_category_id;",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"FINAL\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"FINAL\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"FINAL\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"FINAL\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"FINAL\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"FINAL\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"FINAL\" AS \"FINAL\" GROUP BY \"FINAL\".\"CHANNEL\" , \"FINAL\".\"I_BRAND_ID\" , \"FINAL\".\"I_CLASS_ID\" , \"FINAL\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0      web    10008012           4              5   76304.73      19\n1      web     8001003           1              9  103038.53      19\n2      web     8012010           5              8  152609.34      35\n3      web     9011005           4              5  174912.02      40\n4      web    10001013           2             10  115198.24      26\n5      web     8015007           6             10   44682.10      15\n6      web     6014007          16             10   90005.53      19\n7      web     7002001          13              9  133140.09      30\n8      web    10015001           3              1   67413.54      14\n9      web    10016005           2              1  103123.15      21\n10     web    10012013           3              5   64889.10      17\n11     web     6009001           2              1   80732.88      20\n12     web     9010010          16              9  223060.92      37\n13     web     9004011           4              9  453692.53      81\n14     web    10012014          12              5   71425.26      18\n15     web     9010009           3              1  104884.80      21\n16     web     6014001          14              4  259943.60      45\n17     web     9012003           1              8  111163.03      26\n18     web     7013007          13              1  115378.77      25\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017926,
                    "execution_time": 0.007704,
                    "compile_time": 5.4e-05,
                    "planning_time": 0.003824
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.07055,
                    "execution_time": 0.008122,
                    "compile_time": 0.051932,
                    "planning_time": 0.003902
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0      web    10008012           4              5   76304.73      19\n1      web     8001003           1              9  103038.53      19\n2      web     8012010           5              8  152609.34      35\n3      web     9011005           4              5  174912.02      40\n4      web    10001013           2             10  115198.24      26\n5      web     8015007           6             10   44682.10      15\n6      web     6014007          16             10   90005.53      19\n7      web     7002001          13              9  133140.09      30\n8      web    10015001           3              1   67413.54      14\n9      web    10016005           2              1  103123.15      21\n10     web    10012013           3              5   64889.10      17\n11     web     6009001           2              1   80732.88      20\n12     web     9010010          16              9  223060.92      37\n13     web     9004011           4              9  453692.53      81\n14     web    10012014          12              5   71425.26      18\n15     web     9010009           3              1  104884.80      21\n16     web     6014001          14              4  259943.60      45\n17     web     9012003           1              8  111163.03      26\n18     web     7013007          13              1  115378.77      25\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) ) AS final_result\nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id; \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"FINAL_RESULT\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"FINAL_RESULT\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_RESULT\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"FINAL_RESULT\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"FINAL_RESULT\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"FINAL_RESULT\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"FINAL_RESULT\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"FINAL_RESULT\" AS \"FINAL_RESULT\" GROUP BY \"FINAL_RESULT\".\"CHANNEL\" , \"FINAL_RESULT\".\"I_BRAND_ID\" , \"FINAL_RESULT\".\"I_CLASS_ID\" , \"FINAL_RESULT\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0      web     8013003          13              6   301916.02      42\n1      web    10004004           4              9   200429.95      37\n2      web    10016011           9              7   116267.80      28\n3      web     9002003           1              9   142651.98      28\n4      web     8011001           3              1   350959.21      68\n5      web    10010007          10             10  2069009.15     393\n6      web     9016011          16              5   233404.45      45\n7      web     9007011           4              3   146936.07      29\n8      web     6007003           7              7   393162.69      75\n9      web    10008004          15             10    94863.17      19\n10     web     7007001           7              2   523042.07     101\n11     web     7009003           1              2    72419.75      14\n12     web     6013001           3              2   115393.16      23\n13     web     7014004           2              7   729172.06     123\n14     web     7001007           1              2    82375.84      23\n15     web     6011004           3              6   823167.08     161\n16     web     7003007           3              4   255246.39      43\n17     web     2003001           5             10   237118.32      56\n18     web     5001001          11              6   350068.06      86\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017341,
                    "execution_time": 0.007304,
                    "compile_time": 4.8e-05,
                    "planning_time": 0.003743
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.017846,
                    "execution_time": 0.007812,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.003816
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0      web     8013003          13              6   301916.02      42\n1      web    10004004           4              9   200429.95      37\n2      web    10016011           9              7   116267.80      28\n3      web     9002003           1              9   142651.98      28\n4      web     8011001           3              1   350959.21      68\n5      web    10010007          10             10  2069009.15     393\n6      web     9016011          16              5   233404.45      45\n7      web     9007011           4              3   146936.07      29\n8      web     6007003           7              7   393162.69      75\n9      web    10008004          15             10    94863.17      19\n10     web     7007001           7              2   523042.07     101\n11     web     7009003           1              2    72419.75      14\n12     web     6013001           3              2   115393.16      23\n13     web     7014004           2              7   729172.06     123\n14     web     7001007           1              2    82375.84      23\n15     web     6011004           3              6   823167.08     161\n16     web     7003007           3              4   255246.39      43\n17     web     2003001           5             10   237118.32      56\n18     web     5001001          11              6   350068.06      86\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales) AS total_sales, \n               Sum(number_sales) AS total_number_sales \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) a\nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"A\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"A\".\"CHANNEL\" AS \"CHANNEL\" , \"A\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"A\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"A\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"A\".\"SALES\" ) AS \"TOTAL_SALES\" , SUM ( \"A\".\"NUMBER_SALES\" ) AS \"TOTAL_NUMBER_SALES\" FROM \"A\" AS \"A\" GROUP BY \"A\".\"CHANNEL\" , \"A\".\"I_BRAND_ID\" , \"A\".\"I_CLASS_ID\" , \"A\".\"I_CATEGORY_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_11\" AS SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"TOTAL_SALES\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"TOTAL_NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.172402,
                    "execution_time": 0.059376,
                    "compile_time": 0.000311,
                    "planning_time": 0.004949,
                    "create_size": 639
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.387786,
                    "execution_time": 0.100247,
                    "compile_time": 0.114224,
                    "planning_time": 0.06273,
                    "create_size": 639
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_11\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"TOTAL_SALES\" AS \"TOTAL_SALES\" , \"SPEQLITE_TEMP_TABLE_11\".\"TOTAL_NUMBER_SALES\" AS \"TOTAL_NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_11\" AS \"SPEQLITE_TEMP_TABLE_11\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id  total_sales  total_number_sales\n0      web     1002001           1              6    531899.81                  96\n1      web     6011006           9              6    119344.25                  32\n2      web     8001009           3              3    258996.67                  47\n3      web    10001010           8             10    102666.80                  17\n4      web    10014015          14              2    181957.97                  39\n5      web    10016016          16              6    116655.96                  26\n6      web     6001001          14              9     76894.45                  21\n7      web    10007001           7              1    116765.69                  33\n8      web    10006009           6              8    644671.29                 111\n9      web     7004001           9              6     98179.15                  19\n10     web     8006004           2              8    491701.69                  98\n11     web     5003001           1              5   1232039.77                 247\n12     web     8008003          12              9    179863.30                  24\n13     web     9004005           2              5     96185.18                  22\n14     web     6015002          13              6    213959.54                  33\n15     web     7012001           3              1     78121.02                  17\n16     web     6015005           2              1    124384.40                  20\n17     web    10002011           2              3    117603.49                  21\n18     web     7012009           4              4     89439.73                  20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017709,
                    "execution_time": 0.007877,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.00371
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.053252,
                    "execution_time": 0.007909,
                    "compile_time": 5.2e-05,
                    "planning_time": 0.038948
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"TOTAL_SALES\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"TOTAL_NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_11\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"TOTAL_SALES\" AS \"TOTAL_SALES\" , \"SPEQLITE_TEMP_TABLE_11\".\"TOTAL_NUMBER_SALES\" AS \"TOTAL_NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_11\" AS \"SPEQLITE_TEMP_TABLE_11\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id  total_sales  total_number_sales\n0      web     1002001           1              6    531899.81                  96\n1      web     6011006           9              6    119344.25                  32\n2      web     8001009           3              3    258996.67                  47\n3      web    10001010           8             10    102666.80                  17\n4      web    10014015          14              2    181957.97                  39\n5      web    10016016          16              6    116655.96                  26\n6      web     6001001          14              9     76894.45                  21\n7      web    10007001           7              1    116765.69                  33\n8      web    10006009           6              8    644671.29                 111\n9      web     7004001           9              6     98179.15                  19\n10     web     8006004           2              8    491701.69                  98\n11     web     5003001           1              5   1232039.77                 247\n12     web     8008003          12              9    179863.30                  24\n13     web     9004005           2              5     96185.18                  22\n14     web     6015002          13              6    213959.54                  33\n15     web     7012001           3              1     78121.02                  17\n16     web     6015005           2              1    124384.40                  20\n17     web    10002011           2              3    117603.49                  21\n18     web     7012009           4              4     89439.73                  20\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2\n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)\n     ) final_sales\nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"FINAL_SALES\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"FINAL_SALES\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_SALES\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"FINAL_SALES\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"FINAL_SALES\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"FINAL_SALES\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"FINAL_SALES\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"FINAL_SALES\" AS \"FINAL_SALES\" GROUP BY \"FINAL_SALES\".\"CHANNEL\" , \"FINAL_SALES\".\"I_BRAND_ID\" , \"FINAL_SALES\".\"I_CLASS_ID\" , \"FINAL_SALES\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     6001007           2              3    214305.27      45\n1   catalog    10001003           1             10   5497340.60    1062\n2   catalog     2001001           1              6  10546156.95    1987\n3   catalog    10015008          13             10    286460.40      51\n4   catalog     5004001           6              9    890359.14     189\n5     store     9013006          16              9    542737.15     152\n6     store     8014002          13              8    584715.58     175\n7     store     9008003           9              8    353030.68     101\n8     store    10014001          13             10    320224.22      83\n9     store     8007007           7              7    342290.41      97\n10    store     6005005           4              5    350184.21      84\n11    store     7008003           8              2    659926.74     194\n12    store     7009003           8             10    252039.42      75\n13    store    10004008           1             10    381418.58      92\n14    store    10014016          14              8    577699.62     165\n15    store     8008005           1              4    251704.39      76\n16    store     8001009           3              1    291130.85      82\n17    store     9016006           9              9    328655.17      94\n18    store     6016003           8             10    262920.41      82\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017841,
                    "execution_time": 0.007998,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.003689
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.01791,
                    "execution_time": 0.007679,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.003815
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     6001007           2              3    214305.27      45\n1   catalog    10001003           1             10   5497340.60    1062\n2   catalog     2001001           1              6  10546156.95    1987\n3   catalog    10015008          13             10    286460.40      51\n4   catalog     5004001           6              9    890359.14     189\n5     store     9013006          16              9    542737.15     152\n6     store     8014002          13              8    584715.58     175\n7     store     9008003           9              8    353030.68     101\n8     store    10014001          13             10    320224.22      83\n9     store     8007007           7              7    342290.41      97\n10    store     6005005           4              5    350184.21      84\n11    store     7008003           8              2    659926.74     194\n12    store     7009003           8             10    252039.42      75\n13    store    10004008           1             10    381418.58      92\n14    store    10014016          14              8    577699.62     165\n15    store     8008005           1              4    251704.39      76\n16    store     8001009           3              1    291130.85      82\n17    store     9016006           9              9    328655.17      94\n18    store     6016003           8             10    262920.41      82\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n       i_brand_id, \n       i_class_id, \n       i_category_id, \n       Sum(sales), \n       Sum(number_sales) \nFROM   (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) a \nGROUP  BY channel, i_brand_id, i_class_id, i_category_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"A\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"A\".\"CHANNEL\" AS \"CHANNEL\" , \"A\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"A\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"A\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"A\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"A\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"A\" AS \"A\" GROUP BY \"A\".\"CHANNEL\" , \"A\".\"I_BRAND_ID\" , \"A\".\"I_CLASS_ID\" , \"A\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0      web     9004003           3              2   101857.71      22\n1      web     6007004          10              6   149524.84      25\n2      web     8010007          15              6   122264.77      26\n3      web     8011007           2             10   343772.55      48\n4      web    10012013           4              2   188982.98      26\n5      web     3002001           5              9   135735.00      21\n6      web     9005004          11              9   164742.95      24\n7      web     8007004          10              8   210845.89      46\n8      web     8007005           3              5    66554.09      17\n9      web     8013005          13              2   106420.06      25\n10     web    10007010           7             10  1855356.81     373\n11     web     9004012          13              9   147050.93      26\n12     web     8004010          12              8   113998.26      20\n13     web    10014013          12              9   123272.67      28\n14     web    10015016           1              1    91878.62      19\n15     web    10010010           1              4   117075.24      24\n16     web     7013004           1              7   561481.96     100\n17     web     9014004           3              9    73420.12      18\n18     web     6015008          16              6    95261.84      20\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.016754,
                    "execution_time": 0.007293,
                    "compile_time": 4.5e-05,
                    "planning_time": 0.003561
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.017518,
                    "execution_time": 0.007538,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.003676
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0      web     9004003           3              2   101857.71      22\n1      web     6007004          10              6   149524.84      25\n2      web     8010007          15              6   122264.77      26\n3      web     8011007           2             10   343772.55      48\n4      web    10012013           4              2   188982.98      26\n5      web     3002001           5              9   135735.00      21\n6      web     9005004          11              9   164742.95      24\n7      web     8007004          10              8   210845.89      46\n8      web     8007005           3              5    66554.09      17\n9      web     8013005          13              2   106420.06      25\n10     web    10007010           7             10  1855356.81     373\n11     web     9004012          13              9   147050.93      26\n12     web     8004010          12              8   113998.26      20\n13     web    10014013          12              9   123272.67      28\n14     web    10015016           1              1    91878.62      19\n15     web    10010010           1              4   117075.24      24\n16     web     7013004           1              7   561481.96     100\n17     web     9014004           3              9    73420.12      18\n18     web     6015008          16              6    95261.84      20\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) \nGROUP BY channel, i_brand_id, i_class_id, i_category_id /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"_Q_1\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0      web     7016007          16              3   766980.25     133\n1      web    10003002           4              2   108621.30      21\n2      web    10002017           1             10    89164.59      18\n3      web     8013001           3              4    56714.92      20\n4      web     9004004           2              9   551602.26     126\n5      web    10011010           9              8   156353.75      29\n6      web     8007009           7              9   130975.72      27\n7      web     9016011           2              3   143860.65      26\n8      web     6001001           1              5   235160.07      50\n9      web     1002002          15              1  1781438.94     360\n10     web     7005009           5              6   533825.54      99\n11     web     7001006           5              7   252829.64      48\n12     web     1002001           1             10   330446.34      58\n13     web     6005001           9              6   153040.25      24\n14     web    10004011           6             10   242535.33      45\n15     web    10007008           7              8    98137.45      13\n16     web    10003008           4              5   130309.87      30\n17     web    10009008           8              9   157529.16      30\n18     web     6009001           2              2   121141.63      29\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017342,
                    "execution_time": 0.007601,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.003644
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.018214,
                    "execution_time": 0.008013,
                    "compile_time": 5.2e-05,
                    "planning_time": 0.003855
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0      web     7016007          16              3   766980.25     133\n1      web    10003002           4              2   108621.30      21\n2      web    10002017           1             10    89164.59      18\n3      web     8013001           3              4    56714.92      20\n4      web     9004004           2              9   551602.26     126\n5      web    10011010           9              8   156353.75      29\n6      web     8007009           7              9   130975.72      27\n7      web     9016011           2              3   143860.65      26\n8      web     6001001           1              5   235160.07      50\n9      web     1002002          15              1  1781438.94     360\n10     web     7005009           5              6   533825.54      99\n11     web     7001006           5              7   252829.64      48\n12     web     1002001           1             10   330446.34      58\n13     web     6005001           9              6   153040.25      24\n14     web    10004011           6             10   242535.33      45\n15     web    10007008           7              8    98137.45      13\n16     web    10003008           4              5   130309.87      30\n17     web    10009008           8              9   157529.16      30\n18     web     6009001           2              2   121141.63      29\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id) \nGROUP  BY channel, \n          i_brand_id, \n          i_class_id, \n          i_category_id; \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"_Q_1\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_12\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_6\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.639591,
                    "execution_time": 0.430904,
                    "compile_time": 0.00118,
                    "planning_time": 0.081755,
                    "create_size": 630
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 5.242634,
                    "execution_time": 0.451431,
                    "compile_time": 4.469244,
                    "planning_time": 0.191276,
                    "create_size": 630
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_13\" AS SELECT \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_12\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_12\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_12\" AS \"SPEQLITE_TEMP_TABLE_12\" GROUP BY \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.173502,
                    "execution_time": 0.05895,
                    "compile_time": 0.000334,
                    "planning_time": 0.005186,
                    "create_size": 639
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.281039,
                    "execution_time": 0.106354,
                    "compile_time": 0.000334,
                    "planning_time": 0.063543,
                    "create_size": 639
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_13\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_13\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_13\" AS \"SPEQLITE_TEMP_TABLE_13\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0   catalog     6015003          15             10  412624.42      87\n1   catalog    10016001          16              5  174990.14      40\n2   catalog     6009002           4              6  397254.94      78\n3   catalog     1002001           5              9  482403.07     105\n4   catalog     6006002           5              6  171349.96      35\n5   catalog     6013003          13              5  268425.44      52\n6   catalog     9013010          10              9  389377.70      80\n7   catalog     6010005           5              8  236717.85      42\n8   catalog     8014003           4              2  289173.31      49\n9   catalog     1004001           5              9  509668.61      87\n10  catalog    10012010          11             10  218297.92      47\n11  catalog    10014014           4              5  307025.45      53\n12  catalog     9006003           6              9  725052.02     145\n13  catalog     8013002          10              8  269469.28      54\n14  catalog    10004017           1              5  276460.07      49\n15  catalog     2001001          13             10  548879.36      94\n16  catalog    10009006          10             10  259833.08      52\n17  catalog     9016006           9              9  203883.12      40\n18  catalog    10001016           1              5  231583.53      52\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.0178,
                    "execution_time": 0.007448,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.003921
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.053289,
                    "execution_time": 0.007495,
                    "compile_time": 5.4e-05,
                    "planning_time": 0.039214
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_12\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_12\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_12\" AS \"SPEQLITE_TEMP_TABLE_12\" GROUP BY \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_13\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_13\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_13\" AS \"SPEQLITE_TEMP_TABLE_13\""
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0   catalog     6015003          15             10  412624.42      87\n1   catalog    10016001          16              5  174990.14      40\n2   catalog     6009002           4              6  397254.94      78\n3   catalog     1002001           5              9  482403.07     105\n4   catalog     6006002           5              6  171349.96      35\n5   catalog     6013003          13              5  268425.44      52\n6   catalog     9013010          10              9  389377.70      80\n7   catalog     6010005           5              8  236717.85      42\n8   catalog     8014003           4              2  289173.31      49\n9   catalog     1004001           5              9  509668.61      87\n10  catalog    10012010          11             10  218297.92      47\n11  catalog    10014014           4              5  307025.45      53\n12  catalog     9006003           6              9  725052.02     145\n13  catalog     8013002          10              8  269469.28      54\n14  catalog    10004017           1              5  276460.07      49\n15  catalog     2001001          13             10  548879.36      94\n16  catalog    10009006          10             10  259833.08      52\n17  catalog     9016006           9              9  203883.12      40\n18  catalog    10001016           1              5  231583.53      52\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  iss.i_item_sk = ss_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  ics.i_item_sk = cs_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  iws.i_item_sk = ws_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              iss.i_brand_id, \n              iss.i_class_id, \n              iss.i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item iss, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = iss.i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY iss.i_brand_id, \n                 iss.i_class_id, \n                 iss.i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              ics.i_brand_id, \n              ics.i_class_id, \n              ics.i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item ics, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = ics.i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY ics.i_brand_id, \n                 ics.i_class_id, \n                 ics.i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              iws.i_brand_id, \n              iws.i_class_id, \n              iws.i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item iws, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = iws.i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY iws.i_brand_id, \n                 iws.i_class_id, \n                 iws.i_category_id) total_sales \nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ISS\" AS ( SELECT \"ISS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ISS\" ) , \"ICS\" AS ( SELECT \"ICS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ICS\" ) , \"IWS\" AS ( SELECT \"IWS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"IWS\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ISS\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ICS\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"IWS\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"TOTAL_SALES\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ISS\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ISS\".\"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ICS\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ICS\".\"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"IWS\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"IWS\".\"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" ) SELECT \"TOTAL_SALES\".\"CHANNEL\" AS \"CHANNEL\" , \"TOTAL_SALES\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"TOTAL_SALES\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"TOTAL_SALES\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"TOTAL_SALES\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"TOTAL_SALES\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"TOTAL_SALES\" AS \"TOTAL_SALES\" GROUP BY \"TOTAL_SALES\".\"CHANNEL\" , \"TOTAL_SALES\".\"I_BRAND_ID\" , \"TOTAL_SALES\".\"I_CLASS_ID\" , \"TOTAL_SALES\".\"I_CATEGORY_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_14\" AS SELECT \"ISS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ISS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.249122,
                    "execution_time": 0.05327,
                    "compile_time": 0.000266,
                    "planning_time": 0.024973,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.417283,
                    "execution_time": 0.15691,
                    "compile_time": 0.000251,
                    "planning_time": 0.088607,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_15\" AS SELECT \"ICS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ICS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.248811,
                    "execution_time": 0.052575,
                    "compile_time": 0.000268,
                    "planning_time": 0.02539,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.422957,
                    "execution_time": 0.165643,
                    "compile_time": 0.000238,
                    "planning_time": 0.085281,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_16\" AS SELECT \"IWS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"IWS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.257228,
                    "execution_time": 0.058939,
                    "compile_time": 0.000284,
                    "planning_time": 0.026479,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.424155,
                    "execution_time": 0.166389,
                    "compile_time": 0.000242,
                    "planning_time": 0.086861,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_17\" AS SELECT \"SPEQLITE_TEMP_TABLE_14\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"SPEQLITE_TEMP_TABLE_14\" AS \"SPEQLITE_TEMP_TABLE_14\" ON \"SPEQLITE_TEMP_TABLE_14\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"SPEQLITE_TEMP_TABLE_15\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"SPEQLITE_TEMP_TABLE_15\" AS \"SPEQLITE_TEMP_TABLE_15\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_15\".\"I_ITEM_SK\" INTERSECT SELECT \"SPEQLITE_TEMP_TABLE_16\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"SPEQLITE_TEMP_TABLE_16\" AS \"SPEQLITE_TEMP_TABLE_16\" ON \"SPEQLITE_TEMP_TABLE_16\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.589954,
                    "execution_time": 3.465923,
                    "compile_time": 0.000772,
                    "planning_time": 0.071411,
                    "create_size": 144
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 11.310152,
                    "execution_time": 3.65535,
                    "compile_time": 7.406778,
                    "planning_time": 0.190588,
                    "create_size": 144
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_18\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM\" AS \"ITEM\" JOIN \"SPEQLITE_TEMP_TABLE_17\" AS \"SPEQLITE_TEMP_TABLE_17\" ON \"SPEQLITE_TEMP_TABLE_17\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_17\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_17\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.141632,
                    "execution_time": 0.053237,
                    "compile_time": 0.000357,
                    "planning_time": 0.028665,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.364175,
                    "execution_time": 0.097211,
                    "compile_time": 0.115299,
                    "planning_time": 0.091593,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_19\" AS SELECT 'store' AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_18\" AS \"SPEQLITE_TEMP_TABLE_18\" ON \"SPEQLITE_TEMP_TABLE_18\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_14\" AS \"SPEQLITE_TEMP_TABLE_14\" ON \"SPEQLITE_TEMP_TABLE_14\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_18\".\"SS_ITEM_SK\" IS NULL GROUP BY \"SPEQLITE_TEMP_TABLE_14\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_6\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_18\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_15\" AS \"SPEQLITE_TEMP_TABLE_15\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_15\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"SPEQLITE_TEMP_TABLE_15\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_18\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_16\" AS \"SPEQLITE_TEMP_TABLE_16\" ON \"SPEQLITE_TEMP_TABLE_16\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"SPEQLITE_TEMP_TABLE_16\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.667353,
                    "execution_time": 0.45801,
                    "compile_time": 0.001192,
                    "planning_time": 0.082661,
                    "create_size": 630
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.810241,
                    "execution_time": 0.492858,
                    "compile_time": 0.001187,
                    "planning_time": 0.188795,
                    "create_size": 630
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_20\" AS SELECT \"SPEQLITE_TEMP_TABLE_19\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_19\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_19\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_19\" AS \"SPEQLITE_TEMP_TABLE_19\" GROUP BY \"SPEQLITE_TEMP_TABLE_19\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.18139,
                    "execution_time": 0.066941,
                    "compile_time": 0.000325,
                    "planning_time": 0.00487,
                    "create_size": 639
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.350188,
                    "execution_time": 0.179741,
                    "compile_time": 0.000301,
                    "planning_time": 0.061612,
                    "create_size": 639
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_20\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_20\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_20\" AS \"SPEQLITE_TEMP_TABLE_20\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0      web    10009008           3             10  128857.84      28\n1      web     6001001           6              6   95877.73      23\n2      web     6004002           1              6  637476.31     107\n3      web    10002012           4             10  215856.83      43\n4      web     8016005          16              9  368259.35      79\n5      web     6008006          16              6  374569.04      75\n6      web    10007003           6             10   96044.55      18\n7      web     9005009           7              9  116401.31      21\n8      web     8003001           4              2   99167.82      24\n9      web    10012008          12              5  162460.70      28\n10     web     9004004           3              9  399711.27      85\n11     web    10007008           6             10   95262.16      21\n12     web     9003011           1              6  104437.26      24\n13     web     1004001           1              6  325570.24      52\n14     web     9016009           2              1   99512.01      22\n15     web     9014006           3              9  127488.92      29\n16     web     9007003           4              2  424883.94      69\n17     web     9001004           8              9  104424.66      22\n18     web    10007012          16             10  198968.39      33\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017876,
                    "execution_time": 0.007209,
                    "compile_time": 5.3e-05,
                    "planning_time": 0.004073
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.053789,
                    "execution_time": 0.00776,
                    "compile_time": 6.6e-05,
                    "planning_time": 0.039278
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_19\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_19\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_19\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_19\" AS \"SPEQLITE_TEMP_TABLE_19\" GROUP BY \"SPEQLITE_TEMP_TABLE_19\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_20\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_20\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_20\" AS \"SPEQLITE_TEMP_TABLE_20\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0      web    10009008           3             10  128857.84      28\n1      web     6001001           6              6   95877.73      23\n2      web     6004002           1              6  637476.31     107\n3      web    10002012           4             10  215856.83      43\n4      web     8016005          16              9  368259.35      79\n5      web     6008006          16              6  374569.04      75\n6      web    10007003           6             10   96044.55      18\n7      web     9005009           7              9  116401.31      21\n8      web     8003001           4              2   99167.82      24\n9      web    10012008          12              5  162460.70      28\n10     web     9004004           3              9  399711.27      85\n11     web    10007008           6             10   95262.16      21\n12     web     9003011           1              6  104437.26      24\n13     web     1004001           1              6  325570.24      52\n14     web     9016009           2              1   99512.01      22\n15     web     9014006           3              9  127488.92      29\n16     web     9007003           4              2  424883.94      69\n17     web     9001004           8              9  104424.66      22\n18     web    10007012          16             10  198968.39      33\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": " \n\n-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) y \nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"Y\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"Y\".\"CHANNEL\" AS \"CHANNEL\" , \"Y\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"Y\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"Y\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"Y\" AS \"Y\" GROUP BY \"Y\".\"CHANNEL\" , \"Y\".\"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     6001007           2              3    214305.27      45\n1   catalog    10001003           1             10   5497340.60    1062\n2   catalog     2001001           1              6  10546156.95    1987\n3   catalog    10015008          13             10    286460.40      51\n4   catalog     5004001           6              9    890359.14     189\n5     store     9013006          16              9    542737.15     152\n6     store     8014002          13              8    584715.58     175\n7     store     9008003           9              8    353030.68     101\n8     store    10014001          13             10    320224.22      83\n9     store     8007007           7              7    342290.41      97\n10    store     6005005           4              5    350184.21      84\n11    store     7008003           8              2    659926.74     194\n12    store     7009003           8             10    252039.42      75\n13    store    10004008           1             10    381418.58      92\n14    store    10014016          14              8    577699.62     165\n15    store     8008005           1              4    251704.39      76\n16    store     8001009           3              1    291130.85      82\n17    store     9016006           9              9    328655.17      94\n18    store     6016003           8             10    262920.41      82\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017925,
                    "execution_time": 0.007488,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.003852
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.017868,
                    "execution_time": 0.007472,
                    "compile_time": 5e-05,
                    "planning_time": 0.003933
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     6001007           2              3    214305.27      45\n1   catalog    10001003           1             10   5497340.60    1062\n2   catalog     2001001           1              6  10546156.95    1987\n3   catalog    10015008          13             10    286460.40      51\n4   catalog     5004001           6              9    890359.14     189\n5     store     9013006          16              9    542737.15     152\n6     store     8014002          13              8    584715.58     175\n7     store     9008003           9              8    353030.68     101\n8     store    10014001          13             10    320224.22      83\n9     store     8007007           7              7    342290.41      97\n10    store     6005005           4              5    350184.21      84\n11    store     7008003           8              2    659926.74     194\n12    store     7009003           8             10    252039.42      75\n13    store    10004008           1             10    381418.58      92\n14    store    10014016          14              8    577699.62     165\n15    store     8008005           1              4    251704.39      76\n16    store     8001009           3              1    291130.85      82\n17    store     9016006           9              9    328655.17      94\n18    store     6016003           8             10    262920.41      82\n...*/"
    },
    {
        "input": " \n\n-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) y \nGROUP  BY rollup ( channel, i_brand_id, i_class_id, i_category_id ) \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"Y\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"Y\".\"CHANNEL\" AS \"CHANNEL\" , \"Y\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"Y\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"Y\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"Y\" AS \"Y\" GROUP BY ROLLUP ( \"Y\".\"CHANNEL\" , \"Y\".\"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" )"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_21\" AS SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY ROLLUP ( \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.29303,
                    "execution_time": 0.08497,
                    "compile_time": 0.043206,
                    "planning_time": 0.006636,
                    "create_size": 963
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.773007,
                    "execution_time": 0.227428,
                    "compile_time": 3.319784,
                    "planning_time": 0.064202,
                    "create_size": 954
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0   catalog     9015009          13              7  240172.36      48\n1   catalog     7004007           4              1  407775.69      98\n2   catalog     7002009          11              7  265690.40      51\n3   catalog     7007006          10              7  237590.87      36\n4   catalog     9005004          16              9  408676.79      90\n5   catalog     6014008           3              6  205874.71      40\n6   catalog     6003007          16              7  195598.41      33\n7   catalog     8003007           5              7  211344.41      41\n8   catalog     8002003           6              9  213218.15      43\n9   catalog     8011010          14              8  185379.89      45\n10  catalog     9013005           3              6  194722.76      33\n11  catalog     9002011           5              7  220217.80      39\n12  catalog     5003001          16             10  338917.10      55\n13  catalog     7006009           5              6  213561.01      47\n14  catalog     8010003          15              8  163714.77      35\n15  catalog     9004010           6              9  193618.43      51\n16  catalog     9013003           2              1  274206.80      49\n17  catalog     8014007           1              3  382166.52      79\n18  catalog     6003001           2              3  238118.08      44\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.01768,
                    "execution_time": 0.007472,
                    "compile_time": 5e-05,
                    "planning_time": 0.003814
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.054337,
                    "execution_time": 0.008098,
                    "compile_time": 5.2e-05,
                    "planning_time": 0.039011
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY ROLLUP ( \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" )",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\""
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id     _col_4  _col_5\n0   catalog     9015009          13              7  240172.36      48\n1   catalog     7004007           4              1  407775.69      98\n2   catalog     7002009          11              7  265690.40      51\n3   catalog     7007006          10              7  237590.87      36\n4   catalog     9005004          16              9  408676.79      90\n5   catalog     6014008           3              6  205874.71      40\n6   catalog     6003007          16              7  195598.41      33\n7   catalog     8003007           5              7  211344.41      41\n8   catalog     8002003           6              9  213218.15      43\n9   catalog     8011010          14              8  185379.89      45\n10  catalog     9013005           3              6  194722.76      33\n11  catalog     9002011           5              7  220217.80      39\n12  catalog     5003001          16             10  338917.10      55\n13  catalog     7006009           5              6  213561.01      47\n14  catalog     8010003          15              8  163714.77      35\n15  catalog     9004010           6              9  193618.43      51\n16  catalog     9013003           2              1  274206.80      49\n17  catalog     8014007           1              3  382166.52      79\n18  catalog     6003001           2              3  238118.08      44\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": " \n\n-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk AS ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) AS average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store' AS channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog' AS channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web' AS channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) y \nGROUP  BY rollup ( channel, i_brand_id, i_class_id, i_category_id ) \nORDER  BY channel, \n          i_brand_id, \n          i_class_id /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"Y\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"Y\".\"CHANNEL\" AS \"CHANNEL\" , \"Y\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"Y\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"Y\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"Y\" AS \"Y\" GROUP BY ROLLUP ( \"Y\".\"CHANNEL\" , \"Y\".\"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" , \"I_BRAND_ID\" , \"I_CLASS_ID\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id        _col_4  _col_5\n0   catalog     1001001           1            8.0  9.893337e+06    1963\n1   catalog     1001001           1            6.0  1.088270e+07    2092\n2   catalog     1001001           1           10.0  1.245343e+07    2437\n3   catalog     1001001           1            1.0  1.054453e+07    2149\n4   catalog     1001001           1            2.0  1.355738e+07    2624\n5   catalog     1001001           1            NaN  1.069581e+08   21202\n6   catalog     1001001           1            5.0  1.069211e+07    2119\n7   catalog     1001001           1            7.0  9.221299e+06    1870\n8   catalog     1001001           1            4.0  1.167865e+07    2407\n9   catalog     1001001           1            9.0  8.873379e+06    1745\n10  catalog     1001001           1            3.0  9.161305e+06    1796\n11  catalog     1001001           2            NaN  1.322520e+07    2554\n12  catalog     1001001           2            8.0  1.509220e+06     296\n13  catalog     1001001           2            3.0  7.116255e+05     138\n14  catalog     1001001           2            7.0  2.378827e+05      52\n15  catalog     1001001           2            1.0  3.474508e+06     660\n16  catalog     1001001           2            2.0  2.443469e+06     491\n17  catalog     1001001           2            5.0  1.787818e+06     351\n18  catalog     1001001           2           10.0  6.466659e+05     119\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.03741,
                    "execution_time": 0.010989,
                    "compile_time": 0.015449,
                    "planning_time": 0.00427
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.737824,
                    "execution_time": 0.01196,
                    "compile_time": 4.686053,
                    "planning_time": 0.039378
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY ROLLUP ( \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST"
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id        _col_4  _col_5\n0   catalog     1001001           1            8.0  9.893337e+06    1963\n1   catalog     1001001           1            6.0  1.088270e+07    2092\n2   catalog     1001001           1           10.0  1.245343e+07    2437\n3   catalog     1001001           1            1.0  1.054453e+07    2149\n4   catalog     1001001           1            2.0  1.355738e+07    2624\n5   catalog     1001001           1            NaN  1.069581e+08   21202\n6   catalog     1001001           1            5.0  1.069211e+07    2119\n7   catalog     1001001           1            7.0  9.221299e+06    1870\n8   catalog     1001001           1            4.0  1.167865e+07    2407\n9   catalog     1001001           1            9.0  8.873379e+06    1745\n10  catalog     1001001           1            3.0  9.161305e+06    1796\n11  catalog     1001001           2            NaN  1.322520e+07    2554\n12  catalog     1001001           2            8.0  1.509220e+06     296\n13  catalog     1001001           2            3.0  7.116255e+05     138\n14  catalog     1001001           2            7.0  2.378827e+05      52\n15  catalog     1001001           2            1.0  3.474508e+06     660\n16  catalog     1001001           2            2.0  2.443469e+06     491\n17  catalog     1001001           2            5.0  1.787818e+06     351\n18  catalog     1001001           2           10.0  6.466659e+05     119\n...*/"
    },
    {
        "input": " \n\n-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) y \nGROUP  BY rollup ( channel, i_brand_id, i_class_id, i_category_id ) \nORDER  BY channel, \n          i_brand_id, \n          i_class_id, \n          i_category_id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"Y\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"Y\".\"CHANNEL\" AS \"CHANNEL\" , \"Y\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"Y\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"Y\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"Y\" AS \"Y\" GROUP BY ROLLUP ( \"Y\".\"CHANNEL\" , \"Y\".\"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" , \"I_BRAND_ID\" , \"I_CLASS_ID\" , \"I_CATEGORY_ID\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id        _col_4  _col_5\n0   catalog     1001001           1            1.0  1.054453e+07    2149\n1   catalog     1001001           1            2.0  1.355738e+07    2624\n2   catalog     1001001           1            3.0  9.161305e+06    1796\n3   catalog     1001001           1            4.0  1.167865e+07    2407\n4   catalog     1001001           1            5.0  1.069211e+07    2119\n5   catalog     1001001           1            6.0  1.088270e+07    2092\n6   catalog     1001001           1            7.0  9.221299e+06    1870\n7   catalog     1001001           1            8.0  9.893337e+06    1963\n8   catalog     1001001           1            9.0  8.873379e+06    1745\n9   catalog     1001001           1           10.0  1.245343e+07    2437\n10  catalog     1001001           1            NaN  1.069581e+08   21202\n11  catalog     1001001           2            1.0  3.474508e+06     660\n12  catalog     1001001           2            2.0  2.443469e+06     491\n13  catalog     1001001           2            3.0  7.116255e+05     138\n14  catalog     1001001           2            4.0  1.864973e+06     348\n15  catalog     1001001           2            5.0  1.787818e+06     351\n16  catalog     1001001           2            6.0  3.303527e+05      55\n17  catalog     1001001           2            7.0  2.378827e+05      52\n18  catalog     1001001           2            8.0  1.509220e+06     296\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.020057,
                    "execution_time": 0.009425,
                    "compile_time": 7.4e-05,
                    "planning_time": 0.004215
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.138544,
                    "execution_time": 0.009755,
                    "compile_time": 0.082903,
                    "planning_time": 0.039279
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY ROLLUP ( \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST"
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id        _col_4  _col_5\n0   catalog     1001001           1            1.0  1.054453e+07    2149\n1   catalog     1001001           1            2.0  1.355738e+07    2624\n2   catalog     1001001           1            3.0  9.161305e+06    1796\n3   catalog     1001001           1            4.0  1.167865e+07    2407\n4   catalog     1001001           1            5.0  1.069211e+07    2119\n5   catalog     1001001           1            6.0  1.088270e+07    2092\n6   catalog     1001001           1            7.0  9.221299e+06    1870\n7   catalog     1001001           1            8.0  9.893337e+06    1963\n8   catalog     1001001           1            9.0  8.873379e+06    1745\n9   catalog     1001001           1           10.0  1.245343e+07    2437\n10  catalog     1001001           1            NaN  1.069581e+08   21202\n11  catalog     1001001           2            1.0  3.474508e+06     660\n12  catalog     1001001           2            2.0  2.443469e+06     491\n13  catalog     1001001           2            3.0  7.116255e+05     138\n14  catalog     1001001           2            4.0  1.864973e+06     348\n15  catalog     1001001           2            5.0  1.787818e+06     351\n16  catalog     1001001           2            6.0  3.303527e+05      55\n17  catalog     1001001           2            7.0  2.378827e+05      52\n18  catalog     1001001           2            8.0  1.509220e+06     296\n...*/"
    },
    {
        "input": " \n\n-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) y \nGROUP  BY rollup ( channel, i_brand_id, i_class_id, i_category_id ) \nORDER  BY channel, \n          i_brand_id, \n          i_class_id, \n          i_category_id\nLIMIT 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"Y\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"Y\".\"CHANNEL\" AS \"CHANNEL\" , \"Y\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"Y\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"Y\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"Y\" AS \"Y\" GROUP BY ROLLUP ( \"Y\".\"CHANNEL\" , \"Y\".\"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" , \"I_BRAND_ID\" , \"I_CLASS_ID\" , \"I_CATEGORY_ID\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id        _col_4  _col_5\n0   catalog     1001001           1            1.0  1.054453e+07    2149\n1   catalog     1001001           1            2.0  1.355738e+07    2624\n2   catalog     1001001           1            3.0  9.161305e+06    1796\n3   catalog     1001001           1            4.0  1.167865e+07    2407\n4   catalog     1001001           1            5.0  1.069211e+07    2119\n5   catalog     1001001           1            6.0  1.088270e+07    2092\n6   catalog     1001001           1            7.0  9.221299e+06    1870\n7   catalog     1001001           1            8.0  9.893337e+06    1963\n8   catalog     1001001           1            9.0  8.873379e+06    1745\n9   catalog     1001001           1           10.0  1.245343e+07    2437\n10  catalog     1001001           1            NaN  1.069581e+08   21202\n11  catalog     1001001           2            1.0  3.474508e+06     660\n12  catalog     1001001           2            2.0  2.443469e+06     491\n13  catalog     1001001           2            3.0  7.116255e+05     138\n14  catalog     1001001           2            4.0  1.864973e+06     348\n15  catalog     1001001           2            5.0  1.787818e+06     351\n16  catalog     1001001           2            6.0  3.303527e+05      55\n17  catalog     1001001           2            7.0  2.378827e+05      52\n18  catalog     1001001           2            8.0  1.509220e+06     296\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.01962,
                    "execution_time": 0.009226,
                    "compile_time": 7.2e-05,
                    "planning_time": 0.004211
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.020841,
                    "execution_time": 0.009952,
                    "compile_time": 7.7e-05,
                    "planning_time": 0.004325
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY ROLLUP ( \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST LIMIT 100",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST LIMIT 100"
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id        _col_4  _col_5\n0   catalog     1001001           1            1.0  1.054453e+07    2149\n1   catalog     1001001           1            2.0  1.355738e+07    2624\n2   catalog     1001001           1            3.0  9.161305e+06    1796\n3   catalog     1001001           1            4.0  1.167865e+07    2407\n4   catalog     1001001           1            5.0  1.069211e+07    2119\n5   catalog     1001001           1            6.0  1.088270e+07    2092\n6   catalog     1001001           1            7.0  9.221299e+06    1870\n7   catalog     1001001           1            8.0  9.893337e+06    1963\n8   catalog     1001001           1            9.0  8.873379e+06    1745\n9   catalog     1001001           1           10.0  1.245343e+07    2437\n10  catalog     1001001           1            NaN  1.069581e+08   21202\n11  catalog     1001001           2            1.0  3.474508e+06     660\n12  catalog     1001001           2            2.0  2.443469e+06     491\n13  catalog     1001001           2            3.0  7.116255e+05     138\n14  catalog     1001001           2            4.0  1.864973e+06     348\n15  catalog     1001001           2            5.0  1.787818e+06     351\n16  catalog     1001001           2            6.0  3.303527e+05      55\n17  catalog     1001001           2            7.0  2.378827e+05      52\n18  catalog     1001001           2            8.0  1.509220e+06     296\n...*/"
    }
]