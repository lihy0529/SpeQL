[
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n/*CURSOR_IDENTIFIER*/\n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales) \n) previous_year ",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"PREVIOUS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_4\" CROSS JOIN \"DATE_DIM\" AS \"DATE_DIM\" CROSS JOIN \"ITEM\" AS \"ITEM\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_4\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"PREVIOUS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"PREVIOUS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"PREVIOUS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"PREVIOUS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"PREVIOUS_YEAR\".\"SALES\" AS \"SALES\" , \"PREVIOUS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" CROSS JOIN \"PREVIOUS_YEAR\" AS \"PREVIOUS_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.350203,
                    "execution_time": 0.052604,
                    "compile_time": 0.105044,
                    "planning_time": 0.021822,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 4.90943,
                    "execution_time": 1.276515,
                    "compile_time": 3.434092,
                    "planning_time": 0.021972,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.967811,
                    "execution_time": 3.837825,
                    "compile_time": 0.000751,
                    "planning_time": 0.077943,
                    "create_size": 144
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 22.680275,
                    "execution_time": 5.0415,
                    "compile_time": 17.50614,
                    "planning_time": 0.076691,
                    "create_size": 144
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.10894,
                    "execution_time": 0.031819,
                    "compile_time": 0.030278,
                    "planning_time": 0.023287,
                    "create_size": 20
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.332099,
                    "execution_time": 0.032461,
                    "compile_time": 3.190354,
                    "planning_time": 0.083499,
                    "create_size": 20
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 4.648968,
                    "execution_time": 4.407588,
                    "compile_time": 0.000515,
                    "planning_time": 0.043138,
                    "create_size": 4352
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 11.912767,
                    "execution_time": 8.269708,
                    "compile_time": 3.298836,
                    "planning_time": 0.138877,
                    "create_size": 4352
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT AVG ( \"SPEQLITE_TEMP_TABLE_2\".\"QUANTITY\" * \"SPEQLITE_TEMP_TABLE_2\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.254882,
                    "execution_time": 0.225907,
                    "compile_time": 0.000286,
                    "planning_time": 0.003591,
                    "create_size": 4
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.312378,
                    "execution_time": 0.2254,
                    "compile_time": 0.001249,
                    "planning_time": 0.059179,
                    "create_size": 4
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.061384,
                    "execution_time": 0.035604,
                    "compile_time": 0.000223,
                    "planning_time": 0.002815,
                    "create_size": 4
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.115929,
                    "execution_time": 0.034943,
                    "compile_time": 0.000227,
                    "planning_time": 0.057315,
                    "create_size": 4
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"ITEM\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_2\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_2\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_2\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.201077,
                    "execution_time": 0.077267,
                    "compile_time": 0.061036,
                    "planning_time": 0.005865,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.834338,
                    "execution_time": 0.079894,
                    "compile_time": 6.629355,
                    "planning_time": 0.06117,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"SPEQLITE_TEMP_TABLE_3\".\"D_WEEK_SEQ\" AND \"SPEQLITE_TEMP_TABLE_3\".\"D_DOM\" = 25 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = 12 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = 2000 WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_6\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.414213,
                    "execution_time": 0.253036,
                    "compile_time": 0.070727,
                    "planning_time": 0.048414,
                    "create_size": 153
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 10.242604,
                    "execution_time": 0.255991,
                    "compile_time": 9.820549,
                    "planning_time": 0.117036,
                    "create_size": 153
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_4\" CROSS JOIN \"DATE_DIM\" AS \"DATE_DIM\" CROSS JOIN \"ITEM\" AS \"ITEM\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_4\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH PREVIOUS_YEAR AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_4\" CROSS JOIN \"DATE_DIM\" AS \"DATE_DIM\" CROSS JOIN \"ITEM\" AS \"ITEM\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_4\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"SPEQLITE_TEMP_TABLE_8\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"PREVIOUS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"PREVIOUS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"PREVIOUS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"PREVIOUS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"PREVIOUS_YEAR\".\"SALES\" AS \"SALES\" , \"PREVIOUS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" CROSS JOIN \"PREVIOUS_YEAR\" AS \"PREVIOUS_YEAR\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH PREVIOUS_YEAR AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_4\" CROSS JOIN \"DATE_DIM\" AS \"DATE_DIM\" CROSS JOIN \"ITEM\" AS \"ITEM\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_4\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"SPEQLITE_TEMP_TABLE_8\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"PREVIOUS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"PREVIOUS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"PREVIOUS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"PREVIOUS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"PREVIOUS_YEAR\".\"SALES\" AS \"SALES\" , \"PREVIOUS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" CROSS JOIN \"PREVIOUS_YEAR\" AS \"PREVIOUS_YEAR\"",
                "rewrite": "WITH PREVIOUS_YEAR AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_4\" CROSS JOIN \"DATE_DIM\" AS \"DATE_DIM\" CROSS JOIN \"ITEM\" AS \"ITEM\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_4\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"SPEQLITE_TEMP_TABLE_8\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"PREVIOUS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"PREVIOUS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"PREVIOUS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"PREVIOUS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"PREVIOUS_YEAR\".\"SALES\" AS \"SALES\" , \"PREVIOUS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" CROSS JOIN \"PREVIOUS_YEAR\" AS \"PREVIOUS_YEAR\""
            }
        ],
        "preview": null
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n/*CURSOR_IDENTIFIER*/\n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales) \n) previous_year \n",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"PREVIOUS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_4\" CROSS JOIN \"DATE_DIM\" AS \"DATE_DIM\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_4\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"PREVIOUS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"PREVIOUS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"PREVIOUS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"PREVIOUS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"PREVIOUS_YEAR\".\"SALES\" AS \"SALES\" , \"PREVIOUS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" CROSS JOIN \"PREVIOUS_YEAR\" AS \"PREVIOUS_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_4\" CROSS JOIN \"DATE_DIM\" AS \"DATE_DIM\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_4\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH PREVIOUS_YEAR AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_4\" CROSS JOIN \"DATE_DIM\" AS \"DATE_DIM\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_4\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"SPEQLITE_TEMP_TABLE_8\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"PREVIOUS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"PREVIOUS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"PREVIOUS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"PREVIOUS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"PREVIOUS_YEAR\".\"SALES\" AS \"SALES\" , \"PREVIOUS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" CROSS JOIN \"PREVIOUS_YEAR\" AS \"PREVIOUS_YEAR\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH PREVIOUS_YEAR AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_4\" CROSS JOIN \"DATE_DIM\" AS \"DATE_DIM\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_4\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"SPEQLITE_TEMP_TABLE_8\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"PREVIOUS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"PREVIOUS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"PREVIOUS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"PREVIOUS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"PREVIOUS_YEAR\".\"SALES\" AS \"SALES\" , \"PREVIOUS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" CROSS JOIN \"PREVIOUS_YEAR\" AS \"PREVIOUS_YEAR\"",
                "rewrite": "WITH PREVIOUS_YEAR AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_4\" CROSS JOIN \"DATE_DIM\" AS \"DATE_DIM\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_4\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"SPEQLITE_TEMP_TABLE_8\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_8\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"PREVIOUS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"PREVIOUS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"PREVIOUS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"PREVIOUS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"PREVIOUS_YEAR\".\"SALES\" AS \"SALES\" , \"PREVIOUS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" CROSS JOIN \"PREVIOUS_YEAR\" AS \"PREVIOUS_YEAR\""
            }
        ],
        "preview": null
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"_U_1\" AS ( SELECT \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DOM\" = 25 AND \"DATE_DIM\".\"D_MOY\" = 12 AND \"DATE_DIM\".\"D_YEAR\" = 2000 ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"AVG_SALES\" AS \"AVG_SALES\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"AVG_SALES\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"_Q_0\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"_U_1\" AS \"_U_4\" ON \"_U_4\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_0\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_0\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" CROSS JOIN \"_Q_0\" AS \"_Q_0\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 5.893903,
                    "execution_time": 5.592351,
                    "compile_time": 0.000255,
                    "planning_time": 0.022156,
                    "create_size": 6528
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 9.66446,
                    "execution_time": 5.523532,
                    "compile_time": 3.770804,
                    "planning_time": 0.08275,
                    "create_size": 6528
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_10\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.101108,
                    "execution_time": 0.03921,
                    "compile_time": 0.000222,
                    "planning_time": 0.022963,
                    "create_size": 480
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.163635,
                    "execution_time": 0.040171,
                    "compile_time": 0.000228,
                    "planning_time": 0.083383,
                    "create_size": 480
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_11\" AS SELECT \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DOM\" = 25 AND \"DATE_DIM\".\"D_MOY\" = 12",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.106104,
                    "execution_time": 0.031219,
                    "compile_time": 0.029223,
                    "planning_time": 0.023317,
                    "create_size": 8
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.282963,
                    "execution_time": 0.032561,
                    "compile_time": 3.142338,
                    "planning_time": 0.082567,
                    "create_size": 8
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_12\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_11\" AS \"SPEQLITE_TEMP_TABLE_11\" ON \"SPEQLITE_TEMP_TABLE_11\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.74051,
                    "execution_time": 0.663193,
                    "compile_time": 0.000602,
                    "planning_time": 0.014763,
                    "create_size": 216
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 11.387845,
                    "execution_time": 0.7064,
                    "compile_time": 10.590804,
                    "planning_time": 0.071484,
                    "create_size": 216
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_13\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_11\" AS \"_U_4\" ON \"_U_4\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.63944,
                    "execution_time": 0.567058,
                    "compile_time": 0.000516,
                    "planning_time": 0.012006,
                    "create_size": 216
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 8.122337,
                    "execution_time": 0.568256,
                    "compile_time": 7.420005,
                    "planning_time": 0.067603,
                    "create_size": 216
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_14\" AS SELECT \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_12\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_13\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_13\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_13\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_12\" AS \"SPEQLITE_TEMP_TABLE_12\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_13\" AS \"SPEQLITE_TEMP_TABLE_13\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_12\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_13\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_13\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_13\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_12\" AS \"SPEQLITE_TEMP_TABLE_12\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_13\" AS \"SPEQLITE_TEMP_TABLE_13\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     4003002          14              4  1972836.75           559         store           6012001                13                   10     324411.92                   88\n1    store     4003002          14              4  1972836.75           559         store           8001009                 3                    8     316985.39                   95\n2    store     4003002          14              4  1972836.75           559         store           4001001                 1                    9    8696018.14                 2386\n3    store     4003002          14              4  1972836.75           559         store           1003001                 3                    2   10425680.46                 2904\n4    store     4003002          14              4  1972836.75           559         store           1003001                 2                    2    2498849.81                  674\n5    store     4003002          14              4  1972836.75           559         store           6003006                 4                    6     614046.00                  166\n6    store     4003002          14              4  1972836.75           559         store           3002001                12                    7     449686.23                  123\n7    store     4003002          14              4  1972836.75           559         store           8015006                16                    8     408876.87                  106\n8    store     4003002          14              4  1972836.75           559         store           8009001                 9                   10     272579.36                   73\n9    store     4003002          14              4  1972836.75           559         store           6002003                 2                    5     346204.48                   95\n10   store     4003002          14              4  1972836.75           559         store           8012009                12                    3     847258.42                  225\n11   store     4003002          14              4  1972836.75           559         store           4004002                10                    4    2264350.20                  627\n12   store     4003002          14              4  1972836.75           559         store           9005003                 5                    4     751921.25                  220\n13   store     4003002          14              4  1972836.75           559         store           3002001                11                    6     649841.36                  173\n14   store     4003002          14              4  1972836.75           559         store          10004017                 4                    3     315172.69                   65\n15   store     4003002          14              4  1972836.75           559         store           8009001                 7                    8     283136.08                   92\n16   store     4003002          14              4  1972836.75           559         store           5004001                 6                    7     785848.81                  216\n17   store     4003002          14              4  1972836.75           559         store          10009014                 4                    4     161953.69                   41\n18   store     4003002          14              4  1972836.75           559         store           3002001                 7                    7     437304.00                  123\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.058077,
                    "execution_time": 0.016038,
                    "compile_time": 0.035471,
                    "planning_time": 0.005893
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.155803,
                    "execution_time": 0.02219,
                    "compile_time": 3.094295,
                    "planning_time": 0.041945
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_12\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_13\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_13\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_12\" AS \"SPEQLITE_TEMP_TABLE_12\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_13\" AS \"SPEQLITE_TEMP_TABLE_13\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_12\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_13\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_13\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_13\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_12\" AS \"SPEQLITE_TEMP_TABLE_12\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_13\" AS \"SPEQLITE_TEMP_TABLE_13\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     4003002          14              4  1972836.75           559         store           6012001                13                   10     324411.92                   88\n1    store     4003002          14              4  1972836.75           559         store           8001009                 3                    8     316985.39                   95\n2    store     4003002          14              4  1972836.75           559         store           4001001                 1                    9    8696018.14                 2386\n3    store     4003002          14              4  1972836.75           559         store           1003001                 3                    2   10425680.46                 2904\n4    store     4003002          14              4  1972836.75           559         store           1003001                 2                    2    2498849.81                  674\n5    store     4003002          14              4  1972836.75           559         store           6003006                 4                    6     614046.00                  166\n6    store     4003002          14              4  1972836.75           559         store           3002001                12                    7     449686.23                  123\n7    store     4003002          14              4  1972836.75           559         store           8015006                16                    8     408876.87                  106\n8    store     4003002          14              4  1972836.75           559         store           8009001                 9                   10     272579.36                   73\n9    store     4003002          14              4  1972836.75           559         store           6002003                 2                    5     346204.48                   95\n10   store     4003002          14              4  1972836.75           559         store           8012009                12                    3     847258.42                  225\n11   store     4003002          14              4  1972836.75           559         store           4004002                10                    4    2264350.20                  627\n12   store     4003002          14              4  1972836.75           559         store           9005003                 5                    4     751921.25                  220\n13   store     4003002          14              4  1972836.75           559         store           3002001                11                    6     649841.36                  173\n14   store     4003002          14              4  1972836.75           559         store          10004017                 4                    3     315172.69                   65\n15   store     4003002          14              4  1972836.75           559         store           8009001                 7                    8     283136.08                   92\n16   store     4003002          14              4  1972836.75           559         store           5004001                 6                    7     785848.81                  216\n17   store     4003002          14              4  1972836.75           559         store          10009014                 4                    4     161953.69                   41\n18   store     4003002          14              4  1972836.75           559         store           3002001                 7                    7     437304.00                  123\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales))/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"_U_1\" AS ( SELECT \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DOM\" = 25 AND \"DATE_DIM\".\"D_MOY\" = 12 AND \"DATE_DIM\".\"D_YEAR\" = 2000 ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"_Q_0\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"_U_1\" AS \"_U_4\" ON \"_U_4\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_0\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_0\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" CROSS JOIN \"_Q_0\" AS \"_Q_0\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_14\" AS SELECT \"SPEQLITE_TEMP_TABLE_11\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"SPEQLITE_TEMP_TABLE_11\" AS \"SPEQLITE_TEMP_TABLE_11\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.060583,
                    "execution_time": 0.035129,
                    "compile_time": 0.000224,
                    "planning_time": 0.002635,
                    "create_size": 8
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.117975,
                    "execution_time": 0.035119,
                    "compile_time": 0.000226,
                    "planning_time": 0.058798,
                    "create_size": 8
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_15\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_14\" AS \"SPEQLITE_TEMP_TABLE_14\" ON \"SPEQLITE_TEMP_TABLE_14\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_6\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.746134,
                    "execution_time": 0.668327,
                    "compile_time": 0.000623,
                    "planning_time": 0.014741,
                    "create_size": 216
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 2.347236,
                    "execution_time": 2.214426,
                    "compile_time": 0.000595,
                    "planning_time": 0.070722,
                    "create_size": 216
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_16\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_14\" AS \"_U_4\" ON \"_U_4\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.738962,
                    "execution_time": 0.661666,
                    "compile_time": 0.00059,
                    "planning_time": 0.014746,
                    "create_size": 216
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.812599,
                    "execution_time": 0.668714,
                    "compile_time": 0.000591,
                    "planning_time": 0.07021,
                    "create_size": 216
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_17\" AS SELECT \"SPEQLITE_TEMP_TABLE_15\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_15\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_16\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_16\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_16\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_15\" AS \"SPEQLITE_TEMP_TABLE_15\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_16\" AS \"SPEQLITE_TEMP_TABLE_16\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_15\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_15\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_16\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_16\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_16\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_15\" AS \"SPEQLITE_TEMP_TABLE_15\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_16\" AS \"SPEQLITE_TEMP_TABLE_16\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     5003001           3             10  6809651.69          1842         store          10004006                 4                   10  8.867079e+06                 2371\n1    store     5003001           3             10  6809651.69          1842         store           4002001                 2                    4  3.414961e+08                92966\n2    store     5003001           3             10  6809651.69          1842         store           1002002                 3                    1  1.147646e+07                 3035\n3    store     5003001           3             10  6809651.69          1842         store           2003001                 3                    2  3.397530e+08                91879\n4    store     5003001           3             10  6809651.69          1842         store           9006002                 6                    9  4.137100e+07                11174\n5    store     5003001           3             10  6809651.69          1842         store           5002001                 2                    5  3.553483e+08                96354\n6    store     5003001           3             10  6809651.69          1842         store          10012003                12                   10  1.455085e+07                 4016\n7    store     5003001           3             10  6809651.69          1842         store           7002003                 2                    1  1.772939e+05                   49\n8    store     5003001           3             10  6809651.69          1842         store           8016003                16                    8  1.930820e+07                 5195\n9    store     5003001           3             10  6809651.69          1842         store           9003005                 3                    5  6.452250e+05                  166\n10   store     5003001           3             10  6809651.69          1842         store           6016007                16                    6  2.021296e+07                 5494\n11   store     5003001           3             10  6809651.69          1842         store           8006002                 3                    8  7.658136e+05                  210\n12   store     5003001           3             10  6809651.69          1842         store           9005012                 5                    9  3.930772e+06                 1083\n13   store     5003001           3             10  6809651.69          1842         store           6009008                 9                    6  2.232327e+07                 6001\n14   store     5003001           3             10  6809651.69          1842         store           8006010                 6                    8  1.928960e+07                 5079\n15   store     5003001           3             10  6809651.69          1842         store           5003001                 3                    4  6.828719e+06                 1787\n16   store     5003001           3             10  6809651.69          1842         store           6004003                 4                    6  2.254325e+07                 6008\n17   store     5003001           3             10  6809651.69          1842         store           7007006                 7                    7  1.591821e+07                 4288\n18   store     5003001           3             10  6809651.69          1842         store          10010015                 4                    4  1.787138e+05                   48\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.029822,
                    "execution_time": 0.015795,
                    "compile_time": 9.6e-05,
                    "planning_time": 0.006109
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.142986,
                    "execution_time": 0.024166,
                    "compile_time": 0.08415,
                    "planning_time": 0.041899
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_15\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_15\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_16\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_16\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_15\" AS \"SPEQLITE_TEMP_TABLE_15\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_16\" AS \"SPEQLITE_TEMP_TABLE_16\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_15\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_15\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_16\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_16\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_16\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_15\" AS \"SPEQLITE_TEMP_TABLE_15\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_16\" AS \"SPEQLITE_TEMP_TABLE_16\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     5003001           3             10  6809651.69          1842         store          10004006                 4                   10  8.867079e+06                 2371\n1    store     5003001           3             10  6809651.69          1842         store           4002001                 2                    4  3.414961e+08                92966\n2    store     5003001           3             10  6809651.69          1842         store           1002002                 3                    1  1.147646e+07                 3035\n3    store     5003001           3             10  6809651.69          1842         store           2003001                 3                    2  3.397530e+08                91879\n4    store     5003001           3             10  6809651.69          1842         store           9006002                 6                    9  4.137100e+07                11174\n5    store     5003001           3             10  6809651.69          1842         store           5002001                 2                    5  3.553483e+08                96354\n6    store     5003001           3             10  6809651.69          1842         store          10012003                12                   10  1.455085e+07                 4016\n7    store     5003001           3             10  6809651.69          1842         store           7002003                 2                    1  1.772939e+05                   49\n8    store     5003001           3             10  6809651.69          1842         store           8016003                16                    8  1.930820e+07                 5195\n9    store     5003001           3             10  6809651.69          1842         store           9003005                 3                    5  6.452250e+05                  166\n10   store     5003001           3             10  6809651.69          1842         store           6016007                16                    6  2.021296e+07                 5494\n11   store     5003001           3             10  6809651.69          1842         store           8006002                 3                    8  7.658136e+05                  210\n12   store     5003001           3             10  6809651.69          1842         store           9005012                 5                    9  3.930772e+06                 1083\n13   store     5003001           3             10  6809651.69          1842         store           6009008                 9                    6  2.232327e+07                 6001\n14   store     5003001           3             10  6809651.69          1842         store           8006010                 6                    8  1.928960e+07                 5079\n15   store     5003001           3             10  6809651.69          1842         store           5003001                 3                    4  6.828719e+06                 1787\n16   store     5003001           3             10  6809651.69          1842         store           6004003                 4                    6  2.254325e+07                 6008\n17   store     5003001           3             10  6809651.69          1842         store           7007006                 7                    7  1.591821e+07                 4288\n18   store     5003001           3             10  6809651.69          1842         store          10010015                 4                    4  1.787138e+05                   48\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               iss.i_brand_id, \n               iss.i_class_id, \n               iss.i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item iss, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = iss.i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY iss.i_brand_id, \n                  iss.i_class_id, \n                  iss.i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               iss.i_brand_id, \n               iss.i_class_id, \n               iss.i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item iss, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = iss.i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1998 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY iss.i_brand_id, \n                  iss.i_class_id, \n                  iss.i_category_id) previous_year\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ISS\" AS ( SELECT \"ISS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ISS\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ISS\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"AVG_SALES\" AS \"AVG_SALES\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ISS\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ISS\".\"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" HAVING MAX ( \"AVG_SALES\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"PREVIOUS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ISS\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1998 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ISS\".\"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"PREVIOUS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"PREVIOUS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"PREVIOUS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"PREVIOUS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"PREVIOUS_YEAR\".\"SALES\" AS \"SALES\" , \"PREVIOUS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" CROSS JOIN \"PREVIOUS_YEAR\" AS \"PREVIOUS_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_17\" AS SELECT \"ISS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ISS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.245463,
                    "execution_time": 0.053472,
                    "compile_time": 0.000236,
                    "planning_time": 0.022189,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.312949,
                    "execution_time": 0.053761,
                    "compile_time": 0.000277,
                    "planning_time": 0.087501,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_18\" AS SELECT \"SPEQLITE_TEMP_TABLE_17\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"SPEQLITE_TEMP_TABLE_17\" AS \"SPEQLITE_TEMP_TABLE_17\" ON \"SPEQLITE_TEMP_TABLE_17\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.972505,
                    "execution_time": 3.844972,
                    "compile_time": 0.00077,
                    "planning_time": 0.074544,
                    "create_size": 144
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 7.803712,
                    "execution_time": 4.029232,
                    "compile_time": 3.683867,
                    "planning_time": 0.180329,
                    "create_size": 144
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_19\" AS SELECT AVG ( \"SPEQLITE_TEMP_TABLE_18\".\"QUANTITY\" * \"SPEQLITE_TEMP_TABLE_18\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_18\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.255335,
                    "execution_time": 0.22603,
                    "compile_time": 0.000287,
                    "planning_time": 0.003528,
                    "create_size": 4
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 2.096938,
                    "execution_time": 2.010331,
                    "compile_time": 0.000304,
                    "planning_time": 0.060742,
                    "create_size": 4
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_20\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM\" AS \"ITEM\" JOIN \"SPEQLITE_TEMP_TABLE_18\" AS \"SPEQLITE_TEMP_TABLE_18\" ON \"ITEM\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_18\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_18\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_18\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.205306,
                    "execution_time": 0.067338,
                    "compile_time": 0.055535,
                    "planning_time": 0.025594,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.292925,
                    "execution_time": 0.07181,
                    "compile_time": 6.071641,
                    "planning_time": 0.085479,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_21\" AS SELECT 'store' AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_19\" AS \"SPEQLITE_TEMP_TABLE_19\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_20\" AS \"SPEQLITE_TEMP_TABLE_20\" ON \"SPEQLITE_TEMP_TABLE_20\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_17\" AS \"SPEQLITE_TEMP_TABLE_17\" ON \"SPEQLITE_TEMP_TABLE_17\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"SPEQLITE_TEMP_TABLE_3\".\"D_WEEK_SEQ\" AND \"SPEQLITE_TEMP_TABLE_3\".\"D_DOM\" = 25 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = 12 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = 2000 WHERE NOT \"SPEQLITE_TEMP_TABLE_20\".\"SS_ITEM_SK\" IS NULL GROUP BY \"SPEQLITE_TEMP_TABLE_17\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_19\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.403665,
                    "execution_time": 0.312267,
                    "compile_time": 0.000603,
                    "planning_time": 0.037594,
                    "create_size": 153
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 10.308228,
                    "execution_time": 0.404439,
                    "compile_time": 9.751535,
                    "planning_time": 0.097251,
                    "create_size": 153
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_22\" AS SELECT 'store' AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_20\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_17\" AS \"SPEQLITE_TEMP_TABLE_17\" ON \"SPEQLITE_TEMP_TABLE_17\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"SPEQLITE_TEMP_TABLE_3\".\"D_WEEK_SEQ\" AND \"SPEQLITE_TEMP_TABLE_3\".\"D_DOM\" = 25 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = 12 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = 1998 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"SPEQLITE_TEMP_TABLE_17\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.460457,
                    "execution_time": 0.388101,
                    "compile_time": 0.000544,
                    "planning_time": 0.033578,
                    "create_size": 18
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.795156,
                    "execution_time": 0.391278,
                    "compile_time": 6.266458,
                    "planning_time": 0.093283,
                    "create_size": 18
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_23\" AS SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_21\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_22\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_22\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_22\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_22\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_22\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_22\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_22\" AS \"SPEQLITE_TEMP_TABLE_22\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.968522,
                    "execution_time": 1.168943,
                    "compile_time": 0.123677,
                    "planning_time": 0.005897,
                    "create_size": 2176
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 9.134017,
                    "execution_time": 2.061806,
                    "compile_time": 6.325723,
                    "planning_time": 0.061884,
                    "create_size": 2176
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_23\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_23\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_23\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_23\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_23\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_23\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_23\" AS \"SPEQLITE_TEMP_TABLE_23\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     9005003           5              9  8486016.56          2361         store           9014011                14                    9    8183993.78                 2142\n1    store     9005003           5              9  8486016.56          2361         store          10015003                15                   10    3115540.18                  845\n2    store     9005003           5              9  8486016.56          2361         store          10008003                 8                   10    3288192.53                  879\n3    store     9005003           5              9  8486016.56          2361         store           8001009                 1                    8    7755394.46                 2077\n4    store     9005003           5              9  8486016.56          2361         store          10003015                 3                   10    3300528.63                  904\n5    store     9005003           5              9  8486016.56          2361         store           6006007                 6                    6    8076011.00                 2218\n6    store     9005003           5              9  8486016.56          2361         store          10002017                 2                   10    2290737.69                  620\n7    store     9005003           5              9  8486016.56          2361         store          10013017                13                   10    3049869.51                  825\n8    store     9005003           5              9  8486016.56          2361         store           7009007                 9                    7    6591517.11                 1780\n9    store     9005003           5              9  8486016.56          2361         store           8012003                12                    8    7395278.86                 1961\n10   store     9005003           5              9  8486016.56          2361         store           6006001                 6                    6    8541543.80                 2354\n11   store     9005003           5              9  8486016.56          2361         store           8014007                14                    8    6664821.20                 1746\n12   store     9005003           5              9  8486016.56          2361         store          10002010                 2                   10    3645378.30                  959\n13   store     9005003           5              9  8486016.56          2361         store           7005002                 5                    7    2969826.48                  802\n14   store     9005003           5              9  8486016.56          2361         store           8012002                12                    8    3929216.82                 1048\n15   store     9005003           5              9  8486016.56          2361         store           6002008                 2                    6    4053287.19                 1147\n16   store     9005003           5              9  8486016.56          2361         store          10009014                 9                   10    2718301.40                  789\n17   store     9005003           5              9  8486016.56          2361         store           8013004                13                    8    3732626.59                 1027\n18   store     9005003           5              9  8486016.56          2361         store          10002001                 2                   10    2886263.78                  771\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.019318,
                    "execution_time": 0.007839,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.004746
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.0573,
                    "execution_time": 0.00868,
                    "compile_time": 0.000998,
                    "planning_time": 0.040297
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_21\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_22\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_22\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_22\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_22\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_22\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_22\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_22\" AS \"SPEQLITE_TEMP_TABLE_22\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_23\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_23\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_23\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_23\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_23\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_23\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_23\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_23\" AS \"SPEQLITE_TEMP_TABLE_23\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     9005003           5              9  8486016.56          2361         store           9014011                14                    9    8183993.78                 2142\n1    store     9005003           5              9  8486016.56          2361         store          10015003                15                   10    3115540.18                  845\n2    store     9005003           5              9  8486016.56          2361         store          10008003                 8                   10    3288192.53                  879\n3    store     9005003           5              9  8486016.56          2361         store           8001009                 1                    8    7755394.46                 2077\n4    store     9005003           5              9  8486016.56          2361         store          10003015                 3                   10    3300528.63                  904\n5    store     9005003           5              9  8486016.56          2361         store           6006007                 6                    6    8076011.00                 2218\n6    store     9005003           5              9  8486016.56          2361         store          10002017                 2                   10    2290737.69                  620\n7    store     9005003           5              9  8486016.56          2361         store          10013017                13                   10    3049869.51                  825\n8    store     9005003           5              9  8486016.56          2361         store           7009007                 9                    7    6591517.11                 1780\n9    store     9005003           5              9  8486016.56          2361         store           8012003                12                    8    7395278.86                 1961\n10   store     9005003           5              9  8486016.56          2361         store           6006001                 6                    6    8541543.80                 2354\n11   store     9005003           5              9  8486016.56          2361         store           8014007                14                    8    6664821.20                 1746\n12   store     9005003           5              9  8486016.56          2361         store          10002010                 2                   10    3645378.30                  959\n13   store     9005003           5              9  8486016.56          2361         store           7005002                 5                    7    2969826.48                  802\n14   store     9005003           5              9  8486016.56          2361         store           8012002                12                    8    3929216.82                 1048\n15   store     9005003           5              9  8486016.56          2361         store           6002008                 2                    6    4053287.19                 1147\n16   store     9005003           5              9  8486016.56          2361         store          10009014                 9                   10    2718301.40                  789\n17   store     9005003           5              9  8486016.56          2361         store           8013004                13                    8    3732626.59                 1027\n18   store     9005003           5              9  8486016.56          2361         store          10002001                 2                   10    2886263.78                  771\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"LAST_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"LAST_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"LAST_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"LAST_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"LAST_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"LAST_YEAR\".\"SALES\" AS \"SALES\" , \"LAST_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" CROSS JOIN \"LAST_YEAR\" AS \"LAST_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_24\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"SPEQLITE_TEMP_TABLE_3\".\"D_WEEK_SEQ\" AND \"SPEQLITE_TEMP_TABLE_3\".\"D_DOM\" = 25 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = 12 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = 2000 WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_6\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.408006,
                    "execution_time": 0.316888,
                    "compile_time": 0.000604,
                    "planning_time": 0.036919,
                    "create_size": 153
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.48706,
                    "execution_time": 0.336179,
                    "compile_time": 0.000603,
                    "planning_time": 0.097067,
                    "create_size": 153
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_25\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"SPEQLITE_TEMP_TABLE_3\".\"D_WEEK_SEQ\" AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.046827,
                    "execution_time": 2.957906,
                    "compile_time": 0.000611,
                    "planning_time": 0.03554,
                    "create_size": 153
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 7.789546,
                    "execution_time": 2.988394,
                    "compile_time": 4.647025,
                    "planning_time": 0.096403,
                    "create_size": 153
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_26\" AS SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_25\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_25\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_25\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_25\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_25\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_25\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_25\" AS \"SPEQLITE_TEMP_TABLE_25\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 14.32878,
                    "execution_time": 13.597473,
                    "compile_time": 0.00055,
                    "planning_time": 0.005959,
                    "create_size": 11776
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 22.732064,
                    "execution_time": 18.652195,
                    "compile_time": 3.304777,
                    "planning_time": 0.063475,
                    "create_size": 11776
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_26\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_26\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_26\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_26\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_26\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_26\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_26\" AS \"SPEQLITE_TEMP_TABLE_26\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     9003005           4              8  107372.76            27         store           4004002                10                    4     566591.84                  144\n1    store     6013001           5              7   44371.06            16         store           4004002                10                    4     566591.84                  144\n2    store     8004004           3              8  102061.15            19         store           4004002                10                    4     566591.84                  144\n3    store     7004005           4              4   80762.48            24         store           4004002                10                    4     566591.84                  144\n4    store     9009011           3              3   98168.65            19         store           4004002                10                    4     566591.84                  144\n5    store     6007007           3              5   73427.10            15         store           4004002                10                    4     566591.84                  144\n6    store     9013011           9             10   96847.19            25         store           4004002                10                    4     566591.84                  144\n7    store     7015007           6             10   86866.99            23         store           4004002                10                    4     566591.84                  144\n8    store    10011009          11              8   73620.12            27         store           4004002                10                    4     566591.84                  144\n9    store     8012001           3              3   63239.08            17         store           4004002                10                    4     566591.84                  144\n10   store     4001001          13             10   67084.80            17         store           4004002                10                    4     566591.84                  144\n11   store     2002001          13              7  101706.20            27         store           4004002                10                    4     566591.84                  144\n12   store    10009016           7             10   28958.79            12         store           4004002                10                    4     566591.84                  144\n13   store     8002001           2              7   92949.31            21         store           4004002                10                    4     566591.84                  144\n14   store     8008005           2              5   77695.22            24         store           4004002                10                    4     566591.84                  144\n15   store    10014008           5              9   95384.49            21         store           4004002                10                    4     566591.84                  144\n16   store     8009003           3              3   62660.68            19         store           4004002                10                    4     566591.84                  144\n17   store     7013005          13              1   67358.98            27         store           4004002                10                    4     566591.84                  144\n18   store    10005012          15              9   50221.81            20         store           4004002                10                    4     566591.84                  144\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.019973,
                    "execution_time": 0.008188,
                    "compile_time": 5.2e-05,
                    "planning_time": 0.004945
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.06356,
                    "execution_time": 0.014142,
                    "compile_time": 5.6e-05,
                    "planning_time": 0.040879
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_25\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_25\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_25\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_25\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_25\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_25\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_25\" AS \"SPEQLITE_TEMP_TABLE_25\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_26\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_26\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_26\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_26\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_26\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_26\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_26\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_26\" AS \"SPEQLITE_TEMP_TABLE_26\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     9003005           4              8  107372.76            27         store           4004002                10                    4     566591.84                  144\n1    store     6013001           5              7   44371.06            16         store           4004002                10                    4     566591.84                  144\n2    store     8004004           3              8  102061.15            19         store           4004002                10                    4     566591.84                  144\n3    store     7004005           4              4   80762.48            24         store           4004002                10                    4     566591.84                  144\n4    store     9009011           3              3   98168.65            19         store           4004002                10                    4     566591.84                  144\n5    store     6007007           3              5   73427.10            15         store           4004002                10                    4     566591.84                  144\n6    store     9013011           9             10   96847.19            25         store           4004002                10                    4     566591.84                  144\n7    store     7015007           6             10   86866.99            23         store           4004002                10                    4     566591.84                  144\n8    store    10011009          11              8   73620.12            27         store           4004002                10                    4     566591.84                  144\n9    store     8012001           3              3   63239.08            17         store           4004002                10                    4     566591.84                  144\n10   store     4001001          13             10   67084.80            17         store           4004002                10                    4     566591.84                  144\n11   store     2002001          13              7  101706.20            27         store           4004002                10                    4     566591.84                  144\n12   store    10009016           7             10   28958.79            12         store           4004002                10                    4     566591.84                  144\n13   store     8002001           2              7   92949.31            21         store           4004002                10                    4     566591.84                  144\n14   store     8008005           2              5   77695.22            24         store           4004002                10                    4     566591.84                  144\n15   store    10014008           5              9   95384.49            21         store           4004002                10                    4     566591.84                  144\n16   store     8009003           3              3   62660.68            19         store           4004002                10                    4     566591.84                  144\n17   store     7013005          13              1   67358.98            27         store           4004002                10                    4     566591.84                  144\n18   store    10005012          15              9   50221.81            20         store           4004002                10                    4     566591.84                  144\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"AVG_SALES\" AS \"AVG_SALES\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"AVG_SALES\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"_Q_0\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_0\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_0\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" CROSS JOIN \"_Q_0\" AS \"_Q_0\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_27\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"SPEQLITE_TEMP_TABLE_3\".\"D_WEEK_SEQ\" AND \"SPEQLITE_TEMP_TABLE_3\".\"D_DOM\" = 25 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = 12 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = 2000 WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.41709,
                    "execution_time": 0.315094,
                    "compile_time": 0.000631,
                    "planning_time": 0.046883,
                    "create_size": 153
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.497767,
                    "execution_time": 0.342705,
                    "compile_time": 0.000668,
                    "planning_time": 0.099192,
                    "create_size": 153
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_28\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"SPEQLITE_TEMP_TABLE_3\".\"D_WEEK_SEQ\" AND \"SPEQLITE_TEMP_TABLE_3\".\"D_DOM\" = 25 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = 12 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.456114,
                    "execution_time": 0.381976,
                    "compile_time": 0.000583,
                    "planning_time": 0.033832,
                    "create_size": 18
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.574209,
                    "execution_time": 0.435102,
                    "compile_time": 0.000568,
                    "planning_time": 0.098641,
                    "create_size": 18
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_29\" AS SELECT \"SPEQLITE_TEMP_TABLE_27\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_27\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_27\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_27\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_27\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_27\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_28\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_28\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_28\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_28\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_28\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_28\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_27\" AS \"SPEQLITE_TEMP_TABLE_27\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_28\" AS \"SPEQLITE_TEMP_TABLE_28\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.891575,
                    "execution_time": 1.213991,
                    "compile_time": 0.000563,
                    "planning_time": 0.005898,
                    "create_size": 2176
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.427512,
                    "execution_time": 2.685324,
                    "compile_time": 0.000571,
                    "planning_time": 0.062467,
                    "create_size": 2176
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_29\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_29\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_29\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_29\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_29\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_29\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_29\" AS \"SPEQLITE_TEMP_TABLE_29\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     4001001           1              4  68182932.37         18449         store           2002001                 2                    2  1.249255e+08                33981\n1    store     4001001           1              4  68182932.37         18449         store           6009003                 9                    6  8.087335e+06                 2202\n2    store     4001001           1              4  68182932.37         18449         store           7009009                 9                    7  6.821068e+06                 1835\n3    store     4001001           1              4  68182932.37         18449         store           8001007                 1                    8  6.614088e+06                 1775\n4    store     4001001           1              4  68182932.37         18449         store           7009002                 9                    7  3.221930e+06                  849\n5    store     4001001           1              4  68182932.37         18449         store           8005005                 5                    8  6.989154e+06                 1969\n6    store     4001001           1              4  68182932.37         18449         store           6012001                12                    6  8.688038e+06                 2326\n7    store     4001001           1              4  68182932.37         18449         store           7010005                10                    7  6.895533e+06                 1866\n8    store     4001001           1              4  68182932.37         18449         store           7006005                 6                    7  5.629236e+06                 1562\n9    store     4001001           1              4  68182932.37         18449         store           6008003                 8                    6  8.280435e+06                 2266\n10   store     4001001           1              4  68182932.37         18449         store           7003007                 3                    7  6.785247e+06                 1809\n11   store     4001001           1              4  68182932.37         18449         store           3002002                 2                    3  6.543987e+07                17667\n12   store     4001001           1              4  68182932.37         18449         store           6002006                 2                    6  3.294471e+06                  908\n13   store     4001001           1              4  68182932.37         18449         store           7016005                16                    7  6.364640e+06                 1704\n14   store     4001001           1              4  68182932.37         18449         store           7015004                15                    7  2.997966e+06                  801\n15   store     4001001           1              4  68182932.37         18449         store           8009009                 9                    8  6.991136e+06                 1881\n16   store     4001001           1              4  68182932.37         18449         store           9006005                 6                    9  8.510506e+06                 2278\n17   store     4001001           1              4  68182932.37         18449         store           8005006                 5                    8  3.013847e+06                  862\n18   store     4001001           1              4  68182932.37         18449         store           7010002                10                    7  3.303676e+06                  911\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.020006,
                    "execution_time": 0.007814,
                    "compile_time": 5.8e-05,
                    "planning_time": 0.004989
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.05668,
                    "execution_time": 0.009127,
                    "compile_time": 5.3e-05,
                    "planning_time": 0.040665
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_27\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_27\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_27\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_27\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_27\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_27\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_28\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_28\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_28\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_28\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_28\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_28\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_27\" AS \"SPEQLITE_TEMP_TABLE_27\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_28\" AS \"SPEQLITE_TEMP_TABLE_28\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_29\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_29\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_29\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_29\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_29\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_29\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_29\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_29\" AS \"SPEQLITE_TEMP_TABLE_29\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     4001001           1              4  68182932.37         18449         store           2002001                 2                    2  1.249255e+08                33981\n1    store     4001001           1              4  68182932.37         18449         store           6009003                 9                    6  8.087335e+06                 2202\n2    store     4001001           1              4  68182932.37         18449         store           7009009                 9                    7  6.821068e+06                 1835\n3    store     4001001           1              4  68182932.37         18449         store           8001007                 1                    8  6.614088e+06                 1775\n4    store     4001001           1              4  68182932.37         18449         store           7009002                 9                    7  3.221930e+06                  849\n5    store     4001001           1              4  68182932.37         18449         store           8005005                 5                    8  6.989154e+06                 1969\n6    store     4001001           1              4  68182932.37         18449         store           6012001                12                    6  8.688038e+06                 2326\n7    store     4001001           1              4  68182932.37         18449         store           7010005                10                    7  6.895533e+06                 1866\n8    store     4001001           1              4  68182932.37         18449         store           7006005                 6                    7  5.629236e+06                 1562\n9    store     4001001           1              4  68182932.37         18449         store           6008003                 8                    6  8.280435e+06                 2266\n10   store     4001001           1              4  68182932.37         18449         store           7003007                 3                    7  6.785247e+06                 1809\n11   store     4001001           1              4  68182932.37         18449         store           3002002                 2                    3  6.543987e+07                17667\n12   store     4001001           1              4  68182932.37         18449         store           6002006                 2                    6  3.294471e+06                  908\n13   store     4001001           1              4  68182932.37         18449         store           7016005                16                    7  6.364640e+06                 1704\n14   store     4001001           1              4  68182932.37         18449         store           7015004                15                    7  2.997966e+06                  801\n15   store     4001001           1              4  68182932.37         18449         store           8009009                 9                    8  6.991136e+06                 1881\n16   store     4001001           1              4  68182932.37         18449         store           9006005                 6                    9  8.510506e+06                 2278\n17   store     4001001           1              4  68182932.37         18449         store           8005006                 5                    8  3.013847e+06                  862\n18   store     4001001           1              4  68182932.37         18449         store           7010002                10                    7  3.303676e+06                  911\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"AVG_SALES\" AS \"AVG_SALES\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"AVG_SALES\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"_Q_0\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_0\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_0\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" CROSS JOIN \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_29\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     4001001           1              4  68182932.37         18449         store           2002001                 2                    2  1.249255e+08                33981\n1    store     4001001           1              4  68182932.37         18449         store           6009003                 9                    6  8.087335e+06                 2202\n2    store     4001001           1              4  68182932.37         18449         store           7009009                 9                    7  6.821068e+06                 1835\n3    store     4001001           1              4  68182932.37         18449         store           8001007                 1                    8  6.614088e+06                 1775\n4    store     4001001           1              4  68182932.37         18449         store           7009002                 9                    7  3.221930e+06                  849\n5    store     4001001           1              4  68182932.37         18449         store           8005005                 5                    8  6.989154e+06                 1969\n6    store     4001001           1              4  68182932.37         18449         store           6012001                12                    6  8.688038e+06                 2326\n7    store     4001001           1              4  68182932.37         18449         store           7010005                10                    7  6.895533e+06                 1866\n8    store     4001001           1              4  68182932.37         18449         store           7006005                 6                    7  5.629236e+06                 1562\n9    store     4001001           1              4  68182932.37         18449         store           6008003                 8                    6  8.280435e+06                 2266\n10   store     4001001           1              4  68182932.37         18449         store           7003007                 3                    7  6.785247e+06                 1809\n11   store     4001001           1              4  68182932.37         18449         store           3002002                 2                    3  6.543987e+07                17667\n12   store     4001001           1              4  68182932.37         18449         store           6002006                 2                    6  3.294471e+06                  908\n13   store     4001001           1              4  68182932.37         18449         store           7016005                16                    7  6.364640e+06                 1704\n14   store     4001001           1              4  68182932.37         18449         store           7015004                15                    7  2.997966e+06                  801\n15   store     4001001           1              4  68182932.37         18449         store           8009009                 9                    8  6.991136e+06                 1881\n16   store     4001001           1              4  68182932.37         18449         store           9006005                 6                    9  8.510506e+06                 2278\n17   store     4001001           1              4  68182932.37         18449         store           8005006                 5                    8  3.013847e+06                  862\n18   store     4001001           1              4  68182932.37         18449         store           7010002                10                    7  3.303676e+06                  911\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.019538,
                    "execution_time": 0.00866,
                    "compile_time": 5.3e-05,
                    "planning_time": 0.004472
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.056166,
                    "execution_time": 0.008765,
                    "compile_time": 5.3e-05,
                    "planning_time": 0.039591
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_27\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_27\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_27\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_27\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_27\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_27\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_28\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_28\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_28\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_28\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_28\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_28\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_27\" AS \"SPEQLITE_TEMP_TABLE_27\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_28\" AS \"SPEQLITE_TEMP_TABLE_28\"",
                "rewrite": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_29\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     4001001           1              4  68182932.37         18449         store           2002001                 2                    2  1.249255e+08                33981\n1    store     4001001           1              4  68182932.37         18449         store           6009003                 9                    6  8.087335e+06                 2202\n2    store     4001001           1              4  68182932.37         18449         store           7009009                 9                    7  6.821068e+06                 1835\n3    store     4001001           1              4  68182932.37         18449         store           8001007                 1                    8  6.614088e+06                 1775\n4    store     4001001           1              4  68182932.37         18449         store           7009002                 9                    7  3.221930e+06                  849\n5    store     4001001           1              4  68182932.37         18449         store           8005005                 5                    8  6.989154e+06                 1969\n6    store     4001001           1              4  68182932.37         18449         store           6012001                12                    6  8.688038e+06                 2326\n7    store     4001001           1              4  68182932.37         18449         store           7010005                10                    7  6.895533e+06                 1866\n8    store     4001001           1              4  68182932.37         18449         store           7006005                 6                    7  5.629236e+06                 1562\n9    store     4001001           1              4  68182932.37         18449         store           6008003                 8                    6  8.280435e+06                 2266\n10   store     4001001           1              4  68182932.37         18449         store           7003007                 3                    7  6.785247e+06                 1809\n11   store     4001001           1              4  68182932.37         18449         store           3002002                 2                    3  6.543987e+07                17667\n12   store     4001001           1              4  68182932.37         18449         store           6002006                 2                    6  3.294471e+06                  908\n13   store     4001001           1              4  68182932.37         18449         store           7016005                16                    7  6.364640e+06                 1704\n14   store     4001001           1              4  68182932.37         18449         store           7015004                15                    7  2.997966e+06                  801\n15   store     4001001           1              4  68182932.37         18449         store           8009009                 9                    8  6.991136e+06                 1881\n16   store     4001001           1              4  68182932.37         18449         store           9006005                 6                    9  8.510506e+06                 2278\n17   store     4001001           1              4  68182932.37         18449         store           8005006                 5                    8  3.013847e+06                  862\n18   store     4001001           1              4  68182932.37         18449         store           7010002                10                    7  3.303676e+06                  911\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"_Q_0\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_0\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_0\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" CROSS JOIN \"_Q_0\" AS \"_Q_0\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_30\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"_U_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_10\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"SPEQLITE_TEMP_TABLE_3\".\"D_WEEK_SEQ\" AND \"SPEQLITE_TEMP_TABLE_3\".\"D_DOM\" = 25 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = 12 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.383648,
                    "execution_time": 0.306645,
                    "compile_time": 0.000606,
                    "planning_time": 0.036343,
                    "create_size": 18
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.45309,
                    "execution_time": 0.308355,
                    "compile_time": 0.000699,
                    "planning_time": 0.10139,
                    "create_size": 18
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_31\" AS SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_30\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_30\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.857858,
                    "execution_time": 1.169767,
                    "compile_time": 0.000557,
                    "planning_time": 0.006328,
                    "create_size": 2176
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.547304,
                    "execution_time": 2.799808,
                    "compile_time": 0.000567,
                    "planning_time": 0.067242,
                    "create_size": 2176
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     4001001           1              4  68182932.37         18449         store           6012005                12                    6    8295252.74                 2176\n1    store     4001001           1              4  68182932.37         18449         store           6011007                11                    6    7781985.76                 2078\n2    store     4001001           1              4  68182932.37         18449         store           9004002                 4                    9    8835781.32                 2436\n3    store     4001001           1              4  68182932.37         18449         store           6001004                 1                    6    3845918.33                 1005\n4    store     4001001           1              4  68182932.37         18449         store          10013006                13                   10    3510238.54                  929\n5    store     4001001           1              4  68182932.37         18449         store           9015008                15                    9    8183386.58                 2329\n6    store     4001001           1              4  68182932.37         18449         store           7004007                 4                    7    7577810.72                 2090\n7    store     4001001           1              4  68182932.37         18449         store           7011004                11                    7    3985538.95                 1052\n8    store     4001001           1              4  68182932.37         18449         store          10008017                 8                   10    1650934.89                  433\n9    store     4001001           1              4  68182932.37         18449         store           4001002                 1                    4   63141749.65                17363\n10   store     4001001           1              4  68182932.37         18449         store          10009004                 9                   10    2609137.82                  674\n11   store     4001001           1              4  68182932.37         18449         store           6015004                15                    6    3536642.94                  943\n12   store     4001001           1              4  68182932.37         18449         store          10009007                 9                   10    2496821.95                  682\n13   store     4001001           1              4  68182932.37         18449         store           6002001                 2                    6    8451415.38                 2311\n14   store     4001001           1              4  68182932.37         18449         store           7001008                 1                    7    3256590.23                  887\n15   store     4001001           1              4  68182932.37         18449         store           9007005                 7                    9    7797580.71                 2112\n16   store     4001001           1              4  68182932.37         18449         store           6004006                 4                    6    3840076.54                 1016\n17   store     4001001           1              4  68182932.37         18449         store           8006003                 6                    8    6236813.06                 1656\n18   store     4001001           1              4  68182932.37         18449         store           9013005                13                    9    8660382.04                 2275\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.019452,
                    "execution_time": 0.007799,
                    "compile_time": 5.4e-05,
                    "planning_time": 0.004771
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.05631,
                    "execution_time": 0.008614,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.040668
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     4001001           1              4  68182932.37         18449         store           6012005                12                    6    8295252.74                 2176\n1    store     4001001           1              4  68182932.37         18449         store           6011007                11                    6    7781985.76                 2078\n2    store     4001001           1              4  68182932.37         18449         store           9004002                 4                    9    8835781.32                 2436\n3    store     4001001           1              4  68182932.37         18449         store           6001004                 1                    6    3845918.33                 1005\n4    store     4001001           1              4  68182932.37         18449         store          10013006                13                   10    3510238.54                  929\n5    store     4001001           1              4  68182932.37         18449         store           9015008                15                    9    8183386.58                 2329\n6    store     4001001           1              4  68182932.37         18449         store           7004007                 4                    7    7577810.72                 2090\n7    store     4001001           1              4  68182932.37         18449         store           7011004                11                    7    3985538.95                 1052\n8    store     4001001           1              4  68182932.37         18449         store          10008017                 8                   10    1650934.89                  433\n9    store     4001001           1              4  68182932.37         18449         store           4001002                 1                    4   63141749.65                17363\n10   store     4001001           1              4  68182932.37         18449         store          10009004                 9                   10    2609137.82                  674\n11   store     4001001           1              4  68182932.37         18449         store           6015004                15                    6    3536642.94                  943\n12   store     4001001           1              4  68182932.37         18449         store          10009007                 9                   10    2496821.95                  682\n13   store     4001001           1              4  68182932.37         18449         store           6002001                 2                    6    8451415.38                 2311\n14   store     4001001           1              4  68182932.37         18449         store           7001008                 1                    7    3256590.23                  887\n15   store     4001001           1              4  68182932.37         18449         store           9007005                 7                    9    7797580.71                 2112\n16   store     4001001           1              4  68182932.37         18449         store           6004006                 4                    6    3840076.54                 1016\n17   store     4001001           1              4  68182932.37         18449         store           8006003                 6                    8    6236813.06                 1656\n18   store     4001001           1              4  68182932.37         18449         store           9013005                13                    9    8660382.04                 2275\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"LAST_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"LAST_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"LAST_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"LAST_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"LAST_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"LAST_YEAR\".\"SALES\" AS \"SALES\" , \"LAST_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" CROSS JOIN \"LAST_YEAR\" AS \"LAST_YEAR\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_31\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n1    store     8013005          13              8  2609500.21           716         store           7008005                 8                    7    5362341.74                 1468\n2    store     8013005          13              8  2609500.21           716         store           9016003                16                    9    7910092.56                 2138\n3    store     8013005          13              8  2609500.21           716         store           9012011                12                    9    7997497.82                 2160\n4    store     8013005          13              8  2609500.21           716         store           6005003                 5                    6    7600407.68                 2002\n5    store     8013005          13              8  2609500.21           716         store           8002009                 2                    8    6231741.98                 1695\n6    store     8013005          13              8  2609500.21           716         store           8009008                 9                    8    2908951.41                  801\n7    store     8013005          13              8  2609500.21           716         store           7016008                16                    7    3305999.78                  925\n8    store     8013005          13              8  2609500.21           716         store           7007005                 7                    7    5409684.24                 1457\n9    store     8013005          13              8  2609500.21           716         store           6002006                 2                    6    3294470.52                  908\n10   store     8013005          13              8  2609500.21           716         store          10006015                 6                   10    2904684.87                  763\n11   store     8013005          13              8  2609500.21           716         store           6008003                 8                    6    8280434.90                 2266\n12   store     8013005          13              8  2609500.21           716         store           9006005                 6                    9    8510506.25                 2278\n13   store     8013005          13              8  2609500.21           716         store           7009009                 9                    7    6821067.51                 1835\n14   store     8013005          13              8  2609500.21           716         store           7010002                10                    7    3303676.38                  911\n15   store     8013005          13              8  2609500.21           716         store           6012001                12                    6    8688038.48                 2326\n16   store     8013005          13              8  2609500.21           716         store           8005003                 5                    8    6348580.69                 1739\n17   store     8013005          13              8  2609500.21           716         store          10003006                 3                   10    3057332.17                  783\n18   store     8013005          13              8  2609500.21           716         store          10008009                 8                   10    2916403.11                  790\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018692,
                    "execution_time": 0.007711,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.004474
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.055043,
                    "execution_time": 0.008739,
                    "compile_time": 5.5e-05,
                    "planning_time": 0.039599
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\"",
                "rewrite": "SELECT * FROM \"SPEQLITE_TEMP_TABLE_31\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n1    store     8013005          13              8  2609500.21           716         store           7008005                 8                    7    5362341.74                 1468\n2    store     8013005          13              8  2609500.21           716         store           9016003                16                    9    7910092.56                 2138\n3    store     8013005          13              8  2609500.21           716         store           9012011                12                    9    7997497.82                 2160\n4    store     8013005          13              8  2609500.21           716         store           6005003                 5                    6    7600407.68                 2002\n5    store     8013005          13              8  2609500.21           716         store           8002009                 2                    8    6231741.98                 1695\n6    store     8013005          13              8  2609500.21           716         store           8009008                 9                    8    2908951.41                  801\n7    store     8013005          13              8  2609500.21           716         store           7016008                16                    7    3305999.78                  925\n8    store     8013005          13              8  2609500.21           716         store           7007005                 7                    7    5409684.24                 1457\n9    store     8013005          13              8  2609500.21           716         store           6002006                 2                    6    3294470.52                  908\n10   store     8013005          13              8  2609500.21           716         store          10006015                 6                   10    2904684.87                  763\n11   store     8013005          13              8  2609500.21           716         store           6008003                 8                    6    8280434.90                 2266\n12   store     8013005          13              8  2609500.21           716         store           9006005                 6                    9    8510506.25                 2278\n13   store     8013005          13              8  2609500.21           716         store           7009009                 9                    7    6821067.51                 1835\n14   store     8013005          13              8  2609500.21           716         store           7010002                10                    7    3303676.38                  911\n15   store     8013005          13              8  2609500.21           716         store           6012001                12                    6    8688038.48                 2326\n16   store     8013005          13              8  2609500.21           716         store           8005003                 5                    8    6348580.69                 1739\n17   store     8013005          13              8  2609500.21           716         store          10003006                 3                   10    3057332.17                  783\n18   store     8013005          13              8  2609500.21           716         store          10008009                 8                   10    2916403.11                  790\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year \nWHERE  this_year.i_brand_id = last_year.i_brand_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"LAST_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"LAST_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"LAST_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"LAST_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"LAST_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"LAST_YEAR\".\"SALES\" AS \"SALES\" , \"LAST_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" JOIN \"LAST_YEAR\" AS \"LAST_YEAR\" ON \"LAST_YEAR\".\"I_BRAND_ID\" = \"THIS_YEAR\".\"I_BRAND_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_32\" AS SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n1    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n2    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n3    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n4    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n5    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n6    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n7    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n8    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n9    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n10   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n11   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n12   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n13   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n14   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n15   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n16   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n17   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n18   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.031275,
                    "execution_time": 0.015503,
                    "compile_time": 9.8e-05,
                    "planning_time": 0.00769
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.376962,
                    "execution_time": 0.016369,
                    "compile_time": 3.31229,
                    "planning_time": 0.04346
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n1    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n2    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n3    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n4    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n5    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n6    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n7    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n8    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n9    store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n10   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n11   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n12   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n13   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n14   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n15   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n16   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n17   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n18   store     8013005          13              8  2609500.21           716         store          10004016                 4                   10    3015484.51                  857\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year \nWHERE  this_year.i_brand_id = last_year.i_brand_id \n       AND this_year.i_class_id = last_year.i_class_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"LAST_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"LAST_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"LAST_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"LAST_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"LAST_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"LAST_YEAR\".\"SALES\" AS \"SALES\" , \"LAST_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" JOIN \"LAST_YEAR\" AS \"LAST_YEAR\" ON \"LAST_YEAR\".\"I_BRAND_ID\" = \"THIS_YEAR\".\"I_BRAND_ID\" AND \"LAST_YEAR\".\"I_CLASS_ID\" = \"THIS_YEAR\".\"I_CLASS_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_32\" AS SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.433191,
                    "execution_time": 0.741683,
                    "compile_time": 0.000567,
                    "planning_time": 0.007272,
                    "create_size": 1920
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 1.814736,
                    "execution_time": 0.933773,
                    "compile_time": 0.136038,
                    "planning_time": 0.063504,
                    "create_size": 1920
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_32\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_32\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_32\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_32\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_32\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_32\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_32\" AS \"SPEQLITE_TEMP_TABLE_32\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     4001001           1              4  68182932.37         18449         store           1004001                 4                    1  1.276248e+08                34538\n1    store     4001001           1              4  68182932.37         18449         store          10003001                 3                   10  3.248546e+06                  828\n2    store     4001001           1              4  68182932.37         18449         store           4002001                 2                    4  1.261616e+08                34352\n3    store     4001001           1              4  68182932.37         18449         store           9012009                12                    9  7.634030e+06                 2090\n4    store     4001001           1              4  68182932.37         18449         store           8007001                 7                    8  5.978850e+06                 1645\n5    store     4001001           1              4  68182932.37         18449         store           2003001                 3                    2  1.261207e+08                34194\n6    store     4001001           1              4  68182932.37         18449         store           9001011                 1                    9  8.914948e+06                 2430\n7    store     4001001           1              4  68182932.37         18449         store          10004015                 4                   10  3.184478e+06                  834\n8    store     4001001           1              4  68182932.37         18449         store           7013007                13                    7  5.590275e+06                 1528\n9    store     4001001           1              4  68182932.37         18449         store           7011001                11                    7  6.151563e+06                 1705\n10   store     4001001           1              4  68182932.37         18449         store           7009003                 9                    7  6.343601e+06                 1709\n11   store     4001001           1              4  68182932.37         18449         store          10013012                13                   10  3.910832e+06                 1029\n12   store     4001001           1              4  68182932.37         18449         store           8003001                 3                    8  5.881165e+06                 1542\n13   store     4001001           1              4  68182932.37         18449         store           9013009                13                    9  1.002598e+07                 2743\n14   store     4001001           1              4  68182932.37         18449         store           6005001                 5                    6  8.110401e+06                 2222\n15   store     4001001           1              4  68182932.37         18449         store           6010006                10                    6  4.201299e+06                 1185\n16   store     4001001           1              4  68182932.37         18449         store           5002001                 2                    5  1.313863e+08                35623\n17   store     4001001           1              4  68182932.37         18449         store           7010009                10                    7  7.348992e+06                 1993\n18   store     4001001           1              4  68182932.37         18449         store           9014008                14                    9  8.358089e+06                 2276\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.019512,
                    "execution_time": 0.008045,
                    "compile_time": 5.4e-05,
                    "planning_time": 0.004772
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.0571,
                    "execution_time": 0.008287,
                    "compile_time": 5.3e-05,
                    "planning_time": 0.040613
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_32\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_32\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_32\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_32\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_32\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_32\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_32\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_32\" AS \"SPEQLITE_TEMP_TABLE_32\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     4001001           1              4  68182932.37         18449         store           1004001                 4                    1  1.276248e+08                34538\n1    store     4001001           1              4  68182932.37         18449         store          10003001                 3                   10  3.248546e+06                  828\n2    store     4001001           1              4  68182932.37         18449         store           4002001                 2                    4  1.261616e+08                34352\n3    store     4001001           1              4  68182932.37         18449         store           9012009                12                    9  7.634030e+06                 2090\n4    store     4001001           1              4  68182932.37         18449         store           8007001                 7                    8  5.978850e+06                 1645\n5    store     4001001           1              4  68182932.37         18449         store           2003001                 3                    2  1.261207e+08                34194\n6    store     4001001           1              4  68182932.37         18449         store           9001011                 1                    9  8.914948e+06                 2430\n7    store     4001001           1              4  68182932.37         18449         store          10004015                 4                   10  3.184478e+06                  834\n8    store     4001001           1              4  68182932.37         18449         store           7013007                13                    7  5.590275e+06                 1528\n9    store     4001001           1              4  68182932.37         18449         store           7011001                11                    7  6.151563e+06                 1705\n10   store     4001001           1              4  68182932.37         18449         store           7009003                 9                    7  6.343601e+06                 1709\n11   store     4001001           1              4  68182932.37         18449         store          10013012                13                   10  3.910832e+06                 1029\n12   store     4001001           1              4  68182932.37         18449         store           8003001                 3                    8  5.881165e+06                 1542\n13   store     4001001           1              4  68182932.37         18449         store           9013009                13                    9  1.002598e+07                 2743\n14   store     4001001           1              4  68182932.37         18449         store           6005001                 5                    6  8.110401e+06                 2222\n15   store     4001001           1              4  68182932.37         18449         store           6010006                10                    6  4.201299e+06                 1185\n16   store     4001001           1              4  68182932.37         18449         store           5002001                 2                    5  1.313863e+08                35623\n17   store     4001001           1              4  68182932.37         18449         store           7010009                10                    7  7.348992e+06                 1993\n18   store     4001001           1              4  68182932.37         18449         store           9014008                14                    9  8.358089e+06                 2276\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year \nWHERE  this_year.i_brand_id = last_year.i_brand_id \n       AND this_year.i_class_id = last_year.i_class_id \n       AND this_year.i_category_id = last_year.i_category_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"LAST_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"LAST_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"LAST_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"LAST_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"LAST_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"LAST_YEAR\".\"SALES\" AS \"SALES\" , \"LAST_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" JOIN \"LAST_YEAR\" AS \"LAST_YEAR\" ON \"LAST_YEAR\".\"I_BRAND_ID\" = \"THIS_YEAR\".\"I_BRAND_ID\" AND \"LAST_YEAR\".\"I_CATEGORY_ID\" = \"THIS_YEAR\".\"I_CATEGORY_ID\" AND \"LAST_YEAR\".\"I_CLASS_ID\" = \"THIS_YEAR\".\"I_CLASS_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_33\" AS SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.459499,
                    "execution_time": 0.758407,
                    "compile_time": 0.038945,
                    "planning_time": 0.007846,
                    "create_size": 1920
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 4.839348,
                    "execution_time": 0.74909,
                    "compile_time": 3.369033,
                    "planning_time": 0.063315,
                    "create_size": 1920
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_33\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_33\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_33\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_33\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_33\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_33\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_33\" AS \"SPEQLITE_TEMP_TABLE_33\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     5004002           4              5  87216333.74         23498         store          10011002                11                   10    2358290.10                  654\n1    store     5004002           4              5  87216333.74         23498         store           6002003                 2                    6    7580178.58                 2140\n2    store     5004002           4              5  87216333.74         23498         store           7016002                16                    7    2695271.99                  799\n3    store     5004002           4              5  87216333.74         23498         store           9014009                14                    9    6520720.02                 1813\n4    store     5004002           4              5  87216333.74         23498         store          10007003                 7                   10    3162194.54                  817\n5    store     5004002           4              5  87216333.74         23498         store           7013010                13                    7    2877426.92                  826\n6    store     5004002           4              5  87216333.74         23498         store           7002003                 2                    7    5814044.73                 1602\n7    store     5004002           4              5  87216333.74         23498         store          10007007                 7                   10    2544160.33                  690\n8    store     5004002           4              5  87216333.74         23498         store          10010014                10                   10    2725861.47                  710\n9    store     5004002           4              5  87216333.74         23498         store          10008005                 8                   10    3118646.75                  866\n10   store     5004002           4              5  87216333.74         23498         store           8009007                 9                    8    6859598.17                 1881\n11   store     5004002           4              5  87216333.74         23498         store          10014007                14                   10    3046429.06                  841\n12   store     5004002           4              5  87216333.74         23498         store           7016004                16                    7    3610974.15                  928\n13   store     5004002           4              5  87216333.74         23498         store          10008001                 8                   10    2293599.29                  623\n14   store     5004002           4              5  87216333.74         23498         store           6010004                10                    6    5698585.40                 1527\n15   store     5004002           4              5  87216333.74         23498         store           8005002                 5                    8    2866065.92                  804\n16   store     5004002           4              5  87216333.74         23498         store           6013005                13                    6    7573633.54                 2134\n17   store     5004002           4              5  87216333.74         23498         store          10001015                 1                   10    2790436.86                  789\n18   store     5004002           4              5  87216333.74         23498         store           6005004                 5                    6    2848459.20                  761\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.020002,
                    "execution_time": 0.008454,
                    "compile_time": 5.2e-05,
                    "planning_time": 0.004703
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.057668,
                    "execution_time": 0.008856,
                    "compile_time": 5.5e-05,
                    "planning_time": 0.04054
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_33\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_33\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_33\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_33\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_33\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_33\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_33\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_33\" AS \"SPEQLITE_TEMP_TABLE_33\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     5004002           4              5  87216333.74         23498         store          10011002                11                   10    2358290.10                  654\n1    store     5004002           4              5  87216333.74         23498         store           6002003                 2                    6    7580178.58                 2140\n2    store     5004002           4              5  87216333.74         23498         store           7016002                16                    7    2695271.99                  799\n3    store     5004002           4              5  87216333.74         23498         store           9014009                14                    9    6520720.02                 1813\n4    store     5004002           4              5  87216333.74         23498         store          10007003                 7                   10    3162194.54                  817\n5    store     5004002           4              5  87216333.74         23498         store           7013010                13                    7    2877426.92                  826\n6    store     5004002           4              5  87216333.74         23498         store           7002003                 2                    7    5814044.73                 1602\n7    store     5004002           4              5  87216333.74         23498         store          10007007                 7                   10    2544160.33                  690\n8    store     5004002           4              5  87216333.74         23498         store          10010014                10                   10    2725861.47                  710\n9    store     5004002           4              5  87216333.74         23498         store          10008005                 8                   10    3118646.75                  866\n10   store     5004002           4              5  87216333.74         23498         store           8009007                 9                    8    6859598.17                 1881\n11   store     5004002           4              5  87216333.74         23498         store          10014007                14                   10    3046429.06                  841\n12   store     5004002           4              5  87216333.74         23498         store           7016004                16                    7    3610974.15                  928\n13   store     5004002           4              5  87216333.74         23498         store          10008001                 8                   10    2293599.29                  623\n14   store     5004002           4              5  87216333.74         23498         store           6010004                10                    6    5698585.40                 1527\n15   store     5004002           4              5  87216333.74         23498         store           8005002                 5                    8    2866065.92                  804\n16   store     5004002           4              5  87216333.74         23498         store           6013005                13                    6    7573633.54                 2134\n17   store     5004002           4              5  87216333.74         23498         store          10001015                 1                   10    2790436.86                  789\n18   store     5004002           4              5  87216333.74         23498         store           6005004                 5                    6    2848459.20                  761\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year \nWHERE  this_year.i_brand_id = last_year.i_brand_id \n       AND this_year.i_class_id = last_year.i_class_id \n       AND this_year.i_category_id = last_year.i_category_id \nORDER  BY this_year.channel, \n          this_year.sales DESC \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"LAST_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"LAST_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"LAST_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"LAST_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"LAST_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"LAST_YEAR\".\"SALES\" AS \"SALES\" , \"LAST_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" JOIN \"LAST_YEAR\" AS \"LAST_YEAR\" ON \"LAST_YEAR\".\"I_BRAND_ID\" = \"THIS_YEAR\".\"I_BRAND_ID\" AND \"LAST_YEAR\".\"I_CATEGORY_ID\" = \"THIS_YEAR\".\"I_CATEGORY_ID\" AND \"LAST_YEAR\".\"I_CLASS_ID\" = \"THIS_YEAR\".\"I_CLASS_ID\" ORDER BY \"THIS_YEAR\".\"CHANNEL\" NULLS LAST , \"THIS_YEAR\".\"SALES\" DESC NULLS FIRST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" DESC NULLS FIRST LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     5004002           4              5  87216333.74         23498         store           8003001                 3                    8  5.881165e+06                 1542\n1    store     5004002           4              5  87216333.74         23498         store           8003008                 3                    8  3.167923e+06                  828\n2    store     5004002           4              5  87216333.74         23498         store           6002002                 2                    6  3.128323e+06                  848\n3    store     5004002           4              5  87216333.74         23498         store           6015007                15                    6  7.474041e+06                 2021\n4    store     5004002           4              5  87216333.74         23498         store           8001001                 1                    8  6.494439e+06                 1812\n5    store     5004002           4              5  87216333.74         23498         store          10009003                 9                   10  2.532342e+06                  672\n6    store     5004002           4              5  87216333.74         23498         store           9001011                 1                    9  8.914948e+06                 2430\n7    store     5004002           4              5  87216333.74         23498         store           9006008                 6                    9  8.331756e+06                 2198\n8    store     5004002           4              5  87216333.74         23498         store           8013002                13                    8  2.294785e+06                  635\n9    store     5004002           4              5  87216333.74         23498         store          10013012                13                   10  3.910832e+06                 1029\n10   store     5004002           4              5  87216333.74         23498         store           6013002                13                    6  3.514634e+06                  968\n11   store     5004002           4              5  87216333.74         23498         store           7015001                15                    7  6.836467e+06                 1949\n12   store     5004002           4              5  87216333.74         23498         store           6010006                10                    6  4.201299e+06                 1185\n13   store     5004002           4              5  87216333.74         23498         store          10008006                 8                   10  4.243510e+06                 1164\n14   store     5004002           4              5  87216333.74         23498         store           9002003                 2                    9  9.185364e+06                 2480\n15   store     5004002           4              5  87216333.74         23498         store           9014008                14                    9  8.358089e+06                 2276\n16   store     5004002           4              5  87216333.74         23498         store          10013014                13                   10  2.295560e+06                  633\n17   store     5004002           4              5  87216333.74         23498         store          10008004                 8                   10  2.313292e+06                  600\n18   store     5004002           4              5  87216333.74         23498         store           4002001                 2                    4  1.261616e+08                34352\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.22358,
                    "execution_time": 0.192246,
                    "compile_time": 0.013151,
                    "planning_time": 0.008101
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.701903,
                    "execution_time": 0.192231,
                    "compile_time": 4.633037,
                    "planning_time": 0.044234
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" DESC NULLS FIRST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" DESC NULLS FIRST"
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     5004002           4              5  87216333.74         23498         store           8003001                 3                    8  5.881165e+06                 1542\n1    store     5004002           4              5  87216333.74         23498         store           8003008                 3                    8  3.167923e+06                  828\n2    store     5004002           4              5  87216333.74         23498         store           6002002                 2                    6  3.128323e+06                  848\n3    store     5004002           4              5  87216333.74         23498         store           6015007                15                    6  7.474041e+06                 2021\n4    store     5004002           4              5  87216333.74         23498         store           8001001                 1                    8  6.494439e+06                 1812\n5    store     5004002           4              5  87216333.74         23498         store          10009003                 9                   10  2.532342e+06                  672\n6    store     5004002           4              5  87216333.74         23498         store           9001011                 1                    9  8.914948e+06                 2430\n7    store     5004002           4              5  87216333.74         23498         store           9006008                 6                    9  8.331756e+06                 2198\n8    store     5004002           4              5  87216333.74         23498         store           8013002                13                    8  2.294785e+06                  635\n9    store     5004002           4              5  87216333.74         23498         store          10013012                13                   10  3.910832e+06                 1029\n10   store     5004002           4              5  87216333.74         23498         store           6013002                13                    6  3.514634e+06                  968\n11   store     5004002           4              5  87216333.74         23498         store           7015001                15                    7  6.836467e+06                 1949\n12   store     5004002           4              5  87216333.74         23498         store           6010006                10                    6  4.201299e+06                 1185\n13   store     5004002           4              5  87216333.74         23498         store          10008006                 8                   10  4.243510e+06                 1164\n14   store     5004002           4              5  87216333.74         23498         store           9002003                 2                    9  9.185364e+06                 2480\n15   store     5004002           4              5  87216333.74         23498         store           9014008                14                    9  8.358089e+06                 2276\n16   store     5004002           4              5  87216333.74         23498         store          10013014                13                   10  2.295560e+06                  633\n17   store     5004002           4              5  87216333.74         23498         store          10008004                 8                   10  2.313292e+06                  600\n18   store     5004002           4              5  87216333.74         23498         store           4002001                 2                    4  1.261616e+08                34352\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year \nWHERE  this_year.i_brand_id = last_year.i_brand_id \n       AND this_year.i_class_id = last_year.i_class_id \n       AND this_year.i_category_id = last_year.i_category_id \nORDER  BY this_year.channel, \n          this_year.i_brand_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"LAST_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"LAST_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"LAST_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"LAST_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"LAST_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"LAST_YEAR\".\"SALES\" AS \"SALES\" , \"LAST_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" JOIN \"LAST_YEAR\" AS \"LAST_YEAR\" ON \"LAST_YEAR\".\"I_BRAND_ID\" = \"THIS_YEAR\".\"I_BRAND_ID\" AND \"LAST_YEAR\".\"I_CATEGORY_ID\" = \"THIS_YEAR\".\"I_CATEGORY_ID\" AND \"LAST_YEAR\".\"I_CLASS_ID\" = \"THIS_YEAR\".\"I_CLASS_ID\" ORDER BY \"THIS_YEAR\".\"CHANNEL\" NULLS LAST , \"THIS_YEAR\".\"I_BRAND_ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" NULLS LAST LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     1001001           1              1  63849258.35         17349         store          10005014                 5                   10  2.594778e+06                  761\n1    store     1001001           1              1  63849258.35         17349         store           8003001                 3                    8  5.881165e+06                 1542\n2    store     1001001           1              1  63849258.35         17349         store           9002005                 2                    9  7.651564e+06                 2065\n3    store     1001001           1              1  63849258.35         17349         store           8009004                 9                    8  3.360104e+06                  893\n4    store     1001001           1              1  63849258.35         17349         store           6015007                15                    6  7.474041e+06                 2021\n5    store     1001001           1              1  63849258.35         17349         store           8002002                 2                    8  3.313851e+06                  908\n6    store     1001001           1              1  63849258.35         17349         store          10012009                12                   10  2.567700e+06                  697\n7    store     1001001           1              1  63849258.35         17349         store           9001011                 1                    9  8.914948e+06                 2430\n8    store     1001001           1              1  63849258.35         17349         store           7005006                 5                    7  3.025645e+06                  845\n9    store     1001001           1              1  63849258.35         17349         store           9002003                 2                    9  9.185364e+06                 2480\n10   store     1001001           1              1  63849258.35         17349         store          10013012                13                   10  3.910832e+06                 1029\n11   store     1001001           1              1  63849258.35         17349         store           7001007                 1                    7  5.094872e+06                 1443\n12   store     1001001           1              1  63849258.35         17349         store          10009003                 9                   10  2.532342e+06                  672\n13   store     1001001           1              1  63849258.35         17349         store           6010006                10                    6  4.201299e+06                 1185\n14   store     1001001           1              1  63849258.35         17349         store           7016010                16                    7  3.250287e+06                  868\n15   store     1001001           1              1  63849258.35         17349         store           9011003                11                    9  7.764127e+06                 2129\n16   store     1001001           1              1  63849258.35         17349         store           9014008                14                    9  8.358089e+06                 2276\n17   store     1001001           1              1  63849258.35         17349         store           9015002                15                    9  7.711787e+06                 2156\n18   store     1001001           1              1  63849258.35         17349         store           8013002                13                    8  2.294785e+06                  635\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.222373,
                    "execution_time": 0.188796,
                    "compile_time": 0.015442,
                    "planning_time": 0.008119
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.543083,
                    "execution_time": 0.18923,
                    "compile_time": 3.298267,
                    "planning_time": 0.044168
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" NULLS LAST"
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     1001001           1              1  63849258.35         17349         store          10005014                 5                   10  2.594778e+06                  761\n1    store     1001001           1              1  63849258.35         17349         store           8003001                 3                    8  5.881165e+06                 1542\n2    store     1001001           1              1  63849258.35         17349         store           9002005                 2                    9  7.651564e+06                 2065\n3    store     1001001           1              1  63849258.35         17349         store           8009004                 9                    8  3.360104e+06                  893\n4    store     1001001           1              1  63849258.35         17349         store           6015007                15                    6  7.474041e+06                 2021\n5    store     1001001           1              1  63849258.35         17349         store           8002002                 2                    8  3.313851e+06                  908\n6    store     1001001           1              1  63849258.35         17349         store          10012009                12                   10  2.567700e+06                  697\n7    store     1001001           1              1  63849258.35         17349         store           9001011                 1                    9  8.914948e+06                 2430\n8    store     1001001           1              1  63849258.35         17349         store           7005006                 5                    7  3.025645e+06                  845\n9    store     1001001           1              1  63849258.35         17349         store           9002003                 2                    9  9.185364e+06                 2480\n10   store     1001001           1              1  63849258.35         17349         store          10013012                13                   10  3.910832e+06                 1029\n11   store     1001001           1              1  63849258.35         17349         store           7001007                 1                    7  5.094872e+06                 1443\n12   store     1001001           1              1  63849258.35         17349         store          10009003                 9                   10  2.532342e+06                  672\n13   store     1001001           1              1  63849258.35         17349         store           6010006                10                    6  4.201299e+06                 1185\n14   store     1001001           1              1  63849258.35         17349         store           7016010                16                    7  3.250287e+06                  868\n15   store     1001001           1              1  63849258.35         17349         store           9011003                11                    9  7.764127e+06                 2129\n16   store     1001001           1              1  63849258.35         17349         store           9014008                14                    9  8.358089e+06                 2276\n17   store     1001001           1              1  63849258.35         17349         store           9015002                15                    9  7.711787e+06                 2156\n18   store     1001001           1              1  63849258.35         17349         store           8013002                13                    8  2.294785e+06                  635\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               iss.i_brand_id, \n               iss.i_class_id, \n               iss.i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item iss, \n               date_dim d \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = iss.i_item_sk \n               AND ss_sold_date_sk = d.d_date_sk \n               AND d.d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY iss.i_brand_id, \n                  iss.i_class_id, \n                  iss.i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               iss.i_brand_id, \n               iss.i_class_id, \n               iss.i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item iss, \n               date_dim d \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = iss.i_item_sk \n               AND ss_sold_date_sk = d.d_date_sk \n               AND d.d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY iss.i_brand_id, \n                  iss.i_class_id, \n                  iss.i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year \nWHERE  this_year.i_brand_id = last_year.i_brand_id \n       AND this_year.i_class_id = last_year.i_class_id \n       AND this_year.i_category_id = last_year.i_category_id \nORDER  BY this_year.channel, \n          this_year.i_brand_id, \n          this_year.i_class_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ISS\" AS ( SELECT \"ISS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ISS\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ISS\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"D\" AS ( SELECT \"D\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"D\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"D\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"D\" AS \"D\" ON \"D\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ISS\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"D\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" AND \"DATE_DIM\".\"D_DOM\" = 25 AND \"DATE_DIM\".\"D_MOY\" = 12 AND \"DATE_DIM\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ISS\".\"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"LAST_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"D\" AS \"D\" ON \"D\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ISS\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"D\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" AND \"DATE_DIM\".\"D_DOM\" = 25 AND \"DATE_DIM\".\"D_MOY\" = 12 AND \"DATE_DIM\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ISS\".\"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"LAST_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"LAST_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"LAST_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"LAST_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"LAST_YEAR\".\"SALES\" AS \"SALES\" , \"LAST_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" JOIN \"LAST_YEAR\" AS \"LAST_YEAR\" ON \"LAST_YEAR\".\"I_BRAND_ID\" = \"THIS_YEAR\".\"I_BRAND_ID\" AND \"LAST_YEAR\".\"I_CATEGORY_ID\" = \"THIS_YEAR\".\"I_CATEGORY_ID\" AND \"LAST_YEAR\".\"I_CLASS_ID\" = \"THIS_YEAR\".\"I_CLASS_ID\" ORDER BY \"THIS_YEAR\".\"CHANNEL\" NULLS LAST , \"THIS_YEAR\".\"I_BRAND_ID\" NULLS LAST , \"THIS_YEAR\".\"I_CLASS_ID\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_34\" AS SELECT \"SPEQLITE_TEMP_TABLE_19\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"SPEQLITE_TEMP_TABLE_19\" AS \"SPEQLITE_TEMP_TABLE_19\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.063741,
                    "execution_time": 0.035447,
                    "compile_time": 0.000277,
                    "planning_time": 0.003355,
                    "create_size": 4
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.118309,
                    "execution_time": 0.036801,
                    "compile_time": 0.000229,
                    "planning_time": 0.058058,
                    "create_size": 4
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_35\" AS SELECT \"D\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"D\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"D\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.103614,
                    "execution_time": 0.04041,
                    "compile_time": 0.000238,
                    "planning_time": 0.022704,
                    "create_size": 480
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.162514,
                    "execution_time": 0.040688,
                    "compile_time": 0.000227,
                    "planning_time": 0.082143,
                    "create_size": 480
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_36\" AS SELECT 'store' AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_34\" AS \"SPEQLITE_TEMP_TABLE_34\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_20\" AS \"SPEQLITE_TEMP_TABLE_20\" ON \"SPEQLITE_TEMP_TABLE_20\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_35\" AS \"SPEQLITE_TEMP_TABLE_35\" ON \"SPEQLITE_TEMP_TABLE_35\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_17\" AS \"SPEQLITE_TEMP_TABLE_17\" ON \"SPEQLITE_TEMP_TABLE_17\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"SPEQLITE_TEMP_TABLE_35\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" AND \"DATE_DIM\".\"D_DOM\" = 25 AND \"DATE_DIM\".\"D_MOY\" = 12 AND \"DATE_DIM\".\"D_YEAR\" = 2000 WHERE NOT \"SPEQLITE_TEMP_TABLE_20\".\"SS_ITEM_SK\" IS NULL GROUP BY \"SPEQLITE_TEMP_TABLE_17\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_34\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.405441,
                    "execution_time": 0.31364,
                    "compile_time": 0.000622,
                    "planning_time": 0.037119,
                    "create_size": 153
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.612891,
                    "execution_time": 0.458825,
                    "compile_time": 0.000669,
                    "planning_time": 0.098551,
                    "create_size": 153
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_37\" AS SELECT 'store' AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_34\" AS \"_U_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_20\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_35\" AS \"SPEQLITE_TEMP_TABLE_35\" ON \"SPEQLITE_TEMP_TABLE_35\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_17\" AS \"SPEQLITE_TEMP_TABLE_17\" ON \"SPEQLITE_TEMP_TABLE_17\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"SPEQLITE_TEMP_TABLE_35\".\"D_WEEK_SEQ\" = \"DATE_DIM\".\"D_WEEK_SEQ\" AND \"DATE_DIM\".\"D_DOM\" = 25 AND \"DATE_DIM\".\"D_MOY\" = 12 AND \"DATE_DIM\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"SPEQLITE_TEMP_TABLE_17\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_17\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.389633,
                    "execution_time": 0.312924,
                    "compile_time": 0.000624,
                    "planning_time": 0.036446,
                    "create_size": 18
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.480829,
                    "execution_time": 0.34113,
                    "compile_time": 0.00069,
                    "planning_time": 0.097751,
                    "create_size": 18
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_38\" AS SELECT \"SPEQLITE_TEMP_TABLE_36\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_36\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_36\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_36\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_36\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_36\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_37\".\"CHANNEL\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_37\".\"I_BRAND_ID\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_37\".\"I_CLASS_ID\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_37\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_37\".\"SALES\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_37\".\"NUMBER_SALES\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_36\" AS \"SPEQLITE_TEMP_TABLE_36\" JOIN \"SPEQLITE_TEMP_TABLE_37\" AS \"SPEQLITE_TEMP_TABLE_37\" ON \"SPEQLITE_TEMP_TABLE_37\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_36\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_37\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_36\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_37\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_36\".\"I_CLASS_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.291697,
                    "execution_time": 0.047217,
                    "compile_time": 0.205643,
                    "planning_time": 0.007195,
                    "create_size": 60
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 10.007525,
                    "execution_time": 0.049235,
                    "compile_time": 9.854576,
                    "planning_time": 0.062883,
                    "create_size": 60
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_38\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_38\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_38\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_38\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_38\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_38\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_38\" AS \"SPEQLITE_TEMP_TABLE_38\" ORDER BY \"SPEQLITE_TEMP_TABLE_38\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_38\".\"I_BRAND_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_38\".\"I_CLASS_ID\" NULLS LAST LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     1001001           1              1  63849258.35         17349         store           1001001                 1                    1  1.264098e+08                34516\n1    store     1001002           1              1  79817404.31         21735         store           1001002                 1                    1  6.523457e+07                17870\n2    store     1002001           2              1  63482961.33         17448         store           1002001                 2                    1  1.228776e+08                33376\n3    store     1002002           2              1  83934929.17         22841         store           1002002                 2                    1  6.529721e+07                17549\n4    store     1003001           3              1  67792075.78         18423         store           1003001                 3                    1  1.293290e+08                35228\n5    store     1003002           3              1  85010777.72         23041         store           1003002                 3                    1  6.378800e+07                17386\n6    store     1004001           4              1  65519651.92         17699         store           1004001                 4                    1  1.276248e+08                34538\n7    store     1004002           4              1  81914145.08         22371         store           1004002                 4                    1  6.589128e+07                17927\n8    store     2001001           1              2  66508072.22         18313         store           2001001                 1                    2  1.278399e+08                34831\n9    store     2001002           1              2  86861659.59         23407         store           2001002                 1                    2  6.694873e+07                18127\n10   store     2002001           2              2  65810996.43         17891         store           2002001                 2                    2  1.249255e+08                33981\n11   store     2002002           2              2  80178154.21         21551         store           2002002                 2                    2  6.059976e+07                16483\n12   store     2003001           3              2  63205068.38         17257         store           2003001                 3                    2  1.261207e+08                34194\n13   store     2003002           3              2  74253579.57         20069         store           2003002                 3                    2  5.746432e+07                15731\n14   store     2004001           4              2  69704476.84         18852         store           2004001                 4                    2  1.346163e+08                36711\n15   store     2004002           4              2  80815000.84         21896         store           2004002                 4                    2  5.926186e+07                16278\n16   store     3001001           1              3  68534514.50         18586         store           3001001                 1                    3  1.304496e+08                35267\n17   store     3001002           1              3  77295590.65         21224         store           3001002                 1                    3  6.110190e+07                16385\n18   store     3002001           2              3  67351395.95         18333         store           3002001                 2                    3  1.292699e+08                34884\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.038591,
                    "execution_time": 0.00845,
                    "compile_time": 0.017775,
                    "planning_time": 0.005245
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.339435,
                    "execution_time": 0.009361,
                    "compile_time": 3.278876,
                    "planning_time": 0.041267
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_36\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_36\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_36\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_36\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_36\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_36\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_37\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_37\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_37\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_37\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_37\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_37\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_36\" AS \"SPEQLITE_TEMP_TABLE_36\" JOIN \"SPEQLITE_TEMP_TABLE_37\" AS \"SPEQLITE_TEMP_TABLE_37\" ON \"SPEQLITE_TEMP_TABLE_37\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_36\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_37\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_36\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_37\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_36\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_36\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_36\".\"I_BRAND_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_36\".\"I_CLASS_ID\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_38\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_38\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_38\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_38\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_38\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_38\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_38\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_38\" AS \"SPEQLITE_TEMP_TABLE_38\" ORDER BY \"SPEQLITE_TEMP_TABLE_38\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_38\".\"I_BRAND_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_38\".\"I_CLASS_ID\" NULLS LAST"
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     1001001           1              1  63849258.35         17349         store           1001001                 1                    1  1.264098e+08                34516\n1    store     1001002           1              1  79817404.31         21735         store           1001002                 1                    1  6.523457e+07                17870\n2    store     1002001           2              1  63482961.33         17448         store           1002001                 2                    1  1.228776e+08                33376\n3    store     1002002           2              1  83934929.17         22841         store           1002002                 2                    1  6.529721e+07                17549\n4    store     1003001           3              1  67792075.78         18423         store           1003001                 3                    1  1.293290e+08                35228\n5    store     1003002           3              1  85010777.72         23041         store           1003002                 3                    1  6.378800e+07                17386\n6    store     1004001           4              1  65519651.92         17699         store           1004001                 4                    1  1.276248e+08                34538\n7    store     1004002           4              1  81914145.08         22371         store           1004002                 4                    1  6.589128e+07                17927\n8    store     2001001           1              2  66508072.22         18313         store           2001001                 1                    2  1.278399e+08                34831\n9    store     2001002           1              2  86861659.59         23407         store           2001002                 1                    2  6.694873e+07                18127\n10   store     2002001           2              2  65810996.43         17891         store           2002001                 2                    2  1.249255e+08                33981\n11   store     2002002           2              2  80178154.21         21551         store           2002002                 2                    2  6.059976e+07                16483\n12   store     2003001           3              2  63205068.38         17257         store           2003001                 3                    2  1.261207e+08                34194\n13   store     2003002           3              2  74253579.57         20069         store           2003002                 3                    2  5.746432e+07                15731\n14   store     2004001           4              2  69704476.84         18852         store           2004001                 4                    2  1.346163e+08                36711\n15   store     2004002           4              2  80815000.84         21896         store           2004002                 4                    2  5.926186e+07                16278\n16   store     3001001           1              3  68534514.50         18586         store           3001001                 1                    3  1.304496e+08                35267\n17   store     3001002           1              3  77295590.65         21224         store           3001002                 1                    3  6.110190e+07                16385\n18   store     3002001           2              3  67351395.95         18333         store           3002001                 2                    3  1.292699e+08                34884\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year \nWHERE  this_year.i_brand_id = last_year.i_brand_id \n       AND this_year.i_class_id = last_year.i_class_id \n       AND this_year.i_category_id = last_year.i_category_id \nORDER  BY this_year.channel, \n          this_year.i_brand_id, \n          this_year.i_class_id, \n          this_year.i_category_id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"LAST_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"LAST_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"LAST_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"LAST_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"LAST_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"LAST_YEAR\".\"SALES\" AS \"SALES\" , \"LAST_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" JOIN \"LAST_YEAR\" AS \"LAST_YEAR\" ON \"LAST_YEAR\".\"I_BRAND_ID\" = \"THIS_YEAR\".\"I_BRAND_ID\" AND \"LAST_YEAR\".\"I_CATEGORY_ID\" = \"THIS_YEAR\".\"I_CATEGORY_ID\" AND \"LAST_YEAR\".\"I_CLASS_ID\" = \"THIS_YEAR\".\"I_CLASS_ID\" ORDER BY \"THIS_YEAR\".\"CHANNEL\" NULLS LAST , \"THIS_YEAR\".\"I_BRAND_ID\" NULLS LAST , \"THIS_YEAR\".\"I_CLASS_ID\" NULLS LAST , \"THIS_YEAR\".\"I_CATEGORY_ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" NULLS LAST LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     1001001           1              1  63849258.35         17349         store          10005014                 5                   10  2.594778e+06                  761\n1    store     1001001           1              1  63849258.35         17349         store           8003001                 3                    8  5.881165e+06                 1542\n2    store     1001001           1              1  63849258.35         17349         store           9002005                 2                    9  7.651564e+06                 2065\n3    store     1001001           1              1  63849258.35         17349         store           8009004                 9                    8  3.360104e+06                  893\n4    store     1001001           1              1  63849258.35         17349         store           6015007                15                    6  7.474041e+06                 2021\n5    store     1001001           1              1  63849258.35         17349         store           8002002                 2                    8  3.313851e+06                  908\n6    store     1001001           1              1  63849258.35         17349         store          10012009                12                   10  2.567700e+06                  697\n7    store     1001001           1              1  63849258.35         17349         store           9001011                 1                    9  8.914948e+06                 2430\n8    store     1001001           1              1  63849258.35         17349         store           7005006                 5                    7  3.025645e+06                  845\n9    store     1001001           1              1  63849258.35         17349         store           9002003                 2                    9  9.185364e+06                 2480\n10   store     1001001           1              1  63849258.35         17349         store          10013012                13                   10  3.910832e+06                 1029\n11   store     1001001           1              1  63849258.35         17349         store           7001007                 1                    7  5.094872e+06                 1443\n12   store     1001001           1              1  63849258.35         17349         store          10009003                 9                   10  2.532342e+06                  672\n13   store     1001001           1              1  63849258.35         17349         store           6010006                10                    6  4.201299e+06                 1185\n14   store     1001001           1              1  63849258.35         17349         store           7016010                16                    7  3.250287e+06                  868\n15   store     1001001           1              1  63849258.35         17349         store           9011003                11                    9  7.764127e+06                 2129\n16   store     1001001           1              1  63849258.35         17349         store           9014008                14                    9  8.358089e+06                 2276\n17   store     1001001           1              1  63849258.35         17349         store           9015002                15                    9  7.711787e+06                 2156\n18   store     1001001           1              1  63849258.35         17349         store           8013002                13                    8  2.294785e+06                  635\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.226318,
                    "execution_time": 0.192178,
                    "compile_time": 0.015902,
                    "planning_time": 0.008236
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.507089,
                    "execution_time": 0.192526,
                    "compile_time": 3.247212,
                    "planning_time": 0.044436
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" NULLS LAST"
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     1001001           1              1  63849258.35         17349         store          10005014                 5                   10  2.594778e+06                  761\n1    store     1001001           1              1  63849258.35         17349         store           8003001                 3                    8  5.881165e+06                 1542\n2    store     1001001           1              1  63849258.35         17349         store           9002005                 2                    9  7.651564e+06                 2065\n3    store     1001001           1              1  63849258.35         17349         store           8009004                 9                    8  3.360104e+06                  893\n4    store     1001001           1              1  63849258.35         17349         store           6015007                15                    6  7.474041e+06                 2021\n5    store     1001001           1              1  63849258.35         17349         store           8002002                 2                    8  3.313851e+06                  908\n6    store     1001001           1              1  63849258.35         17349         store          10012009                12                   10  2.567700e+06                  697\n7    store     1001001           1              1  63849258.35         17349         store           9001011                 1                    9  8.914948e+06                 2430\n8    store     1001001           1              1  63849258.35         17349         store           7005006                 5                    7  3.025645e+06                  845\n9    store     1001001           1              1  63849258.35         17349         store           9002003                 2                    9  9.185364e+06                 2480\n10   store     1001001           1              1  63849258.35         17349         store          10013012                13                   10  3.910832e+06                 1029\n11   store     1001001           1              1  63849258.35         17349         store           7001007                 1                    7  5.094872e+06                 1443\n12   store     1001001           1              1  63849258.35         17349         store          10009003                 9                   10  2.532342e+06                  672\n13   store     1001001           1              1  63849258.35         17349         store           6010006                10                    6  4.201299e+06                 1185\n14   store     1001001           1              1  63849258.35         17349         store           7016010                16                    7  3.250287e+06                  868\n15   store     1001001           1              1  63849258.35         17349         store           9011003                11                    9  7.764127e+06                 2129\n16   store     1001001           1              1  63849258.35         17349         store           9014008                14                    9  8.358089e+06                 2276\n17   store     1001001           1              1  63849258.35         17349         store           9015002                15                    9  7.711787e+06                 2156\n18   store     1001001           1              1  63849258.35         17349         store           8013002                13                    8  2.294785e+06                  635\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) x \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT  * \nFROM   (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 + 1 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) this_year, \n       (SELECT 'store'                          channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(ss_quantity * ss_list_price) sales, \n               Count(*)                         number_sales \n        FROM   store_sales, \n               item, \n               date_dim \n        WHERE  ss_item_sk IN (SELECT ss_item_sk \n                              FROM   cross_items) \n               AND ss_item_sk = i_item_sk \n               AND ss_sold_date_sk = d_date_sk \n               AND d_week_seq = (SELECT d_week_seq \n                                 FROM   date_dim \n                                 WHERE  d_year = 1999 \n                                        AND d_moy = 12 \n                                        AND d_dom = 25) \n        GROUP  BY i_brand_id, \n                  i_class_id, \n                  i_category_id \n        HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                   FROM   avg_sales)) last_year \nWHERE  this_year.i_brand_id = last_year.i_brand_id \n       AND this_year.i_class_id = last_year.i_class_id \n       AND this_year.i_category_id = last_year.i_category_id \nORDER  BY this_year.channel, \n          this_year.i_brand_id, \n          this_year.i_class_id, \n          this_year.i_category_id\nLIMIT 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"X\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X_2\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X_2\" AS \"X\" ) , \"STORE_SALES_4\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_QUANTITY\" AS \"SS_QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"SS_LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"_U_2\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"X\" AS \"X\" ON \"ITEM\".\"I_BRAND_ID\" = \"X\".\"BRAND_ID\" AND \"ITEM\".\"I_CATEGORY_ID\" = \"X\".\"CATEGORY_ID\" AND \"ITEM\".\"I_CLASS_ID\" = \"X\".\"CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_WEEK_SEQ\" AS \"D_WEEK_SEQ\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"THIS_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_2\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 2000 WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_2\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) , \"LAST_YEAR\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES_4\" AS \"STORE_SALES\" CROSS JOIN \"_U_2\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_3\" ON \"_U_3\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM_2\" ON \"DATE_DIM\".\"D_WEEK_SEQ\" = \"DATE_DIM_2\".\"D_WEEK_SEQ\" AND \"DATE_DIM_2\".\"D_DOM\" = 25 AND \"DATE_DIM_2\".\"D_MOY\" = 12 AND \"DATE_DIM_2\".\"D_YEAR\" = 1999 WHERE NOT \"_U_3\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) ) SELECT \"THIS_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"THIS_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"THIS_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"THIS_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"THIS_YEAR\".\"SALES\" AS \"SALES\" , \"THIS_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"LAST_YEAR\".\"CHANNEL\" AS \"CHANNEL\" , \"LAST_YEAR\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"LAST_YEAR\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"LAST_YEAR\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"LAST_YEAR\".\"SALES\" AS \"SALES\" , \"LAST_YEAR\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"THIS_YEAR\" AS \"THIS_YEAR\" JOIN \"LAST_YEAR\" AS \"LAST_YEAR\" ON \"LAST_YEAR\".\"I_BRAND_ID\" = \"THIS_YEAR\".\"I_BRAND_ID\" AND \"LAST_YEAR\".\"I_CATEGORY_ID\" = \"THIS_YEAR\".\"I_CATEGORY_ID\" AND \"LAST_YEAR\".\"I_CLASS_ID\" = \"THIS_YEAR\".\"I_CLASS_ID\" ORDER BY \"THIS_YEAR\".\"CHANNEL\" NULLS LAST , \"THIS_YEAR\".\"I_BRAND_ID\" NULLS LAST , \"THIS_YEAR\".\"I_CLASS_ID\" NULLS LAST , \"THIS_YEAR\".\"I_CATEGORY_ID\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" NULLS LAST LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     1001001           1              1  63849258.35         17349         store          10005014                 5                   10  2.594778e+06                  761\n1    store     1001001           1              1  63849258.35         17349         store           8003001                 3                    8  5.881165e+06                 1542\n2    store     1001001           1              1  63849258.35         17349         store           9002005                 2                    9  7.651564e+06                 2065\n3    store     1001001           1              1  63849258.35         17349         store           8009004                 9                    8  3.360104e+06                  893\n4    store     1001001           1              1  63849258.35         17349         store           6015007                15                    6  7.474041e+06                 2021\n5    store     1001001           1              1  63849258.35         17349         store           8002002                 2                    8  3.313851e+06                  908\n6    store     1001001           1              1  63849258.35         17349         store          10012009                12                   10  2.567700e+06                  697\n7    store     1001001           1              1  63849258.35         17349         store           9001011                 1                    9  8.914948e+06                 2430\n8    store     1001001           1              1  63849258.35         17349         store           7005006                 5                    7  3.025645e+06                  845\n9    store     1001001           1              1  63849258.35         17349         store           9002003                 2                    9  9.185364e+06                 2480\n10   store     1001001           1              1  63849258.35         17349         store          10013012                13                   10  3.910832e+06                 1029\n11   store     1001001           1              1  63849258.35         17349         store           7001007                 1                    7  5.094872e+06                 1443\n12   store     1001001           1              1  63849258.35         17349         store          10009003                 9                   10  2.532342e+06                  672\n13   store     1001001           1              1  63849258.35         17349         store           6010006                10                    6  4.201299e+06                 1185\n14   store     1001001           1              1  63849258.35         17349         store           7016010                16                    7  3.250287e+06                  868\n15   store     1001001           1              1  63849258.35         17349         store           9011003                11                    9  7.764127e+06                 2129\n16   store     1001001           1              1  63849258.35         17349         store           9014008                14                    9  8.358089e+06                 2276\n17   store     1001001           1              1  63849258.35         17349         store           9015002                15                    9  7.711787e+06                 2156\n18   store     1001001           1              1  63849258.35         17349         store           8013002                13                    8  2.294785e+06                  635\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.210047,
                    "execution_time": 0.191788,
                    "compile_time": 0.00014,
                    "planning_time": 0.008258
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.21944,
                    "execution_time": 0.200663,
                    "compile_time": 0.000145,
                    "planning_time": 0.008377
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_24\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_24\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_30\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_30\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_24\" AS \"SPEQLITE_TEMP_TABLE_24\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_24\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_24\".\"I_BRAND_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_24\".\"I_CLASS_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_24\".\"I_CATEGORY_ID\" NULLS LAST LIMIT 100",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES\" AS \"SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES\" AS \"NUMBER_SALES\" , \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL_COL_6\" AS \"CHANNEL_COL_6\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID_COL_7\" AS \"I_BRAND_ID_COL_7\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID_COL_8\" AS \"I_CLASS_ID_COL_8\" , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID_COL_9\" AS \"I_CATEGORY_ID_COL_9\" , \"SPEQLITE_TEMP_TABLE_31\".\"SALES_COL_10\" AS \"SALES_COL_10\" , \"SPEQLITE_TEMP_TABLE_31\".\"NUMBER_SALES_COL_11\" AS \"NUMBER_SALES_COL_11\" FROM \"SPEQLITE_TEMP_TABLE_31\" AS \"SPEQLITE_TEMP_TABLE_31\" JOIN \"SPEQLITE_TEMP_TABLE_30\" AS \"SPEQLITE_TEMP_TABLE_30\" ON \"SPEQLITE_TEMP_TABLE_30\".\"I_BRAND_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CATEGORY_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_30\".\"I_CLASS_ID\" = \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" ORDER BY \"SPEQLITE_TEMP_TABLE_31\".\"CHANNEL\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_BRAND_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_CLASS_ID\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_31\".\"I_CATEGORY_ID\" NULLS LAST LIMIT 100"
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id        sales  number_sales channel_col_6  i_brand_id_col_7  i_class_id_col_8  i_category_id_col_9  sales_col_10  number_sales_col_11\n0    store     1001001           1              1  63849258.35         17349         store          10005014                 5                   10  2.594778e+06                  761\n1    store     1001001           1              1  63849258.35         17349         store           8003001                 3                    8  5.881165e+06                 1542\n2    store     1001001           1              1  63849258.35         17349         store           9002005                 2                    9  7.651564e+06                 2065\n3    store     1001001           1              1  63849258.35         17349         store           8009004                 9                    8  3.360104e+06                  893\n4    store     1001001           1              1  63849258.35         17349         store           6015007                15                    6  7.474041e+06                 2021\n5    store     1001001           1              1  63849258.35         17349         store           8002002                 2                    8  3.313851e+06                  908\n6    store     1001001           1              1  63849258.35         17349         store          10012009                12                   10  2.567700e+06                  697\n7    store     1001001           1              1  63849258.35         17349         store           9001011                 1                    9  8.914948e+06                 2430\n8    store     1001001           1              1  63849258.35         17349         store           7005006                 5                    7  3.025645e+06                  845\n9    store     1001001           1              1  63849258.35         17349         store           9002003                 2                    9  9.185364e+06                 2480\n10   store     1001001           1              1  63849258.35         17349         store          10013012                13                   10  3.910832e+06                 1029\n11   store     1001001           1              1  63849258.35         17349         store           7001007                 1                    7  5.094872e+06                 1443\n12   store     1001001           1              1  63849258.35         17349         store          10009003                 9                   10  2.532342e+06                  672\n13   store     1001001           1              1  63849258.35         17349         store           6010006                10                    6  4.201299e+06                 1185\n14   store     1001001           1              1  63849258.35         17349         store           7016010                16                    7  3.250287e+06                  868\n15   store     1001001           1              1  63849258.35         17349         store           9011003                11                    9  7.764127e+06                 2129\n16   store     1001001           1              1  63849258.35         17349         store           9014008                14                    9  8.358089e+06                 2276\n17   store     1001001           1              1  63849258.35         17349         store           9015002                15                    9  7.711787e+06                 2156\n18   store     1001001           1              1  63849258.35         17349         store           8013002                13                    8  2.294785e+06                  635\n...*/"
    }
]