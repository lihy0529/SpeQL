[
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     (select d_date_sk, d_date from date_dim) as dim, -- Assuming date_dim has these columns\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     (select d_date_sk, d_date from date_dim) as dim, -- Assuming date_dim has these columns\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     (select d_date_sk, d_date from date_dim) as dim, -- Assuming date_dim has these columns\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  wsr\n ) summary\n group by rollup(channel, id)\n )\n select * from results\n order by channel, id\n /*CURSOR_IDENTIFIER*/;",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DIM\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DIM\" AS \"DIM\" ON \"DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DIM\" AS \"DIM\" ON \"DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DIM\" AS \"DIM\" ON \"DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"SUMMARY\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"SUMMARY\".\"CHANNEL\" AS \"CHANNEL\" , \"SUMMARY\".\"ID\" AS \"ID\" , SUM ( \"SUMMARY\".\"SALES\" ) AS \"SALES\" , SUM ( \"SUMMARY\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"SUMMARY\".\"PROFIT\" ) AS \"PROFIT\" FROM \"SUMMARY\" AS \"SUMMARY\" GROUP BY ROLLUP ( \"SUMMARY\".\"CHANNEL\" , \"SUMMARY\".\"ID\" ) ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ORDER BY \"RESULTS\".\"CHANNEL\" NULLS LAST , \"RESULTS\".\"ID\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 12.195469,
                    "execution_time": 11.633607,
                    "compile_time": 0.000409,
                    "planning_time": 0.032763,
                    "create_size": 13440
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 26.146603,
                    "execution_time": 20.722244,
                    "compile_time": 4.851784,
                    "planning_time": 0.034082,
                    "create_size": 13440
                }
            }
        ],
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , ( SELECT D_DATE_SK , D_DATE FROM DATE_DIM ) AS DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , ( SELECT D_DATE_SK , D_DATE FROM DATE_DIM ) AS DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , ( SELECT D_DATE_SK , D_DATE FROM DATE_DIM ) AS DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS SUMMARY GROUP BY ROLLUP ( CHANNEL , ID ) ) SELECT * FROM RESULTS ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
                "preview": "\n/*            channel                            id         sales       returns        profit\n0              None                          None  1.139377e+10  2.441517e+08 -3.117214e+09\n1   catalog channel                          None  3.931255e+09  8.139799e+07 -4.441859e+08\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  1.035449e+07  9.137224e+04 -1.176622e+06\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  4.973426e+06  2.096417e+04 -6.392356e+05\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00  1.442031e+04 -1.020728e+04\n5   catalog channel  catalog_pageAAAAAAAAAAEAAAAA  0.000000e+00  1.743454e+04 -8.560800e+03\n6   catalog channel  catalog_pageAAAAAAAAAAFAAAAA  0.000000e+00  6.021100e+02 -2.875200e+02\n7   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00  3.044959e+05 -1.876899e+05\n8   catalog channel  catalog_pageAAAAAAAAABBAAAAA  1.066971e+07  6.735108e+04 -9.657929e+05\n9   catalog channel  catalog_pageAAAAAAAAABCAAAAA  5.308341e+06  2.648591e+04 -5.023632e+05\n10  catalog channel  catalog_pageAAAAAAAAABDAAAAA  0.000000e+00  2.378763e+04 -1.045046e+04\n11  catalog channel  catalog_pageAAAAAAAAABEAAAAA  0.000000e+00  4.864700e+03 -3.543160e+03\n12  catalog channel  catalog_pageAAAAAAAAABFAAAAA  0.000000e+00  4.370870e+03 -1.519240e+03\n13  catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00  3.400083e+05 -1.754601e+05\n14  catalog channel  catalog_pageAAAAAAAAACBAAAAA  1.093475e+07  7.864932e+04 -1.131547e+06\n15  catalog channel  catalog_pageAAAAAAAAACCAAAAA  5.423600e+06  3.198252e+04 -5.055619e+05\n16  catalog channel  catalog_pageAAAAAAAAACDAAAAA  0.000000e+00  2.121324e+04 -1.273482e+04\n17  catalog channel  catalog_pageAAAAAAAAACEAAAAA  0.000000e+00  1.325499e+04 -1.498940e+04\n18  catalog channel  catalog_pageAAAAAAAAACFAAAAA  0.000000e+00  1.067760e+03 -8.108700e+02\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.474228,
                    "execution_time": 0.225736,
                    "compile_time": 0.050432,
                    "planning_time": 0.162241
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 22.236255,
                    "execution_time": 18.007106,
                    "compile_time": 4.064274,
                    "planning_time": 0.167446
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id         sales       returns        profit\n0              None                          None  1.139377e+10  2.441517e+08 -3.117214e+09\n1   catalog channel                          None  3.931255e+09  8.139799e+07 -4.441859e+08\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  1.035449e+07  9.137224e+04 -1.176622e+06\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  4.973426e+06  2.096417e+04 -6.392356e+05\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00  1.442031e+04 -1.020728e+04\n5   catalog channel  catalog_pageAAAAAAAAAAEAAAAA  0.000000e+00  1.743454e+04 -8.560800e+03\n6   catalog channel  catalog_pageAAAAAAAAAAFAAAAA  0.000000e+00  6.021100e+02 -2.875200e+02\n7   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00  3.044959e+05 -1.876899e+05\n8   catalog channel  catalog_pageAAAAAAAAABBAAAAA  1.066971e+07  6.735108e+04 -9.657929e+05\n9   catalog channel  catalog_pageAAAAAAAAABCAAAAA  5.308341e+06  2.648591e+04 -5.023632e+05\n10  catalog channel  catalog_pageAAAAAAAAABDAAAAA  0.000000e+00  2.378763e+04 -1.045046e+04\n11  catalog channel  catalog_pageAAAAAAAAABEAAAAA  0.000000e+00  4.864700e+03 -3.543160e+03\n12  catalog channel  catalog_pageAAAAAAAAABFAAAAA  0.000000e+00  4.370870e+03 -1.519240e+03\n13  catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00  3.400083e+05 -1.754601e+05\n14  catalog channel  catalog_pageAAAAAAAAACBAAAAA  1.093475e+07  7.864932e+04 -1.131547e+06\n15  catalog channel  catalog_pageAAAAAAAAACCAAAAA  5.423600e+06  3.198252e+04 -5.055619e+05\n16  catalog channel  catalog_pageAAAAAAAAACDAAAAA  0.000000e+00  2.121324e+04 -1.273482e+04\n17  catalog channel  catalog_pageAAAAAAAAACEAAAAA  0.000000e+00  1.325499e+04 -1.498940e+04\n18  catalog channel  catalog_pageAAAAAAAAACFAAAAA  0.000000e+00  1.067760e+03 -8.108700e+02\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   csr\n union all\n select 'web channel' as channel\n        , 'web' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) as combined\n group by channel, id\n )\nselect *\nfrom results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"COMBINED\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"COMBINED\".\"CHANNEL\" AS \"CHANNEL\" , \"COMBINED\".\"ID\" AS \"ID\" , SUM ( \"COMBINED\".\"SALES\" ) AS \"SALES\" , SUM ( \"COMBINED\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"COMBINED\".\"PROFIT\" ) AS \"PROFIT\" FROM \"COMBINED\" AS \"COMBINED\" GROUP BY \"COMBINED\".\"CHANNEL\" , \"COMBINED\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS COMBINED GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAMKAAAAAA  28498533.36  652385.11 -12568443.28\n1     store channel         storeAAAAAAAANGAAAAAA  27658632.89  618502.67 -12099790.78\n2     store channel         storeAAAAAAAABDAAAAAA  27042169.68  572843.09 -12017193.15\n3   catalog channel  catalog_pageAAAAAAAAHMAAAAAA  10174408.84   85815.75  -1155138.34\n4   catalog channel  catalog_pageAAAAAAAAOBBAAAAA  10877213.59   75286.56  -1114386.02\n5   catalog channel  catalog_pageAAAAAAAALMAAAAAA  10466145.06   66924.08   -991444.66\n6   catalog channel  catalog_pageAAAAAAAAJFBAAAAA  11073230.49  110928.58   -956274.40\n7   catalog channel  catalog_pageAAAAAAAACDBAAAAA  10689835.49   84719.49  -1080831.87\n8   catalog channel  catalog_pageAAAAAAAAECBAAAAA  10404381.31   40513.46  -1332525.81\n9   catalog channel  catalog_pageAAAAAAAAIPBAAAAA   5444416.33   16505.16   -293401.14\n10  catalog channel  catalog_pageAAAAAAAABDAAAAAA         0.00  312885.25   -172552.18\n11  catalog channel  catalog_pageAAAAAAAACHAAAAAA         0.00  244333.58   -128711.07\n12  catalog channel  catalog_pageAAAAAAAACCDAAAAA         0.00   33964.37    -16163.66\n13  catalog channel  catalog_pageAAAAAAAAAOCAAAAA         0.00    8117.07     -6626.53\n14  catalog channel  catalog_pageAAAAAAAAKAEAAAAA         0.00    2860.87     -2572.04\n15  catalog channel  catalog_pageAAAAAAAAKECAAAAA         0.00   17351.68    -12479.04\n16  catalog channel  catalog_pageAAAAAAAAGGEAAAAA         0.00   11631.00     -8940.17\n17  catalog channel  catalog_pageAAAAAAAADICAAAAA         0.00   13776.23     -6031.93\n18  catalog channel  catalog_pageAAAAAAAABFCAAAAA         0.00    6558.46     -4741.37\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.445124,
                    "execution_time": 0.24046,
                    "compile_time": 0.01894,
                    "planning_time": 0.150404
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.776579,
                    "execution_time": 0.226027,
                    "compile_time": 3.254271,
                    "planning_time": 0.259486
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAMKAAAAAA  28498533.36  652385.11 -12568443.28\n1     store channel         storeAAAAAAAANGAAAAAA  27658632.89  618502.67 -12099790.78\n2     store channel         storeAAAAAAAABDAAAAAA  27042169.68  572843.09 -12017193.15\n3   catalog channel  catalog_pageAAAAAAAAHMAAAAAA  10174408.84   85815.75  -1155138.34\n4   catalog channel  catalog_pageAAAAAAAAOBBAAAAA  10877213.59   75286.56  -1114386.02\n5   catalog channel  catalog_pageAAAAAAAALMAAAAAA  10466145.06   66924.08   -991444.66\n6   catalog channel  catalog_pageAAAAAAAAJFBAAAAA  11073230.49  110928.58   -956274.40\n7   catalog channel  catalog_pageAAAAAAAACDBAAAAA  10689835.49   84719.49  -1080831.87\n8   catalog channel  catalog_pageAAAAAAAAECBAAAAA  10404381.31   40513.46  -1332525.81\n9   catalog channel  catalog_pageAAAAAAAAIPBAAAAA   5444416.33   16505.16   -293401.14\n10  catalog channel  catalog_pageAAAAAAAABDAAAAAA         0.00  312885.25   -172552.18\n11  catalog channel  catalog_pageAAAAAAAACHAAAAAA         0.00  244333.58   -128711.07\n12  catalog channel  catalog_pageAAAAAAAACCDAAAAA         0.00   33964.37    -16163.66\n13  catalog channel  catalog_pageAAAAAAAAAOCAAAAA         0.00    8117.07     -6626.53\n14  catalog channel  catalog_pageAAAAAAAAKAEAAAAA         0.00    2860.87     -2572.04\n15  catalog channel  catalog_pageAAAAAAAAKECAAAAA         0.00   17351.68    -12479.04\n16  catalog channel  catalog_pageAAAAAAAAGGEAAAAA         0.00   11631.00     -8940.17\n17  catalog channel  catalog_pageAAAAAAAADICAAAAA         0.00   13776.23     -6031.93\n18  catalog channel  catalog_pageAAAAAAAABFCAAAAA         0.00    6558.46     -4741.37\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(returns) as returns,\n        sum(profit_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as returns,\n            cast(0 as decimal(7,2)) as profit_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as returns,\n           sr_net_loss as profit_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(returns) as returns,\n        sum(profit_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as returns,\n            cast(0 as decimal(7,2)) as profit_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as returns,\n           cr_net_loss as profit_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(returns) as returns,\n        sum(profit_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as returns,\n            cast(0 as decimal(7,2)) as profit_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as returns,\n           wr_net_loss as profit_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  wsr\n )\n group by channel, id)\nselect * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURNS\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURNS\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"PROFIT_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURNS\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURNS\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"PROFIT_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURNS\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURNS\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"PROFIT_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURNS\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURNS\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 12.321706,
                    "execution_time": 11.737163,
                    "compile_time": 0.000407,
                    "planning_time": 0.032253,
                    "create_size": 13440
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 25.28478,
                    "execution_time": 24.611883,
                    "compile_time": 0.000416,
                    "planning_time": 0.114517,
                    "create_size": 13440
                }
            }
        ],
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURNS , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURNS , SR_NET_LOSS AS PROFIT_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURNS , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURNS , CR_NET_LOSS AS PROFIT_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURNS , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURNS , WR_NET_LOSS AS PROFIT_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAMHBAAAAA  27667350.59  690520.27 -12577954.71\n1   catalog channel  catalog_pageAAAAAAAAAIFAAAAA   5020385.32     230.88   -510442.30\n2   catalog channel  catalog_pageAAAAAAAAFMAAAAAA  10119157.38  112075.90  -1116493.02\n3   catalog channel  catalog_pageAAAAAAAAFGFAAAAA   5201170.71     159.96   -497643.95\n4   catalog channel  catalog_pageAAAAAAAAFABAAAAA  10186720.43   85304.63  -1170592.78\n5   catalog channel  catalog_pageAAAAAAAADMBAAAAA   5701268.60   23873.05   -467771.16\n6   catalog channel  catalog_pageAAAAAAAADIFAAAAA   5358370.64       0.00   -389462.03\n7   catalog channel  catalog_pageAAAAAAAALIBAAAAA   4923533.31   29729.37   -670004.69\n8   catalog channel  catalog_pageAAAAAAAAOMCAAAAA         0.00    6863.82     -5004.65\n9   catalog channel  catalog_pageAAAAAAAABLAAAAAA         0.00  274239.28   -160701.89\n10  catalog channel  catalog_pageAAAAAAAABJAAAAAA         0.00  256123.02   -121626.07\n11  catalog channel  catalog_pageAAAAAAAALOCAAAAA         0.00   10922.44     -6747.39\n12  catalog channel  catalog_pageAAAAAAAADFAAAAAA         0.00  289610.00   -170004.45\n13  catalog channel  catalog_pageAAAAAAAACPCAAAAA         0.00    3553.67     -3018.64\n14  catalog channel  catalog_pageAAAAAAAAHOCAAAAA         0.00   21464.56    -10816.77\n15  catalog channel  catalog_pageAAAAAAAACLCAAAAA         0.00   45618.65    -21957.64\n16  catalog channel  catalog_pageAAAAAAAAHFEAAAAA         0.00    9773.33     -6331.70\n17  catalog channel  catalog_pageAAAAAAAADFEAAAAA         0.00    9036.89     -9552.55\n18  catalog channel  catalog_pageAAAAAAAAFCDAAAAA         0.00   17544.08    -10912.63\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.419958,
                    "execution_time": 0.226176,
                    "compile_time": 0.000805,
                    "planning_time": 0.15545
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.616284,
                    "execution_time": 0.251687,
                    "compile_time": 0.069865,
                    "planning_time": 0.26008
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAMHBAAAAA  27667350.59  690520.27 -12577954.71\n1   catalog channel  catalog_pageAAAAAAAAAIFAAAAA   5020385.32     230.88   -510442.30\n2   catalog channel  catalog_pageAAAAAAAAFMAAAAAA  10119157.38  112075.90  -1116493.02\n3   catalog channel  catalog_pageAAAAAAAAFGFAAAAA   5201170.71     159.96   -497643.95\n4   catalog channel  catalog_pageAAAAAAAAFABAAAAA  10186720.43   85304.63  -1170592.78\n5   catalog channel  catalog_pageAAAAAAAADMBAAAAA   5701268.60   23873.05   -467771.16\n6   catalog channel  catalog_pageAAAAAAAADIFAAAAA   5358370.64       0.00   -389462.03\n7   catalog channel  catalog_pageAAAAAAAALIBAAAAA   4923533.31   29729.37   -670004.69\n8   catalog channel  catalog_pageAAAAAAAAOMCAAAAA         0.00    6863.82     -5004.65\n9   catalog channel  catalog_pageAAAAAAAABLAAAAAA         0.00  274239.28   -160701.89\n10  catalog channel  catalog_pageAAAAAAAABJAAAAAA         0.00  256123.02   -121626.07\n11  catalog channel  catalog_pageAAAAAAAALOCAAAAA         0.00   10922.44     -6747.39\n12  catalog channel  catalog_pageAAAAAAAADFAAAAAA         0.00  289610.00   -170004.45\n13  catalog channel  catalog_pageAAAAAAAACPCAAAAA         0.00    3553.67     -3018.64\n14  catalog channel  catalog_pageAAAAAAAAHOCAAAAA         0.00   21464.56    -10816.77\n15  catalog channel  catalog_pageAAAAAAAACLCAAAAA         0.00   45618.65    -21957.64\n16  catalog channel  catalog_pageAAAAAAAAHFEAAAAA         0.00    9773.33     -6331.70\n17  catalog channel  catalog_pageAAAAAAAADFEAAAAA         0.00    9036.89     -9552.55\n18  catalog channel  catalog_pageAAAAAAAAFCDAAAAA         0.00   17544.08    -10912.63\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from wsr\n ) final_results\n group by channel, id)\n select *\n from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"FINAL_RESULTS\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"FINAL_RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_RESULTS\".\"ID\" AS \"ID\" , SUM ( \"FINAL_RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"FINAL_RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"FINAL_RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"FINAL_RESULTS\" AS \"FINAL_RESULTS\" GROUP BY \"FINAL_RESULTS\".\"CHANNEL\" , \"FINAL_RESULTS\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS FINAL_RESULTS GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAGOAAAAAA  29203755.89  676507.96 -13085118.83\n1     store channel         storeAAAAAAAAOAAAAAAA  28694767.62  693515.63 -12894342.44\n2     store channel         storeAAAAAAAAPHAAAAAA  26990859.17  646886.02 -12354533.79\n3     store channel         storeAAAAAAAAGEAAAAAA  27926428.08  760369.26 -12094893.32\n4     store channel         storeAAAAAAAAOLAAAAAA  26752630.58  645299.63 -12021937.50\n5   catalog channel  catalog_pageAAAAAAAAMEBAAAAA   9997236.40   79962.91  -1104855.38\n6   catalog channel  catalog_pageAAAAAAAAEOAAAAAA  10707874.47   74964.02   -944041.08\n7   catalog channel  catalog_pageAAAAAAAAJGBAAAAA   9994959.05   68738.82  -1120901.99\n8   catalog channel  catalog_pageAAAAAAAAJIBAAAAA   5177559.16   15663.25   -573253.57\n9   catalog channel  catalog_pageAAAAAAAAFHBAAAAA  10720340.03   62728.59  -1197622.99\n10  catalog channel  catalog_pageAAAAAAAAHICAAAAA         0.00   20053.96    -11063.92\n11  catalog channel  catalog_pageAAAAAAAAIAAAAAAA         0.00  271914.67   -157429.68\n12  catalog channel  catalog_pageAAAAAAAAELAAAAAA         0.00  366877.52   -226775.01\n13  catalog channel  catalog_pageAAAAAAAAGEAAAAAA         0.00  282522.55   -155460.01\n14  catalog channel  catalog_pageAAAAAAAAGJAAAAAA         0.00  247233.42   -152709.89\n15  catalog channel  catalog_pageAAAAAAAACKAAAAAA         0.00  299246.18   -177606.14\n16  catalog channel  catalog_pageAAAAAAAAGODAAAAA         0.00    7913.65     -6310.56\n17  catalog channel  catalog_pageAAAAAAAACGDAAAAA         0.00   13483.01     -5578.29\n18  catalog channel  catalog_pageAAAAAAAAJFCAAAAA         0.00   13306.41     -5703.28\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.421208,
                    "execution_time": 0.226846,
                    "compile_time": 0.000846,
                    "planning_time": 0.156727
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.522028,
                    "execution_time": 0.222262,
                    "compile_time": 0.000766,
                    "planning_time": 0.262855
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAGOAAAAAA  29203755.89  676507.96 -13085118.83\n1     store channel         storeAAAAAAAAOAAAAAAA  28694767.62  693515.63 -12894342.44\n2     store channel         storeAAAAAAAAPHAAAAAA  26990859.17  646886.02 -12354533.79\n3     store channel         storeAAAAAAAAGEAAAAAA  27926428.08  760369.26 -12094893.32\n4     store channel         storeAAAAAAAAOLAAAAAA  26752630.58  645299.63 -12021937.50\n5   catalog channel  catalog_pageAAAAAAAAMEBAAAAA   9997236.40   79962.91  -1104855.38\n6   catalog channel  catalog_pageAAAAAAAAEOAAAAAA  10707874.47   74964.02   -944041.08\n7   catalog channel  catalog_pageAAAAAAAAJGBAAAAA   9994959.05   68738.82  -1120901.99\n8   catalog channel  catalog_pageAAAAAAAAJIBAAAAA   5177559.16   15663.25   -573253.57\n9   catalog channel  catalog_pageAAAAAAAAFHBAAAAA  10720340.03   62728.59  -1197622.99\n10  catalog channel  catalog_pageAAAAAAAAHICAAAAA         0.00   20053.96    -11063.92\n11  catalog channel  catalog_pageAAAAAAAAIAAAAAAA         0.00  271914.67   -157429.68\n12  catalog channel  catalog_pageAAAAAAAAELAAAAAA         0.00  366877.52   -226775.01\n13  catalog channel  catalog_pageAAAAAAAAGEAAAAAA         0.00  282522.55   -155460.01\n14  catalog channel  catalog_pageAAAAAAAAGJAAAAAA         0.00  247233.42   -152709.89\n15  catalog channel  catalog_pageAAAAAAAACKAAAAAA         0.00  299246.18   -177606.14\n16  catalog channel  catalog_pageAAAAAAAAGODAAAAA         0.00    7913.65     -6310.56\n17  catalog channel  catalog_pageAAAAAAAACGDAAAAA         0.00   13483.01     -5578.29\n18  catalog channel  catalog_pageAAAAAAAAJFCAAAAA         0.00   13306.41     -5703.28\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from wsr\n ) final_results\n group by channel, id\n) \nselect * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"FINAL_RESULTS\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"FINAL_RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_RESULTS\".\"ID\" AS \"ID\" , SUM ( \"FINAL_RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"FINAL_RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"FINAL_RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"FINAL_RESULTS\" AS \"FINAL_RESULTS\" GROUP BY \"FINAL_RESULTS\".\"CHANNEL\" , \"FINAL_RESULTS\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS FINAL_RESULTS GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAMHBAAAAA  27667350.59  690520.27 -12577954.71\n1   catalog channel  catalog_pageAAAAAAAAAIFAAAAA   5020385.32     230.88   -510442.30\n2   catalog channel  catalog_pageAAAAAAAAFMAAAAAA  10119157.38  112075.90  -1116493.02\n3   catalog channel  catalog_pageAAAAAAAAFGFAAAAA   5201170.71     159.96   -497643.95\n4   catalog channel  catalog_pageAAAAAAAAFABAAAAA  10186720.43   85304.63  -1170592.78\n5   catalog channel  catalog_pageAAAAAAAADMBAAAAA   5701268.60   23873.05   -467771.16\n6   catalog channel  catalog_pageAAAAAAAADIFAAAAA   5358370.64       0.00   -389462.03\n7   catalog channel  catalog_pageAAAAAAAALIBAAAAA   4923533.31   29729.37   -670004.69\n8   catalog channel  catalog_pageAAAAAAAAOMCAAAAA         0.00    6863.82     -5004.65\n9   catalog channel  catalog_pageAAAAAAAABLAAAAAA         0.00  274239.28   -160701.89\n10  catalog channel  catalog_pageAAAAAAAABJAAAAAA         0.00  256123.02   -121626.07\n11  catalog channel  catalog_pageAAAAAAAALOCAAAAA         0.00   10922.44     -6747.39\n12  catalog channel  catalog_pageAAAAAAAADFAAAAAA         0.00  289610.00   -170004.45\n13  catalog channel  catalog_pageAAAAAAAACPCAAAAA         0.00    3553.67     -3018.64\n14  catalog channel  catalog_pageAAAAAAAAHOCAAAAA         0.00   21464.56    -10816.77\n15  catalog channel  catalog_pageAAAAAAAACLCAAAAA         0.00   45618.65    -21957.64\n16  catalog channel  catalog_pageAAAAAAAAHFEAAAAA         0.00    9773.33     -6331.70\n17  catalog channel  catalog_pageAAAAAAAADFEAAAAA         0.00    9036.89     -9552.55\n18  catalog channel  catalog_pageAAAAAAAAFCDAAAAA         0.00   17544.08    -10912.63\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.412942,
                    "execution_time": 0.223914,
                    "compile_time": 0.000853,
                    "planning_time": 0.152242
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.52924,
                    "execution_time": 0.22525,
                    "compile_time": 0.000748,
                    "planning_time": 0.267416
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAMHBAAAAA  27667350.59  690520.27 -12577954.71\n1   catalog channel  catalog_pageAAAAAAAAAIFAAAAA   5020385.32     230.88   -510442.30\n2   catalog channel  catalog_pageAAAAAAAAFMAAAAAA  10119157.38  112075.90  -1116493.02\n3   catalog channel  catalog_pageAAAAAAAAFGFAAAAA   5201170.71     159.96   -497643.95\n4   catalog channel  catalog_pageAAAAAAAAFABAAAAA  10186720.43   85304.63  -1170592.78\n5   catalog channel  catalog_pageAAAAAAAADMBAAAAA   5701268.60   23873.05   -467771.16\n6   catalog channel  catalog_pageAAAAAAAADIFAAAAA   5358370.64       0.00   -389462.03\n7   catalog channel  catalog_pageAAAAAAAALIBAAAAA   4923533.31   29729.37   -670004.69\n8   catalog channel  catalog_pageAAAAAAAAOMCAAAAA         0.00    6863.82     -5004.65\n9   catalog channel  catalog_pageAAAAAAAABLAAAAAA         0.00  274239.28   -160701.89\n10  catalog channel  catalog_pageAAAAAAAABJAAAAAA         0.00  256123.02   -121626.07\n11  catalog channel  catalog_pageAAAAAAAALOCAAAAA         0.00   10922.44     -6747.39\n12  catalog channel  catalog_pageAAAAAAAADFAAAAAA         0.00  289610.00   -170004.45\n13  catalog channel  catalog_pageAAAAAAAACPCAAAAA         0.00    3553.67     -3018.64\n14  catalog channel  catalog_pageAAAAAAAAHOCAAAAA         0.00   21464.56    -10816.77\n15  catalog channel  catalog_pageAAAAAAAACLCAAAAA         0.00   45618.65    -21957.64\n16  catalog channel  catalog_pageAAAAAAAAHFEAAAAA         0.00    9773.33     -6331.70\n17  catalog channel  catalog_pageAAAAAAAADFEAAAAA         0.00    9036.89     -9552.55\n18  catalog channel  catalog_pageAAAAAAAAFCDAAAAA         0.00   17544.08    -10912.63\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr)\n group by channel, id\n )\n select * from results; \n /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAEFBAAAAA  26068962.48  619869.70 -12001137.09\n1   catalog channel  catalog_pageAAAAAAAALJBAAAAA   5209396.10   13926.85   -500280.31\n2   catalog channel  catalog_pageAAAAAAAAKPBAAAAA   4872810.27   28655.68   -638026.71\n3   catalog channel  catalog_pageAAAAAAAAHIFAAAAA   5044738.47      48.70   -490148.06\n4   catalog channel  catalog_pageAAAAAAAAOLBAAAAA   5192283.01   36795.68   -551881.39\n5   catalog channel  catalog_pageAAAAAAAAONAAAAAA  10408799.17   96219.54  -1024910.50\n6   catalog channel  catalog_pageAAAAAAAAKNAAAAAA  10769987.61   83244.19  -1366920.34\n7   catalog channel  catalog_pageAAAAAAAAEGFAAAAA   5040812.98       0.00   -725037.25\n8   catalog channel  catalog_pageAAAAAAAAPMBAAAAA   5295457.67   19405.46   -640871.71\n9   catalog channel  catalog_pageAAAAAAAAGIBAAAAA   5174382.76   31013.98   -517922.83\n10  catalog channel  catalog_pageAAAAAAAAANFAAAAA   5016286.89       0.00   -647420.93\n11  catalog channel  catalog_pageAAAAAAAAFEFAAAAA   4926393.67       0.00   -663937.39\n12  catalog channel  catalog_pageAAAAAAAAGFFAAAAA   5236754.36       0.00   -611770.99\n13  catalog channel  catalog_pageAAAAAAAAOKBAAAAA   5065397.41   39282.34   -622318.31\n14  catalog channel  catalog_pageAAAAAAAAMDFAAAAA   5449027.88       0.00   -582154.62\n15  catalog channel  catalog_pageAAAAAAAAMKFAAAAA   5475157.84       0.00   -545623.38\n16  catalog channel  catalog_pageAAAAAAAAPJAAAAAA         0.00  209050.03   -149275.43\n17  catalog channel  catalog_pageAAAAAAAAHGAAAAAA         0.00  276572.40   -169219.38\n18  catalog channel  catalog_pageAAAAAAAANKCAAAAA         0.00   31097.35    -11545.71\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.41667,
                    "execution_time": 0.22257,
                    "compile_time": 0.000774,
                    "planning_time": 0.157902
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.521437,
                    "execution_time": 0.222559,
                    "compile_time": 0.000762,
                    "planning_time": 0.262369
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAEFBAAAAA  26068962.48  619869.70 -12001137.09\n1   catalog channel  catalog_pageAAAAAAAALJBAAAAA   5209396.10   13926.85   -500280.31\n2   catalog channel  catalog_pageAAAAAAAAKPBAAAAA   4872810.27   28655.68   -638026.71\n3   catalog channel  catalog_pageAAAAAAAAHIFAAAAA   5044738.47      48.70   -490148.06\n4   catalog channel  catalog_pageAAAAAAAAOLBAAAAA   5192283.01   36795.68   -551881.39\n5   catalog channel  catalog_pageAAAAAAAAONAAAAAA  10408799.17   96219.54  -1024910.50\n6   catalog channel  catalog_pageAAAAAAAAKNAAAAAA  10769987.61   83244.19  -1366920.34\n7   catalog channel  catalog_pageAAAAAAAAEGFAAAAA   5040812.98       0.00   -725037.25\n8   catalog channel  catalog_pageAAAAAAAAPMBAAAAA   5295457.67   19405.46   -640871.71\n9   catalog channel  catalog_pageAAAAAAAAGIBAAAAA   5174382.76   31013.98   -517922.83\n10  catalog channel  catalog_pageAAAAAAAAANFAAAAA   5016286.89       0.00   -647420.93\n11  catalog channel  catalog_pageAAAAAAAAFEFAAAAA   4926393.67       0.00   -663937.39\n12  catalog channel  catalog_pageAAAAAAAAGFFAAAAA   5236754.36       0.00   -611770.99\n13  catalog channel  catalog_pageAAAAAAAAOKBAAAAA   5065397.41   39282.34   -622318.31\n14  catalog channel  catalog_pageAAAAAAAAMDFAAAAA   5449027.88       0.00   -582154.62\n15  catalog channel  catalog_pageAAAAAAAAMKFAAAAA   5475157.84       0.00   -545623.38\n16  catalog channel  catalog_pageAAAAAAAAPJAAAAAA         0.00  209050.03   -149275.43\n17  catalog channel  catalog_pageAAAAAAAAHGAAAAAA         0.00  276572.40   -169219.38\n18  catalog channel  catalog_pageAAAAAAAANKCAAAAA         0.00   31097.35    -11545.71\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id\n )\nselect * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAMIAAAAAA  27483878.79  620251.33 -12389572.66\n1     store channel         storeAAAAAAAAHCBAAAAA  27855729.41  703912.18 -12569558.09\n2     store channel         storeAAAAAAAAAEBAAAAA  26647272.90  687096.78 -12162040.66\n3     store channel         storeAAAAAAAALHBAAAAA  27402785.25  635888.58 -12249135.46\n4   catalog channel  catalog_pageAAAAAAAAGPAAAAAA  10601866.81   74691.34  -1138883.13\n5   catalog channel  catalog_pageAAAAAAAAJCBAAAAA  10282230.03   55334.49  -1110760.61\n6   catalog channel  catalog_pageAAAAAAAAADCAAAAA   5183567.51   21981.03   -569613.13\n7   catalog channel  catalog_pageAAAAAAAAHJFAAAAA   5180180.55       0.00   -507923.75\n8   catalog channel  catalog_pageAAAAAAAACJBAAAAA   5583344.19   14042.45   -460013.83\n9   catalog channel  catalog_pageAAAAAAAADFBAAAAA  10972586.16   61647.29   -869998.23\n10  catalog channel  catalog_pageAAAAAAAAEHFAAAAA   5484776.77       0.00   -570976.40\n11  catalog channel  catalog_pageAAAAAAAAMFFAAAAA   5036963.53       0.00   -654313.59\n12  catalog channel  catalog_pageAAAAAAAAIHAAAAAA         0.00  244470.54   -165760.55\n13  catalog channel  catalog_pageAAAAAAAAPDDAAAAA         0.00    6995.82     -4311.43\n14  catalog channel  catalog_pageAAAAAAAAMIAAAAAA         0.00  291610.15   -172279.79\n15  catalog channel  catalog_pageAAAAAAAAGGAAAAAA         0.00  252767.54   -152478.66\n16  catalog channel  catalog_pageAAAAAAAALEAAAAAA         0.00  263313.00   -139555.41\n17  catalog channel  catalog_pageAAAAAAAAAPDAAAAA         0.00   18885.34     -5736.32\n18  catalog channel  catalog_pageAAAAAAAAAHDAAAAA         0.00   28550.41    -16843.32\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.417094,
                    "execution_time": 0.226434,
                    "compile_time": 0.000781,
                    "planning_time": 0.153455
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.556295,
                    "execution_time": 0.225231,
                    "compile_time": 0.00074,
                    "planning_time": 0.290624
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAMIAAAAAA  27483878.79  620251.33 -12389572.66\n1     store channel         storeAAAAAAAAHCBAAAAA  27855729.41  703912.18 -12569558.09\n2     store channel         storeAAAAAAAAAEBAAAAA  26647272.90  687096.78 -12162040.66\n3     store channel         storeAAAAAAAALHBAAAAA  27402785.25  635888.58 -12249135.46\n4   catalog channel  catalog_pageAAAAAAAAGPAAAAAA  10601866.81   74691.34  -1138883.13\n5   catalog channel  catalog_pageAAAAAAAAJCBAAAAA  10282230.03   55334.49  -1110760.61\n6   catalog channel  catalog_pageAAAAAAAAADCAAAAA   5183567.51   21981.03   -569613.13\n7   catalog channel  catalog_pageAAAAAAAAHJFAAAAA   5180180.55       0.00   -507923.75\n8   catalog channel  catalog_pageAAAAAAAACJBAAAAA   5583344.19   14042.45   -460013.83\n9   catalog channel  catalog_pageAAAAAAAADFBAAAAA  10972586.16   61647.29   -869998.23\n10  catalog channel  catalog_pageAAAAAAAAEHFAAAAA   5484776.77       0.00   -570976.40\n11  catalog channel  catalog_pageAAAAAAAAMFFAAAAA   5036963.53       0.00   -654313.59\n12  catalog channel  catalog_pageAAAAAAAAIHAAAAAA         0.00  244470.54   -165760.55\n13  catalog channel  catalog_pageAAAAAAAAPDDAAAAA         0.00    6995.82     -4311.43\n14  catalog channel  catalog_pageAAAAAAAAMIAAAAAA         0.00  291610.15   -172279.79\n15  catalog channel  catalog_pageAAAAAAAAGGAAAAAA         0.00  252767.54   -152478.66\n16  catalog channel  catalog_pageAAAAAAAALEAAAAAA         0.00  263313.00   -139555.41\n17  catalog channel  catalog_pageAAAAAAAAAPDAAAAA         0.00   18885.34     -5736.32\n18  catalog channel  catalog_pageAAAAAAAAAHDAAAAA         0.00   28550.41    -16843.32\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\nSELECT * FROM results /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAANGAAAAAA  27658632.89  618502.67 -12099790.78\n1     store channel         storeAAAAAAAAMKAAAAAA  28498533.36  652385.11 -12568443.28\n2     store channel         storeAAAAAAAABDAAAAAA  27042169.68  572843.09 -12017193.15\n3   catalog channel  catalog_pageAAAAAAAACDBAAAAA  10689835.49   84719.49  -1080831.87\n4   catalog channel  catalog_pageAAAAAAAAHMAAAAAA  10174408.84   85815.75  -1155138.34\n5   catalog channel  catalog_pageAAAAAAAAECBAAAAA  10404381.31   40513.46  -1332525.81\n6   catalog channel  catalog_pageAAAAAAAALMAAAAAA  10466145.06   66924.08   -991444.66\n7   catalog channel  catalog_pageAAAAAAAAJFBAAAAA  11073230.49  110928.58   -956274.40\n8   catalog channel  catalog_pageAAAAAAAAIPBAAAAA   5444416.33   16505.16   -293401.14\n9   catalog channel  catalog_pageAAAAAAAAOBBAAAAA  10877213.59   75286.56  -1114386.02\n10  catalog channel  catalog_pageAAAAAAAACHAAAAAA         0.00  244333.58   -128711.07\n11  catalog channel  catalog_pageAAAAAAAABDAAAAAA         0.00  312885.25   -172552.18\n12  catalog channel  catalog_pageAAAAAAAABFCAAAAA         0.00    6558.46     -4741.37\n13  catalog channel  catalog_pageAAAAAAAAKECAAAAA         0.00   17351.68    -12479.04\n14  catalog channel  catalog_pageAAAAAAAABGDAAAAA         0.00   18329.95    -10419.70\n15  catalog channel  catalog_pageAAAAAAAAKDCAAAAA         0.00   14721.33    -13551.22\n16  catalog channel  catalog_pageAAAAAAAACCDAAAAA         0.00   33964.37    -16163.66\n17  catalog channel  catalog_pageAAAAAAAAMOEAAAAA         0.00    8634.36     -2391.48\n18  catalog channel  catalog_pageAAAAAAAAAOCAAAAA         0.00    8117.07     -6626.53\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.414523,
                    "execution_time": 0.22852,
                    "compile_time": 0.000733,
                    "planning_time": 0.150261
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.416488,
                    "execution_time": 0.225367,
                    "compile_time": 0.000743,
                    "planning_time": 0.154772
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAANGAAAAAA  27658632.89  618502.67 -12099790.78\n1     store channel         storeAAAAAAAAMKAAAAAA  28498533.36  652385.11 -12568443.28\n2     store channel         storeAAAAAAAABDAAAAAA  27042169.68  572843.09 -12017193.15\n3   catalog channel  catalog_pageAAAAAAAACDBAAAAA  10689835.49   84719.49  -1080831.87\n4   catalog channel  catalog_pageAAAAAAAAHMAAAAAA  10174408.84   85815.75  -1155138.34\n5   catalog channel  catalog_pageAAAAAAAAECBAAAAA  10404381.31   40513.46  -1332525.81\n6   catalog channel  catalog_pageAAAAAAAALMAAAAAA  10466145.06   66924.08   -991444.66\n7   catalog channel  catalog_pageAAAAAAAAJFBAAAAA  11073230.49  110928.58   -956274.40\n8   catalog channel  catalog_pageAAAAAAAAIPBAAAAA   5444416.33   16505.16   -293401.14\n9   catalog channel  catalog_pageAAAAAAAAOBBAAAAA  10877213.59   75286.56  -1114386.02\n10  catalog channel  catalog_pageAAAAAAAACHAAAAAA         0.00  244333.58   -128711.07\n11  catalog channel  catalog_pageAAAAAAAABDAAAAAA         0.00  312885.25   -172552.18\n12  catalog channel  catalog_pageAAAAAAAABFCAAAAA         0.00    6558.46     -4741.37\n13  catalog channel  catalog_pageAAAAAAAAKECAAAAA         0.00   17351.68    -12479.04\n14  catalog channel  catalog_pageAAAAAAAABGDAAAAA         0.00   18329.95    -10419.70\n15  catalog channel  catalog_pageAAAAAAAAKDCAAAAA         0.00   14721.33    -13551.22\n16  catalog channel  catalog_pageAAAAAAAACCDAAAAA         0.00   33964.37    -16163.66\n17  catalog channel  catalog_pageAAAAAAAAMOEAAAAA         0.00    8634.36     -2391.48\n18  catalog channel  catalog_pageAAAAAAAAAOCAAAAA         0.00    8117.07     -6626.53\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from results \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAIJAAAAAA  28485419.21  646321.81 -12731630.91\n1   catalog channel  catalog_pageAAAAAAAALEBAAAAA  10595186.28  101920.99  -1167638.56\n2   catalog channel  catalog_pageAAAAAAAAILBAAAAA   5753152.44   48627.15   -399399.12\n3   catalog channel  catalog_pageAAAAAAAAEJBAAAAA   5005193.35   30266.67   -488739.06\n4   catalog channel  catalog_pageAAAAAAAADBBAAAAA  10083138.27   88710.20  -1208849.98\n5   catalog channel  catalog_pageAAAAAAAALEFAAAAA   5111308.61    1067.43   -643091.81\n6   catalog channel  catalog_pageAAAAAAAABMAAAAAA  10858467.10   94006.12  -1209513.03\n7   catalog channel  catalog_pageAAAAAAAACACAAAAA   5203222.46   15275.78   -457030.79\n8   catalog channel  catalog_pageAAAAAAAABHBAAAAA  10331764.41   93177.75  -1269433.75\n9   catalog channel  catalog_pageAAAAAAAANPBAAAAA   5055777.02   27573.41   -488974.02\n10  catalog channel  catalog_pageAAAAAAAACMBAAAAA   4997874.52   22766.60   -662250.79\n11  catalog channel  catalog_pageAAAAAAAAIJAAAAAA         0.00  241938.37   -150543.54\n12  catalog channel  catalog_pageAAAAAAAAFHCAAAAA         0.00   17390.94    -12540.56\n13  catalog channel  catalog_pageAAAAAAAAFGAAAAAA         0.00  256714.15   -139983.40\n14  catalog channel  catalog_pageAAAAAAAANHAAAAAA         0.00  278398.53   -153374.12\n15  catalog channel  catalog_pageAAAAAAAAKFCAAAAA         0.00   15116.29     -9068.77\n16  catalog channel  catalog_pageAAAAAAAAPICAAAAA         0.00   18737.30    -11612.13\n17  catalog channel  catalog_pageAAAAAAAANBEAAAAA         0.00   20306.88    -10879.99\n18  catalog channel  catalog_pageAAAAAAAAAIDAAAAA         0.00   14412.67     -8864.42\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.410748,
                    "execution_time": 0.223943,
                    "compile_time": 0.000841,
                    "planning_time": 0.150542
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.531837,
                    "execution_time": 0.22298,
                    "compile_time": 0.000776,
                    "planning_time": 0.272148
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAIJAAAAAA  28485419.21  646321.81 -12731630.91\n1   catalog channel  catalog_pageAAAAAAAALEBAAAAA  10595186.28  101920.99  -1167638.56\n2   catalog channel  catalog_pageAAAAAAAAILBAAAAA   5753152.44   48627.15   -399399.12\n3   catalog channel  catalog_pageAAAAAAAAEJBAAAAA   5005193.35   30266.67   -488739.06\n4   catalog channel  catalog_pageAAAAAAAADBBAAAAA  10083138.27   88710.20  -1208849.98\n5   catalog channel  catalog_pageAAAAAAAALEFAAAAA   5111308.61    1067.43   -643091.81\n6   catalog channel  catalog_pageAAAAAAAABMAAAAAA  10858467.10   94006.12  -1209513.03\n7   catalog channel  catalog_pageAAAAAAAACACAAAAA   5203222.46   15275.78   -457030.79\n8   catalog channel  catalog_pageAAAAAAAABHBAAAAA  10331764.41   93177.75  -1269433.75\n9   catalog channel  catalog_pageAAAAAAAANPBAAAAA   5055777.02   27573.41   -488974.02\n10  catalog channel  catalog_pageAAAAAAAACMBAAAAA   4997874.52   22766.60   -662250.79\n11  catalog channel  catalog_pageAAAAAAAAIJAAAAAA         0.00  241938.37   -150543.54\n12  catalog channel  catalog_pageAAAAAAAAFHCAAAAA         0.00   17390.94    -12540.56\n13  catalog channel  catalog_pageAAAAAAAAFGAAAAAA         0.00  256714.15   -139983.40\n14  catalog channel  catalog_pageAAAAAAAANHAAAAAA         0.00  278398.53   -153374.12\n15  catalog channel  catalog_pageAAAAAAAAKFCAAAAA         0.00   15116.29     -9068.77\n16  catalog channel  catalog_pageAAAAAAAAPICAAAAA         0.00   18737.30    -11612.13\n17  catalog channel  catalog_pageAAAAAAAANBEAAAAA         0.00   20306.88    -10879.99\n18  catalog channel  catalog_pageAAAAAAAAAIDAAAAA         0.00   14412.67     -8864.42\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS ) LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAIGAAAAAA  25859959.93  780964.94 -11863853.23\n1     store channel         storeAAAAAAAAHGAAAAAA  26310257.58  625724.50 -11977110.83\n2     store channel         storeAAAAAAAABPAAAAAA  29160942.88  608961.95 -13240566.65\n3     store channel         storeAAAAAAAAEGBAAAAA  27432080.27  656365.20 -12875347.13\n4   catalog channel  catalog_pageAAAAAAAAICCAAAAA   5191756.91   35687.49   -483452.75\n5   catalog channel  catalog_pageAAAAAAAACOBAAAAA   5158431.51   22034.87   -534614.55\n6   catalog channel  catalog_pageAAAAAAAAMLFAAAAA   5297524.71       0.00   -557115.93\n7   catalog channel  catalog_pageAAAAAAAADNBAAAAA   5166025.45   21768.60   -623805.35\n8   catalog channel  catalog_pageAAAAAAAALIFAAAAA   5374942.52       0.00   -670019.22\n9   catalog channel  catalog_pageAAAAAAAAFHFAAAAA   5277546.77     885.40   -361359.18\n10  catalog channel  catalog_pageAAAAAAAAFPBAAAAA   5227721.27   27441.42   -525495.18\n11  catalog channel  catalog_pageAAAAAAAAHMBAAAAA   5199026.15   31635.08   -673168.79\n12  catalog channel  catalog_pageAAAAAAAAGHFAAAAA   5171482.89       0.00   -371667.15\n13  catalog channel  catalog_pageAAAAAAAANEAAAAAA         0.00  300719.48   -153896.57\n14  catalog channel  catalog_pageAAAAAAAABEAAAAAA         0.00  237335.06   -149341.91\n15  catalog channel  catalog_pageAAAAAAAALDAAAAAA         0.00  287840.18   -186695.49\n16  catalog channel  catalog_pageAAAAAAAAIECAAAAA         0.00   29320.04    -16583.04\n17  catalog channel  catalog_pageAAAAAAAAODCAAAAA         0.00   31867.50    -13075.88\n18  catalog channel  catalog_pageAAAAAAAANJAAAAAA         0.00  309603.40   -174066.53\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.417786,
                    "execution_time": 0.223172,
                    "compile_time": 0.000729,
                    "planning_time": 0.158903
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.531209,
                    "execution_time": 0.224644,
                    "compile_time": 0.000726,
                    "planning_time": 0.270229
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAIGAAAAAA  25859959.93  780964.94 -11863853.23\n1     store channel         storeAAAAAAAAHGAAAAAA  26310257.58  625724.50 -11977110.83\n2     store channel         storeAAAAAAAABPAAAAAA  29160942.88  608961.95 -13240566.65\n3     store channel         storeAAAAAAAAEGBAAAAA  27432080.27  656365.20 -12875347.13\n4   catalog channel  catalog_pageAAAAAAAAICCAAAAA   5191756.91   35687.49   -483452.75\n5   catalog channel  catalog_pageAAAAAAAACOBAAAAA   5158431.51   22034.87   -534614.55\n6   catalog channel  catalog_pageAAAAAAAAMLFAAAAA   5297524.71       0.00   -557115.93\n7   catalog channel  catalog_pageAAAAAAAADNBAAAAA   5166025.45   21768.60   -623805.35\n8   catalog channel  catalog_pageAAAAAAAALIFAAAAA   5374942.52       0.00   -670019.22\n9   catalog channel  catalog_pageAAAAAAAAFHFAAAAA   5277546.77     885.40   -361359.18\n10  catalog channel  catalog_pageAAAAAAAAFPBAAAAA   5227721.27   27441.42   -525495.18\n11  catalog channel  catalog_pageAAAAAAAAHMBAAAAA   5199026.15   31635.08   -673168.79\n12  catalog channel  catalog_pageAAAAAAAAGHFAAAAA   5171482.89       0.00   -371667.15\n13  catalog channel  catalog_pageAAAAAAAANEAAAAAA         0.00  300719.48   -153896.57\n14  catalog channel  catalog_pageAAAAAAAABEAAAAAA         0.00  237335.06   -149341.91\n15  catalog channel  catalog_pageAAAAAAAALDAAAAAA         0.00  287840.18   -186695.49\n16  catalog channel  catalog_pageAAAAAAAAIECAAAAA         0.00   29320.04    -16583.04\n17  catalog channel  catalog_pageAAAAAAAAODCAAAAA         0.00   31867.50    -13075.88\n18  catalog channel  catalog_pageAAAAAAAANJAAAAAA         0.00  309603.40   -174066.53\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns\n     , date_dim\n     , store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns\n     , date_dim\n     , catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns\n     , date_dim\n     , web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union all\n  select channel, id, sales, returns, profit from results\n) as final_results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FINAL_RESULTS\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION ALL SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FINAL_RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_RESULTS\".\"ID\" AS \"ID\" , \"FINAL_RESULTS\".\"SALES\" AS \"SALES\" , \"FINAL_RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"FINAL_RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"FINAL_RESULTS\" AS \"FINAL_RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION ALL SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS ) AS FINAL_RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id  sales   returns    profit\n0   catalog channel  catalog_pageAAAAAAAADIDAAAAA    0.0  17430.93 -13652.21\n1   catalog channel  catalog_pageAAAAAAAAAKDAAAAA    0.0  13658.17  -7738.48\n2   catalog channel  catalog_pageAAAAAAAACOCAAAAA    0.0   9138.16  -8894.80\n3   catalog channel  catalog_pageAAAAAAAAMNCAAAAA    0.0   6933.65  -4157.07\n4   catalog channel  catalog_pageAAAAAAAANJCAAAAA    0.0  13894.58 -14372.76\n5   catalog channel  catalog_pageAAAAAAAAIJDAAAAA    0.0  12815.98  -5741.51\n6   catalog channel  catalog_pageAAAAAAAAHIDAAAAA    0.0  10486.85  -4950.84\n7   catalog channel  catalog_pageAAAAAAAADCFAAAAA    0.0  15841.73  -7421.68\n8   catalog channel  catalog_pageAAAAAAAAGNCAAAAA    0.0  24551.53 -27619.44\n9   catalog channel  catalog_pageAAAAAAAAGBEAAAAA    0.0  17081.21  -8813.29\n10  catalog channel  catalog_pageAAAAAAAAEMEAAAAA    0.0   1583.40  -1279.16\n11  catalog channel  catalog_pageAAAAAAAAEIDAAAAA    0.0  30305.19 -12794.69\n12  catalog channel  catalog_pageAAAAAAAAFKCAAAAA    0.0  15921.88  -4186.79\n13  catalog channel  catalog_pageAAAAAAAAPPEAAAAA    0.0   2669.62   -529.18\n14  catalog channel  catalog_pageAAAAAAAAFLEAAAAA    0.0   7382.34  -3073.59\n15  catalog channel  catalog_pageAAAAAAAAIGDAAAAA    0.0  19800.44  -6442.72\n16  catalog channel  catalog_pageAAAAAAAACGCAAAAA    0.0   8603.57  -7047.41\n17  catalog channel  catalog_pageAAAAAAAAANDAAAAA    0.0   8768.56  -5652.08\n18  catalog channel  catalog_pageAAAAAAAAADDAAAAA    0.0  21100.33 -10388.61\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.642871,
                    "execution_time": 0.272805,
                    "compile_time": 0.001065,
                    "planning_time": 0.620217
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 5.560947,
                    "execution_time": 0.273207,
                    "compile_time": 4.816908,
                    "planning_time": 1.051398
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id  sales   returns    profit\n0   catalog channel  catalog_pageAAAAAAAADIDAAAAA    0.0  17430.93 -13652.21\n1   catalog channel  catalog_pageAAAAAAAAAKDAAAAA    0.0  13658.17  -7738.48\n2   catalog channel  catalog_pageAAAAAAAACOCAAAAA    0.0   9138.16  -8894.80\n3   catalog channel  catalog_pageAAAAAAAAMNCAAAAA    0.0   6933.65  -4157.07\n4   catalog channel  catalog_pageAAAAAAAANJCAAAAA    0.0  13894.58 -14372.76\n5   catalog channel  catalog_pageAAAAAAAAIJDAAAAA    0.0  12815.98  -5741.51\n6   catalog channel  catalog_pageAAAAAAAAHIDAAAAA    0.0  10486.85  -4950.84\n7   catalog channel  catalog_pageAAAAAAAADCFAAAAA    0.0  15841.73  -7421.68\n8   catalog channel  catalog_pageAAAAAAAAGNCAAAAA    0.0  24551.53 -27619.44\n9   catalog channel  catalog_pageAAAAAAAAGBEAAAAA    0.0  17081.21  -8813.29\n10  catalog channel  catalog_pageAAAAAAAAEMEAAAAA    0.0   1583.40  -1279.16\n11  catalog channel  catalog_pageAAAAAAAAEIDAAAAA    0.0  30305.19 -12794.69\n12  catalog channel  catalog_pageAAAAAAAAFKCAAAAA    0.0  15921.88  -4186.79\n13  catalog channel  catalog_pageAAAAAAAAPPEAAAAA    0.0   2669.62   -529.18\n14  catalog channel  catalog_pageAAAAAAAAFLEAAAAA    0.0   7382.34  -3073.59\n15  catalog channel  catalog_pageAAAAAAAAIGDAAAAA    0.0  19800.44  -6442.72\n16  catalog channel  catalog_pageAAAAAAAACGCAAAAA    0.0   8603.57  -7047.41\n17  catalog channel  catalog_pageAAAAAAAAANDAAAAA    0.0   8768.56  -5652.08\n18  catalog channel  catalog_pageAAAAAAAAADDAAAAA    0.0  21100.33 -10388.61\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union\n  select channel, null as id, sum(sales), sum(returns), sum(profit) from results group by channel\n) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"_Q_0\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"RETURNS\" AS \"RETURNS\" , \"_Q_0\".\"PROFIT\" AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS GROUP BY CHANNEL ) LIMIT 21",
                "preview": "\n/*            channel                            id         sales     returns       profit\n0     store channel         storeAAAAAAAADDBAAAAA  2.652385e+07   718829.51 -12120185.08\n1     store channel         storeAAAAAAAAHAAAAAAA  2.654305e+07   631660.20 -11712125.21\n2       web channel      web_siteAAAAAAAAKAAAAAAA  1.656747e+08  2570595.65 -18623924.04\n3   catalog channel  catalog_pageAAAAAAAABLBAAAAA  5.136568e+06    30526.57   -476016.37\n4   catalog channel  catalog_pageAAAAAAAAEIFAAAAA  5.457608e+06        0.00   -405814.86\n5   catalog channel  catalog_pageAAAAAAAAEACAAAAA  5.150566e+06    10972.02   -555973.38\n6   catalog channel  catalog_pageAAAAAAAAFJFAAAAA  5.203675e+06        0.00   -435849.94\n7   catalog channel  catalog_pageAAAAAAAADGAAAAAA  0.000000e+00   305018.21   -178441.21\n8   catalog channel  catalog_pageAAAAAAAAHLFAAAAA  5.164757e+06       68.68   -585141.42\n9   catalog channel  catalog_pageAAAAAAAANIBAAAAA  5.052160e+06    30059.58   -700141.80\n10  catalog channel  catalog_pageAAAAAAAAELFAAAAA  4.988495e+06      100.04   -846212.58\n11  catalog channel  catalog_pageAAAAAAAAPFAAAAAA  0.000000e+00   332227.82   -186319.84\n12  catalog channel  catalog_pageAAAAAAAALKDAAAAA  0.000000e+00    28292.98     -7845.09\n13  catalog channel  catalog_pageAAAAAAAADCFAAAAA  0.000000e+00    15841.73     -7421.68\n14  catalog channel  catalog_pageAAAAAAAAIHDAAAAA  0.000000e+00    22302.49    -14530.45\n15  catalog channel  catalog_pageAAAAAAAAOFCAAAAA  0.000000e+00    14855.15     -6608.64\n16  catalog channel  catalog_pageAAAAAAAAPAEAAAAA  0.000000e+00     3929.00     -3065.79\n17  catalog channel  catalog_pageAAAAAAAAIDAAAAAA  0.000000e+00   257074.81   -152256.10\n18  catalog channel  catalog_pageAAAAAAAAHMCAAAAA  0.000000e+00     8925.68     -7806.55\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.917181,
                    "execution_time": 0.481319,
                    "compile_time": 0.001748,
                    "planning_time": 0.52351
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 7.595052,
                    "execution_time": 0.48239,
                    "compile_time": 6.562874,
                    "planning_time": 0.843247
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id         sales     returns       profit\n0     store channel         storeAAAAAAAADDBAAAAA  2.652385e+07   718829.51 -12120185.08\n1     store channel         storeAAAAAAAAHAAAAAAA  2.654305e+07   631660.20 -11712125.21\n2       web channel      web_siteAAAAAAAAKAAAAAAA  1.656747e+08  2570595.65 -18623924.04\n3   catalog channel  catalog_pageAAAAAAAABLBAAAAA  5.136568e+06    30526.57   -476016.37\n4   catalog channel  catalog_pageAAAAAAAAEIFAAAAA  5.457608e+06        0.00   -405814.86\n5   catalog channel  catalog_pageAAAAAAAAEACAAAAA  5.150566e+06    10972.02   -555973.38\n6   catalog channel  catalog_pageAAAAAAAAFJFAAAAA  5.203675e+06        0.00   -435849.94\n7   catalog channel  catalog_pageAAAAAAAADGAAAAAA  0.000000e+00   305018.21   -178441.21\n8   catalog channel  catalog_pageAAAAAAAAHLFAAAAA  5.164757e+06       68.68   -585141.42\n9   catalog channel  catalog_pageAAAAAAAANIBAAAAA  5.052160e+06    30059.58   -700141.80\n10  catalog channel  catalog_pageAAAAAAAAELFAAAAA  4.988495e+06      100.04   -846212.58\n11  catalog channel  catalog_pageAAAAAAAAPFAAAAAA  0.000000e+00   332227.82   -186319.84\n12  catalog channel  catalog_pageAAAAAAAALKDAAAAA  0.000000e+00    28292.98     -7845.09\n13  catalog channel  catalog_pageAAAAAAAADCFAAAAA  0.000000e+00    15841.73     -7421.68\n14  catalog channel  catalog_pageAAAAAAAAIHDAAAAA  0.000000e+00    22302.49    -14530.45\n15  catalog channel  catalog_pageAAAAAAAAOFCAAAAA  0.000000e+00    14855.15     -6608.64\n16  catalog channel  catalog_pageAAAAAAAAPAEAAAAA  0.000000e+00     3929.00     -3065.79\n17  catalog channel  catalog_pageAAAAAAAAIDAAAAAA  0.000000e+00   257074.81   -152256.10\n18  catalog channel  catalog_pageAAAAAAAAHMCAAAAA  0.000000e+00     8925.68     -7806.55\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - 0) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - 0) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - 0) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union\n  select channel, null as id, sum(sales), sum(returns), sum(profit) from results group by channel\n) results_final  /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - 0 AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - 0 AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - 0 AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"RESULTS_FINAL\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" ) SELECT \"RESULTS_FINAL\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS_FINAL\".\"ID\" AS \"ID\" , \"RESULTS_FINAL\".\"SALES\" AS \"SALES\" , \"RESULTS_FINAL\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS_FINAL\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS_FINAL\" AS \"RESULTS_FINAL\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 9.250022,
                    "execution_time": 8.753909,
                    "compile_time": 0.000402,
                    "planning_time": 0.031771,
                    "create_size": 10880
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 24.966349,
                    "execution_time": 20.128521,
                    "compile_time": 4.251576,
                    "planning_time": 0.114319,
                    "create_size": 10880
                }
            }
        ],
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - 0 ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - 0 ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - 0 ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS GROUP BY CHANNEL ) AS RESULTS_FINAL LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAOIBAAAAA  27229624.45  671697.12 -12222428.12\n1     store channel         storeAAAAAAAAAHBAAAAA  27663112.98  660602.23 -11906550.57\n2     store channel         storeAAAAAAAAKDBAAAAA  26525572.42  702992.46 -11081327.69\n3     store channel         storeAAAAAAAAEIBAAAAA  26681981.07  667475.01 -12169423.09\n4     store channel         storeAAAAAAAAEDBAAAAA  25446188.42  621430.39 -11151382.06\n5   catalog channel  catalog_pageAAAAAAAAONBAAAAA   5403701.82   25154.08   -465858.69\n6   catalog channel  catalog_pageAAAAAAAABEBAAAAA  10021999.35  109413.60  -1329545.87\n7   catalog channel  catalog_pageAAAAAAAACGFAAAAA   5152852.10    5079.36   -666715.03\n8   catalog channel  catalog_pageAAAAAAAAJFBAAAAA  11073230.49  110928.58   -892434.16\n9   catalog channel  catalog_pageAAAAAAAAIPBAAAAA   5444416.33   16505.16   -279920.57\n10  catalog channel  catalog_pageAAAAAAAADPBAAAAA   5269949.38   12309.86   -374004.01\n11  catalog channel  catalog_pageAAAAAAAAEHBAAAAA  10322416.16   95039.55  -1131095.02\n12  catalog channel  catalog_pageAAAAAAAAHHFAAAAA   5047193.00       0.00   -591884.05\n13  catalog channel  catalog_pageAAAAAAAAJGCAAAAA         0.00   31148.80         0.00\n14  catalog channel  catalog_pageAAAAAAAAILDAAAAA         0.00   10921.62         0.00\n15  catalog channel  catalog_pageAAAAAAAAIIDAAAAA         0.00   20231.01         0.00\n16  catalog channel  catalog_pageAAAAAAAAGJDAAAAA         0.00   20490.80         0.00\n17  catalog channel  catalog_pageAAAAAAAAFBFAAAAA         0.00   19908.84         0.00\n18  catalog channel  catalog_pageAAAAAAAAAHEAAAAA         0.00    3083.21         0.00\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.018267,
                    "execution_time": 0.471977,
                    "compile_time": 0.112107,
                    "planning_time": 0.632898
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 15.816181,
                    "execution_time": 1.443882,
                    "compile_time": 13.854129,
                    "planning_time": 8.770018
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0     store channel         storeAAAAAAAAOIBAAAAA  27229624.45  671697.12 -12222428.12\n1     store channel         storeAAAAAAAAAHBAAAAA  27663112.98  660602.23 -11906550.57\n2     store channel         storeAAAAAAAAKDBAAAAA  26525572.42  702992.46 -11081327.69\n3     store channel         storeAAAAAAAAEIBAAAAA  26681981.07  667475.01 -12169423.09\n4     store channel         storeAAAAAAAAEDBAAAAA  25446188.42  621430.39 -11151382.06\n5   catalog channel  catalog_pageAAAAAAAAONBAAAAA   5403701.82   25154.08   -465858.69\n6   catalog channel  catalog_pageAAAAAAAABEBAAAAA  10021999.35  109413.60  -1329545.87\n7   catalog channel  catalog_pageAAAAAAAACGFAAAAA   5152852.10    5079.36   -666715.03\n8   catalog channel  catalog_pageAAAAAAAAJFBAAAAA  11073230.49  110928.58   -892434.16\n9   catalog channel  catalog_pageAAAAAAAAIPBAAAAA   5444416.33   16505.16   -279920.57\n10  catalog channel  catalog_pageAAAAAAAADPBAAAAA   5269949.38   12309.86   -374004.01\n11  catalog channel  catalog_pageAAAAAAAAEHBAAAAA  10322416.16   95039.55  -1131095.02\n12  catalog channel  catalog_pageAAAAAAAAHHFAAAAA   5047193.00       0.00   -591884.05\n13  catalog channel  catalog_pageAAAAAAAAJGCAAAAA         0.00   31148.80         0.00\n14  catalog channel  catalog_pageAAAAAAAAILDAAAAA         0.00   10921.62         0.00\n15  catalog channel  catalog_pageAAAAAAAAIIDAAAAA         0.00   20231.01         0.00\n16  catalog channel  catalog_pageAAAAAAAAGJDAAAAA         0.00   20490.80         0.00\n17  catalog channel  catalog_pageAAAAAAAAFBFAAAAA         0.00   19908.84         0.00\n18  catalog channel  catalog_pageAAAAAAAAAHEAAAAA         0.00    3083.21         0.00\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union\n  select channel, null as id, sum(sales), sum(returns), sum(profit) from results group by channel\n  union\n  select null as channel, null as id, sum(sales), sum(returns), sum(profit) from results) foo\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS ) AS FOO LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns       profit\n0   catalog channel  catalog_pageAAAAAAAANOCAAAAA         0.00    8309.91     -5203.98\n1   catalog channel  catalog_pageAAAAAAAAOIEAAAAA         0.00    1504.84     -2455.60\n2   catalog channel  catalog_pageAAAAAAAAOLCAAAAA         0.00   22338.77    -11486.08\n3   catalog channel  catalog_pageAAAAAAAAIAFAAAAA         0.00    1948.31     -2118.53\n4   catalog channel  catalog_pageAAAAAAAADECAAAAA         0.00   20389.85     -9070.39\n5   catalog channel  catalog_pageAAAAAAAAMBDAAAAA         0.00    3043.37     -3158.75\n6   catalog channel  catalog_pageAAAAAAAAKHDAAAAA         0.00   16259.78    -10343.94\n7   catalog channel  catalog_pageAAAAAAAABPDAAAAA         0.00   10302.48     -3064.74\n8     store channel         storeAAAAAAAAILAAAAAA  28384107.01  640269.64 -12458334.72\n9     store channel         storeAAAAAAAAIDAAAAAA  27527712.55  667158.96 -12216547.35\n10    store channel         storeAAAAAAAAMABAAAAA  26960054.99  652732.13 -12160868.91\n11    store channel         storeAAAAAAAAOFBAAAAA  27133589.08  631128.16 -11805304.04\n12  catalog channel  catalog_pageAAAAAAAAGKBAAAAA   5004474.57   42851.58   -634484.66\n13  catalog channel  catalog_pageAAAAAAAAFGFAAAAA   5201170.71     159.96   -497643.95\n14  catalog channel  catalog_pageAAAAAAAAIHFAAAAA   5198206.29     678.92   -537189.71\n15  catalog channel  catalog_pageAAAAAAAAEBAAAAAA         0.00  239576.30   -147058.02\n16  catalog channel  catalog_pageAAAAAAAAMEAAAAAA         0.00  334858.32   -191669.88\n17  catalog channel  catalog_pageAAAAAAAAGHAAAAAA         0.00  305206.70   -164434.41\n18  catalog channel  catalog_pageAAAAAAAABDEAAAAA         0.00   31136.85    -11464.04\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.35367,
                    "execution_time": 0.658634,
                    "compile_time": 0.020769,
                    "planning_time": 0.742697
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.609162,
                    "execution_time": 0.653511,
                    "compile_time": 3.168295,
                    "planning_time": 0.864409
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns       profit\n0   catalog channel  catalog_pageAAAAAAAANOCAAAAA         0.00    8309.91     -5203.98\n1   catalog channel  catalog_pageAAAAAAAAOIEAAAAA         0.00    1504.84     -2455.60\n2   catalog channel  catalog_pageAAAAAAAAOLCAAAAA         0.00   22338.77    -11486.08\n3   catalog channel  catalog_pageAAAAAAAAIAFAAAAA         0.00    1948.31     -2118.53\n4   catalog channel  catalog_pageAAAAAAAADECAAAAA         0.00   20389.85     -9070.39\n5   catalog channel  catalog_pageAAAAAAAAMBDAAAAA         0.00    3043.37     -3158.75\n6   catalog channel  catalog_pageAAAAAAAAKHDAAAAA         0.00   16259.78    -10343.94\n7   catalog channel  catalog_pageAAAAAAAABPDAAAAA         0.00   10302.48     -3064.74\n8     store channel         storeAAAAAAAAILAAAAAA  28384107.01  640269.64 -12458334.72\n9     store channel         storeAAAAAAAAIDAAAAAA  27527712.55  667158.96 -12216547.35\n10    store channel         storeAAAAAAAAMABAAAAA  26960054.99  652732.13 -12160868.91\n11    store channel         storeAAAAAAAAOFBAAAAA  27133589.08  631128.16 -11805304.04\n12  catalog channel  catalog_pageAAAAAAAAGKBAAAAA   5004474.57   42851.58   -634484.66\n13  catalog channel  catalog_pageAAAAAAAAFGFAAAAA   5201170.71     159.96   -497643.95\n14  catalog channel  catalog_pageAAAAAAAAIHFAAAAA   5198206.29     678.92   -537189.71\n15  catalog channel  catalog_pageAAAAAAAAEBAAAAAA         0.00  239576.30   -147058.02\n16  catalog channel  catalog_pageAAAAAAAAMEAAAAAA         0.00  334858.32   -191669.88\n17  catalog channel  catalog_pageAAAAAAAAGHAAAAAA         0.00  305206.70   -164434.41\n18  catalog channel  catalog_pageAAAAAAAABDEAAAAA         0.00   31136.85    -11464.04\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union\n  select channel, null as id, sum(sales), sum(returns), sum(profit) from results group by channel\n  union\n  select null as channel, null as id, sum(sales), sum(returns), sum(profit) from results) foo\norder by channel, id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\" ORDER BY \"CHANNEL\" NULLS LAST , \"ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS ) AS FOO ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
                "preview": "\n/*            channel                            id         sales       returns        profit\n0              None                          None  1.139377e+10  2.441517e+08 -3.117214e+09\n1   catalog channel                          None  3.931255e+09  8.139799e+07 -4.441859e+08\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  1.035449e+07  9.137224e+04 -1.176622e+06\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  4.973426e+06  2.096417e+04 -6.392356e+05\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00  1.442031e+04 -1.020728e+04\n5   catalog channel  catalog_pageAAAAAAAAAAEAAAAA  0.000000e+00  1.743454e+04 -8.560800e+03\n6   catalog channel  catalog_pageAAAAAAAAAAFAAAAA  0.000000e+00  6.021100e+02 -2.875200e+02\n7   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00  3.044959e+05 -1.876899e+05\n8   catalog channel  catalog_pageAAAAAAAAABBAAAAA  1.066971e+07  6.735108e+04 -9.657929e+05\n9   catalog channel  catalog_pageAAAAAAAAABCAAAAA  5.308341e+06  2.648591e+04 -5.023632e+05\n10  catalog channel  catalog_pageAAAAAAAAABDAAAAA  0.000000e+00  2.378763e+04 -1.045046e+04\n11  catalog channel  catalog_pageAAAAAAAAABEAAAAA  0.000000e+00  4.864700e+03 -3.543160e+03\n12  catalog channel  catalog_pageAAAAAAAAABFAAAAA  0.000000e+00  4.370870e+03 -1.519240e+03\n13  catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00  3.400083e+05 -1.754601e+05\n14  catalog channel  catalog_pageAAAAAAAAACBAAAAA  1.093475e+07  7.864932e+04 -1.131547e+06\n15  catalog channel  catalog_pageAAAAAAAAACCAAAAA  5.423600e+06  3.198252e+04 -5.055619e+05\n16  catalog channel  catalog_pageAAAAAAAAACDAAAAA  0.000000e+00  2.121324e+04 -1.273482e+04\n17  catalog channel  catalog_pageAAAAAAAAACEAAAAA  0.000000e+00  1.325499e+04 -1.498940e+04\n18  catalog channel  catalog_pageAAAAAAAAACFAAAAA  0.000000e+00  1.067760e+03 -8.108700e+02\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.30281,
                    "execution_time": 0.652166,
                    "compile_time": 0.038826,
                    "planning_time": 0.684601
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.509303,
                    "execution_time": 0.656233,
                    "compile_time": 0.123649,
                    "planning_time": 0.812029
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id         sales       returns        profit\n0              None                          None  1.139377e+10  2.441517e+08 -3.117214e+09\n1   catalog channel                          None  3.931255e+09  8.139799e+07 -4.441859e+08\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  1.035449e+07  9.137224e+04 -1.176622e+06\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  4.973426e+06  2.096417e+04 -6.392356e+05\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00  1.442031e+04 -1.020728e+04\n5   catalog channel  catalog_pageAAAAAAAAAAEAAAAA  0.000000e+00  1.743454e+04 -8.560800e+03\n6   catalog channel  catalog_pageAAAAAAAAAAFAAAAA  0.000000e+00  6.021100e+02 -2.875200e+02\n7   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00  3.044959e+05 -1.876899e+05\n8   catalog channel  catalog_pageAAAAAAAAABBAAAAA  1.066971e+07  6.735108e+04 -9.657929e+05\n9   catalog channel  catalog_pageAAAAAAAAABCAAAAA  5.308341e+06  2.648591e+04 -5.023632e+05\n10  catalog channel  catalog_pageAAAAAAAAABDAAAAA  0.000000e+00  2.378763e+04 -1.045046e+04\n11  catalog channel  catalog_pageAAAAAAAAABEAAAAA  0.000000e+00  4.864700e+03 -3.543160e+03\n12  catalog channel  catalog_pageAAAAAAAAABFAAAAA  0.000000e+00  4.370870e+03 -1.519240e+03\n13  catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00  3.400083e+05 -1.754601e+05\n14  catalog channel  catalog_pageAAAAAAAAACBAAAAA  1.093475e+07  7.864932e+04 -1.131547e+06\n15  catalog channel  catalog_pageAAAAAAAAACCAAAAA  5.423600e+06  3.198252e+04 -5.055619e+05\n16  catalog channel  catalog_pageAAAAAAAAACDAAAAA  0.000000e+00  2.121324e+04 -1.273482e+04\n17  catalog channel  catalog_pageAAAAAAAAACEAAAAA  0.000000e+00  1.325499e+04 -1.498940e+04\n18  catalog channel  catalog_pageAAAAAAAAACFAAAAA  0.000000e+00  1.067760e+03 -8.108700e+02\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union\n  select channel, null as id, sum(sales), sum(returns), sum(profit) from results group by channel\n  union\n  select null as channel, null as id, sum(sales), sum(returns), sum(profit) from results) foo\norder by channel, id\nlimit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\" ORDER BY \"CHANNEL\" NULLS LAST , \"ID\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS ) AS FOO ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
                "preview": "\n/*            channel                            id         sales       returns        profit\n0              None                          None  1.139377e+10  2.441517e+08 -3.117214e+09\n1   catalog channel                          None  3.931255e+09  8.139799e+07 -4.441859e+08\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  1.035449e+07  9.137224e+04 -1.176622e+06\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  4.973426e+06  2.096417e+04 -6.392356e+05\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00  1.442031e+04 -1.020728e+04\n5   catalog channel  catalog_pageAAAAAAAAAAEAAAAA  0.000000e+00  1.743454e+04 -8.560800e+03\n6   catalog channel  catalog_pageAAAAAAAAAAFAAAAA  0.000000e+00  6.021100e+02 -2.875200e+02\n7   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00  3.044959e+05 -1.876899e+05\n8   catalog channel  catalog_pageAAAAAAAAABBAAAAA  1.066971e+07  6.735108e+04 -9.657929e+05\n9   catalog channel  catalog_pageAAAAAAAAABCAAAAA  5.308341e+06  2.648591e+04 -5.023632e+05\n10  catalog channel  catalog_pageAAAAAAAAABDAAAAA  0.000000e+00  2.378763e+04 -1.045046e+04\n11  catalog channel  catalog_pageAAAAAAAAABEAAAAA  0.000000e+00  4.864700e+03 -3.543160e+03\n12  catalog channel  catalog_pageAAAAAAAAABFAAAAA  0.000000e+00  4.370870e+03 -1.519240e+03\n13  catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00  3.400083e+05 -1.754601e+05\n14  catalog channel  catalog_pageAAAAAAAAACBAAAAA  1.093475e+07  7.864932e+04 -1.131547e+06\n15  catalog channel  catalog_pageAAAAAAAAACCAAAAA  5.423600e+06  3.198252e+04 -5.055619e+05\n16  catalog channel  catalog_pageAAAAAAAAACDAAAAA  0.000000e+00  2.121324e+04 -1.273482e+04\n17  catalog channel  catalog_pageAAAAAAAAACEAAAAA  0.000000e+00  1.325499e+04 -1.498940e+04\n18  catalog channel  catalog_pageAAAAAAAAACFAAAAA  0.000000e+00  1.067760e+03 -8.108700e+02\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.27051,
                    "execution_time": 0.650694,
                    "compile_time": 0.002342,
                    "planning_time": 0.692283
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.269102,
                    "execution_time": 0.647771,
                    "compile_time": 0.002475,
                    "planning_time": 0.695277
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id         sales       returns        profit\n0              None                          None  1.139377e+10  2.441517e+08 -3.117214e+09\n1   catalog channel                          None  3.931255e+09  8.139799e+07 -4.441859e+08\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  1.035449e+07  9.137224e+04 -1.176622e+06\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  4.973426e+06  2.096417e+04 -6.392356e+05\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00  1.442031e+04 -1.020728e+04\n5   catalog channel  catalog_pageAAAAAAAAAAEAAAAA  0.000000e+00  1.743454e+04 -8.560800e+03\n6   catalog channel  catalog_pageAAAAAAAAAAFAAAAA  0.000000e+00  6.021100e+02 -2.875200e+02\n7   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00  3.044959e+05 -1.876899e+05\n8   catalog channel  catalog_pageAAAAAAAAABBAAAAA  1.066971e+07  6.735108e+04 -9.657929e+05\n9   catalog channel  catalog_pageAAAAAAAAABCAAAAA  5.308341e+06  2.648591e+04 -5.023632e+05\n10  catalog channel  catalog_pageAAAAAAAAABDAAAAA  0.000000e+00  2.378763e+04 -1.045046e+04\n11  catalog channel  catalog_pageAAAAAAAAABEAAAAA  0.000000e+00  4.864700e+03 -3.543160e+03\n12  catalog channel  catalog_pageAAAAAAAAABFAAAAA  0.000000e+00  4.370870e+03 -1.519240e+03\n13  catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00  3.400083e+05 -1.754601e+05\n14  catalog channel  catalog_pageAAAAAAAAACBAAAAA  1.093475e+07  7.864932e+04 -1.131547e+06\n15  catalog channel  catalog_pageAAAAAAAAACCAAAAA  5.423600e+06  3.198252e+04 -5.055619e+05\n16  catalog channel  catalog_pageAAAAAAAAACDAAAAA  0.000000e+00  2.121324e+04 -1.273482e+04\n17  catalog channel  catalog_pageAAAAAAAAACEAAAAA  0.000000e+00  1.325499e+04 -1.498940e+04\n18  catalog channel  catalog_pageAAAAAAAAACFAAAAA  0.000000e+00  1.067760e+03 -8.108700e+02\n...*/"
    }
]