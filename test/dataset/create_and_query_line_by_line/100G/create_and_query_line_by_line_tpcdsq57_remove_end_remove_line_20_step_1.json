[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) as sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) as rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1\n left join v1 as v1_lag on v1.rn = v1_lag.rn + 1\n left join v1 as v1_lead on v1.rn = v1_lead.rn - 1\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category \n/*CURSOR_IDENTIFIER*/)\nselect * from v2;",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"CALL_CENTER\".\"CC_NAME\" AS \"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"ITEM\" AS \"ITEM\" JOIN \"CATALOG_SALES\" AS \"CATALOG_SALES\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" JOIN \"CALL_CENTER\" AS \"CALL_CENTER\" ON \"CALL_CENTER\".\"CC_CALL_CENTER_SK\" = \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"CC_NAME\" AS \"CC_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" LEFT JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 LEFT JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 WHERE \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"CALL_CENTER\".\"CC_NAME\" AS \"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"ITEM\" AS \"ITEM\" JOIN \"CATALOG_SALES\" AS \"CATALOG_SALES\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" JOIN \"CALL_CENTER\" AS \"CALL_CENTER\" ON \"CALL_CENTER\".\"CC_CALL_CENTER_SK\" = \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.134558,
                    "execution_time": 1.568572,
                    "compile_time": 0.147836,
                    "planning_time": 0.065478,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 16.965916,
                    "execution_time": 3.105648,
                    "compile_time": 13.481045,
                    "planning_time": 0.059253,
                    "create_size": 1280
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 WHERE \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 30,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_1\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 WHERE \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" LIMIT 21",
                "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum    nsum\n0       North Midwest_2    2001      3             126.07      63.59  19749.88  166.94\n1            NY Metro_2    2001      5              61.48       9.77  19749.88  166.94\n2            NY Metro_1    2001      2             135.19      87.12  19749.88  166.94\n3        Mid Atlantic_2    2001      1             163.90       1.94  19749.88  166.94\n4          Mid Atlantic    2001      2              65.04      58.67  19749.88  166.94\n5         Hawaii/Alaska    2001      1             173.87     201.34  19749.88  166.94\n6     Pacific Northwest    2001      8             141.97      38.22  19749.88  166.94\n7        Mid Atlantic_2    2001      4             120.99     103.27  19749.88  166.94\n8          Mid Atlantic    2001      3             103.64      18.34  19749.88  166.94\n9         Hawaii/Alaska    2001      6             119.39      21.55  19749.88  166.94\n10       Mid Atlantic_2    2001      1             207.60     148.27  19749.88  166.94\n11  Pacific Northwest_1    2002      1              90.51      90.51  19749.88  166.94\n12         Mid Atlantic    2001      1             136.58      95.17  19749.88  166.94\n13       Mid Atlantic_1    2001      5              98.11     337.18  19749.88  166.94\n14      Hawaii/Alaska_1    2001      1             111.83       8.06  19749.88  166.94\n15        Hawaii/Alaska    2001      2              56.65      37.75  19749.88  166.94\n16         California_1    2001      7             193.22     162.57  19749.88  166.94\n17           California    2001      2             139.77       4.39  19749.88  166.94\n18           NY Metro_1    2001      3             110.78     142.04  19749.88  166.94\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 8.493763,
                    "execution_time": 8.469154,
                    "compile_time": 0.000204,
                    "planning_time": 0.011472
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 14.824124,
                    "execution_time": 8.519315,
                    "compile_time": 6.249141,
                    "planning_time": 0.048781
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_1\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 WHERE \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_1\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 LEFT JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 WHERE \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\""
            }
        ],
        "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum    nsum\n0       North Midwest_2    2001      3             126.07      63.59  19749.88  166.94\n1            NY Metro_2    2001      5              61.48       9.77  19749.88  166.94\n2            NY Metro_1    2001      2             135.19      87.12  19749.88  166.94\n3        Mid Atlantic_2    2001      1             163.90       1.94  19749.88  166.94\n4          Mid Atlantic    2001      2              65.04      58.67  19749.88  166.94\n5         Hawaii/Alaska    2001      1             173.87     201.34  19749.88  166.94\n6     Pacific Northwest    2001      8             141.97      38.22  19749.88  166.94\n7        Mid Atlantic_2    2001      4             120.99     103.27  19749.88  166.94\n8          Mid Atlantic    2001      3             103.64      18.34  19749.88  166.94\n9         Hawaii/Alaska    2001      6             119.39      21.55  19749.88  166.94\n10       Mid Atlantic_2    2001      1             207.60     148.27  19749.88  166.94\n11  Pacific Northwest_1    2002      1              90.51      90.51  19749.88  166.94\n12         Mid Atlantic    2001      1             136.58      95.17  19749.88  166.94\n13       Mid Atlantic_1    2001      5              98.11     337.18  19749.88  166.94\n14      Hawaii/Alaska_1    2001      1             111.83       8.06  19749.88  166.94\n15        Hawaii/Alaska    2001      2              56.65      37.75  19749.88  166.94\n16         California_1    2001      7             193.22     162.57  19749.88  166.94\n17           California    2001      2             139.77       4.39  19749.88  166.94\n18           NY Metro_1    2001      3             110.78     142.04  19749.88  166.94\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) as sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) as rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk = cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2000 and d_moy = 12) or\n         ( d_year = 2002 and d_moy = 1)\n       )\n group by i_category, i_brand,\n          cc_name, d_year, d_moy),\n v2 as(\n select v1.cc_name,\n        v1.d_year, v1.d_moy,\n        v1.avg_monthly_sales,\n        v1.sum_sales,\n        lag(v1.sum_sales) over (partition by v1.i_category, v1.i_brand, v1.cc_name order by v1.d_year, v1.d_moy) as psum,\n        lead(v1.sum_sales) over (partition by v1.i_category, v1.i_brand, v1.cc_name order by v1.d_year, v1.d_moy) as nsum\n from v1\n)\nselect * from v2\nwhere /*CURSOR_IDENTIFIER*/ 1 = 1",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" AS \"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"CATALOG_SALES\" AS \"CATALOG_SALES\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" JOIN \"CALL_CENTER\" AS \"CALL_CENTER\" ON \"CALL_CENTER\".\"CC_CALL_CENTER_SK\" = \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) , \"V2\" AS ( SELECT \"V1\".\"CC_NAME\" AS \"CC_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , LAG ( \"V1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"V1\".\"I_CATEGORY\" , \"V1\".\"I_BRAND\" , \"V1\".\"CC_NAME\" ORDER BY \"V1\".\"D_YEAR\" NULLS LAST , \"V1\".\"D_MOY\" NULLS LAST ) AS \"PSUM\" , LEAD ( \"V1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"V1\".\"I_CATEGORY\" , \"V1\".\"I_BRAND\" , \"V1\".\"CC_NAME\" ORDER BY \"V1\".\"D_YEAR\" NULLS LAST , \"V1\".\"D_MOY\" NULLS LAST ) AS \"NSUM\" FROM \"V1\" AS \"V1\" ) SELECT \"V2\".\"CC_NAME\" AS \"CC_NAME\" , \"V2\".\"D_YEAR\" AS \"D_YEAR\" , \"V2\".\"D_MOY\" AS \"D_MOY\" , \"V2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V2\".\"PSUM\" AS \"PSUM\" , \"V2\".\"NSUM\" AS \"NSUM\" FROM \"V2\" AS \"V2\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" AS \"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"CATALOG_SALES\" AS \"CATALOG_SALES\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" JOIN \"CALL_CENTER\" AS \"CALL_CENTER\" ON \"CALL_CENTER\".\"CC_CALL_CENTER_SK\" = \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.186381,
                    "execution_time": 1.565668,
                    "compile_time": 0.250125,
                    "planning_time": 0.058865,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 11.744372,
                    "execution_time": 4.403304,
                    "compile_time": 9.852463,
                    "planning_time": 0.142252,
                    "create_size": 1280
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"SPEQLITE_TEMP_TABLE_2\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , LAG ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_2\".\"CC_NAME\" ORDER BY \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" NULLS LAST ) AS \"PSUM\" , LEAD ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_2\".\"CC_NAME\" ORDER BY \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" NULLS LAST ) AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.864581,
                    "execution_time": 0.124269,
                    "compile_time": 0.279583,
                    "planning_time": 0.0058,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 13.797469,
                    "execution_time": 0.168011,
                    "compile_time": 13.133541,
                    "planning_time": 0.064385,
                    "create_size": 1280
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_3\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" LIMIT 21",
                "preview": "\n/*         cc_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0   California_1    2001      7             150.03      30.39   82.52  303.02\n1   California_1    2001      8             150.03     303.02   30.39  124.98\n2   California_1    2001      9             150.03     124.98  303.02   96.02\n3   California_1    2001     10             150.03      96.02  124.98  407.73\n4   California_1    2001     11             150.03     407.73   96.02  233.06\n5   California_1    2001     12             150.03     233.06  407.73     NaN\n6     California    2001      3             113.96       7.40     NaN  161.83\n7     California    2001      4             113.96     161.83    7.40   51.28\n8     California    2001      6             113.96      51.28  161.83   45.11\n9     California    2001      7             113.96      45.11   51.28  113.97\n10    California    2001      8             113.96     113.97   45.11  216.36\n11    California    2001      9             113.96     216.36  113.97  138.45\n12    California    2001     10             113.96     138.45  216.36  217.29\n13    California    2001     11             113.96     217.29  138.45   73.96\n14    California    2001     12             113.96      73.96  217.29  114.91\n15    California    2002      1             114.91     114.91   73.96     NaN\n16  California_1    2001      1              68.52       2.08     NaN  152.44\n17  California_1    2001      2              68.52     152.44    2.08   27.04\n18  California_1    2001      3              68.52      27.04  152.44   40.74\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017971,
                    "execution_time": 0.007911,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.003816
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.05762,
                    "execution_time": 0.007662,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.041099
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_3\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_3\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\""
            }
        ],
        "preview": "\n/*         cc_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0   California_1    2001      7             150.03      30.39   82.52  303.02\n1   California_1    2001      8             150.03     303.02   30.39  124.98\n2   California_1    2001      9             150.03     124.98  303.02   96.02\n3   California_1    2001     10             150.03      96.02  124.98  407.73\n4   California_1    2001     11             150.03     407.73   96.02  233.06\n5   California_1    2001     12             150.03     233.06  407.73     NaN\n6     California    2001      3             113.96       7.40     NaN  161.83\n7     California    2001      4             113.96     161.83    7.40   51.28\n8     California    2001      6             113.96      51.28  161.83   45.11\n9     California    2001      7             113.96      45.11   51.28  113.97\n10    California    2001      8             113.96     113.97   45.11  216.36\n11    California    2001      9             113.96     216.36  113.97  138.45\n12    California    2001     10             113.96     138.45  216.36  217.29\n13    California    2001     11             113.96     217.29  138.45   73.96\n14    California    2001     12             113.96      73.96  217.29  114.91\n15    California    2002      1             114.91     114.91   73.96     NaN\n16  California_1    2001      1              68.52       2.08     NaN  152.44\n17  California_1    2001      2              68.52     152.44    2.08   27.04\n18  California_1    2001      3              68.52      27.04  152.44   40.74\n...*/"
    },
    {
        "input": "with /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) as sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) as rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk = cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2000 and d_moy = 12) or\n         ( d_year = 2002 and d_moy = 1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name,\n        v1.d_year, v1.d_moy,\n        v1.avg_monthly_sales,\n        v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1\n left join v1 as v1_lag\n on v1.i_category = v1_lag.i_category\n and v1.i_brand = v1_lag.i_brand\n and v1.d_year = v1_lag.d_year\n and v1.d_moy = v1_lag.d_moy + 1\n left join v1 as v1_lead\n on v1.i_category = v1_lead.i_category\n and v1.i_brand = v1_lead.i_brand\n and v1.d_year = v1_lead.d_year\n and v1.d_moy = v1_lead.d_moy - 1\n/*CURSOR_IDENTIFIER*/\n)\nselect *\nfrom v2\nwhere (psum is null or sum_sales > psum)\nand (nsum is null or sum_sales > nsum);",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" AS \"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"CATALOG_SALES\" AS \"CATALOG_SALES\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" JOIN \"CALL_CENTER\" AS \"CALL_CENTER\" ON \"CALL_CENTER\".\"CC_CALL_CENTER_SK\" = \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"CALL_CENTER\".\"CC_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"CC_NAME\" AS \"CC_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" LEFT JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"V1\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"V1\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" LEFT JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"V1\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"V1\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" WHERE ( \"V1\".\"SUM_SALES\" > \"V1_LAG\".\"SUM_SALES\" OR \"V1_LAG\".\"SUM_SALES\" IS NULL ) AND ( \"V1\".\"SUM_SALES\" > \"V1_LEAD\".\"SUM_SALES\" OR \"V1_LEAD\".\"SUM_SALES\" IS NULL )"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"SPEQLITE_TEMP_TABLE_2\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" WHERE ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" > \"V1_LAG\".\"SUM_SALES\" OR \"V1_LAG\".\"SUM_SALES\" IS NULL ) AND ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" > \"V1_LEAD\".\"SUM_SALES\" OR \"V1_LEAD\".\"SUM_SALES\" IS NULL )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.593873,
                    "execution_time": 0.743518,
                    "compile_time": 0.117296,
                    "planning_time": 0.014008,
                    "create_size": 1280
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 10.963338,
                    "execution_time": 1.515209,
                    "compile_time": 8.660607,
                    "planning_time": 0.071604,
                    "create_size": 1280
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_4\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0   Pacific Northwest_1    2001      8              97.93     114.52  103.90   64.41\n1   Pacific Northwest_1    2001      8              97.93     114.52  103.90    3.76\n2   Pacific Northwest_1    2001      8              97.93     114.52  103.90   19.98\n3   Pacific Northwest_1    2001      8              97.93     114.52   11.59   10.84\n4   Pacific Northwest_1    2001      8              97.93     114.52   11.59   47.47\n5   Pacific Northwest_1    2001      8              97.93     114.52   11.59   81.41\n6   Pacific Northwest_1    2001      8              97.93     114.52   11.59   61.88\n7   Pacific Northwest_1    2001      8              97.93     114.52   11.59  111.47\n8   Pacific Northwest_1    2001      8              97.93     114.52   11.59  104.83\n9   Pacific Northwest_1    2001      8              97.93     114.52   11.59   88.68\n10  Pacific Northwest_1    2001      8              97.93     114.52   11.59   64.41\n11  Pacific Northwest_1    2001      8              97.93     114.52   11.59    3.76\n12  Pacific Northwest_1    2001      8              97.93     114.52   11.59   19.98\n13  Pacific Northwest_1    2001      8              97.93     114.52   42.10   10.84\n14  Pacific Northwest_1    2001      8              97.93     114.52   42.10   47.47\n15  Pacific Northwest_1    2001      8              97.93     114.52   42.10   81.41\n16  Pacific Northwest_1    2001      8              97.93     114.52   42.10   61.88\n17  Pacific Northwest_1    2001      8              97.93     114.52   42.10  111.47\n18  Pacific Northwest_1    2001      8              97.93     114.52   42.10  104.83\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018296,
                    "execution_time": 0.007838,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.003998
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.058178,
                    "execution_time": 0.008294,
                    "compile_time": 4.8e-05,
                    "planning_time": 0.041055
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" WHERE ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" > \"V1_LAG\".\"SUM_SALES\" OR \"V1_LAG\".\"SUM_SALES\" IS NULL ) AND ( \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" > \"V1_LEAD\".\"SUM_SALES\" OR \"V1_LEAD\".\"SUM_SALES\" IS NULL )",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"CC_NAME\" AS \"CC_NAME\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_4\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*                cc_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0   Pacific Northwest_1    2001      8              97.93     114.52  103.90   64.41\n1   Pacific Northwest_1    2001      8              97.93     114.52  103.90    3.76\n2   Pacific Northwest_1    2001      8              97.93     114.52  103.90   19.98\n3   Pacific Northwest_1    2001      8              97.93     114.52   11.59   10.84\n4   Pacific Northwest_1    2001      8              97.93     114.52   11.59   47.47\n5   Pacific Northwest_1    2001      8              97.93     114.52   11.59   81.41\n6   Pacific Northwest_1    2001      8              97.93     114.52   11.59   61.88\n7   Pacific Northwest_1    2001      8              97.93     114.52   11.59  111.47\n8   Pacific Northwest_1    2001      8              97.93     114.52   11.59  104.83\n9   Pacific Northwest_1    2001      8              97.93     114.52   11.59   88.68\n10  Pacific Northwest_1    2001      8              97.93     114.52   11.59   64.41\n11  Pacific Northwest_1    2001      8              97.93     114.52   11.59    3.76\n12  Pacific Northwest_1    2001      8              97.93     114.52   11.59   19.98\n13  Pacific Northwest_1    2001      8              97.93     114.52   42.10   10.84\n14  Pacific Northwest_1    2001      8              97.93     114.52   42.10   47.47\n15  Pacific Northwest_1    2001      8              97.93     114.52   42.10   81.41\n16  Pacific Northwest_1    2001      8              97.93     114.52   42.10   61.88\n17  Pacific Northwest_1    2001      8              97.93     114.52   42.10  111.47\n18  Pacific Northwest_1    2001      8              97.93     114.52   42.10  104.83\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) as sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) as rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1, v1 as v1_lag, v1 as v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.cc_name = v1_lag.cc_name and\n       v1.cc_name = v1_lead.cc_name and\n       v1.d_year = v1_lag.d_year + 1 and\n       v1.d_year = v1_lead.d_year - 1\n/*CURSOR_IDENTIFIER*/\n)\nselect * from v2;",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.D_YEAR = V1_LAG.D_YEAR + 1 AND V1.D_YEAR = V1_LEAD.D_YEAR - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum     nsum\n0          NY Metro    2001      2            8473.51    4707.50  17521.44  4551.27\n1          NY Metro    2001      3            8473.51    3837.27  17521.44  4551.27\n2          NY Metro    2001      4            8473.51    4609.50  17521.44  4551.27\n3          NY Metro    2001     10            8473.51   12309.64  17521.44  4551.27\n4          NY Metro    2001      6            8473.51    4628.91  17521.44  4551.27\n5          NY Metro    2001     11            8473.51   18057.56  17521.44  4551.27\n6          NY Metro    2001      5            8473.51    5755.71  17521.44  4551.27\n7          NY Metro    2001      8            8473.51   10145.12  17521.44  4551.27\n8          NY Metro    2001      7            8473.51    4858.95  17521.44  4551.27\n9          NY Metro    2001      1            8473.51    3894.78  17521.44  4551.27\n10         NY Metro    2001      9            8473.51   10919.98  17521.44  4551.27\n11         NY Metro    2001     12            8473.51   17957.23  17521.44  4551.27\n12  North Midwest_1    2001      2            8737.89    5660.57  20465.48  5419.94\n13  North Midwest_1    2001      3            8737.89    5847.51  20465.48  5419.94\n14  North Midwest_1    2001      1            8737.89    6124.40  20465.48  5419.94\n15  North Midwest_1    2001      6            8737.89    4499.44  20465.48  5419.94\n16  North Midwest_1    2001      7            8737.89    4710.56  20465.48  5419.94\n17  North Midwest_1    2001      9            8737.89   11118.18  20465.48  5419.94\n18  North Midwest_1    2001     10            8737.89   11344.07  20465.48  5419.94\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 2.960237,
                    "execution_time": 2.314444,
                    "compile_time": 0.164973,
                    "planning_time": 1.717892
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 22.292153,
                    "execution_time": 6.317348,
                    "compile_time": 15.437004,
                    "planning_time": 12.708871
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum     nsum\n0          NY Metro    2001      2            8473.51    4707.50  17521.44  4551.27\n1          NY Metro    2001      3            8473.51    3837.27  17521.44  4551.27\n2          NY Metro    2001      4            8473.51    4609.50  17521.44  4551.27\n3          NY Metro    2001     10            8473.51   12309.64  17521.44  4551.27\n4          NY Metro    2001      6            8473.51    4628.91  17521.44  4551.27\n5          NY Metro    2001     11            8473.51   18057.56  17521.44  4551.27\n6          NY Metro    2001      5            8473.51    5755.71  17521.44  4551.27\n7          NY Metro    2001      8            8473.51   10145.12  17521.44  4551.27\n8          NY Metro    2001      7            8473.51    4858.95  17521.44  4551.27\n9          NY Metro    2001      1            8473.51    3894.78  17521.44  4551.27\n10         NY Metro    2001      9            8473.51   10919.98  17521.44  4551.27\n11         NY Metro    2001     12            8473.51   17957.23  17521.44  4551.27\n12  North Midwest_1    2001      2            8737.89    5660.57  20465.48  5419.94\n13  North Midwest_1    2001      3            8737.89    5847.51  20465.48  5419.94\n14  North Midwest_1    2001      1            8737.89    6124.40  20465.48  5419.94\n15  North Midwest_1    2001      6            8737.89    4499.44  20465.48  5419.94\n16  North Midwest_1    2001      7            8737.89    4710.56  20465.48  5419.94\n17  North Midwest_1    2001      9            8737.89   11118.18  20465.48  5419.94\n18  North Midwest_1    2001     10            8737.89   11344.07  20465.48  5419.94\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n/*CURSOR_IDENTIFIER*/\nselect *\nfrom v2",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*         cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0     California    2001      1            8959.30    5643.84  19749.88   4027.09\n1     California    2001      2            8959.30    4027.09   5643.84   6874.67\n2     California    2001      3            8959.30    6874.67   4027.09   6011.86\n3     California    2001      4            8959.30    6011.86   6874.67   5697.50\n4     California    2001      5            8959.30    5697.50   6011.86   4657.03\n5     California    2001      6            8959.30    4657.03   5697.50   4842.74\n6     California    2001      7            8959.30    4842.74   4657.03  12041.34\n7     California    2001      8            8959.30   12041.34   4842.74  10936.68\n8     California    2001      9            8959.30   10936.68  12041.34  12909.91\n9     California    2001     10            8959.30   12909.91  10936.68  16356.52\n10    California    2001     11            8959.30   16356.52  12909.91  17512.48\n11    California    2001     12            8959.30   17512.48  16356.52   5839.24\n12  California_1    2001      1            8469.09    5950.98  19894.35   4734.65\n13  California_1    2001      2            8469.09    4734.65   5950.98   4722.75\n14  California_1    2001      3            8469.09    4722.75   4734.65   5558.40\n15  California_1    2001      4            8469.09    5558.40   4722.75   4099.66\n16  California_1    2001      5            8469.09    4099.66   5558.40   5444.76\n17  California_1    2001      6            8469.09    5444.76   4099.66   5048.06\n18  California_1    2001      7            8469.09    5048.06   5444.76  11853.96\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 2.946692,
                    "execution_time": 2.412919,
                    "compile_time": 0.087284,
                    "planning_time": 1.645877
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 19.924476,
                    "execution_time": 2.426996,
                    "compile_time": 18.096317,
                    "planning_time": 12.020365
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*         cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0     California    2001      1            8959.30    5643.84  19749.88   4027.09\n1     California    2001      2            8959.30    4027.09   5643.84   6874.67\n2     California    2001      3            8959.30    6874.67   4027.09   6011.86\n3     California    2001      4            8959.30    6011.86   6874.67   5697.50\n4     California    2001      5            8959.30    5697.50   6011.86   4657.03\n5     California    2001      6            8959.30    4657.03   5697.50   4842.74\n6     California    2001      7            8959.30    4842.74   4657.03  12041.34\n7     California    2001      8            8959.30   12041.34   4842.74  10936.68\n8     California    2001      9            8959.30   10936.68  12041.34  12909.91\n9     California    2001     10            8959.30   12909.91  10936.68  16356.52\n10    California    2001     11            8959.30   16356.52  12909.91  17512.48\n11    California    2001     12            8959.30   17512.48  16356.52   5839.24\n12  California_1    2001      1            8469.09    5950.98  19894.35   4734.65\n13  California_1    2001      2            8469.09    4734.65   5950.98   4722.75\n14  California_1    2001      3            8469.09    4722.75   4734.65   5558.40\n15  California_1    2001      4            8469.09    5558.40   4722.75   4099.66\n16  California_1    2001      5            8469.09    4099.66   5558.40   5444.76\n17  California_1    2001      6            8469.09    5444.76   4099.66   5048.06\n18  California_1    2001      7            8469.09    5048.06   5444.76  11853.96\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0   Hawaii/Alaska_1    2001      1            8862.03    5393.81  21796.57   5688.31\n1   Hawaii/Alaska_1    2001      2            8862.03    5688.31   5393.81   5025.96\n2   Hawaii/Alaska_1    2001      3            8862.03    5025.96   5688.31   5200.94\n3   Hawaii/Alaska_1    2001      4            8862.03    5200.94   5025.96   5853.51\n4   Hawaii/Alaska_1    2001      5            8862.03    5853.51   5200.94   5248.80\n5   Hawaii/Alaska_1    2001      6            8862.03    5248.80   5853.51   4202.53\n6   Hawaii/Alaska_1    2001      7            8862.03    4202.53   5248.80  12553.39\n7   Hawaii/Alaska_1    2001      8            8862.03   12553.39   4202.53  10943.35\n8   Hawaii/Alaska_1    2001      9            8862.03   10943.35  12553.39  12157.99\n9   Hawaii/Alaska_1    2001     10            8862.03   12157.99  10943.35  17140.56\n10  Hawaii/Alaska_1    2001     11            8862.03   17140.56  12157.99  16935.22\n11  Hawaii/Alaska_1    2001     12            8862.03   16935.22  17140.56   4536.72\n12    North Midwest    2001      1            8579.19    5441.10  19713.53   4413.11\n13    North Midwest    2001      2            8579.19    4413.11   5441.10   5819.25\n14    North Midwest    2001      3            8579.19    5819.25   4413.11   6023.43\n15    North Midwest    2001      4            8579.19    6023.43   5819.25   5220.58\n16    North Midwest    2001      5            8579.19    5220.58   6023.43   4877.43\n17    North Midwest    2001      6            8579.19    4877.43   5220.58   5098.96\n18    North Midwest    2001      7            8579.19    5098.96   4877.43  10619.98\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 2.9308,
                    "execution_time": 2.494004,
                    "compile_time": 0.001103,
                    "planning_time": 1.609331
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 2.804765,
                    "execution_time": 2.363448,
                    "compile_time": 0.001111,
                    "planning_time": 1.589195
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0   Hawaii/Alaska_1    2001      1            8862.03    5393.81  21796.57   5688.31\n1   Hawaii/Alaska_1    2001      2            8862.03    5688.31   5393.81   5025.96\n2   Hawaii/Alaska_1    2001      3            8862.03    5025.96   5688.31   5200.94\n3   Hawaii/Alaska_1    2001      4            8862.03    5200.94   5025.96   5853.51\n4   Hawaii/Alaska_1    2001      5            8862.03    5853.51   5200.94   5248.80\n5   Hawaii/Alaska_1    2001      6            8862.03    5248.80   5853.51   4202.53\n6   Hawaii/Alaska_1    2001      7            8862.03    4202.53   5248.80  12553.39\n7   Hawaii/Alaska_1    2001      8            8862.03   12553.39   4202.53  10943.35\n8   Hawaii/Alaska_1    2001      9            8862.03   10943.35  12553.39  12157.99\n9   Hawaii/Alaska_1    2001     10            8862.03   12157.99  10943.35  17140.56\n10  Hawaii/Alaska_1    2001     11            8862.03   17140.56  12157.99  16935.22\n11  Hawaii/Alaska_1    2001     12            8862.03   16935.22  17140.56   4536.72\n12    North Midwest    2001      1            8579.19    5441.10  19713.53   4413.11\n13    North Midwest    2001      2            8579.19    4413.11   5441.10   5819.25\n14    North Midwest    2001      3            8579.19    5819.25   4413.11   6023.43\n15    North Midwest    2001      4            8579.19    6023.43   5819.25   5220.58\n16    North Midwest    2001      5            8579.19    5220.58   6023.43   4877.43\n17    North Midwest    2001      6            8579.19    4877.43   5220.58   5098.96\n18    North Midwest    2001      7            8579.19    5098.96   4877.43  10619.98\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0   Hawaii/Alaska_1    2001      1            8862.03    5393.81  21796.57   5688.31\n1   Hawaii/Alaska_1    2001      2            8862.03    5688.31   5393.81   5025.96\n2   Hawaii/Alaska_1    2001      3            8862.03    5025.96   5688.31   5200.94\n3   Hawaii/Alaska_1    2001      4            8862.03    5200.94   5025.96   5853.51\n4   Hawaii/Alaska_1    2001      5            8862.03    5853.51   5200.94   5248.80\n5   Hawaii/Alaska_1    2001      6            8862.03    5248.80   5853.51   4202.53\n6   Hawaii/Alaska_1    2001      7            8862.03    4202.53   5248.80  12553.39\n7   Hawaii/Alaska_1    2001      8            8862.03   12553.39   4202.53  10943.35\n8   Hawaii/Alaska_1    2001      9            8862.03   10943.35  12553.39  12157.99\n9   Hawaii/Alaska_1    2001     10            8862.03   12157.99  10943.35  17140.56\n10  Hawaii/Alaska_1    2001     11            8862.03   17140.56  12157.99  16935.22\n11  Hawaii/Alaska_1    2001     12            8862.03   16935.22  17140.56   4536.72\n12    North Midwest    2001      1            8579.19    5441.10  19713.53   4413.11\n13    North Midwest    2001      2            8579.19    4413.11   5441.10   5819.25\n14    North Midwest    2001      3            8579.19    5819.25   4413.11   6023.43\n15    North Midwest    2001      4            8579.19    6023.43   5819.25   5220.58\n16    North Midwest    2001      5            8579.19    5220.58   6023.43   4877.43\n17    North Midwest    2001      6            8579.19    4877.43   5220.58   5098.96\n18    North Midwest    2001      7            8579.19    5098.96   4877.43  10619.98\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 2.789119,
                    "execution_time": 2.348721,
                    "compile_time": 0.0011,
                    "planning_time": 1.568016
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 2.792636,
                    "execution_time": 2.352947,
                    "compile_time": 0.001121,
                    "planning_time": 1.561233
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0   Hawaii/Alaska_1    2001      1            8862.03    5393.81  21796.57   5688.31\n1   Hawaii/Alaska_1    2001      2            8862.03    5688.31   5393.81   5025.96\n2   Hawaii/Alaska_1    2001      3            8862.03    5025.96   5688.31   5200.94\n3   Hawaii/Alaska_1    2001      4            8862.03    5200.94   5025.96   5853.51\n4   Hawaii/Alaska_1    2001      5            8862.03    5853.51   5200.94   5248.80\n5   Hawaii/Alaska_1    2001      6            8862.03    5248.80   5853.51   4202.53\n6   Hawaii/Alaska_1    2001      7            8862.03    4202.53   5248.80  12553.39\n7   Hawaii/Alaska_1    2001      8            8862.03   12553.39   4202.53  10943.35\n8   Hawaii/Alaska_1    2001      9            8862.03   10943.35  12553.39  12157.99\n9   Hawaii/Alaska_1    2001     10            8862.03   12157.99  10943.35  17140.56\n10  Hawaii/Alaska_1    2001     11            8862.03   17140.56  12157.99  16935.22\n11  Hawaii/Alaska_1    2001     12            8862.03   16935.22  17140.56   4536.72\n12    North Midwest    2001      1            8579.19    5441.10  19713.53   4413.11\n13    North Midwest    2001      2            8579.19    4413.11   5441.10   5819.25\n14    North Midwest    2001      3            8579.19    5819.25   4413.11   6023.43\n15    North Midwest    2001      4            8579.19    6023.43   5819.25   5220.58\n16    North Midwest    2001      5            8579.19    5220.58   6023.43   4877.43\n17    North Midwest    2001      6            8579.19    4877.43   5220.58   5098.96\n18    North Midwest    2001      7            8579.19    5098.96   4877.43  10619.98\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 LIMIT 21",
                "preview": "\n/*           cc_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0     Mid Atlantic    2001      6              56.58      47.33  342.09    8.77\n1     Mid Atlantic    2001      7              56.58       8.77   47.33   28.66\n2     Mid Atlantic    2001      9              56.58      28.66    8.77   29.87\n3     Mid Atlantic    2001     10              56.58      29.87   28.66   46.45\n4     Mid Atlantic    2001     11              56.58      46.45   29.87  178.45\n5   Mid Atlantic_1    2001      1             107.93     177.03  106.46  162.94\n6   Mid Atlantic_1    2001      2             107.93     162.94  177.03    9.28\n7   Mid Atlantic_1    2001      3             107.93       9.28  162.94  279.82\n8   Mid Atlantic_1    2001      5             107.93     279.82    9.28   28.95\n9   Mid Atlantic_1    2001      6             107.93      28.95  279.82    1.47\n10  Mid Atlantic_1    2001      7             107.93       1.47   28.95   13.75\n11  Mid Atlantic_1    2001      8             107.93      13.75    1.47    5.52\n12  Mid Atlantic_1    2001      9             107.93       5.52   13.75    9.23\n13  Mid Atlantic_1    2001     10             107.93       9.23    5.52  336.98\n14  Mid Atlantic_1    2001     11             107.93     336.98    9.23  162.34\n15  Mid Atlantic_2    2001      2              86.91      54.90  186.13   12.45\n16  Mid Atlantic_2    2001      3              86.91      12.45   54.90    9.86\n17  Mid Atlantic_2    2001      5              86.91       9.86   12.45   57.99\n18  Mid Atlantic_2    2001      8              86.91      57.99    9.86   32.41\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 3.098474,
                    "execution_time": 2.451202,
                    "compile_time": 0.227662,
                    "planning_time": 1.667825
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.052376,
                    "execution_time": 2.374449,
                    "compile_time": 10.171898,
                    "planning_time": 1.622068
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*           cc_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0     Mid Atlantic    2001      6              56.58      47.33  342.09    8.77\n1     Mid Atlantic    2001      7              56.58       8.77   47.33   28.66\n2     Mid Atlantic    2001      9              56.58      28.66    8.77   29.87\n3     Mid Atlantic    2001     10              56.58      29.87   28.66   46.45\n4     Mid Atlantic    2001     11              56.58      46.45   29.87  178.45\n5   Mid Atlantic_1    2001      1             107.93     177.03  106.46  162.94\n6   Mid Atlantic_1    2001      2             107.93     162.94  177.03    9.28\n7   Mid Atlantic_1    2001      3             107.93       9.28  162.94  279.82\n8   Mid Atlantic_1    2001      5             107.93     279.82    9.28   28.95\n9   Mid Atlantic_1    2001      6             107.93      28.95  279.82    1.47\n10  Mid Atlantic_1    2001      7             107.93       1.47   28.95   13.75\n11  Mid Atlantic_1    2001      8             107.93      13.75    1.47    5.52\n12  Mid Atlantic_1    2001      9             107.93       5.52   13.75    9.23\n13  Mid Atlantic_1    2001     10             107.93       9.23    5.52  336.98\n14  Mid Atlantic_1    2001     11             107.93     336.98    9.23  162.34\n15  Mid Atlantic_2    2001      2              86.91      54.90  186.13   12.45\n16  Mid Atlantic_2    2001      3              86.91      12.45   54.90    9.86\n17  Mid Atlantic_2    2001      5              86.91       9.86   12.45   57.99\n18  Mid Atlantic_2    2001      8              86.91      57.99    9.86   32.41\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and\n        avg_monthly_sales > 0 /*CURSOR_IDENTIFIER*/\n",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 LIMIT 21",
                "preview": "\n/*           cc_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0     California_1    2001      2             223.48     238.61  188.18   30.48\n1     California_1    2001      3             223.48      30.48  238.61   47.09\n2     California_1    2001      5             223.48      47.09   30.48  447.88\n3     California_1    2001      6             223.48     447.88   47.09  257.12\n4     California_1    2001      7             223.48     257.12  447.88  150.99\n5     California_1    2001      8             223.48     150.99  257.12  224.83\n6     California_1    2001      9             223.48     224.83  150.99  442.84\n7     California_1    2001     10             223.48     442.84  224.83  321.22\n8     California_1    2001     11             223.48     321.22  442.84  109.10\n9     California_1    2001     12             223.48     109.10  321.22   28.86\n10    Mid Atlantic    2001      4             202.47      22.34  124.15  157.17\n11    Mid Atlantic    2001      5             202.47     157.17   22.34    7.50\n12    Mid Atlantic    2001      6             202.47       7.50  157.17   83.89\n13    Mid Atlantic    2001      7             202.47      83.89    7.50  280.54\n14    Mid Atlantic    2001      8             202.47     280.54   83.89  112.49\n15    Mid Atlantic    2001      9             202.47     112.49  280.54  432.18\n16    Mid Atlantic    2001     10             202.47     432.18  112.49  293.83\n17    Mid Atlantic    2001     11             202.47     293.83  432.18  510.63\n18    Mid Atlantic    2001     12             202.47     510.63  293.83  120.22\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 2.87641,
                    "execution_time": 2.434227,
                    "compile_time": 0.001303,
                    "planning_time": 1.680624
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 5.800307,
                    "execution_time": 2.4008,
                    "compile_time": 2.903627,
                    "planning_time": 1.712254
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*           cc_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0     California_1    2001      2             223.48     238.61  188.18   30.48\n1     California_1    2001      3             223.48      30.48  238.61   47.09\n2     California_1    2001      5             223.48      47.09   30.48  447.88\n3     California_1    2001      6             223.48     447.88   47.09  257.12\n4     California_1    2001      7             223.48     257.12  447.88  150.99\n5     California_1    2001      8             223.48     150.99  257.12  224.83\n6     California_1    2001      9             223.48     224.83  150.99  442.84\n7     California_1    2001     10             223.48     442.84  224.83  321.22\n8     California_1    2001     11             223.48     321.22  442.84  109.10\n9     California_1    2001     12             223.48     109.10  321.22   28.86\n10    Mid Atlantic    2001      4             202.47      22.34  124.15  157.17\n11    Mid Atlantic    2001      5             202.47     157.17   22.34    7.50\n12    Mid Atlantic    2001      6             202.47       7.50  157.17   83.89\n13    Mid Atlantic    2001      7             202.47      83.89    7.50  280.54\n14    Mid Atlantic    2001      8             202.47     280.54   83.89  112.49\n15    Mid Atlantic    2001      9             202.47     112.49  280.54  432.18\n16    Mid Atlantic    2001     10             202.47     432.18  112.49  293.83\n17    Mid Atlantic    2001     11             202.47     293.83  432.18  510.63\n18    Mid Atlantic    2001     12             202.47     510.63  293.83  120.22\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and\n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 LIMIT 21",
                "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0   Hawaii/Alaska_1    2001      1            8862.03    5393.81  21796.57   5688.31\n1   Hawaii/Alaska_1    2001      2            8862.03    5688.31   5393.81   5025.96\n2   Hawaii/Alaska_1    2001      3            8862.03    5025.96   5688.31   5200.94\n3   Hawaii/Alaska_1    2001      4            8862.03    5200.94   5025.96   5853.51\n4   Hawaii/Alaska_1    2001      5            8862.03    5853.51   5200.94   5248.80\n5   Hawaii/Alaska_1    2001      6            8862.03    5248.80   5853.51   4202.53\n6   Hawaii/Alaska_1    2001      7            8862.03    4202.53   5248.80  12553.39\n7   Hawaii/Alaska_1    2001      8            8862.03   12553.39   4202.53  10943.35\n8   Hawaii/Alaska_1    2001      9            8862.03   10943.35  12553.39  12157.99\n9   Hawaii/Alaska_1    2001     10            8862.03   12157.99  10943.35  17140.56\n10  Hawaii/Alaska_1    2001     11            8862.03   17140.56  12157.99  16935.22\n11  Hawaii/Alaska_1    2001     12            8862.03   16935.22  17140.56   4536.72\n12    North Midwest    2001      1            8579.19    5441.10  19713.53   4413.11\n13    North Midwest    2001      2            8579.19    4413.11   5441.10   5819.25\n14    North Midwest    2001      3            8579.19    5819.25   4413.11   6023.43\n15    North Midwest    2001      4            8579.19    6023.43   5819.25   5220.58\n16    North Midwest    2001      5            8579.19    5220.58   6023.43   4877.43\n17    North Midwest    2001      6            8579.19    4877.43   5220.58   5098.96\n18    North Midwest    2001      7            8579.19    5098.96   4877.43  10619.98\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 2.90126,
                    "execution_time": 2.46332,
                    "compile_time": 0.001231,
                    "planning_time": 1.696445
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 5.825128,
                    "execution_time": 2.446854,
                    "compile_time": 2.86466,
                    "planning_time": 1.757996
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            cc_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0   Hawaii/Alaska_1    2001      1            8862.03    5393.81  21796.57   5688.31\n1   Hawaii/Alaska_1    2001      2            8862.03    5688.31   5393.81   5025.96\n2   Hawaii/Alaska_1    2001      3            8862.03    5025.96   5688.31   5200.94\n3   Hawaii/Alaska_1    2001      4            8862.03    5200.94   5025.96   5853.51\n4   Hawaii/Alaska_1    2001      5            8862.03    5853.51   5200.94   5248.80\n5   Hawaii/Alaska_1    2001      6            8862.03    5248.80   5853.51   4202.53\n6   Hawaii/Alaska_1    2001      7            8862.03    4202.53   5248.80  12553.39\n7   Hawaii/Alaska_1    2001      8            8862.03   12553.39   4202.53  10943.35\n8   Hawaii/Alaska_1    2001      9            8862.03   10943.35  12553.39  12157.99\n9   Hawaii/Alaska_1    2001     10            8862.03   12157.99  10943.35  17140.56\n10  Hawaii/Alaska_1    2001     11            8862.03   17140.56  12157.99  16935.22\n11  Hawaii/Alaska_1    2001     12            8862.03   16935.22  17140.56   4536.72\n12    North Midwest    2001      1            8579.19    5441.10  19713.53   4413.11\n13    North Midwest    2001      2            8579.19    4413.11   5441.10   5819.25\n14    North Midwest    2001      3            8579.19    5819.25   4413.11   6023.43\n15    North Midwest    2001      4            8579.19    6023.43   5819.25   5220.58\n16    North Midwest    2001      5            8579.19    5220.58   6023.43   4877.43\n17    North Midwest    2001      6            8579.19    4877.43   5220.58   5098.96\n18    North Midwest    2001      7            8579.19    5098.96   4877.43  10619.98\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and\n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, psum\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , PSUM NULLS FIRST LIMIT 21",
                "preview": "\n/*              cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0   Pacific Northwest    2001      2          203956.23  102300.20  118349.96  117588.24\n1       North Midwest    2001      2          202706.67  101215.32  119432.70  117915.30\n2        Mid Atlantic    2001      2          200325.10   99077.31  122018.66  119580.17\n3        California_1    2001      4          203863.79  103054.10  115334.03  124339.28\n4            NY Metro    2001      2          199647.14   99248.37  122540.27  110327.28\n5            NY Metro    2001      2          202144.54  101984.60  120736.47  108033.37\n6     Hawaii/Alaska_1    2001      2          195071.19   95022.03  108591.79  108425.00\n7          NY Metro_1    2001      2          198795.50   99160.86  116308.99  114580.02\n8      Mid Atlantic_2    2001      2          201123.38  101575.81  122156.64  112986.52\n9        Mid Atlantic    2001      2          202423.77  102880.67  123576.60  120991.51\n10     Mid Atlantic_2    2001      2          201165.27  101926.47  123356.71  118424.80\n11       Mid Atlantic    2001      2          207677.93  108525.76  121070.82  119950.76\n12       California_1    2001      2          199948.00  100797.86  121993.65  114258.49\n13           NY Metro    2001      2          201697.77  102573.30  120853.92  116848.41\n14     Mid Atlantic_2    2001      2          198192.58   99075.10  117885.31  108458.21\n15    Hawaii/Alaska_1    2001      2          203223.67  104143.82  119861.91  116595.66\n16     Mid Atlantic_2    2001      2          195721.45   96929.79  119299.79  115838.97\n17       California_1    2001      2          207740.46  109060.36  118611.33  116892.29\n18     Mid Atlantic_2    2001      2          201446.04  102906.19  119755.66  117782.54\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 2.921813,
                    "execution_time": 2.485026,
                    "compile_time": 0.001154,
                    "planning_time": 1.668532
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 9.745929,
                    "execution_time": 2.493385,
                    "compile_time": 6.771981,
                    "planning_time": 1.748356
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*              cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0   Pacific Northwest    2001      2          203956.23  102300.20  118349.96  117588.24\n1       North Midwest    2001      2          202706.67  101215.32  119432.70  117915.30\n2        Mid Atlantic    2001      2          200325.10   99077.31  122018.66  119580.17\n3        California_1    2001      4          203863.79  103054.10  115334.03  124339.28\n4            NY Metro    2001      2          199647.14   99248.37  122540.27  110327.28\n5            NY Metro    2001      2          202144.54  101984.60  120736.47  108033.37\n6     Hawaii/Alaska_1    2001      2          195071.19   95022.03  108591.79  108425.00\n7          NY Metro_1    2001      2          198795.50   99160.86  116308.99  114580.02\n8      Mid Atlantic_2    2001      2          201123.38  101575.81  122156.64  112986.52\n9        Mid Atlantic    2001      2          202423.77  102880.67  123576.60  120991.51\n10     Mid Atlantic_2    2001      2          201165.27  101926.47  123356.71  118424.80\n11       Mid Atlantic    2001      2          207677.93  108525.76  121070.82  119950.76\n12       California_1    2001      2          199948.00  100797.86  121993.65  114258.49\n13           NY Metro    2001      2          201697.77  102573.30  120853.92  116848.41\n14     Mid Atlantic_2    2001      2          198192.58   99075.10  117885.31  108458.21\n15    Hawaii/Alaska_1    2001      2          203223.67  104143.82  119861.91  116595.66\n16     Mid Atlantic_2    2001      2          195721.45   96929.79  119299.79  115838.97\n17       California_1    2001      2          207740.46  109060.36  118611.33  116892.29\n18     Mid Atlantic_2    2001      2          201446.04  102906.19  119755.66  117782.54\n...*/"
    },
    {
        "input": "-- start template query57.tpl query 70 in stream 0\nwith /* TPC-DS query57.tpl 0.70 */ v1 as(\n select i_category, i_brand,\n        cc_name,\n        d_year, d_moy,\n        sum(cs_sales_price) sum_sales,\n        avg(sum(cs_sales_price)) over\n          (partition by i_category, i_brand,\n                     cc_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     cc_name\n           order by d_year, d_moy) rn\n from item, catalog_sales, date_dim, call_center\n where cs_item_sk = i_item_sk and\n       cs_sold_date_sk = d_date_sk and\n       cc_call_center_sk= cs_call_center_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          cc_name , d_year, d_moy),\n v2 as(\n select v1.cc_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1. cc_name = v1_lag. cc_name and\n       v1. cc_name = v1_lead. cc_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and\n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, psum\n limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY , SUM ( CS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( CS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , CC_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , CATALOG_SALES , DATE_DIM , CALL_CENTER WHERE CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND CC_CALL_CENTER_SK = CS_CALL_CENTER_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , CC_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.CC_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.CC_NAME = V1_LAG.CC_NAME AND V1.CC_NAME = V1_LEAD.CC_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , PSUM NULLS FIRST LIMIT 21",
                "preview": "\n/*              cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0   Pacific Northwest    2001      2          203956.23  102300.20  118349.96  117588.24\n1       North Midwest    2001      2          202706.67  101215.32  119432.70  117915.30\n2        Mid Atlantic    2001      2          200325.10   99077.31  122018.66  119580.17\n3        California_1    2001      4          203863.79  103054.10  115334.03  124339.28\n4            NY Metro    2001      2          199647.14   99248.37  122540.27  110327.28\n5            NY Metro    2001      2          202144.54  101984.60  120736.47  108033.37\n6     Hawaii/Alaska_1    2001      2          195071.19   95022.03  108591.79  108425.00\n7          NY Metro_1    2001      2          198795.50   99160.86  116308.99  114580.02\n8      Mid Atlantic_2    2001      2          201123.38  101575.81  122156.64  112986.52\n9        Mid Atlantic    2001      2          202423.77  102880.67  123576.60  120991.51\n10     Mid Atlantic_2    2001      2          201165.27  101926.47  123356.71  118424.80\n11       Mid Atlantic    2001      2          207677.93  108525.76  121070.82  119950.76\n12       California_1    2001      2          199948.00  100797.86  121993.65  114258.49\n13           NY Metro    2001      2          201697.77  102573.30  120853.92  116848.41\n14     Mid Atlantic_2    2001      2          198192.58   99075.10  117885.31  108458.21\n15    Hawaii/Alaska_1    2001      2          203223.67  104143.82  119861.91  116595.66\n16     Mid Atlantic_2    2001      2          195721.45   96929.79  119299.79  115838.97\n17       California_1    2001      2          207740.46  109060.36  118611.33  116892.29\n18     Mid Atlantic_2    2001      2          201446.04  102906.19  119755.66  117782.54\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 2.886942,
                    "execution_time": 2.438285,
                    "compile_time": 0.001138,
                    "planning_time": 1.676785
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 2.895344,
                    "execution_time": 2.46147,
                    "compile_time": 0.001165,
                    "planning_time": 1.657836
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*              cc_name  d_year  d_moy  avg_monthly_sales  sum_sales       psum       nsum\n0   Pacific Northwest    2001      2          203956.23  102300.20  118349.96  117588.24\n1       North Midwest    2001      2          202706.67  101215.32  119432.70  117915.30\n2        Mid Atlantic    2001      2          200325.10   99077.31  122018.66  119580.17\n3        California_1    2001      4          203863.79  103054.10  115334.03  124339.28\n4            NY Metro    2001      2          199647.14   99248.37  122540.27  110327.28\n5            NY Metro    2001      2          202144.54  101984.60  120736.47  108033.37\n6     Hawaii/Alaska_1    2001      2          195071.19   95022.03  108591.79  108425.00\n7          NY Metro_1    2001      2          198795.50   99160.86  116308.99  114580.02\n8      Mid Atlantic_2    2001      2          201123.38  101575.81  122156.64  112986.52\n9        Mid Atlantic    2001      2          202423.77  102880.67  123576.60  120991.51\n10     Mid Atlantic_2    2001      2          201165.27  101926.47  123356.71  118424.80\n11       Mid Atlantic    2001      2          207677.93  108525.76  121070.82  119950.76\n12       California_1    2001      2          199948.00  100797.86  121993.65  114258.49\n13           NY Metro    2001      2          201697.77  102573.30  120853.92  116848.41\n14     Mid Atlantic_2    2001      2          198192.58   99075.10  117885.31  108458.21\n15    Hawaii/Alaska_1    2001      2          203223.67  104143.82  119861.91  116595.66\n16     Mid Atlantic_2    2001      2          195721.45   96929.79  119299.79  115838.97\n17       California_1    2001      2          207740.46  109060.36  118611.33  116892.29\n18     Mid Atlantic_2    2001      2          201446.04  102906.19  119755.66  117782.54\n...*/"
    }
]