[
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0\n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by sts.ss_item_sk\n \t) in_store\n ) store\n where \n (\n store.return_rank <= 10\n or\n store.currency_rank <= 10\n )\n) /*CURSOR_IDENTIFIER*/ as final_selection",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"FINAL_SELECTION\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"FINAL_SELECTION\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_SELECTION\".\"ITEM\" AS \"ITEM\" , \"FINAL_SELECTION\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"FINAL_SELECTION\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"FINAL_SELECTION\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"FINAL_SELECTION\" AS \"FINAL_SELECTION\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.08235,
                    "execution_time": 0.031098,
                    "compile_time": 0.000241,
                    "planning_time": 0.027207,
                    "create_size": 6
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.145694,
                    "execution_time": 0.031572,
                    "compile_time": 0.000245,
                    "planning_time": 0.087646,
                    "create_size": 6
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 GROUP BY \"WS\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.141772,
                    "execution_time": 0.063563,
                    "compile_time": 0.000395,
                    "planning_time": 0.046682,
                    "create_size": 582
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 1.392101,
                    "execution_time": 1.181823,
                    "compile_time": 0.128922,
                    "planning_time": 0.04433,
                    "create_size": 582
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"SPEQLITE_TEMP_TABLE_2\".\"ITEM\" AS \"ITEM\" , \"SPEQLITE_TEMP_TABLE_2\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_2\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_2\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.072118,
                    "execution_time": 0.042171,
                    "compile_time": 0.000324,
                    "planning_time": 0.004076,
                    "create_size": 14
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.140598,
                    "execution_time": 0.043694,
                    "compile_time": 0.00032,
                    "planning_time": 0.061623,
                    "create_size": 14
                }
            }
        ],
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) AS FINAL_SELECTION LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web   12094     0.595745           13              6\n1     store    3896     0.697674            3              3\n2     store   78704     0.768293            9              9\n3       web   50743         0.61           15              8\n4       web   97852        0E-16            1             56\n5   catalog   96284     0.515789            6              2\n6     store   57598     0.666667            1              1\n7       web   30625         0.55           11              4\n8       web    1550        0E-16            1             37\n9   catalog   28286     0.474747            5              1\n10    store   96631     0.755814            8              8\n11      web   46148          0.6           14              7\n12  catalog   27164     0.553191           12              7\n13    store   93901         0.75            7              7\n14      web   71149        0E-16            1             50\n15  catalog   28426      0.53125            7              3\n16  catalog   43804     0.538462            8              4\n17  catalog   18626     0.555556           13              8\n18  catalog   38071      0.56701           15             10\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.38481,
                    "execution_time": 0.170375,
                    "compile_time": 0.044126,
                    "planning_time": 0.126153
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.939102,
                    "execution_time": 0.233347,
                    "compile_time": 3.530424,
                    "planning_time": 0.12446
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web   12094     0.595745           13              6\n1     store    3896     0.697674            3              3\n2     store   78704     0.768293            9              9\n3       web   50743         0.61           15              8\n4       web   97852        0E-16            1             56\n5   catalog   96284     0.515789            6              2\n6     store   57598     0.666667            1              1\n7       web   30625         0.55           11              4\n8       web    1550        0E-16            1             37\n9   catalog   28286     0.474747            5              1\n10    store   96631     0.755814            8              8\n11      web   46148          0.6           14              7\n12  catalog   27164     0.553191           12              7\n13    store   93901         0.75            7              7\n14      web   71149        0E-16            1             50\n15  catalog   28426      0.53125            7              3\n16  catalog   43804     0.538462            8              4\n17  catalog   18626     0.555556           13              8\n18  catalog   38071      0.56701           15             10\n...*/"
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n(select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.WR_RETURN_QUANTITY,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.WR_RETURN_AMT,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.WR_ORDER_NUMBER and \n \t\t\tws.ws_item_sk = wr.WR_ITEM_SK)\n                 ,date_dim\n \t\twhere \n \t\t\twr.WR_RETURN_AMT > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.CR_RETURN_QUANTITY,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.CR_RETURN_AMOUNT,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.CR_ORDER_NUMBER and \n \t\t\tcs.cs_item_sk = cr.CR_ITEM_SK)\n                ,date_dim\n \t\twhere \n \t\t\tcr.CR_RETURN_AMOUNT > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.SR_RETURN_QUANTITY,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.SR_RETURN_AMT,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.SR_TICKET_NUMBER and sts.ss_item_sk = sr.SR_ITEM_SK)\n                ,date_dim\n \t\twhere \n \t\t\tsr.SR_RETURN_AMT > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0\n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by sts.ss_item_sk\n \t) in_store\n ) store\n where \n (\n store.return_rank <= 10\n or\n store.currency_rank <=10\n )\n) as final_result\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"FINAL_RESULT\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"FINAL_RESULT\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_RESULT\".\"ITEM\" AS \"ITEM\" , \"FINAL_RESULT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"FINAL_RESULT\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"FINAL_RESULT\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"FINAL_RESULT\" AS \"FINAL_RESULT\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.142257,
                    "execution_time": 0.065632,
                    "compile_time": 0.000392,
                    "planning_time": 0.045035,
                    "create_size": 606
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.236018,
                    "execution_time": 0.06477,
                    "compile_time": 0.001497,
                    "planning_time": 0.130302,
                    "create_size": 606
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"SPEQLITE_TEMP_TABLE_4\".\"ITEM\" AS \"ITEM\" , \"SPEQLITE_TEMP_TABLE_4\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.073478,
                    "execution_time": 0.042213,
                    "compile_time": 0.000326,
                    "planning_time": 0.004335,
                    "create_size": 14
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.134186,
                    "execution_time": 0.043333,
                    "compile_time": 0.000335,
                    "planning_time": 0.060584,
                    "create_size": 14
                }
            }
        ],
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) AS FINAL_RESULT LIMIT 21",
                "preview": "\n/*    channel   item return_ratio  return_rank  currency_rank\n0       web  46148          0.6           14              7\n1   catalog  27164     0.553191           12              7\n2     store  93901         0.75            7              7\n3       web  12094     0.595745           13              6\n4     store   3896     0.697674            3              3\n5     store  78704     0.768293            9              9\n6       web     91     0.621053           16              9\n7       web  41050     0.627907           17             10\n8       web  87889        0E-16            1             46\n9   catalog  34826     0.546392           10              6\n10  catalog  72472        0E-16            1             66\n11    store  37879     0.670103            2              2\n12      web  50743         0.61           15              8\n13      web  97852        0E-16            1             56\n14  catalog  96284     0.515789            6              2\n15    store  57598     0.666667            1              1\n16      web  36458     0.463158            8              1\n17      web  86644     0.505376           10              3\n18  catalog  64867        0E-16            1            215\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.254673,
                    "execution_time": 0.083757,
                    "compile_time": 0.001062,
                    "planning_time": 0.126273
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.425411,
                    "execution_time": 0.089179,
                    "compile_time": 0.068318,
                    "planning_time": 0.224072
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel   item return_ratio  return_rank  currency_rank\n0       web  46148          0.6           14              7\n1   catalog  27164     0.553191           12              7\n2     store  93901         0.75            7              7\n3       web  12094     0.595745           13              6\n4     store   3896     0.697674            3              3\n5     store  78704     0.768293            9              9\n6       web     91     0.621053           16              9\n7       web  41050     0.627907           17             10\n8       web  87889        0E-16            1             46\n9   catalog  34826     0.546392           10              6\n10  catalog  72472        0E-16            1             66\n11    store  37879     0.670103            2              2\n12      web  50743         0.61           15              8\n13      web  97852        0E-16            1             56\n14  catalog  96284     0.515789            6              2\n15    store  57598     0.666667            1              1\n16      web  36458     0.463158            8              1\n17      web  86644     0.505376           10              3\n18  catalog  64867        0E-16            1            215\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws.ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs.cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and sts.ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n ) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"_Q_0\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ITEM\" AS \"ITEM\" , \"_Q_0\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"_Q_0\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"_Q_0\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"SPEQLITE_TEMP_TABLE_4\".\"ITEM\" AS \"ITEM\" , \"SPEQLITE_TEMP_TABLE_4\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"CURRENCY_RATIO\" AS \"CURRENCY_RATIO\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.071358,
                    "execution_time": 0.044839,
                    "compile_time": 0.000233,
                    "planning_time": 0.003382,
                    "create_size": 606
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.133599,
                    "execution_time": 0.045801,
                    "compile_time": 0.000225,
                    "planning_time": 0.061287,
                    "create_size": 606
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"SPEQLITE_TEMP_TABLE_6\".\"ITEM\" AS \"ITEM\" , \"SPEQLITE_TEMP_TABLE_6\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_6\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"SPEQLITE_TEMP_TABLE_6\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.07141,
                    "execution_time": 0.043499,
                    "compile_time": 0.000337,
                    "planning_time": 0.004111,
                    "create_size": 14
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.129754,
                    "execution_time": 0.045213,
                    "compile_time": 0.000335,
                    "planning_time": 0.061766,
                    "create_size": 14
                }
            }
        ],
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS.WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS.CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND STS.SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) LIMIT 21",
                "preview": "\n/*    channel   item return_ratio  return_rank  currency_rank\n0       web  50743         0.61           15              8\n1       web  97852        0E-16            1             56\n2   catalog  96284     0.515789            6              2\n3     store  57598     0.666667            1              1\n4       web  30625         0.55           11              4\n5       web   1550        0E-16            1             37\n6   catalog  28286     0.474747            5              1\n7     store  96631     0.755814            8              8\n8       web     91     0.621053           16              9\n9       web  41050     0.627907           17             10\n10      web  87889        0E-16            1             46\n11  catalog  34826     0.546392           10              6\n12  catalog  72472        0E-16            1             66\n13    store  37879     0.670103            2              2\n14      web  46148          0.6           14              7\n15  catalog  27164     0.553191           12              7\n16    store  93901         0.75            7              7\n17      web  71149        0E-16            1             50\n18  catalog  28426      0.53125            7              3\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.262053,
                    "execution_time": 0.089291,
                    "compile_time": 0.001069,
                    "planning_time": 0.127643
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.353614,
                    "execution_time": 0.084676,
                    "compile_time": 0.001046,
                    "planning_time": 0.224447
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel   item return_ratio  return_rank  currency_rank\n0       web  50743         0.61           15              8\n1       web  97852        0E-16            1             56\n2   catalog  96284     0.515789            6              2\n3     store  57598     0.666667            1              1\n4       web  30625         0.55           11              4\n5       web   1550        0E-16            1             37\n6   catalog  28286     0.474747            5              1\n7     store  96631     0.755814            8              8\n8       web     91     0.621053           16              9\n9       web  41050     0.627907           17             10\n10      web  87889        0E-16            1             46\n11  catalog  34826     0.546392           10              6\n12  catalog  72472        0E-16            1             66\n13    store  37879     0.670103            2              2\n14      web  46148          0.6           14              7\n15  catalog  27164     0.553191           12              7\n16    store  93901         0.75            7              7\n17      web  71149        0E-16            1             50\n18  catalog  28426      0.53125            7              3\n...*/"
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws.ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs.cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and sts.ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n) /* Added missing parenthesis here for the main query structure */\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"_Q_0\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ITEM\" AS \"ITEM\" , \"_Q_0\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"_Q_0\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"_Q_0\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS.WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS.CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND STS.SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web   50743         0.61           15              8\n1       web   97852        0E-16            1             56\n2   catalog   96284     0.515789            6              2\n3     store   57598     0.666667            1              1\n4       web      91     0.621053           16              9\n5       web   41050     0.627907           17             10\n6       web   87889        0E-16            1             46\n7   catalog   34826     0.546392           10              6\n8   catalog   72472        0E-16            1             66\n9     store   37879     0.670103            2              2\n10      web   71149        0E-16            1             50\n11  catalog   28426      0.53125            7              3\n12  catalog   43804     0.538462            8              4\n13  catalog   18626     0.555556           13              8\n14  catalog   38071      0.56701           15             10\n15    store  101954     0.727273            5              5\n16      web   30625         0.55           11              4\n17      web    1550        0E-16            1             37\n18  catalog   28286     0.474747            5              1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.260848,
                    "execution_time": 0.090887,
                    "compile_time": 0.001025,
                    "planning_time": 0.126224
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.256226,
                    "execution_time": 0.085277,
                    "compile_time": 0.001017,
                    "planning_time": 0.12725
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0       web   50743         0.61           15              8\n1       web   97852        0E-16            1             56\n2   catalog   96284     0.515789            6              2\n3     store   57598     0.666667            1              1\n4       web      91     0.621053           16              9\n5       web   41050     0.627907           17             10\n6       web   87889        0E-16            1             46\n7   catalog   34826     0.546392           10              6\n8   catalog   72472        0E-16            1             66\n9     store   37879     0.670103            2              2\n10      web   71149        0E-16            1             50\n11  catalog   28426      0.53125            7              3\n12  catalog   43804     0.538462            8              4\n13  catalog   18626     0.555556           13              8\n14  catalog   38071      0.56701           15             10\n15    store  101954     0.727273            5              5\n16      web   30625         0.55           11              4\n17      web    1550        0E-16            1             37\n18  catalog   28286     0.474747            5              1\n...*/"
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n )\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"_Q_0\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ITEM\" AS \"ITEM\" , \"_Q_0\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"_Q_0\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"_Q_0\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) LIMIT 21",
                "preview": "\n/*    channel   item return_ratio  return_rank  currency_rank\n0       web  50743         0.61           15              8\n1       web  97852        0E-16            1             56\n2   catalog  96284     0.515789            6              2\n3     store  57598     0.666667            1              1\n4       web  30625         0.55           11              4\n5       web   1550        0E-16            1             37\n6   catalog  28286     0.474747            5              1\n7     store  96631     0.755814            8              8\n8       web  46148          0.6           14              7\n9   catalog  27164     0.553191           12              7\n10    store  93901         0.75            7              7\n11      web     91     0.621053           16              9\n12      web  41050     0.627907           17             10\n13      web  87889        0E-16            1             46\n14  catalog  34826     0.546392           10              6\n15  catalog  72472        0E-16            1             66\n16    store  37879     0.670103            2              2\n17      web  12094     0.595745           13              6\n18    store   3896     0.697674            3              3\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.256959,
                    "execution_time": 0.086108,
                    "compile_time": 0.001016,
                    "planning_time": 0.126338
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.364989,
                    "execution_time": 0.089417,
                    "compile_time": 0.001098,
                    "planning_time": 0.229789
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel   item return_ratio  return_rank  currency_rank\n0       web  50743         0.61           15              8\n1       web  97852        0E-16            1             56\n2   catalog  96284     0.515789            6              2\n3     store  57598     0.666667            1              1\n4       web  30625         0.55           11              4\n5       web   1550        0E-16            1             37\n6   catalog  28286     0.474747            5              1\n7     store  96631     0.755814            8              8\n8       web  46148          0.6           14              7\n9   catalog  27164     0.553191           12              7\n10    store  93901         0.75            7              7\n11      web     91     0.621053           16              9\n12      web  41050     0.627907           17             10\n13      web  87889        0E-16            1             46\n14  catalog  34826     0.546392           10              6\n15  catalog  72472        0E-16            1             66\n16    store  37879     0.670103            2              2\n17      web  12094     0.595745           13              6\n18    store   3896     0.697674            3              3\n...*/"
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n )\n order by 1,4,5,2\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"_Q_0\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ITEM\" AS \"ITEM\" , \"_Q_0\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"_Q_0\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"_Q_0\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"_Q_0\" AS \"_Q_0\" ORDER BY \"CHANNEL\" NULLS LAST , \"RETURN_RANK\" NULLS LAST , \"CURRENCY_RANK\" NULLS LAST , \"ITEM\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) ORDER BY 1 NULLS FIRST , 4 NULLS FIRST , 5 NULLS FIRST , 2 NULLS FIRST LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog   72472        0E-16            1             66\n1   catalog   64867        0E-16            1            215\n2   catalog   75637        0E-16            1            284\n3   catalog   78628        0E-16            1            288\n4   catalog   28286     0.474747            5              1\n5   catalog   96284     0.515789            6              2\n6   catalog   28426      0.53125            7              3\n7   catalog   37682     0.538462            8              4\n8   catalog   43804     0.538462            8              4\n9   catalog   34826     0.546392           10              6\n10  catalog   27164     0.553191           12              7\n11  catalog   18626     0.555556           13              8\n12  catalog   73516     0.557895           14              9\n13  catalog   38071      0.56701           15             10\n14    store   57598     0.666667            1              1\n15    store   37879     0.670103            2              2\n16    store    3896     0.697674            3              3\n17    store   33284     0.705263            4              4\n18    store  101954     0.727273            5              5\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.268241,
                    "execution_time": 0.092904,
                    "compile_time": 0.00114,
                    "planning_time": 0.128268
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.370238,
                    "execution_time": 0.090257,
                    "compile_time": 0.00111,
                    "planning_time": 0.229989
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog   72472        0E-16            1             66\n1   catalog   64867        0E-16            1            215\n2   catalog   75637        0E-16            1            284\n3   catalog   78628        0E-16            1            288\n4   catalog   28286     0.474747            5              1\n5   catalog   96284     0.515789            6              2\n6   catalog   28426      0.53125            7              3\n7   catalog   37682     0.538462            8              4\n8   catalog   43804     0.538462            8              4\n9   catalog   34826     0.546392           10              6\n10  catalog   27164     0.553191           12              7\n11  catalog   18626     0.555556           13              8\n12  catalog   73516     0.557895           14              9\n13  catalog   38071      0.56701           15             10\n14    store   57598     0.666667            1              1\n15    store   37879     0.670103            2              2\n16    store    3896     0.697674            3              3\n17    store   33284     0.705263            4              4\n18    store  101954     0.727273            5              5\n...*/"
    },
    {
        "input": "-- start template query49.tpl query 48 in stream 0\nselect /* TPC-DS query49.tpl 0.48 */  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\t web_sales ws left outer join web_returns wr \n \t\t\ton (ws.ws_order_number = wr.wr_order_number and \n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere \n \t\t\twr.wr_return_amt > 10000 \n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where \n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select \n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect \n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and \n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tcr.cr_return_amount > 10000 \n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where \n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select \n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect \n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom \n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere \n \t\t\tsr.sr_return_amt > 10000 \n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0 \n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 1999\n                         and d_moy = 11\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or \n store.currency_rank <= 10\n )\n )\n order by 1,4,5,2\n limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 1999 ) , \"IN_WEB\" AS ( SELECT \"WS\".\"WS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"WR\".\"WR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"WS\".\"WS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"WR\".\"WR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"WS\".\"WS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"WEB_SALES\" AS \"WS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WS\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WR\" ON \"WR\".\"WR_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"WR\".\"WR_ORDER_NUMBER\" = \"WS\".\"WS_ORDER_NUMBER\" WHERE \"WR\".\"WR_RETURN_AMT\" > 10000 AND \"WS\".\"WS_NET_PAID\" > 0 AND \"WS\".\"WS_NET_PROFIT\" > 1 AND \"WS\".\"WS_QUANTITY\" > 0 GROUP BY \"WS\".\"WS_ITEM_SK\" ) , \"WEB\" AS ( SELECT \"IN_WEB\".\"ITEM\" AS \"ITEM\" , \"IN_WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_WEB\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_WEB\" AS \"IN_WEB\" ) , \"IN_CAT\" AS ( SELECT \"CS\".\"CS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"CR\".\"CR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"CS\".\"CS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"CR\".\"CR_RETURN_AMOUNT\" , 0 ) ) / SUM ( COALESCE ( \"CS\".\"CS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"CATALOG_SALES\" AS \"CS\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CR\" ON \"CR\".\"CR_ITEM_SK\" = \"CS\".\"CS_ITEM_SK\" AND \"CR\".\"CR_ORDER_NUMBER\" = \"CS\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CS\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CR\".\"CR_RETURN_AMOUNT\" > 10000 AND \"CS\".\"CS_NET_PAID\" > 0 AND \"CS\".\"CS_NET_PROFIT\" > 1 AND \"CS\".\"CS_QUANTITY\" > 0 GROUP BY \"CS\".\"CS_ITEM_SK\" ) , \"CATALOG\" AS ( SELECT \"IN_CAT\".\"ITEM\" AS \"ITEM\" , \"IN_CAT\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_CAT\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_CAT\" AS \"IN_CAT\" ) , \"IN_STORE\" AS ( SELECT \"STS\".\"SS_ITEM_SK\" AS \"ITEM\" , CAST ( SUM ( COALESCE ( \"SR\".\"SR_RETURN_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( \"STS\".\"SS_QUANTITY\" , 0 ) ) AS DECIMAL ( 15 , 4 ) ) AS \"RETURN_RATIO\" , SUM ( COALESCE ( \"SR\".\"SR_RETURN_AMT\" , 0 ) ) / SUM ( COALESCE ( \"STS\".\"SS_NET_PAID\" , 0 ) ) AS \"CURRENCY_RATIO\" FROM \"STORE_SALES\" AS \"STS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STS\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"SR\" ON \"SR\".\"SR_ITEM_SK\" = \"STS\".\"SS_ITEM_SK\" AND \"SR\".\"SR_TICKET_NUMBER\" = \"STS\".\"SS_TICKET_NUMBER\" WHERE \"SR\".\"SR_RETURN_AMT\" > 10000 AND \"STS\".\"SS_NET_PAID\" > 0 AND \"STS\".\"SS_NET_PROFIT\" > 1 AND \"STS\".\"SS_QUANTITY\" > 0 GROUP BY \"STS\".\"SS_ITEM_SK\" ) , \"STORE\" AS ( SELECT \"IN_STORE\".\"ITEM\" AS \"ITEM\" , \"IN_STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"RETURN_RATIO\" NULLS LAST ) AS \"RETURN_RANK\" , RANK ( ) OVER ( ORDER BY \"IN_STORE\".\"CURRENCY_RATIO\" NULLS LAST ) AS \"CURRENCY_RANK\" FROM \"IN_STORE\" AS \"IN_STORE\" ) , \"_Q_0\" AS ( SELECT 'web' AS \"CHANNEL\" , \"WEB\".\"ITEM\" AS \"ITEM\" , \"WEB\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"WEB\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"WEB\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"WEB\" AS \"WEB\" WHERE \"WEB\".\"CURRENCY_RANK\" <= 10 OR \"WEB\".\"RETURN_RANK\" <= 10 UNION SELECT 'catalog' AS \"CHANNEL\" , \"CATALOG\".\"ITEM\" AS \"ITEM\" , \"CATALOG\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"CATALOG\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"CATALOG\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"CATALOG\" AS \"CATALOG\" WHERE \"CATALOG\".\"CURRENCY_RANK\" <= 10 OR \"CATALOG\".\"RETURN_RANK\" <= 10 UNION SELECT 'store' AS \"CHANNEL\" , \"STORE\".\"ITEM\" AS \"ITEM\" , \"STORE\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"STORE\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"STORE\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"STORE\" AS \"STORE\" WHERE \"STORE\".\"CURRENCY_RANK\" <= 10 OR \"STORE\".\"RETURN_RANK\" <= 10 ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ITEM\" AS \"ITEM\" , \"_Q_0\".\"RETURN_RATIO\" AS \"RETURN_RATIO\" , \"_Q_0\".\"RETURN_RANK\" AS \"RETURN_RANK\" , \"_Q_0\".\"CURRENCY_RANK\" AS \"CURRENCY_RANK\" FROM \"_Q_0\" AS \"_Q_0\" ORDER BY \"CHANNEL\" NULLS LAST , \"RETURN_RANK\" NULLS LAST , \"CURRENCY_RANK\" NULLS LAST , \"ITEM\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT CHANNEL , ITEM , RETURN_RATIO , RETURN_RANK , CURRENCY_RANK FROM ( SELECT 'web' AS CHANNEL , WEB.ITEM , WEB.RETURN_RATIO , WEB.RETURN_RANK , WEB.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT WS.WS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( WR.WR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( WS.WS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM WEB_SALES AS WS LEFT OUTER JOIN WEB_RETURNS AS WR ON ( WS.WS_ORDER_NUMBER = WR.WR_ORDER_NUMBER AND WS.WS_ITEM_SK = WR.WR_ITEM_SK ) , DATE_DIM WHERE WR.WR_RETURN_AMT > 10000 AND WS.WS_NET_PROFIT > 1 AND WS.WS_NET_PAID > 0 AND WS.WS_QUANTITY > 0 AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY WS.WS_ITEM_SK ) AS IN_WEB ) AS WEB WHERE ( WEB.RETURN_RANK <= 10 OR WEB.CURRENCY_RANK <= 10 ) UNION SELECT 'catalog' AS CHANNEL , CATALOG.ITEM , CATALOG.RETURN_RATIO , CATALOG.RETURN_RANK , CATALOG.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT CS.CS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( CR.CR_RETURN_AMOUNT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( CS.CS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM CATALOG_SALES AS CS LEFT OUTER JOIN CATALOG_RETURNS AS CR ON ( CS.CS_ORDER_NUMBER = CR.CR_ORDER_NUMBER AND CS.CS_ITEM_SK = CR.CR_ITEM_SK ) , DATE_DIM WHERE CR.CR_RETURN_AMOUNT > 10000 AND CS.CS_NET_PROFIT > 1 AND CS.CS_NET_PAID > 0 AND CS.CS_QUANTITY > 0 AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY CS.CS_ITEM_SK ) AS IN_CAT ) AS CATALOG WHERE ( CATALOG.RETURN_RANK <= 10 OR CATALOG.CURRENCY_RANK <= 10 ) UNION SELECT 'store' AS CHANNEL , STORE.ITEM , STORE.RETURN_RATIO , STORE.RETURN_RANK , STORE.CURRENCY_RANK FROM ( SELECT ITEM , RETURN_RATIO , CURRENCY_RATIO , RANK ( ) OVER ( ORDER BY RETURN_RATIO NULLS FIRST ) AS RETURN_RANK , RANK ( ) OVER ( ORDER BY CURRENCY_RATIO NULLS FIRST ) AS CURRENCY_RANK FROM ( SELECT STS.SS_ITEM_SK AS ITEM , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_QUANTITY , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS RETURN_RATIO , ( CAST ( SUM ( COALESCE ( SR.SR_RETURN_AMT , 0 ) ) AS DECIMAL ( 15 , 4 ) ) / CAST ( SUM ( COALESCE ( STS.SS_NET_PAID , 0 ) ) AS DECIMAL ( 15 , 4 ) ) ) AS CURRENCY_RATIO FROM STORE_SALES AS STS LEFT OUTER JOIN STORE_RETURNS AS SR ON ( STS.SS_TICKET_NUMBER = SR.SR_TICKET_NUMBER AND STS.SS_ITEM_SK = SR.SR_ITEM_SK ) , DATE_DIM WHERE SR.SR_RETURN_AMT > 10000 AND STS.SS_NET_PROFIT > 1 AND STS.SS_NET_PAID > 0 AND STS.SS_QUANTITY > 0 AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 AND D_MOY = 11 GROUP BY STS.SS_ITEM_SK ) AS IN_STORE ) AS STORE WHERE ( STORE.RETURN_RANK <= 10 OR STORE.CURRENCY_RANK <= 10 ) ) ORDER BY 1 NULLS FIRST , 4 NULLS FIRST , 5 NULLS FIRST , 2 NULLS FIRST LIMIT 21",
                "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog   72472        0E-16            1             66\n1   catalog   64867        0E-16            1            215\n2   catalog   75637        0E-16            1            284\n3   catalog   78628        0E-16            1            288\n4   catalog   28286     0.474747            5              1\n5   catalog   96284     0.515789            6              2\n6   catalog   28426      0.53125            7              3\n7   catalog   37682     0.538462            8              4\n8   catalog   43804     0.538462            8              4\n9   catalog   34826     0.546392           10              6\n10  catalog   27164     0.553191           12              7\n11  catalog   18626     0.555556           13              8\n12  catalog   73516     0.557895           14              9\n13  catalog   38071      0.56701           15             10\n14    store   57598     0.666667            1              1\n15    store   37879     0.670103            2              2\n16    store    3896     0.697674            3              3\n17    store   33284     0.705263            4              4\n18    store  101954     0.727273            5              5\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.263331,
                    "execution_time": 0.088539,
                    "compile_time": 0.001186,
                    "planning_time": 0.126885
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.26745,
                    "execution_time": 0.095543,
                    "compile_time": 0.001135,
                    "planning_time": 0.12519
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*    channel    item return_ratio  return_rank  currency_rank\n0   catalog   72472        0E-16            1             66\n1   catalog   64867        0E-16            1            215\n2   catalog   75637        0E-16            1            284\n3   catalog   78628        0E-16            1            288\n4   catalog   28286     0.474747            5              1\n5   catalog   96284     0.515789            6              2\n6   catalog   28426      0.53125            7              3\n7   catalog   37682     0.538462            8              4\n8   catalog   43804     0.538462            8              4\n9   catalog   34826     0.546392           10              6\n10  catalog   27164     0.553191           12              7\n11  catalog   18626     0.555556           13              8\n12  catalog   73516     0.557895           14              9\n13  catalog   38071      0.56701           15             10\n14    store   57598     0.666667            1              1\n15    store   37879     0.670103            2              2\n16    store    3896     0.697674            3              3\n17    store   33284     0.705263            4              4\n18    store  101954     0.727273            5              5\n...*/"
    }
]