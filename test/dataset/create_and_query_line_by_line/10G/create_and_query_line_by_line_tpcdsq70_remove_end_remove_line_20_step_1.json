[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query70a.tpl query 34 in stream 0\nwith /* TPC-DS query70a.tpl 0.34 */ results as\n( select\n    sum(ss_net_profit) as total_sum ,s_state ,s_county, 0 as gstate, 0 as g_county\n from\n    store_sales\n  ,date_dim      d1\n  ,store\n where\n    d1.d_month_seq between 1188 and 1188 + 11\n and d1.d_date_sk = ss_sold_date_sk\n and s_store_sk  = ss_store_sk\n and s_state in\n            ( select s_state\n              from  (select s_state as s_state,\n                 rank() over ( partition by s_state order by sum(ss_net_profit) desc) as ranking\n                      from  store_sales, store, date_dim\n                      where d_month_seq between 1188 and 1188 + 11\n                 and d_date_sk = ss_sold_date_sk\n                 and s_store_sk  = ss_store_sk\n                      group by s_state\n                    ) tmp1 \n              where ranking <= 5)\n  group by s_state,s_county) ,  \n results_rollup as \n(select total_sum ,s_state ,s_county, 0 as g_state, 0 as g_county, 0 as lochierarchy from results\n union\n select sum(total_sum) as total_sum,s_state, NULL as s_county, 0 as g_state, 1 as g_county, 1 as lochierarchy from results group by s_state\n union\n select sum(total_sum) as total_sum ,NULL as s_state ,NULL as s_county, 1 as g_state, 1 as g_county, 2 as lochierarchy from results)\n  select  total_sum ,s_state ,s_county, lochierarchy \n  ,rank() over (\n     partition by lochierarchy, \n     case when g_county = 0 then s_state end \n     order by total_sum desc) as rank_within_parent\n from results_rollup\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"STORE_SALES_2\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_STORE_SK\" AS \"SS_STORE_SK\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"SS_NET_PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"TMP1\" AS ( SELECT \"STORE\".\"S_STATE\" AS \"S_STATE\" , RANK ( ) OVER ( PARTITION BY \"STORE\".\"S_STATE\" ORDER BY SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) DESC NULLS FIRST ) AS \"RANKING\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MONTH_SEQ\" <= 1199 AND \"DATE_DIM\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STATE\" ) , \"_U_0\" AS ( SELECT \"TMP1\".\"S_STATE\" AS \"S_STATE\" FROM \"TMP1\" AS \"TMP1\" WHERE \"TMP1\".\"RANKING\" <= 5 GROUP BY \"TMP1\".\"S_STATE\" ) , \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"TOTAL_SUM\" , \"STORE\".\"S_STATE\" AS \"S_STATE\" , \"STORE\".\"S_COUNTY\" AS \"S_COUNTY\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_MONTH_SEQ\" <= 1199 AND \"D1\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"S_STATE\" = \"STORE\".\"S_STATE\" WHERE NOT \"_U_0\".\"S_STATE\" IS NULL GROUP BY \"STORE\".\"S_STATE\" , \"STORE\".\"S_COUNTY\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS\".\"S_COUNTY\" AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 0 AS \"G_COUNTY\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"S_STATE\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , NULL AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 1 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS_ROLLUP\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS_ROLLUP\".\"S_COUNTY\" AS \"S_COUNTY\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"G_COUNTY\" = 0 THEN \"RESULTS_ROLLUP\".\"S_STATE\" END ORDER BY \"RESULTS_ROLLUP\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_STORE_SK\" AS \"SS_STORE_SK\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"SS_NET_PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.916475,
                    "execution_time": 0.662042,
                    "compile_time": 0.000235,
                    "planning_time": 0.023671,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.953404,
                    "execution_time": 0.630839,
                    "compile_time": 0.000243,
                    "planning_time": 0.085312,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"STORE\".\"S_STATE\" AS \"S_STATE\" , RANK ( ) OVER ( PARTITION BY \"STORE\".\"S_STATE\" ORDER BY SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) DESC NULLS FIRST ) AS \"RANKING\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MONTH_SEQ\" <= 1199 AND \"DATE_DIM\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STATE\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.155753,
                    "execution_time": 0.097545,
                    "compile_time": 0.000368,
                    "planning_time": 0.038345,
                    "create_size": 30
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.326932,
                    "execution_time": 0.09585,
                    "compile_time": 0.145742,
                    "planning_time": 0.106047,
                    "create_size": 30
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"SPEQLITE_TEMP_TABLE_2\".\"S_STATE\" AS \"S_STATE\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" WHERE \"SPEQLITE_TEMP_TABLE_2\".\"RANKING\" <= 5 GROUP BY \"SPEQLITE_TEMP_TABLE_2\".\"S_STATE\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.062403,
                    "execution_time": 0.034169,
                    "compile_time": 0.000225,
                    "planning_time": 0.004961,
                    "create_size": 12
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.228507,
                    "execution_time": 0.034288,
                    "compile_time": 0.104204,
                    "planning_time": 0.062899,
                    "create_size": 12
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"TOTAL_SUM\" , \"STORE\".\"S_STATE\" AS \"S_STATE\" , \"STORE\".\"S_COUNTY\" AS \"S_COUNTY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_MONTH_SEQ\" <= 1199 AND \"D1\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"S_STATE\" = \"STORE\".\"S_STATE\" WHERE NOT \"SPEQLITE_TEMP_TABLE_3\".\"S_STATE\" IS NULL GROUP BY \"STORE\".\"S_STATE\" , \"STORE\".\"S_COUNTY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.192077,
                    "execution_time": 0.112114,
                    "compile_time": 0.000437,
                    "planning_time": 0.045991,
                    "create_size": 6
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.391628,
                    "execution_time": 0.112871,
                    "compile_time": 0.126344,
                    "planning_time": 0.11439,
                    "create_size": 6
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"SPEQLITE_TEMP_TABLE_4\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_4\".\"S_COUNTY\" AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 0 AS \"G_COUNTY\" , 0 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_4\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"S_STATE\" AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 1 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" GROUP BY \"SPEQLITE_TEMP_TABLE_4\".\"S_STATE\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_4\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , NULL AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 1 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 2 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.102735,
                    "execution_time": 0.057995,
                    "compile_time": 0.000494,
                    "planning_time": 0.010096,
                    "create_size": 9
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.246839,
                    "execution_time": 0.057956,
                    "compile_time": 0.100644,
                    "planning_time": 0.05195,
                    "create_size": 9
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" LIMIT 21",
                "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -1.562675e+09      AL      Walker County             0                   1\n1 -8.640159e+07      TN                                0                   1\n2 -1.462623e+09      TN  Williamson County             0                   2\n3 -1.291712e+09      SD               None             1                   1\n4 -1.549025e+09      TN               None             1                   2\n5 -1.562675e+09      AL               None             1                   3\n6 -1.291712e+09      SD     Ziebach County             0                   1\n7 -4.403411e+09    None               None             2                   1*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.022295,
                    "execution_time": 0.009357,
                    "compile_time": 9.6e-05,
                    "planning_time": 0.005142
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.063058,
                    "execution_time": 0.009997,
                    "compile_time": 0.002058,
                    "planning_time": 0.040739
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\""
            }
        ],
        "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -1.562675e+09      AL      Walker County             0                   1\n1 -8.640159e+07      TN                                0                   1\n2 -1.462623e+09      TN  Williamson County             0                   2\n3 -1.291712e+09      SD               None             1                   1\n4 -1.549025e+09      TN               None             1                   2\n5 -1.562675e+09      AL               None             1                   3\n6 -1.291712e+09      SD     Ziebach County             0                   1\n7 -4.403411e+09    None               None             2                   1*/"
    },
    {
        "input": "-- start template query70a.tpl query 34 in stream 0\nwith /* TPC-DS query70a.tpl 0.34 */ results as\n( select\n    sum(ss_net_profit) as total_sum ,s_state ,s_county, 0 as gstate, 0 as g_county\n from\n    store_sales\n  ,date_dim      d1\n  ,store\n where\n    d1.d_month_seq between 1188 and 1188 + 11\n and d1.d_date_sk = ss_sold_date_sk\n and s_store_sk  = ss_store_sk\n and s_state in\n            ( select s_state\n              from  (select s_state as s_state,\n                 rank() over ( partition by s_state order by sum(ss_net_profit) desc) as ranking\n                      from  store_sales, store, date_dim\n                      where d_month_seq between 1188 and 1188 + 11\n                 and d_date_sk = ss_sold_date_sk\n                 and s_store_sk  = ss_store_sk\n                      group by s_state\n                    ) tmp1 \n              where ranking <= 5)\n  group by s_state,s_county) ,  \n results_rollup as \n(select total_sum ,s_state ,s_county, 0 as g_state, 0 as g_county, 0 as lochierarchy from results\n union\n select sum(total_sum) as total_sum,s_state, NULL as s_county, 0 as g_state, 1 as g_county, 1 as lochierarchy from results group by s_state\n union\n select sum(total_sum) as total_sum ,NULL as s_state ,NULL as s_county, 1 as g_state, 1 as g_county, 2 as lochierarchy from results)\n  select  total_sum ,s_state ,s_county, lochierarchy \n  ,rank() over (\n     partition by lochierarchy, \n     case when g_county = 0 then s_state end \n     order by total_sum desc) as rank_within_parent\n from results_rollup\n order by total_sum desc\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"STORE_SALES_2\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_STORE_SK\" AS \"SS_STORE_SK\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"SS_NET_PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"TMP1\" AS ( SELECT \"STORE\".\"S_STATE\" AS \"S_STATE\" , RANK ( ) OVER ( PARTITION BY \"STORE\".\"S_STATE\" ORDER BY SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) DESC NULLS FIRST ) AS \"RANKING\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MONTH_SEQ\" <= 1199 AND \"DATE_DIM\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STATE\" ) , \"_U_0\" AS ( SELECT \"TMP1\".\"S_STATE\" AS \"S_STATE\" FROM \"TMP1\" AS \"TMP1\" WHERE \"TMP1\".\"RANKING\" <= 5 GROUP BY \"TMP1\".\"S_STATE\" ) , \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"TOTAL_SUM\" , \"STORE\".\"S_STATE\" AS \"S_STATE\" , \"STORE\".\"S_COUNTY\" AS \"S_COUNTY\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_MONTH_SEQ\" <= 1199 AND \"D1\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"S_STATE\" = \"STORE\".\"S_STATE\" WHERE NOT \"_U_0\".\"S_STATE\" IS NULL GROUP BY \"STORE\".\"S_STATE\" , \"STORE\".\"S_COUNTY\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS\".\"S_COUNTY\" AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 0 AS \"G_COUNTY\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"S_STATE\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , NULL AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 1 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS_ROLLUP\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS_ROLLUP\".\"S_COUNTY\" AS \"S_COUNTY\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"G_COUNTY\" = 0 THEN \"RESULTS_ROLLUP\".\"S_STATE\" END ORDER BY \"RESULTS_ROLLUP\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"TOTAL_SUM\" DESC NULLS FIRST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"TOTAL_SUM\" DESC LIMIT 21",
                "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -8.640159e+07      TN                                0                   1\n1 -1.291712e+09      SD     Ziebach County             0                   1\n2 -1.291712e+09      SD               None             1                   1\n3 -1.462623e+09      TN  Williamson County             0                   2\n4 -1.549025e+09      TN               None             1                   2\n5 -1.562675e+09      AL      Walker County             0                   1\n6 -1.562675e+09      AL               None             1                   3\n7 -4.403411e+09    None               None             2                   1*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.0244,
                    "execution_time": 0.010617,
                    "compile_time": 0.000123,
                    "planning_time": 0.005161
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.061427,
                    "execution_time": 0.011202,
                    "compile_time": 0.001057,
                    "planning_time": 0.040433
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"TOTAL_SUM\" DESC NULLS FIRST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"TOTAL_SUM\" DESC NULLS FIRST"
            }
        ],
        "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -8.640159e+07      TN                                0                   1\n1 -1.291712e+09      SD     Ziebach County             0                   1\n2 -1.291712e+09      SD               None             1                   1\n3 -1.462623e+09      TN  Williamson County             0                   2\n4 -1.549025e+09      TN               None             1                   2\n5 -1.562675e+09      AL      Walker County             0                   1\n6 -1.562675e+09      AL               None             1                   3\n7 -4.403411e+09    None               None             2                   1*/"
    },
    {
        "input": "-- start template query70a.tpl query 34 in stream 0\nwith /* TPC-DS query70a.tpl 0.34 */ results as\n( select\n    sum(ss_net_profit) as total_sum ,s_state ,s_county, 0 as gstate, 0 as g_county\n from\n    store_sales\n  ,date_dim      d1\n  ,store\n where\n    d1.d_month_seq between 1188 and 1188 + 11\n and d1.d_date_sk = ss_sold_date_sk\n and s_store_sk  = ss_store_sk\n and s_state in\n            ( select s_state\n              from  (select s_state as s_state,\n                 rank() over ( partition by s_state order by sum(ss_net_profit) desc) as ranking\n                      from  store_sales, store, date_dim\n                      where d_month_seq between 1188 and 1188 + 11\n                 and d_date_sk = ss_sold_date_sk\n                 and s_store_sk  = ss_store_sk\n                      group by s_state\n                    ) tmp1 \n              where ranking <= 5)\n  group by s_state,s_county) ,  \n results_rollup as \n(select total_sum ,s_state ,s_county, 0 as g_state, 0 as g_county, 0 as lochierarchy from results\n union\n select sum(total_sum) as total_sum,s_state, NULL as s_county, 0 as g_state, 1 as g_county, 1 as lochierarchy from results group by s_state\n union\n select sum(total_sum) as total_sum ,NULL as s_state ,NULL as s_county, 1 as g_state, 1 as g_county, 2 as lochierarchy from results)\n  select  total_sum ,s_state ,s_county, lochierarchy \n  ,rank() over (\n     partition by lochierarchy, \n     case when g_county = 0 then s_state end \n     order by total_sum desc) as rank_within_parent\n from results_rollup\n order by\n  lochierarchy desc\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"STORE_SALES_2\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_STORE_SK\" AS \"SS_STORE_SK\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"SS_NET_PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"TMP1\" AS ( SELECT \"STORE\".\"S_STATE\" AS \"S_STATE\" , RANK ( ) OVER ( PARTITION BY \"STORE\".\"S_STATE\" ORDER BY SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) DESC NULLS FIRST ) AS \"RANKING\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MONTH_SEQ\" <= 1199 AND \"DATE_DIM\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STATE\" ) , \"_U_0\" AS ( SELECT \"TMP1\".\"S_STATE\" AS \"S_STATE\" FROM \"TMP1\" AS \"TMP1\" WHERE \"TMP1\".\"RANKING\" <= 5 GROUP BY \"TMP1\".\"S_STATE\" ) , \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"TOTAL_SUM\" , \"STORE\".\"S_STATE\" AS \"S_STATE\" , \"STORE\".\"S_COUNTY\" AS \"S_COUNTY\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_MONTH_SEQ\" <= 1199 AND \"D1\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"S_STATE\" = \"STORE\".\"S_STATE\" WHERE NOT \"_U_0\".\"S_STATE\" IS NULL GROUP BY \"STORE\".\"S_STATE\" , \"STORE\".\"S_COUNTY\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS\".\"S_COUNTY\" AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 0 AS \"G_COUNTY\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"S_STATE\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , NULL AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 1 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS_ROLLUP\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS_ROLLUP\".\"S_COUNTY\" AS \"S_COUNTY\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"G_COUNTY\" = 0 THEN \"RESULTS_ROLLUP\".\"S_STATE\" END ORDER BY \"RESULTS_ROLLUP\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC LIMIT 21",
                "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -4.403411e+09    None               None             2                   1\n1 -1.549025e+09      TN               None             1                   2\n2 -1.562675e+09      AL               None             1                   3\n3 -1.291712e+09      SD               None             1                   1\n4 -1.462623e+09      TN  Williamson County             0                   2\n5 -1.562675e+09      AL      Walker County             0                   1\n6 -8.640159e+07      TN                                0                   1\n7 -1.291712e+09      SD     Ziebach County             0                   1*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.022817,
                    "execution_time": 0.010184,
                    "compile_time": 0.00013,
                    "planning_time": 0.004862
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.173175,
                    "execution_time": 0.01114,
                    "compile_time": 0.120411,
                    "planning_time": 0.040442
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST"
            }
        ],
        "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -4.403411e+09    None               None             2                   1\n1 -1.549025e+09      TN               None             1                   2\n2 -1.562675e+09      AL               None             1                   3\n3 -1.291712e+09      SD               None             1                   1\n4 -1.462623e+09      TN  Williamson County             0                   2\n5 -1.562675e+09      AL      Walker County             0                   1\n6 -8.640159e+07      TN                                0                   1\n7 -1.291712e+09      SD     Ziebach County             0                   1*/"
    },
    {
        "input": "-- start template query70a.tpl query 34 in stream 0\nwith /* TPC-DS query70a.tpl 0.34 */ results as\n( select\n    sum(ss_net_profit) as total_sum ,s_state ,s_county, 0 as gstate, 0 as g_county\n from\n    store_sales\n  ,date_dim      d1\n  ,store\n where\n    d1.d_month_seq between 1188 and 1188 + 11\n and d1.d_date_sk = ss_sold_date_sk\n and s_store_sk  = ss_store_sk\n and s_state in\n            ( select s_state\n              from  (select s_state as s_state,\n                 rank() over ( partition by s_state order by sum(ss_net_profit) desc) as ranking\n                      from  store_sales, store, date_dim\n                      where d_month_seq between 1188 and 1188 + 11\n                 and d_date_sk = ss_sold_date_sk\n                 and s_store_sk  = ss_store_sk\n                      group by s_state\n                    ) tmp1 \n              where ranking <= 5)\n  group by s_state,s_county) ,  \n results_rollup as \n(select total_sum ,s_state ,s_county, 0 as g_state, 0 as g_county, 0 as lochierarchy from results\n union\n select sum(total_sum) as total_sum,s_state, NULL as s_county, 0 as g_state, 1 as g_county, 1 as lochierarchy from results group by s_state\n union\n select sum(total_sum) as total_sum ,NULL as s_state ,NULL as s_county, 1 as g_state, 1 as g_county, 2 as lochierarchy from results)\n  select  total_sum ,s_state ,s_county, lochierarchy \n  ,rank() over (\n     partition by lochierarchy, \n     case when g_county = 0 then s_state end \n     order by total_sum desc) as rank_within_parent\n from results_rollup\n order by\n  lochierarchy desc\n  ,case when lochierarchy = 0 then s_state end\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"STORE_SALES_2\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_STORE_SK\" AS \"SS_STORE_SK\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"SS_NET_PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"TMP1\" AS ( SELECT \"STORE\".\"S_STATE\" AS \"S_STATE\" , RANK ( ) OVER ( PARTITION BY \"STORE\".\"S_STATE\" ORDER BY SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) DESC NULLS FIRST ) AS \"RANKING\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MONTH_SEQ\" <= 1199 AND \"DATE_DIM\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STATE\" ) , \"_U_0\" AS ( SELECT \"TMP1\".\"S_STATE\" AS \"S_STATE\" FROM \"TMP1\" AS \"TMP1\" WHERE \"TMP1\".\"RANKING\" <= 5 GROUP BY \"TMP1\".\"S_STATE\" ) , \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"TOTAL_SUM\" , \"STORE\".\"S_STATE\" AS \"S_STATE\" , \"STORE\".\"S_COUNTY\" AS \"S_COUNTY\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_MONTH_SEQ\" <= 1199 AND \"D1\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"S_STATE\" = \"STORE\".\"S_STATE\" WHERE NOT \"_U_0\".\"S_STATE\" IS NULL GROUP BY \"STORE\".\"S_STATE\" , \"STORE\".\"S_COUNTY\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS\".\"S_COUNTY\" AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 0 AS \"G_COUNTY\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"S_STATE\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , NULL AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 1 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS_ROLLUP\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS_ROLLUP\".\"S_COUNTY\" AS \"S_COUNTY\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"G_COUNTY\" = 0 THEN \"RESULTS_ROLLUP\".\"S_STATE\" END ORDER BY \"RESULTS_ROLLUP\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END LIMIT 21",
                "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -4.403411e+09    None               None             2                   1\n1 -1.549025e+09      TN               None             1                   2\n2 -1.562675e+09      AL               None             1                   3\n3 -1.291712e+09      SD               None             1                   1\n4 -1.562675e+09      AL      Walker County             0                   1\n5 -1.291712e+09      SD     Ziebach County             0                   1\n6 -1.462623e+09      TN  Williamson County             0                   2\n7 -8.640159e+07      TN                                0                   1*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.024813,
                    "execution_time": 0.01093,
                    "compile_time": 0.000166,
                    "planning_time": 0.005488
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.061568,
                    "execution_time": 0.010627,
                    "compile_time": 0.002143,
                    "planning_time": 0.041006
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END NULLS LAST"
            }
        ],
        "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -4.403411e+09    None               None             2                   1\n1 -1.549025e+09      TN               None             1                   2\n2 -1.562675e+09      AL               None             1                   3\n3 -1.291712e+09      SD               None             1                   1\n4 -1.562675e+09      AL      Walker County             0                   1\n5 -1.291712e+09      SD     Ziebach County             0                   1\n6 -1.462623e+09      TN  Williamson County             0                   2\n7 -8.640159e+07      TN                                0                   1*/"
    },
    {
        "input": "-- start template query70a.tpl query 34 in stream 0\nwith /* TPC-DS query70a.tpl 0.34 */ results as\n( select\n    sum(ss_net_profit) as total_sum ,s_state ,s_county, 0 as gstate, 0 as g_county\n from\n    store_sales\n  ,date_dim      d1\n  ,store\n where\n    d1.d_month_seq between 1188 and 1188 + 11\n and d1.d_date_sk = ss_sold_date_sk\n and s_store_sk  = ss_store_sk\n and s_state in\n            ( select s_state\n              from  (select s_state as s_state,\n                 rank() over ( partition by s_state order by sum(ss_net_profit) desc) as ranking\n                      from  store_sales, store, date_dim\n                      where d_month_seq between 1188 and 1188 + 11\n                 and d_date_sk = ss_sold_date_sk\n                 and s_store_sk  = ss_store_sk\n                      group by s_state\n                    ) tmp1 \n              where ranking <= 5)\n  group by s_state,s_county) ,  \n results_rollup as \n(select total_sum ,s_state ,s_county, 0 as g_state, 0 as g_county, 0 as lochierarchy from results\n union\n select sum(total_sum) as total_sum,s_state, NULL as s_county, 0 as g_state, 1 as g_county, 1 as lochierarchy from results group by s_state\n union\n select sum(total_sum) as total_sum ,NULL as s_state ,NULL as s_county, 1 as g_state, 1 as g_county, 2 as lochierarchy from results)\n  select  total_sum ,s_state ,s_county, lochierarchy \n  ,rank() over (\n     partition by lochierarchy, \n     case when g_county = 0 then s_state end \n     order by total_sum desc) as rank_within_parent\n from results_rollup\n order by\n  lochierarchy desc\n  ,case when lochierarchy = 0 then s_state end\n  ,rank_within_parent\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"STORE_SALES_2\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_STORE_SK\" AS \"SS_STORE_SK\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"SS_NET_PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"TMP1\" AS ( SELECT \"STORE\".\"S_STATE\" AS \"S_STATE\" , RANK ( ) OVER ( PARTITION BY \"STORE\".\"S_STATE\" ORDER BY SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) DESC NULLS FIRST ) AS \"RANKING\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MONTH_SEQ\" <= 1199 AND \"DATE_DIM\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STATE\" ) , \"_U_0\" AS ( SELECT \"TMP1\".\"S_STATE\" AS \"S_STATE\" FROM \"TMP1\" AS \"TMP1\" WHERE \"TMP1\".\"RANKING\" <= 5 GROUP BY \"TMP1\".\"S_STATE\" ) , \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"TOTAL_SUM\" , \"STORE\".\"S_STATE\" AS \"S_STATE\" , \"STORE\".\"S_COUNTY\" AS \"S_COUNTY\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_MONTH_SEQ\" <= 1199 AND \"D1\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"S_STATE\" = \"STORE\".\"S_STATE\" WHERE NOT \"_U_0\".\"S_STATE\" IS NULL GROUP BY \"STORE\".\"S_STATE\" , \"STORE\".\"S_COUNTY\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS\".\"S_COUNTY\" AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 0 AS \"G_COUNTY\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"S_STATE\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , NULL AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 1 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS_ROLLUP\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS_ROLLUP\".\"S_COUNTY\" AS \"S_COUNTY\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"G_COUNTY\" = 0 THEN \"RESULTS_ROLLUP\".\"S_STATE\" END ORDER BY \"RESULTS_ROLLUP\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END , \"RANK_WITHIN_PARENT\" LIMIT 21",
                "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -4.403411e+09    None               None             2                   1\n1 -1.291712e+09      SD               None             1                   1\n2 -1.549025e+09      TN               None             1                   2\n3 -1.562675e+09      AL               None             1                   3\n4 -1.562675e+09      AL      Walker County             0                   1\n5 -1.291712e+09      SD     Ziebach County             0                   1\n6 -8.640159e+07      TN                                0                   1\n7 -1.462623e+09      TN  Williamson County             0                   2*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.025383,
                    "execution_time": 0.010961,
                    "compile_time": 0.000129,
                    "planning_time": 0.006009
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.172077,
                    "execution_time": 0.011114,
                    "compile_time": 0.117897,
                    "planning_time": 0.041389
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST"
            }
        ],
        "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -4.403411e+09    None               None             2                   1\n1 -1.291712e+09      SD               None             1                   1\n2 -1.549025e+09      TN               None             1                   2\n3 -1.562675e+09      AL               None             1                   3\n4 -1.562675e+09      AL      Walker County             0                   1\n5 -1.291712e+09      SD     Ziebach County             0                   1\n6 -8.640159e+07      TN                                0                   1\n7 -1.462623e+09      TN  Williamson County             0                   2*/"
    },
    {
        "input": "-- start template query70a.tpl query 34 in stream 0\nwith /* TPC-DS query70a.tpl 0.34 */ results as\n( select\n    sum(ss_net_profit) as total_sum ,s_state ,s_county, 0 as gstate, 0 as g_county\n from\n    store_sales\n  ,date_dim      d1\n  ,store\n where\n    d1.d_month_seq between 1188 and 1188 + 11\n and d1.d_date_sk = ss_sold_date_sk\n and s_store_sk  = ss_store_sk\n and s_state in\n            ( select s_state\n              from  (select s_state as s_state,\n                 rank() over ( partition by s_state order by sum(ss_net_profit) desc) as ranking\n                      from  store_sales, store, date_dim\n                      where d_month_seq between 1188 and 1188 + 11\n                 and d_date_sk = ss_sold_date_sk\n                 and s_store_sk  = ss_store_sk\n                      group by s_state\n                    ) tmp1 \n              where ranking <= 5)\n  group by s_state,s_county) ,  \n results_rollup as \n(select total_sum ,s_state ,s_county, 0 as g_state, 0 as g_county, 0 as lochierarchy from results\n union\n select sum(total_sum) as total_sum,s_state, NULL as s_county, 0 as g_state, 1 as g_county, 1 as lochierarchy from results group by s_state\n union\n select sum(total_sum) as total_sum ,NULL as s_state ,NULL as s_county, 1 as g_state, 1 as g_county, 2 as lochierarchy from results)\n  select  total_sum ,s_state ,s_county, lochierarchy \n  ,rank() over (\n     partition by lochierarchy, \n     case when g_county = 0 then s_state end \n     order by total_sum desc) as rank_within_parent\n from results_rollup\n order by\n  lochierarchy desc\n  ,case when lochierarchy = 0 then s_state end\n  ,rank_within_parent\n limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"STORE_SALES_2\" AS ( SELECT \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"SS_SOLD_DATE_SK\" , \"STORE_SALES\".\"SS_STORE_SK\" AS \"SS_STORE_SK\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"SS_NET_PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" ) , \"TMP1\" AS ( SELECT \"STORE\".\"S_STATE\" AS \"S_STATE\" , RANK ( ) OVER ( PARTITION BY \"STORE\".\"S_STATE\" ORDER BY SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) DESC NULLS FIRST ) AS \"RANKING\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MONTH_SEQ\" <= 1199 AND \"DATE_DIM\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STATE\" ) , \"_U_0\" AS ( SELECT \"TMP1\".\"S_STATE\" AS \"S_STATE\" FROM \"TMP1\" AS \"TMP1\" WHERE \"TMP1\".\"RANKING\" <= 5 GROUP BY \"TMP1\".\"S_STATE\" ) , \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"TOTAL_SUM\" , \"STORE\".\"S_STATE\" AS \"S_STATE\" , \"STORE\".\"S_COUNTY\" AS \"S_COUNTY\" FROM \"STORE_SALES_2\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_MONTH_SEQ\" <= 1199 AND \"D1\".\"D_MONTH_SEQ\" >= 1188 JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"S_STATE\" = \"STORE\".\"S_STATE\" WHERE NOT \"_U_0\".\"S_STATE\" IS NULL GROUP BY \"STORE\".\"S_STATE\" , \"STORE\".\"S_COUNTY\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS\".\"S_COUNTY\" AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 0 AS \"G_COUNTY\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , \"RESULTS\".\"S_STATE\" AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 0 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"S_STATE\" UNION SELECT SUM ( \"RESULTS\".\"TOTAL_SUM\" ) AS \"TOTAL_SUM\" , NULL AS \"S_STATE\" , NULL AS \"S_COUNTY\" , 1 AS \"G_STATE\" , 1 AS \"G_COUNTY\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"RESULTS_ROLLUP\".\"S_STATE\" AS \"S_STATE\" , \"RESULTS_ROLLUP\".\"S_COUNTY\" AS \"S_COUNTY\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"G_COUNTY\" = 0 THEN \"RESULTS_ROLLUP\".\"S_STATE\" END ORDER BY \"RESULTS_ROLLUP\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END , \"RANK_WITHIN_PARENT\" LIMIT 21",
                "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -4.403411e+09    None               None             2                   1\n1 -1.291712e+09      SD               None             1                   1\n2 -1.549025e+09      TN               None             1                   2\n3 -1.562675e+09      AL               None             1                   3\n4 -1.562675e+09      AL      Walker County             0                   1\n5 -1.291712e+09      SD     Ziebach County             0                   1\n6 -8.640159e+07      TN                                0                   1\n7 -1.462623e+09      TN  Williamson County             0                   2*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.024098,
                    "execution_time": 0.010066,
                    "compile_time": 0.000127,
                    "planning_time": 0.005896
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.029819,
                    "execution_time": 0.01503,
                    "compile_time": 0.000128,
                    "planning_time": 0.006163
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" AS \"TOTAL_SUM\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" AS \"S_STATE\" , \"SPEQLITE_TEMP_TABLE_5\".\"S_COUNTY\" AS \"S_COUNTY\" , \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_5\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_5\".\"G_COUNTY\" = 0 THEN \"SPEQLITE_TEMP_TABLE_5\".\"S_STATE\" END ORDER BY \"SPEQLITE_TEMP_TABLE_5\".\"TOTAL_SUM\" DESC NULLS FIRST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"S_STATE\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100"
            }
        ],
        "preview": "\n/*      total_sum s_state           s_county  lochierarchy  rank_within_parent\n0 -4.403411e+09    None               None             2                   1\n1 -1.291712e+09      SD               None             1                   1\n2 -1.549025e+09      TN               None             1                   2\n3 -1.562675e+09      AL               None             1                   3\n4 -1.562675e+09      AL      Walker County             0                   1\n5 -1.291712e+09      SD     Ziebach County             0                   1\n6 -8.640159e+07      TN                                0                   1\n7 -1.462623e+09      TN  Williamson County             0                   2*/"
    }
]