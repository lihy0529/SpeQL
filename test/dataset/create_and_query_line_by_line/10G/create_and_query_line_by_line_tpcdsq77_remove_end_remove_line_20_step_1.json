[
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales\n      , date_dim\n      , store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns\n      , date_dim\n      , store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales\n      , date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns\n      , date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales\n      , date_dim\n      , web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns\n      , date_dim\n      , web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n/*CURSOR_IDENTIFIER*/\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , ws.sales\n        , coalesce(wr.returns, 0) as returns\n        , (ws.profit - coalesce(wr.profit_loss, 0)) as profit\n from ws\n left join wr\n   on ws.wp_web_page_sk = wr.wp_web_page_sk\n)\n group by channel, id\n)\nselect channel\n      , id\n      , sales\n      , returns\n      , profit\n from results",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , WS.SALES , COALESCE ( WR.RETURNS , 0 ) AS RETURNS , ( WS.PROFIT - COALESCE ( WR.PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel   id         sales      returns        profit\n0       web channel   44  3.944993e+06    172712.68 -5.823050e+05\n1     store channel   76  2.224158e+07    578345.50 -9.886026e+06\n2     store channel    7  2.221531e+07    519766.98 -9.709299e+06\n3     store channel   52  2.145005e+07    523474.27 -9.410307e+06\n4       web channel  176  3.952283e+06    150330.53 -6.069017e+05\n5       web channel  158  4.086166e+06    117133.78 -6.158523e+05\n6   catalog channel   20  1.118725e+09  20885718.55 -1.363673e+08\n7       web channel   55  4.065637e+06    135595.31 -6.326632e+05\n8       web channel  175  3.846447e+06    139315.71 -4.858940e+05\n9       web channel   71  3.772753e+06     46567.70 -4.262122e+05\n10      web channel   20  4.093802e+06    131428.47 -5.439832e+05\n11      web channel   68  3.705242e+06    142645.50 -7.741526e+05\n12      web channel   67  4.192255e+06    169552.16 -4.725532e+05\n13      web channel   56  3.975137e+06    153422.05 -5.290188e+05\n14      web channel  146  4.260032e+06    111556.53 -5.123588e+05\n15    store channel   26  2.290749e+07    591092.58 -1.020340e+07\n16  catalog channel   17  1.156043e+09  20885718.55 -1.244870e+08\n17      web channel  157  4.113438e+06    160766.32 -5.365012e+05\n18      web channel   49  4.088012e+06    118653.36 -4.936202e+05\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.288437,
                    "execution_time": 0.079486,
                    "compile_time": 0.001,
                    "planning_time": 0.158944
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 2.446553,
                    "execution_time": 2.246065,
                    "compile_time": 0.001086,
                    "planning_time": 0.145838
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel   id         sales      returns        profit\n0       web channel   44  3.944993e+06    172712.68 -5.823050e+05\n1     store channel   76  2.224158e+07    578345.50 -9.886026e+06\n2     store channel    7  2.221531e+07    519766.98 -9.709299e+06\n3     store channel   52  2.145005e+07    523474.27 -9.410307e+06\n4       web channel  176  3.952283e+06    150330.53 -6.069017e+05\n5       web channel  158  4.086166e+06    117133.78 -6.158523e+05\n6   catalog channel   20  1.118725e+09  20885718.55 -1.363673e+08\n7       web channel   55  4.065637e+06    135595.31 -6.326632e+05\n8       web channel  175  3.846447e+06    139315.71 -4.858940e+05\n9       web channel   71  3.772753e+06     46567.70 -4.262122e+05\n10      web channel   20  4.093802e+06    131428.47 -5.439832e+05\n11      web channel   68  3.705242e+06    142645.50 -7.741526e+05\n12      web channel   67  4.192255e+06    169552.16 -4.725532e+05\n13      web channel   56  3.975137e+06    153422.05 -5.290188e+05\n14      web channel  146  4.260032e+06    111556.53 -5.123588e+05\n15    store channel   26  2.290749e+07    591092.58 -1.020340e+07\n16  catalog channel   17  1.156043e+09  20885718.55 -1.244870e+08\n17      web channel  157  4.113438e+06    160766.32 -5.365012e+05\n18      web channel   49  4.088012e+06    118653.36 -4.936202e+05\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       join cr\n       on cs.cs_call_center_sk = cr.cr_call_center_sk\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from  ws left join wr\n        on ws.wp_web_page_sk = wr.wp_web_page_sk\n )\n group by channel, id\n )\n select * from results;\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" AS \"CR_CALL_CENTER_SK\" , SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" JOIN \"CR\" AS \"CR\" ON \"CR\".\"CR_CALL_CENTER_SK\" = \"CS\".\"CS_CALL_CENTER_SK\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS JOIN CR ON CS.CS_CALL_CENTER_SK = CR.CR_CALL_CENTER_SK UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*          channel   id        sales    returns       profit\n0     web channel    7   4029061.90  122172.67   -572588.60\n1     web channel  116   3876817.05   99365.24   -544739.16\n2   store channel   86  21117331.97  519995.89  -9410784.21\n3     web channel  173   3953468.17   60238.13   -445025.62\n4   store channel   22  22345523.31  575207.24  -9824885.95\n5     web channel  197   3906552.16   53180.59   -433816.88\n6   store channel   55  21854429.86  578222.03  -9898575.00\n7   store channel   20  23854435.59  506812.95 -10637298.32\n8     web channel  119   4563337.38   62291.86   -366764.15\n9     web channel  134   3947615.33  153369.76   -498675.11\n10  store channel   67  22940023.82  547302.04 -10182241.36\n11  store channel   73  22047605.52  489987.06  -9806742.16\n12  store channel   56  22055755.15  604701.53  -9769783.38\n13  store channel   19  22360157.35  575326.44 -10384413.13\n14  store channel   10  20404775.13  620684.15  -9145793.78\n15  store channel    4  21667166.49  670000.08  -9800043.53\n16    web channel   38   4201156.92  158030.62   -394942.35\n17    web channel   97   4005201.26  138293.51   -471738.63\n18  store channel   98  22919538.24  567944.46  -9907657.82\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.572553,
                    "execution_time": 0.308,
                    "compile_time": 0.062006,
                    "planning_time": 0.150928
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 7.004288,
                    "execution_time": 0.311116,
                    "compile_time": 6.368438,
                    "planning_time": 0.264248
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel   id        sales    returns       profit\n0     web channel    7   4029061.90  122172.67   -572588.60\n1     web channel  116   3876817.05   99365.24   -544739.16\n2   store channel   86  21117331.97  519995.89  -9410784.21\n3     web channel  173   3953468.17   60238.13   -445025.62\n4   store channel   22  22345523.31  575207.24  -9824885.95\n5     web channel  197   3906552.16   53180.59   -433816.88\n6   store channel   55  21854429.86  578222.03  -9898575.00\n7   store channel   20  23854435.59  506812.95 -10637298.32\n8     web channel  119   4563337.38   62291.86   -366764.15\n9     web channel  134   3947615.33  153369.76   -498675.11\n10  store channel   67  22940023.82  547302.04 -10182241.36\n11  store channel   73  22047605.52  489987.06  -9806742.16\n12  store channel   56  22055755.15  604701.53  -9769783.38\n13  store channel   19  22360157.35  575326.44 -10384413.13\n14  store channel   10  20404775.13  620684.15  -9145793.78\n15  store channel    4  21667166.49  670000.08  -9800043.53\n16    web channel   38   4201156.92  158030.62   -394942.35\n17    web channel   97   4005201.26  138293.51   -471738.63\n18  store channel   98  22919538.24  567944.46  -9907657.82\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n (select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       join cr on cs.cs_call_center_sk = cr.cr_call_center_sk\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , ws.sales\n        , coalesce(wr.returns, 0) as returns\n        , (ws.profit - coalesce(wr.profit_loss, 0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n )\n group by channel, id\n )\nselect *\nfrom results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" AS \"CR_CALL_CENTER_SK\" , SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" JOIN \"CR\" AS \"CR\" ON \"CR\".\"CR_CALL_CENTER_SK\" = \"CS\".\"CS_CALL_CENTER_SK\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS JOIN CR ON CS.CS_CALL_CENTER_SK = CR.CR_CALL_CENTER_SK UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , WS.SALES , COALESCE ( WR.RETURNS , 0 ) AS RETURNS , ( WS.PROFIT - COALESCE ( WR.PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*          channel   id        sales    returns      profit\n0   store channel   46  21563729.67  588327.65 -9861077.70\n1     web channel   85   4005853.45  107371.50  -566569.94\n2     web channel   86   4285203.45  175573.92  -520314.49\n3     web channel   62   4208113.81  144878.21  -464020.49\n4     web channel   35   4007565.26   41753.54  -491301.28\n5     web channel  121   3893371.45  144582.71  -603860.34\n6   store channel   50  21568822.85  549760.33 -9510462.95\n7   store channel   92  22525406.55  575710.85 -9990515.65\n8     web channel  149   4026483.24   66381.79  -435368.43\n9     web channel  181   4242720.81  105989.60  -357068.88\n10    web channel   50   4117671.44  163336.27  -535603.67\n11    web channel   77   4062487.47   51686.82  -456666.61\n12    web channel  170   4027238.65  165677.68  -378388.62\n13    web channel  103   4186006.07  153110.44  -502295.31\n14    web channel  109   4016328.68  141266.20  -530242.43\n15    web channel  113   3925083.84   51761.87  -485783.88\n16  store channel   14  21839003.56  542207.71 -9917024.17\n17    web channel   11   4152705.20   55184.03  -412798.84\n18    web channel   53   3811582.20   64373.78  -400647.71\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.325444,
                    "execution_time": 0.08296,
                    "compile_time": 0.042655,
                    "planning_time": 0.149307
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.628134,
                    "execution_time": 0.30963,
                    "compile_time": 0.001092,
                    "planning_time": 0.266113
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel   id        sales    returns      profit\n0   store channel   46  21563729.67  588327.65 -9861077.70\n1     web channel   85   4005853.45  107371.50  -566569.94\n2     web channel   86   4285203.45  175573.92  -520314.49\n3     web channel   62   4208113.81  144878.21  -464020.49\n4     web channel   35   4007565.26   41753.54  -491301.28\n5     web channel  121   3893371.45  144582.71  -603860.34\n6   store channel   50  21568822.85  549760.33 -9510462.95\n7   store channel   92  22525406.55  575710.85 -9990515.65\n8     web channel  149   4026483.24   66381.79  -435368.43\n9     web channel  181   4242720.81  105989.60  -357068.88\n10    web channel   50   4117671.44  163336.27  -535603.67\n11    web channel   77   4062487.47   51686.82  -456666.61\n12    web channel  170   4027238.65  165677.68  -378388.62\n13    web channel  103   4186006.07  153110.44  -502295.31\n14    web channel  109   4016328.68  141266.20  -530242.43\n15    web channel  113   3925083.84   51761.87  -485783.88\n16  store channel   14  21839003.56  542207.71 -9917024.17\n17    web channel   11   4152705.20   55184.03  -412798.84\n18    web channel   53   3811582.20   64373.78  -400647.71\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n )\n group by channel, id\n )\nselect *\nfrom results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel     id        sales      returns       profit\n0   catalog channel    NaN  15673043.24  20885718.55 -15924316.33\n1     store channel   46.0  21563729.67    588327.65  -9861077.70\n2       web channel   85.0   4005853.45    107371.50   -566569.94\n3       web channel   86.0   4285203.45    175573.92   -520314.49\n4       web channel   62.0   4208113.81    144878.21   -464020.49\n5       web channel   35.0   4007565.26     41753.54   -491301.28\n6       web channel  121.0   3893371.45    144582.71   -603860.34\n7     store channel   14.0  21839003.56    542207.71  -9917024.17\n8       web channel   11.0   4152705.20     55184.03   -412798.84\n9       web channel   53.0   3811582.20     64373.78   -400647.71\n10      web channel   37.0   4017355.59    162156.77   -569897.26\n11      web channel  163.0   4398861.52    131558.21   -431871.49\n12    store channel   50.0  21568822.85    549760.33  -9510462.95\n13    store channel   92.0  22525406.55    575710.85  -9990515.65\n14      web channel  149.0   4026483.24     66381.79   -435368.43\n15      web channel  181.0   4242720.81    105989.60   -357068.88\n16      web channel   50.0   4117671.44    163336.27   -535603.67\n17      web channel   77.0   4062487.47     51686.82   -456666.61\n18      web channel  170.0   4027238.65    165677.68   -378388.62\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.272921,
                    "execution_time": 0.080752,
                    "compile_time": 0.001003,
                    "planning_time": 0.142353
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.386604,
                    "execution_time": 0.078197,
                    "compile_time": 0.001003,
                    "planning_time": 0.258121
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel     id        sales      returns       profit\n0   catalog channel    NaN  15673043.24  20885718.55 -15924316.33\n1     store channel   46.0  21563729.67    588327.65  -9861077.70\n2       web channel   85.0   4005853.45    107371.50   -566569.94\n3       web channel   86.0   4285203.45    175573.92   -520314.49\n4       web channel   62.0   4208113.81    144878.21   -464020.49\n5       web channel   35.0   4007565.26     41753.54   -491301.28\n6       web channel  121.0   3893371.45    144582.71   -603860.34\n7     store channel   14.0  21839003.56    542207.71  -9917024.17\n8       web channel   11.0   4152705.20     55184.03   -412798.84\n9       web channel   53.0   3811582.20     64373.78   -400647.71\n10      web channel   37.0   4017355.59    162156.77   -569897.26\n11      web channel  163.0   4398861.52    131558.21   -431871.49\n12    store channel   50.0  21568822.85    549760.33  -9510462.95\n13    store channel   92.0  22525406.55    575710.85  -9990515.65\n14      web channel  149.0   4026483.24     66381.79   -435368.43\n15      web channel  181.0   4242720.81    105989.60   -357068.88\n16      web channel   50.0   4117671.44    163336.27   -535603.67\n17      web channel   77.0   4062487.47     51686.82   -456666.61\n18      web channel  170.0   4027238.65    165677.68   -378388.62\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , coalesce(profit_loss, 0) as profit_loss\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n )\n group by channel, id\n )\nselect *\nfrom results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT_LOSS\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , COALESCE ( PROFIT_LOSS , 0 ) AS PROFIT_LOSS FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*          channel   id        sales    returns       profit\n0     web channel  122   4383658.62   82468.99     51591.06\n1     web channel  116   3876817.05   99365.24     60928.60\n2     web channel    7   4029061.90  122172.67     73435.57\n3   store channel   22  22345523.31  575207.24  -9824885.95\n4     web channel  197   3906552.16   53180.59     32134.08\n5   store channel   98  22919538.24  567944.46  -9907657.82\n6     web channel  161   3983873.79   42837.09     24186.82\n7   store channel   67  22940023.82  547302.04 -10182241.36\n8   store channel   73  22047605.52  489987.06  -9806742.16\n9   store channel   56  22055755.15  604701.53  -9769783.38\n10  store channel   19  22360157.35  575326.44 -10384413.13\n11  store channel   10  20404775.13  620684.15  -9145793.78\n12  store channel    4  21667166.49  670000.08  -9800043.53\n13    web channel   38   4201156.92  158030.62     86712.81\n14    web channel   97   4005201.26  138293.51     80863.02\n15  store channel   55  21854429.86  578222.03  -9898575.00\n16  store channel   20  23854435.59  506812.95 -10637298.32\n17    web channel  134   3947615.33  153369.76     77302.43\n18    web channel  119   4563337.38   62291.86     29179.77\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.28588,
                    "execution_time": 0.082226,
                    "compile_time": 0.001162,
                    "planning_time": 0.14884
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.391667,
                    "execution_time": 0.079062,
                    "compile_time": 0.001071,
                    "planning_time": 0.257437
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel   id        sales    returns       profit\n0     web channel  122   4383658.62   82468.99     51591.06\n1     web channel  116   3876817.05   99365.24     60928.60\n2     web channel    7   4029061.90  122172.67     73435.57\n3   store channel   22  22345523.31  575207.24  -9824885.95\n4     web channel  197   3906552.16   53180.59     32134.08\n5   store channel   98  22919538.24  567944.46  -9907657.82\n6     web channel  161   3983873.79   42837.09     24186.82\n7   store channel   67  22940023.82  547302.04 -10182241.36\n8   store channel   73  22047605.52  489987.06  -9806742.16\n9   store channel   56  22055755.15  604701.53  -9769783.38\n10  store channel   19  22360157.35  575326.44 -10384413.13\n11  store channel   10  20404775.13  620684.15  -9145793.78\n12  store channel    4  21667166.49  670000.08  -9800043.53\n13    web channel   38   4201156.92  158030.62     86712.81\n14    web channel   97   4005201.26  138293.51     80863.02\n15  store channel   55  21854429.86  578222.03  -9898575.00\n16  store channel   20  23854435.59  506812.95 -10637298.32\n17    web channel  134   3947615.33  153369.76     77302.43\n18    web channel  119   4563337.38   62291.86     29179.77\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss, 0)) as profit\n from   cs left join cr\n        on  cs.cs_call_center_sk = cr.cr_call_center_sk\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) as c\n group by channel, id\n )\n select * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" AS \"CR_CALL_CENTER_SK\" , SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"C\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , COALESCE ( \"CR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"CS\".\"PROFIT\" - COALESCE ( \"CR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"CS\" AS \"CS\" LEFT JOIN \"CR\" AS \"CR\" ON \"CR\".\"CR_CALL_CENTER_SK\" = \"CS\".\"CS_CALL_CENTER_SK\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"C\".\"CHANNEL\" AS \"CHANNEL\" , \"C\".\"ID\" AS \"ID\" , SUM ( \"C\".\"SALES\" ) AS \"SALES\" , SUM ( \"C\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"C\".\"PROFIT\" ) AS \"PROFIT\" FROM \"C\" AS \"C\" GROUP BY \"C\".\"CHANNEL\" , \"C\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM CS LEFT JOIN CR ON CS.CS_CALL_CENTER_SK = CR.CR_CALL_CENTER_SK UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS C GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel     id        sales    returns      profit\n0     store channel   50.0  21568822.85  549760.33 -9510462.95\n1     store channel   92.0  22525406.55  575710.85 -9990515.65\n2       web channel  149.0   4026483.24   66381.79  -435368.43\n3       web channel  181.0   4242720.81  105989.60  -357068.88\n4       web channel   50.0   4117671.44  163336.27  -535603.67\n5       web channel   77.0   4062487.47   51686.82  -456666.61\n6   catalog channel    NaN    921943.72       0.00  -226391.27\n7     store channel   46.0  21563729.67  588327.65 -9861077.70\n8       web channel   85.0   4005853.45  107371.50  -566569.94\n9       web channel   86.0   4285203.45  175573.92  -520314.49\n10      web channel   62.0   4208113.81  144878.21  -464020.49\n11      web channel   35.0   4007565.26   41753.54  -491301.28\n12      web channel  121.0   3893371.45  144582.71  -603860.34\n13      web channel  170.0   4027238.65  165677.68  -378388.62\n14      web channel  103.0   4186006.07  153110.44  -502295.31\n15      web channel  109.0   4016328.68  141266.20  -530242.43\n16    store channel   14.0  21839003.56  542207.71 -9917024.17\n17      web channel   11.0   4152705.20   55184.03  -412798.84\n18      web channel   53.0   3811582.20   64373.78  -400647.71\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.285584,
                    "execution_time": 0.079357,
                    "compile_time": 0.000999,
                    "planning_time": 0.155358
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.579305,
                    "execution_time": 0.077528,
                    "compile_time": 0.184886,
                    "planning_time": 0.264364
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel     id        sales    returns      profit\n0     store channel   50.0  21568822.85  549760.33 -9510462.95\n1     store channel   92.0  22525406.55  575710.85 -9990515.65\n2       web channel  149.0   4026483.24   66381.79  -435368.43\n3       web channel  181.0   4242720.81  105989.60  -357068.88\n4       web channel   50.0   4117671.44  163336.27  -535603.67\n5       web channel   77.0   4062487.47   51686.82  -456666.61\n6   catalog channel    NaN    921943.72       0.00  -226391.27\n7     store channel   46.0  21563729.67  588327.65 -9861077.70\n8       web channel   85.0   4005853.45  107371.50  -566569.94\n9       web channel   86.0   4285203.45  175573.92  -520314.49\n10      web channel   62.0   4208113.81  144878.21  -464020.49\n11      web channel   35.0   4007565.26   41753.54  -491301.28\n12      web channel  121.0   3893371.45  144582.71  -603860.34\n13      web channel  170.0   4027238.65  165677.68  -378388.62\n14      web channel  103.0   4186006.07  153110.44  -502295.31\n15      web channel  109.0   4016328.68  141266.20  -530242.43\n16    store channel   14.0  21839003.56  542207.71 -9917024.17\n17      web channel   11.0   4152705.20   55184.03  -412798.84\n18      web channel   53.0   3811582.20   64373.78  -400647.71\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id \n)\nselect * from results\n\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*          channel   id        sales    returns      profit\n0   store channel   46  21563729.67  588327.65 -9861077.70\n1     web channel   85   4005853.45  107371.50  -566569.94\n2     web channel   86   4285203.45  175573.92  -520314.49\n3     web channel   62   4208113.81  144878.21  -464020.49\n4     web channel   35   4007565.26   41753.54  -491301.28\n5     web channel  121   3893371.45  144582.71  -603860.34\n6     web channel  170   4027238.65  165677.68  -378388.62\n7     web channel  103   4186006.07  153110.44  -502295.31\n8     web channel  109   4016328.68  141266.20  -530242.43\n9     web channel  113   3925083.84   51761.87  -485783.88\n10  store channel   50  21568822.85  549760.33 -9510462.95\n11  store channel   92  22525406.55  575710.85 -9990515.65\n12    web channel  149   4026483.24   66381.79  -435368.43\n13    web channel  181   4242720.81  105989.60  -357068.88\n14    web channel   50   4117671.44  163336.27  -535603.67\n15    web channel   77   4062487.47   51686.82  -456666.61\n16    web channel  163   4398861.52  131558.21  -431871.49\n17    web channel   37   4017355.59  162156.77  -569897.26\n18  store channel   14  21839003.56  542207.71 -9917024.17\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.275379,
                    "execution_time": 0.081841,
                    "compile_time": 0.001005,
                    "planning_time": 0.143127
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.383233,
                    "execution_time": 0.07981,
                    "compile_time": 0.001011,
                    "planning_time": 0.253138
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*          channel   id        sales    returns      profit\n0   store channel   46  21563729.67  588327.65 -9861077.70\n1     web channel   85   4005853.45  107371.50  -566569.94\n2     web channel   86   4285203.45  175573.92  -520314.49\n3     web channel   62   4208113.81  144878.21  -464020.49\n4     web channel   35   4007565.26   41753.54  -491301.28\n5     web channel  121   3893371.45  144582.71  -603860.34\n6     web channel  170   4027238.65  165677.68  -378388.62\n7     web channel  103   4186006.07  153110.44  -502295.31\n8     web channel  109   4016328.68  141266.20  -530242.43\n9     web channel  113   3925083.84   51761.87  -485783.88\n10  store channel   50  21568822.85  549760.33 -9510462.95\n11  store channel   92  22525406.55  575710.85 -9990515.65\n12    web channel  149   4026483.24   66381.79  -435368.43\n13    web channel  181   4242720.81  105989.60  -357068.88\n14    web channel   50   4117671.44  163336.27  -535603.67\n15    web channel   77   4062487.47   51686.82  -456666.61\n16    web channel  163   4398861.52  131558.21  -431871.49\n17    web channel   37   4017355.59  162156.77  -569897.26\n18  store channel   14  21839003.56  542207.71 -9917024.17\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel   id         sales      returns        profit\n0     store channel   28  2.240889e+07    503422.09 -1.003187e+07\n1       web channel  127  3.856111e+06    172403.80 -5.731697e+05\n2       web channel    5  4.239258e+06     67753.81 -5.038670e+05\n3     store channel   40  2.338977e+07    498057.48 -1.010812e+07\n4   catalog channel    7  1.167244e+09  20885718.55 -1.212200e+08\n5       web channel  182  4.173039e+06    143541.77 -4.893625e+05\n6     store channel   58  2.099174e+07    526125.60 -9.483864e+06\n7     store channel   70  2.223115e+07    539132.29 -9.935612e+06\n8       web channel   32  4.065287e+06    121906.28 -3.512187e+05\n9       web channel  199  3.984816e+06    135283.21 -3.892596e+05\n10    store channel   94  2.179962e+07    568567.86 -1.001737e+07\n11    store channel   44  2.254939e+07    521831.53 -1.006896e+07\n12      web channel  169  4.113909e+06     97774.61 -3.610248e+05\n13    store channel   91  2.316525e+07    594878.33 -1.065329e+07\n14      web channel   14  4.060667e+06    139779.80 -2.912845e+05\n15      web channel  145  4.178175e+06    143788.25 -4.147824e+05\n16      web channel  104  4.030621e+06    121041.30 -6.385130e+05\n17    store channel   97  2.193213e+07    577031.25 -9.908800e+06\n18    store channel   68  2.146348e+07    562983.96 -9.362349e+06\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.273389,
                    "execution_time": 0.075678,
                    "compile_time": 0.000993,
                    "planning_time": 0.147568
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.272757,
                    "execution_time": 0.078738,
                    "compile_time": 0.001021,
                    "planning_time": 0.14383
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel   id         sales      returns        profit\n0     store channel   28  2.240889e+07    503422.09 -1.003187e+07\n1       web channel  127  3.856111e+06    172403.80 -5.731697e+05\n2       web channel    5  4.239258e+06     67753.81 -5.038670e+05\n3     store channel   40  2.338977e+07    498057.48 -1.010812e+07\n4   catalog channel    7  1.167244e+09  20885718.55 -1.212200e+08\n5       web channel  182  4.173039e+06    143541.77 -4.893625e+05\n6     store channel   58  2.099174e+07    526125.60 -9.483864e+06\n7     store channel   70  2.223115e+07    539132.29 -9.935612e+06\n8       web channel   32  4.065287e+06    121906.28 -3.512187e+05\n9       web channel  199  3.984816e+06    135283.21 -3.892596e+05\n10    store channel   94  2.179962e+07    568567.86 -1.001737e+07\n11    store channel   44  2.254939e+07    521831.53 -1.006896e+07\n12      web channel  169  4.113909e+06     97774.61 -3.610248e+05\n13    store channel   91  2.316525e+07    594878.33 -1.065329e+07\n14      web channel   14  4.060667e+06    139779.80 -2.912845e+05\n15      web channel  145  4.178175e+06    143788.25 -4.147824e+05\n16      web channel  104  4.030621e+06    121041.30 -6.385130e+05\n17    store channel   97  2.193213e+07    577031.25 -9.908800e+06\n18    store channel   68  2.146348e+07    562983.96 -9.362349e+06\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales\n join date_dim on ss_sold_date_sk = d_date_sk\n join store on ss_store_sk = s_store_sk\n where d_date between cast('2000-08-02' as date) \n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by s_store_sk)\n ,\n sr as\n (select sr_store_sk as s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns\n join date_dim on sr_returned_date_sk = d_date_sk\n where d_date between cast('2000-08-02' as date)\n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by sr_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales\n join date_dim on cs_sold_date_sk = d_date_sk\n where d_date between cast('2000-08-02' as date)\n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns\n join date_dim on cr_returned_date_sk = d_date_sk\n where d_date between cast('2000-08-02' as date)\n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales\n join date_dim on ws_sold_date_sk = d_date_sk\n join web_page on ws_web_page_sk = wp_web_page_sk\n where d_date between cast('2000-08-02' as date)\n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns\n join date_dim on wr_returned_date_sk = d_date_sk\n join web_page on wr_web_page_sk = wp_web_page_sk\n where d_date between cast('2000-08-02' as date)\n       and dateadd(day,30,cast('2000-08-02' as date))  \n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       left join cr on cs.cs_call_center_sk = cr.cr_call_center_sk\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" GROUP BY \"STORE_RETURNS\".\"SR_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" AS \"CR_CALL_CENTER_SK\" , SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" LEFT JOIN \"CR\" AS \"CR\" ON \"CR\".\"CR_CALL_CENTER_SK\" = \"CS\".\"CS_CALL_CENTER_SK\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES JOIN DATE_DIM ON SS_SOLD_DATE_SK = D_DATE_SK JOIN STORE ON SS_STORE_SK = S_STORE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY S_STORE_SK ) , SR AS ( SELECT SR_STORE_SK AS S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS JOIN DATE_DIM ON SR_RETURNED_DATE_SK = D_DATE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY SR_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES JOIN DATE_DIM ON CS_SOLD_DATE_SK = D_DATE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS JOIN DATE_DIM ON CR_RETURNED_DATE_SK = D_DATE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES JOIN DATE_DIM ON WS_SOLD_DATE_SK = D_DATE_SK JOIN WEB_PAGE ON WS_WEB_PAGE_SK = WP_WEB_PAGE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS JOIN DATE_DIM ON WR_RETURNED_DATE_SK = D_DATE_SK JOIN WEB_PAGE ON WR_WEB_PAGE_SK = WP_WEB_PAGE_SK WHERE D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS LEFT JOIN CR ON CS.CS_CALL_CENTER_SK = CR.CR_CALL_CENTER_SK UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel     id        sales    returns      profit\n0   catalog channel    NaN    921943.72        NaN         NaN\n1     store channel   14.0  21839003.56  542207.71 -9917024.17\n2       web channel   53.0   3811582.20   64373.78  -400647.71\n3       web channel   11.0   4152705.20   55184.03  -412798.84\n4       web channel  163.0   4398861.52  131558.21  -431871.49\n5       web channel   37.0   4017355.59  162156.77  -569897.26\n6     store channel   46.0  21563729.67  588327.65 -9861077.70\n7       web channel   62.0   4208113.81  144878.21  -464020.49\n8       web channel   86.0   4285203.45  175573.92  -520314.49\n9       web channel   35.0   4007565.26   41753.54  -491301.28\n10      web channel  121.0   3893371.45  144582.71  -603860.34\n11      web channel   85.0   4005853.45  107371.50  -566569.94\n12    store channel   50.0  21568822.85  549760.33 -9510462.95\n13    store channel   92.0  22525406.55  575710.85 -9990515.65\n14      web channel  149.0   4026483.24   66381.79  -435368.43\n15      web channel   50.0   4117671.44  163336.27  -535603.67\n16      web channel  181.0   4242720.81  105989.60  -357068.88\n17      web channel   77.0   4062487.47   51686.82  -456666.61\n18      web channel  113.0   3925083.84   51761.87  -485783.88\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.284953,
                    "execution_time": 0.07284,
                    "compile_time": 0.000969,
                    "planning_time": 0.162727
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.512723,
                    "execution_time": 0.07546,
                    "compile_time": 0.108219,
                    "planning_time": 0.276656
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel     id        sales    returns      profit\n0   catalog channel    NaN    921943.72        NaN         NaN\n1     store channel   14.0  21839003.56  542207.71 -9917024.17\n2       web channel   53.0   3811582.20   64373.78  -400647.71\n3       web channel   11.0   4152705.20   55184.03  -412798.84\n4       web channel  163.0   4398861.52  131558.21  -431871.49\n5       web channel   37.0   4017355.59  162156.77  -569897.26\n6     store channel   46.0  21563729.67  588327.65 -9861077.70\n7       web channel   62.0   4208113.81  144878.21  -464020.49\n8       web channel   86.0   4285203.45  175573.92  -520314.49\n9       web channel   35.0   4007565.26   41753.54  -491301.28\n10      web channel  121.0   3893371.45  144582.71  -603860.34\n11      web channel   85.0   4005853.45  107371.50  -566569.94\n12    store channel   50.0  21568822.85  549760.33 -9510462.95\n13    store channel   92.0  22525406.55  575710.85 -9990515.65\n14      web channel  149.0   4026483.24   66381.79  -435368.43\n15      web channel   50.0   4117671.44  163336.27  -535603.67\n16      web channel  181.0   4242720.81  105989.60  -357068.88\n17      web channel   77.0   4062487.47   51686.82  -456666.61\n18      web channel  113.0   3925083.84   51761.87  -485783.88\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results) \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS ) LIMIT 21",
                "preview": "\n/*            channel   id         sales      returns        profit\n0       web channel   44  3.944993e+06    172712.68 -5.823050e+05\n1     store channel   76  2.224158e+07    578345.50 -9.886026e+06\n2     store channel    7  2.221531e+07    519766.98 -9.709299e+06\n3     store channel   52  2.145005e+07    523474.27 -9.410307e+06\n4       web channel  176  3.952283e+06    150330.53 -6.069017e+05\n5       web channel  158  4.086166e+06    117133.78 -6.158523e+05\n6   catalog channel   20  1.118725e+09  20885718.55 -1.363673e+08\n7       web channel   55  4.065637e+06    135595.31 -6.326632e+05\n8       web channel  175  3.846447e+06    139315.71 -4.858940e+05\n9       web channel   71  3.772753e+06     46567.70 -4.262122e+05\n10      web channel   20  4.093802e+06    131428.47 -5.439832e+05\n11    store channel   26  2.290749e+07    591092.58 -1.020340e+07\n12  catalog channel   17  1.156043e+09  20885718.55 -1.244870e+08\n13      web channel   68  3.705242e+06    142645.50 -7.741526e+05\n14      web channel   67  4.192255e+06    169552.16 -4.725532e+05\n15      web channel   56  3.975137e+06    153422.05 -5.290188e+05\n16      web channel  146  4.260032e+06    111556.53 -5.123588e+05\n17      web channel  157  4.113438e+06    160766.32 -5.365012e+05\n18      web channel   49  4.088012e+06    118653.36 -4.936202e+05\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.28286,
                    "execution_time": 0.076358,
                    "compile_time": 0.001014,
                    "planning_time": 0.156085
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.396815,
                    "execution_time": 0.082732,
                    "compile_time": 0.001062,
                    "planning_time": 0.262912
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel   id         sales      returns        profit\n0       web channel   44  3.944993e+06    172712.68 -5.823050e+05\n1     store channel   76  2.224158e+07    578345.50 -9.886026e+06\n2     store channel    7  2.221531e+07    519766.98 -9.709299e+06\n3     store channel   52  2.145005e+07    523474.27 -9.410307e+06\n4       web channel  176  3.952283e+06    150330.53 -6.069017e+05\n5       web channel  158  4.086166e+06    117133.78 -6.158523e+05\n6   catalog channel   20  1.118725e+09  20885718.55 -1.363673e+08\n7       web channel   55  4.065637e+06    135595.31 -6.326632e+05\n8       web channel  175  3.846447e+06    139315.71 -4.858940e+05\n9       web channel   71  3.772753e+06     46567.70 -4.262122e+05\n10      web channel   20  4.093802e+06    131428.47 -5.439832e+05\n11    store channel   26  2.290749e+07    591092.58 -1.020340e+07\n12  catalog channel   17  1.156043e+09  20885718.55 -1.244870e+08\n13      web channel   68  3.705242e+06    142645.50 -7.741526e+05\n14      web channel   67  4.192255e+06    169552.16 -4.725532e+05\n15      web channel   56  3.975137e+06    153422.05 -5.290188e+05\n16      web channel  146  4.260032e+06    111556.53 -5.123588e+05\n17      web channel  157  4.113438e+06    160766.32 -5.365012e+05\n18      web channel   49  4.088012e+06    118653.36 -4.936202e+05\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from results\n )\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS ) LIMIT 21",
                "preview": "\n/*            channel     id        sales      returns       profit\n0   catalog channel    NaN  15673043.24  20885718.55 -15924316.33\n1     store channel   14.0  21839003.56    542207.71  -9917024.17\n2       web channel   53.0   3811582.20     64373.78   -400647.71\n3       web channel   11.0   4152705.20     55184.03   -412798.84\n4     store channel   46.0  21563729.67    588327.65  -9861077.70\n5       web channel   85.0   4005853.45    107371.50   -566569.94\n6       web channel   86.0   4285203.45    175573.92   -520314.49\n7       web channel   62.0   4208113.81    144878.21   -464020.49\n8       web channel   35.0   4007565.26     41753.54   -491301.28\n9       web channel  121.0   3893371.45    144582.71   -603860.34\n10      web channel  113.0   3925083.84     51761.87   -485783.88\n11    store channel   50.0  21568822.85    549760.33  -9510462.95\n12    store channel   92.0  22525406.55    575710.85  -9990515.65\n13      web channel  149.0   4026483.24     66381.79   -435368.43\n14      web channel  181.0   4242720.81    105989.60   -357068.88\n15      web channel   50.0   4117671.44    163336.27   -535603.67\n16      web channel   77.0   4062487.47     51686.82   -456666.61\n17      web channel  170.0   4027238.65    165677.68   -378388.62\n18      web channel  103.0   4186006.07    153110.44   -502295.31\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.29558,
                    "execution_time": 0.077456,
                    "compile_time": 0.001019,
                    "planning_time": 0.167625
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.282729,
                    "execution_time": 0.078801,
                    "compile_time": 0.001013,
                    "planning_time": 0.153425
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel     id        sales      returns       profit\n0   catalog channel    NaN  15673043.24  20885718.55 -15924316.33\n1     store channel   14.0  21839003.56    542207.71  -9917024.17\n2       web channel   53.0   3811582.20     64373.78   -400647.71\n3       web channel   11.0   4152705.20     55184.03   -412798.84\n4     store channel   46.0  21563729.67    588327.65  -9861077.70\n5       web channel   85.0   4005853.45    107371.50   -566569.94\n6       web channel   86.0   4285203.45    175573.92   -520314.49\n7       web channel   62.0   4208113.81    144878.21   -464020.49\n8       web channel   35.0   4007565.26     41753.54   -491301.28\n9       web channel  121.0   3893371.45    144582.71   -603860.34\n10      web channel  113.0   3925083.84     51761.87   -485783.88\n11    store channel   50.0  21568822.85    549760.33  -9510462.95\n12    store channel   92.0  22525406.55    575710.85  -9990515.65\n13      web channel  149.0   4026483.24     66381.79   -435368.43\n14      web channel  181.0   4242720.81    105989.60   -357068.88\n15      web channel   50.0   4117671.44    163336.27   -535603.67\n16      web channel   77.0   4062487.47     51686.82   -456666.61\n17      web channel  170.0   4027238.65    165677.68   -378388.62\n18      web channel  103.0   4186006.07    153110.44   -502295.31\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  * \n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel )\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"_Q_0\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"RETURNS\" AS \"RETURNS\" , \"_Q_0\".\"PROFIT\" AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL ) LIMIT 21",
                "preview": "\n/*            channel   id         sales      returns        profit\n0       web channel   56  3.975137e+06    153422.05 -5.290188e+05\n1     store channel   76  2.224158e+07    578345.50 -9.886026e+06\n2       web channel   53  3.811582e+06     64373.78 -4.006477e+05\n3     store channel   58  2.099174e+07    526125.60 -9.483864e+06\n4       web channel  193  4.167641e+06    139671.23 -4.396898e+05\n5       web channel   73  3.808650e+06    165797.40 -5.837398e+05\n6       web channel   91  4.470419e+06    166286.67 -4.902178e+05\n7       web channel   65  4.298102e+06     68087.06 -3.997112e+05\n8   catalog channel   14  1.186244e+09  20885718.55 -1.285460e+08\n9       web channel   29  3.898459e+06     64990.37 -5.717716e+05\n10    store channel   79  2.173449e+07    557980.29 -9.762694e+06\n11    store channel   85  2.386019e+07    610255.09 -1.048823e+07\n12      web channel  155  4.234386e+06     51750.06 -2.426888e+05\n13      web channel   61  4.122971e+06    141373.82 -5.642185e+05\n14      web channel  191  4.025145e+06     34056.07 -4.156245e+05\n15      web channel   44  3.944993e+06    172712.68 -5.823050e+05\n16      web channel  158  4.086166e+06    117133.78 -6.158523e+05\n17    store channel   26  2.290749e+07    591092.58 -1.020340e+07\n18    store channel   97  2.193213e+07    577031.25 -9.908800e+06\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.940404,
                    "execution_time": 0.389182,
                    "compile_time": 0.003155,
                    "planning_time": 0.793331
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.068586,
                    "execution_time": 0.397436,
                    "compile_time": 0.003186,
                    "planning_time": 0.920897
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel   id         sales      returns        profit\n0       web channel   56  3.975137e+06    153422.05 -5.290188e+05\n1     store channel   76  2.224158e+07    578345.50 -9.886026e+06\n2       web channel   53  3.811582e+06     64373.78 -4.006477e+05\n3     store channel   58  2.099174e+07    526125.60 -9.483864e+06\n4       web channel  193  4.167641e+06    139671.23 -4.396898e+05\n5       web channel   73  3.808650e+06    165797.40 -5.837398e+05\n6       web channel   91  4.470419e+06    166286.67 -4.902178e+05\n7       web channel   65  4.298102e+06     68087.06 -3.997112e+05\n8   catalog channel   14  1.186244e+09  20885718.55 -1.285460e+08\n9       web channel   29  3.898459e+06     64990.37 -5.717716e+05\n10    store channel   79  2.173449e+07    557980.29 -9.762694e+06\n11    store channel   85  2.386019e+07    610255.09 -1.048823e+07\n12      web channel  155  4.234386e+06     51750.06 -2.426888e+05\n13      web channel   61  4.122971e+06    141373.82 -5.642185e+05\n14      web channel  191  4.025145e+06     34056.07 -4.156245e+05\n15      web channel   44  3.944993e+06    172712.68 -5.823050e+05\n16      web channel  158  4.086166e+06    117133.78 -6.158523e+05\n17    store channel   26  2.290749e+07    591092.58 -1.020340e+07\n18    store channel   97  2.193213e+07    577031.25 -9.908800e+06\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select 'total' as channel, NULL as id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from results\n) /*CURSOR_IDENTIFIER*/\n",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"_Q_0\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT 'total' AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"RETURNS\" AS \"RETURNS\" , \"_Q_0\".\"PROFIT\" AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT 'total' AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) LIMIT 21",
                "preview": "\n/*            channel     id         sales       returns        profit\n0             total    NaN  1.535516e+10  3.113914e+08 -2.113502e+09\n1     store channel   67.0  2.294002e+07  5.473020e+05 -1.018224e+07\n2       web channel   38.0  4.201157e+06  1.580306e+05 -3.949423e+05\n3       web channel   79.0  4.131125e+06  1.696976e+05 -3.411267e+05\n4       web channel  187.0  3.978650e+06  1.549282e+05 -7.519775e+05\n5       web channel   89.0  3.924915e+06  7.193171e+04 -5.106060e+05\n6       web channel   67.0  4.192255e+06  1.695522e+05 -4.725532e+05\n7       web channel   35.0  4.007565e+06  4.175354e+04 -4.913013e+05\n8       web channel   85.0  4.005853e+06  1.073715e+05 -5.665699e+05\n9       web channel   50.0  4.117671e+06  1.633363e+05 -5.356037e+05\n10      web channel  127.0  3.856111e+06  1.724038e+05 -5.731697e+05\n11      web channel  169.0  4.113909e+06  9.777461e+04 -3.610248e+05\n12  catalog channel    7.0  1.167244e+09  2.088572e+07 -1.212200e+08\n13      web channel  182.0  4.173039e+06  1.435418e+05 -4.893625e+05\n14      web channel   32.0  4.065287e+06  1.219063e+05 -3.512187e+05\n15    store channel   44.0  2.254939e+07  5.218315e+05 -1.006896e+07\n16    store channel   38.0  2.268289e+07  4.785067e+05 -1.000545e+07\n17    store channel   37.0  2.261177e+07  5.803128e+05 -1.009888e+07\n18      web channel   14.0  4.060667e+06  1.397798e+05 -2.912845e+05\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.202808,
                    "execution_time": 0.47105,
                    "compile_time": 0.003664,
                    "planning_time": 1.015481
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.307739,
                    "execution_time": 0.465146,
                    "compile_time": 0.003711,
                    "planning_time": 1.117923
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel     id         sales       returns        profit\n0             total    NaN  1.535516e+10  3.113914e+08 -2.113502e+09\n1     store channel   67.0  2.294002e+07  5.473020e+05 -1.018224e+07\n2       web channel   38.0  4.201157e+06  1.580306e+05 -3.949423e+05\n3       web channel   79.0  4.131125e+06  1.696976e+05 -3.411267e+05\n4       web channel  187.0  3.978650e+06  1.549282e+05 -7.519775e+05\n5       web channel   89.0  3.924915e+06  7.193171e+04 -5.106060e+05\n6       web channel   67.0  4.192255e+06  1.695522e+05 -4.725532e+05\n7       web channel   35.0  4.007565e+06  4.175354e+04 -4.913013e+05\n8       web channel   85.0  4.005853e+06  1.073715e+05 -5.665699e+05\n9       web channel   50.0  4.117671e+06  1.633363e+05 -5.356037e+05\n10      web channel  127.0  3.856111e+06  1.724038e+05 -5.731697e+05\n11      web channel  169.0  4.113909e+06  9.777461e+04 -3.610248e+05\n12  catalog channel    7.0  1.167244e+09  2.088572e+07 -1.212200e+08\n13      web channel  182.0  4.173039e+06  1.435418e+05 -4.893625e+05\n14      web channel   32.0  4.065287e+06  1.219063e+05 -3.512187e+05\n15    store channel   44.0  2.254939e+07  5.218315e+05 -1.006896e+07\n16    store channel   38.0  2.268289e+07  4.785067e+05 -1.000545e+07\n17    store channel   37.0  2.261177e+07  5.803128e+05 -1.009888e+07\n18      web channel   14.0  4.060667e+06  1.397798e+05 -2.912845e+05\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select NULL AS channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results )\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"_Q_0\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"RETURNS\" AS \"RETURNS\" , \"_Q_0\".\"PROFIT\" AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) LIMIT 21",
                "preview": "\n/*            channel     id         sales       returns        profit\n0       web channel   44.0  3.944993e+06  1.727127e+05 -5.823050e+05\n1     store channel   26.0  2.290749e+07  5.910926e+05 -1.020340e+07\n2       web channel  158.0  4.086166e+06  1.171338e+05 -6.158523e+05\n3     store channel   25.0  2.282072e+07  5.479248e+05 -9.908275e+06\n4       web channel  197.0  3.906552e+06  5.318059e+04 -4.338169e+05\n5     store channel   98.0  2.291954e+07  5.679445e+05 -9.907658e+06\n6       web channel    7.0  4.029062e+06  1.221727e+05 -5.725886e+05\n7     store channel   20.0  2.385444e+07  5.068130e+05 -1.063730e+07\n8       web channel  167.0  4.139319e+06  6.173051e+04 -4.112436e+05\n9     store channel   43.0  2.236224e+07  5.919358e+05 -9.931899e+06\n10      web channel  109.0  4.016329e+06  1.412662e+05 -5.302424e+05\n11      web channel   26.0  4.158085e+06  1.647447e+05 -4.912994e+05\n12      web channel   25.0  4.019100e+06  1.120509e+05 -4.147638e+05\n13      web channel  179.0  4.228190e+06  4.742489e+04 -3.550638e+05\n14    store channel   40.0  2.338977e+07  4.980575e+05 -1.010812e+07\n15    store channel   97.0  2.193213e+07  5.770312e+05 -9.908800e+06\n16    store channel   68.0  2.146348e+07  5.629840e+05 -9.362349e+06\n17             None    NaN  1.535516e+10  3.113914e+08 -2.113502e+09\n18  catalog channel   17.0  1.156043e+09  2.088572e+07 -1.244870e+08\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.196913,
                    "execution_time": 0.460169,
                    "compile_time": 0.003677,
                    "planning_time": 1.012101
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.298367,
                    "execution_time": 0.462414,
                    "compile_time": 0.003727,
                    "planning_time": 1.114903
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel     id         sales       returns        profit\n0       web channel   44.0  3.944993e+06  1.727127e+05 -5.823050e+05\n1     store channel   26.0  2.290749e+07  5.910926e+05 -1.020340e+07\n2       web channel  158.0  4.086166e+06  1.171338e+05 -6.158523e+05\n3     store channel   25.0  2.282072e+07  5.479248e+05 -9.908275e+06\n4       web channel  197.0  3.906552e+06  5.318059e+04 -4.338169e+05\n5     store channel   98.0  2.291954e+07  5.679445e+05 -9.907658e+06\n6       web channel    7.0  4.029062e+06  1.221727e+05 -5.725886e+05\n7     store channel   20.0  2.385444e+07  5.068130e+05 -1.063730e+07\n8       web channel  167.0  4.139319e+06  6.173051e+04 -4.112436e+05\n9     store channel   43.0  2.236224e+07  5.919358e+05 -9.931899e+06\n10      web channel  109.0  4.016329e+06  1.412662e+05 -5.302424e+05\n11      web channel   26.0  4.158085e+06  1.647447e+05 -4.912994e+05\n12      web channel   25.0  4.019100e+06  1.120509e+05 -4.147638e+05\n13      web channel  179.0  4.228190e+06  4.742489e+04 -3.550638e+05\n14    store channel   40.0  2.338977e+07  4.980575e+05 -1.010812e+07\n15    store channel   97.0  2.193213e+07  5.770312e+05 -9.908800e+06\n16    store channel   68.0  2.146348e+07  5.629840e+05 -9.362349e+06\n17             None    NaN  1.535516e+10  3.113914e+08 -2.113502e+09\n18  catalog channel   17.0  1.156043e+09  2.088572e+07 -1.244870e+08\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select NULL AS channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results\n) foo\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) AS FOO LIMIT 21",
                "preview": "\n/*            channel   id         sales      returns        profit\n0       web channel  121  3.893371e+06    144582.71 -6.038603e+05\n1       web channel  149  4.026483e+06     66381.79 -4.353684e+05\n2       web channel  163  4.398862e+06    131558.21 -4.318715e+05\n3     store channel   70  2.223115e+07    539132.29 -9.935612e+06\n4     store channel   94  2.179962e+07    568567.86 -1.001737e+07\n5       web channel  104  4.030621e+06    121041.30 -6.385130e+05\n6       web channel  119  4.563337e+06     62291.86 -3.667642e+05\n7       web channel  161  3.983874e+06     42837.09 -4.386369e+05\n8     store channel   73  2.204761e+07    489987.06 -9.806742e+06\n9     store channel   74  2.074058e+07    516261.56 -9.722514e+06\n10      web channel   83  3.947631e+06     45221.41 -5.183942e+05\n11      web channel  128  3.843245e+06     99253.57 -5.169403e+05\n12    store channel    8  2.242996e+07    536132.12 -9.831135e+06\n13      web channel  107  3.895962e+06     49910.57 -4.342406e+05\n14  catalog channel   23  1.164310e+09  20885718.55 -1.276345e+08\n15      web channel  194  4.227258e+06    139523.05 -4.901189e+05\n16  catalog channel   20  1.118725e+09  20885718.55 -1.363673e+08\n17      web channel   55  4.065637e+06    135595.31 -6.326632e+05\n18      web channel  157  4.113438e+06    160766.32 -5.365012e+05\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.18639,
                    "execution_time": 0.458401,
                    "compile_time": 0.003615,
                    "planning_time": 1.006144
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.288252,
                    "execution_time": 0.459921,
                    "compile_time": 0.003645,
                    "planning_time": 1.102195
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel   id         sales      returns        profit\n0       web channel  121  3.893371e+06    144582.71 -6.038603e+05\n1       web channel  149  4.026483e+06     66381.79 -4.353684e+05\n2       web channel  163  4.398862e+06    131558.21 -4.318715e+05\n3     store channel   70  2.223115e+07    539132.29 -9.935612e+06\n4     store channel   94  2.179962e+07    568567.86 -1.001737e+07\n5       web channel  104  4.030621e+06    121041.30 -6.385130e+05\n6       web channel  119  4.563337e+06     62291.86 -3.667642e+05\n7       web channel  161  3.983874e+06     42837.09 -4.386369e+05\n8     store channel   73  2.204761e+07    489987.06 -9.806742e+06\n9     store channel   74  2.074058e+07    516261.56 -9.722514e+06\n10      web channel   83  3.947631e+06     45221.41 -5.183942e+05\n11      web channel  128  3.843245e+06     99253.57 -5.169403e+05\n12    store channel    8  2.242996e+07    536132.12 -9.831135e+06\n13      web channel  107  3.895962e+06     49910.57 -4.342406e+05\n14  catalog channel   23  1.164310e+09  20885718.55 -1.276345e+08\n15      web channel  194  4.227258e+06    139523.05 -4.901189e+05\n16  catalog channel   20  1.118725e+09  20885718.55 -1.363673e+08\n17      web channel   55  4.065637e+06    135595.31 -6.326632e+05\n18      web channel  157  4.113438e+06    160766.32 -5.365012e+05\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select NULL AS channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results\n) foo\norder by channel, id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\" ORDER BY \"FOO\".\"CHANNEL\" NULLS LAST , \"FOO\".\"ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) AS FOO ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
                "preview": "\n/*            channel    id         sales       returns        profit\n0              None   NaN  1.535516e+10  3.113914e+08 -2.113502e+09\n1   catalog channel   NaN  1.381005e+10  2.715143e+08 -1.559035e+09\n2   catalog channel   NaN  1.567304e+07  2.088572e+07 -1.592432e+07\n3   catalog channel   1.0  1.169824e+09  2.088572e+07 -1.311145e+08\n4   catalog channel   2.0  1.138150e+09  2.088572e+07 -1.399437e+08\n5   catalog channel   5.0  1.143025e+09  2.088572e+07 -1.301141e+08\n6   catalog channel   7.0  1.167244e+09  2.088572e+07 -1.212200e+08\n7   catalog channel   8.0  1.144943e+09  2.088572e+07 -1.168519e+08\n8   catalog channel  11.0  1.098500e+09  2.088572e+07 -1.314107e+08\n9   catalog channel  13.0  1.167441e+09  2.088572e+07 -1.287551e+08\n10  catalog channel  14.0  1.186244e+09  2.088572e+07 -1.285460e+08\n11  catalog channel  17.0  1.156043e+09  2.088572e+07 -1.244870e+08\n12  catalog channel  19.0  1.139929e+09  2.088572e+07 -1.266660e+08\n13  catalog channel  20.0  1.118725e+09  2.088572e+07 -1.363673e+08\n14  catalog channel  23.0  1.164310e+09  2.088572e+07 -1.276345e+08\n15    store channel   NaN  1.131727e+09  2.828279e+07 -5.060653e+08\n16    store channel   1.0  2.345973e+07  5.628520e+05 -1.026751e+07\n17    store channel   2.0  2.132467e+07  5.502052e+05 -9.685910e+06\n18    store channel   4.0  2.166717e+07  6.700001e+05 -9.800044e+06\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.178245,
                    "execution_time": 0.457124,
                    "compile_time": 0.003674,
                    "planning_time": 0.991439
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.29421,
                    "execution_time": 0.462306,
                    "compile_time": 0.003629,
                    "planning_time": 1.10386
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel    id         sales       returns        profit\n0              None   NaN  1.535516e+10  3.113914e+08 -2.113502e+09\n1   catalog channel   NaN  1.381005e+10  2.715143e+08 -1.559035e+09\n2   catalog channel   NaN  1.567304e+07  2.088572e+07 -1.592432e+07\n3   catalog channel   1.0  1.169824e+09  2.088572e+07 -1.311145e+08\n4   catalog channel   2.0  1.138150e+09  2.088572e+07 -1.399437e+08\n5   catalog channel   5.0  1.143025e+09  2.088572e+07 -1.301141e+08\n6   catalog channel   7.0  1.167244e+09  2.088572e+07 -1.212200e+08\n7   catalog channel   8.0  1.144943e+09  2.088572e+07 -1.168519e+08\n8   catalog channel  11.0  1.098500e+09  2.088572e+07 -1.314107e+08\n9   catalog channel  13.0  1.167441e+09  2.088572e+07 -1.287551e+08\n10  catalog channel  14.0  1.186244e+09  2.088572e+07 -1.285460e+08\n11  catalog channel  17.0  1.156043e+09  2.088572e+07 -1.244870e+08\n12  catalog channel  19.0  1.139929e+09  2.088572e+07 -1.266660e+08\n13  catalog channel  20.0  1.118725e+09  2.088572e+07 -1.363673e+08\n14  catalog channel  23.0  1.164310e+09  2.088572e+07 -1.276345e+08\n15    store channel   NaN  1.131727e+09  2.828279e+07 -5.060653e+08\n16    store channel   1.0  2.345973e+07  5.628520e+05 -1.026751e+07\n17    store channel   2.0  2.132467e+07  5.502052e+05 -9.685910e+06\n18    store channel   4.0  2.166717e+07  6.700001e+05 -9.800044e+06\n...*/"
    },
    {
        "input": "-- start template query77a.tpl query 78 in stream 0\nwith /* TPC-DS query77a.tpl 0.78 */ ss as\n (select s_store_sk,\n         sum(ss_ext_sales_price) as sales,\n         sum(ss_net_profit) as profit\n from store_sales,\n      date_dim,\n      store\n where ss_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date) \n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ss_store_sk = s_store_sk\n group by s_store_sk)\n ,\n sr as\n (select s_store_sk,\n         sum(sr_return_amt) as returns,\n         sum(sr_net_loss) as profit_loss\n from store_returns,\n      date_dim,\n      store\n where sr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and sr_store_sk = s_store_sk\n group by s_store_sk), \n cs as\n (select cs_call_center_sk,\n        sum(cs_ext_sales_price) as sales,\n        sum(cs_net_profit) as profit\n from catalog_sales,\n      date_dim\n where cs_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cs_call_center_sk \n ), \n cr as\n (select cr_call_center_sk,\n         sum(cr_return_amount) as returns,\n         sum(cr_net_loss) as profit_loss\n from catalog_returns,\n      date_dim\n where cr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n group by cr_call_center_sk), \n ws as\n ( select wp_web_page_sk,\n        sum(ws_ext_sales_price) as sales,\n        sum(ws_net_profit) as profit\n from web_sales,\n      date_dim,\n      web_page\n where ws_sold_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and ws_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk), \n wr as\n (select wp_web_page_sk,\n        sum(wr_return_amt) as returns,\n        sum(wr_net_loss) as profit_loss\n from web_returns,\n      date_dim,\n      web_page\n where wr_returned_date_sk = d_date_sk\n       and d_date between cast('2000-08-02' as date)\n                  and dateadd(day,30,cast('2000-08-02' as date))  \n       and wr_web_page_sk = wp_web_page_sk\n group by wp_web_page_sk)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , ss.s_store_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ss left join sr\n        on  ss.s_store_sk = sr.s_store_sk\n union all\n select 'catalog channel' as channel\n        , cs_call_center_sk as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  cs\n       , cr\n union all\n select 'web channel' as channel\n        , ws.wp_web_page_sk as id\n        , sales\n        , coalesce(returns, 0) as returns\n        , (profit - coalesce(profit_loss,0)) as profit\n from   ws left join wr\n        on  ws.wp_web_page_sk = wr.wp_web_page_sk\n ) x\n group by channel, id )\n\n  select  *\n from (\n select channel, id, sales, returns, profit from  results\n union\n select channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results group by channel\n union\n select NULL AS channel, NULL AS id, sum(sales) as sales, sum(returns) as returns, sum(profit) as profit from  results\n) foo\norder by channel, id\n limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 30 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '2000-08-02' AS DATE ) ) , \"STORE_2\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" FROM \"STORE\" AS \"STORE\" ) , \"SS\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"SR\" AS ( SELECT \"STORE\".\"S_STORE_SK\" AS \"S_STORE_SK\" , SUM ( \"STORE_RETURNS\".\"SR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"STORE_RETURNS\".\"SR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" JOIN \"STORE_2\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_RETURNS\".\"SR_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" AS \"CS_CALL_CENTER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_SALES\".\"CS_CALL_CENTER_SK\" ) , \"CR\" AS ( SELECT SUM ( \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" ) AS \"RETURNS\" , SUM ( \"CATALOG_RETURNS\".\"CR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" GROUP BY \"CATALOG_RETURNS\".\"CR_CALL_CENTER_SK\" ) , \"WEB_PAGE_2\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" FROM \"WEB_PAGE\" AS \"WEB_PAGE\" ) , \"WS\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" ) AS \"SALES\" , SUM ( \"WEB_SALES\".\"WS_NET_PROFIT\" ) AS \"PROFIT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_SALES\".\"WS_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"WR\" AS ( SELECT \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" AS \"WP_WEB_PAGE_SK\" , SUM ( \"WEB_RETURNS\".\"WR_RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"WEB_RETURNS\".\"WR_NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" JOIN \"WEB_PAGE_2\" AS \"WEB_PAGE\" ON \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" = \"WEB_RETURNS\".\"WR_WEB_PAGE_SK\" GROUP BY \"WEB_PAGE\".\"WP_WEB_PAGE_SK\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , \"SS\".\"S_STORE_SK\" AS \"ID\" , \"SS\".\"SALES\" AS \"SALES\" , COALESCE ( \"SR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"SS\".\"PROFIT\" - COALESCE ( \"SR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"SS\" AS \"SS\" LEFT JOIN \"SR\" AS \"SR\" ON \"SR\".\"S_STORE_SK\" = \"SS\".\"S_STORE_SK\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , \"CS\".\"CS_CALL_CENTER_SK\" AS \"ID\" , \"CS\".\"SALES\" AS \"SALES\" , \"CR\".\"RETURNS\" AS \"RETURNS\" , \"CS\".\"PROFIT\" - \"CR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CS\" AS \"CS\" CROSS JOIN \"CR\" AS \"CR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , \"WS\".\"WP_WEB_PAGE_SK\" AS \"ID\" , \"WS\".\"SALES\" AS \"SALES\" , COALESCE ( \"WR\".\"RETURNS\" , 0 ) AS \"RETURNS\" , \"WS\".\"PROFIT\" - COALESCE ( \"WR\".\"PROFIT_LOSS\" , 0 ) AS \"PROFIT\" FROM \"WS\" AS \"WS\" LEFT JOIN \"WR\" AS \"WR\" ON \"WR\".\"WP_WEB_PAGE_SK\" = \"WS\".\"WP_WEB_PAGE_SK\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\" ORDER BY \"FOO\".\"CHANNEL\" NULLS LAST , \"FOO\".\"ID\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SS AS ( SELECT S_STORE_SK , SUM ( SS_EXT_SALES_PRICE ) AS SALES , SUM ( SS_NET_PROFIT ) AS PROFIT FROM STORE_SALES , DATE_DIM , STORE WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SS_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , SR AS ( SELECT S_STORE_SK , SUM ( SR_RETURN_AMT ) AS RETURNS , SUM ( SR_NET_LOSS ) AS PROFIT_LOSS FROM STORE_RETURNS , DATE_DIM , STORE WHERE SR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND SR_STORE_SK = S_STORE_SK GROUP BY S_STORE_SK ) , CS AS ( SELECT CS_CALL_CENTER_SK , SUM ( CS_EXT_SALES_PRICE ) AS SALES , SUM ( CS_NET_PROFIT ) AS PROFIT FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CS_CALL_CENTER_SK ) , CR AS ( SELECT CR_CALL_CENTER_SK , SUM ( CR_RETURN_AMOUNT ) AS RETURNS , SUM ( CR_NET_LOSS ) AS PROFIT_LOSS FROM CATALOG_RETURNS , DATE_DIM WHERE CR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) GROUP BY CR_CALL_CENTER_SK ) , WS AS ( SELECT WP_WEB_PAGE_SK , SUM ( WS_EXT_SALES_PRICE ) AS SALES , SUM ( WS_NET_PROFIT ) AS PROFIT FROM WEB_SALES , DATE_DIM , WEB_PAGE WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WS_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , WR AS ( SELECT WP_WEB_PAGE_SK , SUM ( WR_RETURN_AMT ) AS RETURNS , SUM ( WR_NET_LOSS ) AS PROFIT_LOSS FROM WEB_RETURNS , DATE_DIM , WEB_PAGE WHERE WR_RETURNED_DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '2000-08-02' AS DATE ) AND DATEADD ( DAY , 30 , CAST ( '2000-08-02' AS DATE ) ) AND WR_WEB_PAGE_SK = WP_WEB_PAGE_SK GROUP BY WP_WEB_PAGE_SK ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , SS.S_STORE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM SS LEFT JOIN SR ON SS.S_STORE_SK = SR.S_STORE_SK UNION ALL SELECT 'catalog channel' AS CHANNEL , CS_CALL_CENTER_SK AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CS , CR UNION ALL SELECT 'web channel' AS CHANNEL , WS.WP_WEB_PAGE_SK AS ID , SALES , COALESCE ( RETURNS , 0 ) AS RETURNS , ( PROFIT - COALESCE ( PROFIT_LOSS , 0 ) ) AS PROFIT FROM WS LEFT JOIN WR ON WS.WP_WEB_PAGE_SK = WR.WP_WEB_PAGE_SK ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM RESULTS ) AS FOO ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
                "preview": "\n/*            channel    id         sales       returns        profit\n0              None   NaN  1.535516e+10  3.113914e+08 -2.113502e+09\n1   catalog channel   NaN  1.381005e+10  2.715143e+08 -1.559035e+09\n2   catalog channel   NaN  1.567304e+07  2.088572e+07 -1.592432e+07\n3   catalog channel   1.0  1.169824e+09  2.088572e+07 -1.311145e+08\n4   catalog channel   2.0  1.138150e+09  2.088572e+07 -1.399437e+08\n5   catalog channel   5.0  1.143025e+09  2.088572e+07 -1.301141e+08\n6   catalog channel   7.0  1.167244e+09  2.088572e+07 -1.212200e+08\n7   catalog channel   8.0  1.144943e+09  2.088572e+07 -1.168519e+08\n8   catalog channel  11.0  1.098500e+09  2.088572e+07 -1.314107e+08\n9   catalog channel  13.0  1.167441e+09  2.088572e+07 -1.287551e+08\n10  catalog channel  14.0  1.186244e+09  2.088572e+07 -1.285460e+08\n11  catalog channel  17.0  1.156043e+09  2.088572e+07 -1.244870e+08\n12  catalog channel  19.0  1.139929e+09  2.088572e+07 -1.266660e+08\n13  catalog channel  20.0  1.118725e+09  2.088572e+07 -1.363673e+08\n14  catalog channel  23.0  1.164310e+09  2.088572e+07 -1.276345e+08\n15    store channel   NaN  1.131727e+09  2.828279e+07 -5.060653e+08\n16    store channel   1.0  2.345973e+07  5.628520e+05 -1.026751e+07\n17    store channel   2.0  2.132467e+07  5.502052e+05 -9.685910e+06\n18    store channel   4.0  2.166717e+07  6.700001e+05 -9.800044e+06\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.189787,
                    "execution_time": 0.46179,
                    "compile_time": 0.003669,
                    "planning_time": 1.002168
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.186134,
                    "execution_time": 0.465127,
                    "compile_time": 0.003645,
                    "planning_time": 0.99429
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel    id         sales       returns        profit\n0              None   NaN  1.535516e+10  3.113914e+08 -2.113502e+09\n1   catalog channel   NaN  1.381005e+10  2.715143e+08 -1.559035e+09\n2   catalog channel   NaN  1.567304e+07  2.088572e+07 -1.592432e+07\n3   catalog channel   1.0  1.169824e+09  2.088572e+07 -1.311145e+08\n4   catalog channel   2.0  1.138150e+09  2.088572e+07 -1.399437e+08\n5   catalog channel   5.0  1.143025e+09  2.088572e+07 -1.301141e+08\n6   catalog channel   7.0  1.167244e+09  2.088572e+07 -1.212200e+08\n7   catalog channel   8.0  1.144943e+09  2.088572e+07 -1.168519e+08\n8   catalog channel  11.0  1.098500e+09  2.088572e+07 -1.314107e+08\n9   catalog channel  13.0  1.167441e+09  2.088572e+07 -1.287551e+08\n10  catalog channel  14.0  1.186244e+09  2.088572e+07 -1.285460e+08\n11  catalog channel  17.0  1.156043e+09  2.088572e+07 -1.244870e+08\n12  catalog channel  19.0  1.139929e+09  2.088572e+07 -1.266660e+08\n13  catalog channel  20.0  1.118725e+09  2.088572e+07 -1.363673e+08\n14  catalog channel  23.0  1.164310e+09  2.088572e+07 -1.276345e+08\n15    store channel   NaN  1.131727e+09  2.828279e+07 -5.060653e+08\n16    store channel   1.0  2.345973e+07  5.628520e+05 -1.026751e+07\n17    store channel   2.0  2.132467e+07  5.502052e+05 -9.685910e+06\n18    store channel   4.0  2.166717e+07  6.700001e+05 -9.800044e+06\n...*/"
    }
]