[
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     (select d_date_sk, d_date from date_dim) as dim, -- Assuming date_dim has these columns\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     (select d_date_sk, d_date from date_dim) as dim, -- Assuming date_dim has these columns\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     (select d_date_sk, d_date from date_dim) as dim, -- Assuming date_dim has these columns\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  wsr\n ) summary\n group by rollup(channel, id)\n )\n select * from results\n order by channel, id\n /*CURSOR_IDENTIFIER*/;",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DIM\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DIM\" AS \"DIM\" ON \"DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DIM\" AS \"DIM\" ON \"DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DIM\" AS \"DIM\" ON \"DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"SUMMARY\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"SUMMARY\".\"CHANNEL\" AS \"CHANNEL\" , \"SUMMARY\".\"ID\" AS \"ID\" , SUM ( \"SUMMARY\".\"SALES\" ) AS \"SALES\" , SUM ( \"SUMMARY\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"SUMMARY\".\"PROFIT\" ) AS \"PROFIT\" FROM \"SUMMARY\" AS \"SUMMARY\" GROUP BY ROLLUP ( \"SUMMARY\".\"CHANNEL\" , \"SUMMARY\".\"ID\" ) ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ORDER BY \"RESULTS\".\"CHANNEL\" NULLS LAST , \"RESULTS\".\"ID\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.02393,
                    "execution_time": 1.461103,
                    "compile_time": 0.000413,
                    "planning_time": 0.033908,
                    "create_size": 1664
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 2.006454,
                    "execution_time": 1.444719,
                    "compile_time": 0.000396,
                    "planning_time": 0.03278,
                    "create_size": 1664
                }
            }
        ],
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , ( SELECT D_DATE_SK , D_DATE FROM DATE_DIM ) AS DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , ( SELECT D_DATE_SK , D_DATE FROM DATE_DIM ) AS DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , ( SELECT D_DATE_SK , D_DATE FROM DATE_DIM ) AS DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS SUMMARY GROUP BY ROLLUP ( CHANNEL , ID ) ) SELECT * FROM RESULTS ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
                "preview": "\n/*            channel                            id         sales      returns        profit\n0              None                          None  1.140717e+09  24000318.26 -3.130138e+08\n1   catalog channel                          None  3.949869e+08   7976956.02 -4.571558e+07\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  8.185201e+05      1616.56 -1.237419e+05\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  0.000000e+00      1913.29 -7.140200e+02\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00      2079.78 -2.454700e+02\n5   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00     44864.26 -2.770302e+04\n6   catalog channel  catalog_pageAAAAAAAAABBAAAAA  8.064250e+05      1427.41 -5.246177e+04\n7   catalog channel  catalog_pageAAAAAAAAABDAAAAA  9.174218e+05         0.00 -3.589204e+04\n8   catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00     47783.62 -1.855003e+04\n9   catalog channel  catalog_pageAAAAAAAAACBAAAAA  7.946497e+05       430.41 -1.855166e+05\n10  catalog channel  catalog_pageAAAAAAAAACDAAAAA  1.138213e+06         0.00  5.007000e+01\n11  catalog channel  catalog_pageAAAAAAAAADAAAAAA  0.000000e+00     44368.40 -2.315494e+04\n12  catalog channel  catalog_pageAAAAAAAAADBAAAAA  7.539862e+05      5622.75 -8.793739e+04\n13  catalog channel  catalog_pageAAAAAAAAADCAAAAA  0.000000e+00       736.50 -6.489000e+02\n14  catalog channel  catalog_pageAAAAAAAAADDAAAAA  8.536835e+05         0.00 -1.242765e+05\n15  catalog channel  catalog_pageAAAAAAAAAEAAAAAA  0.000000e+00     83146.53 -4.079643e+04\n16  catalog channel  catalog_pageAAAAAAAAAEBAAAAA  7.949546e+05      1769.50 -8.601681e+04\n17  catalog channel  catalog_pageAAAAAAAAAECAAAAA  0.000000e+00      1722.24 -4.904300e+02\n18  catalog channel  catalog_pageAAAAAAAAAEDAAAAA  9.223145e+05         0.00 -1.477075e+05\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.273546,
                    "execution_time": 0.070946,
                    "compile_time": 0.000719,
                    "planning_time": 0.166819
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.383194,
                    "execution_time": 0.177814,
                    "compile_time": 0.000776,
                    "planning_time": 0.166571
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id         sales      returns        profit\n0              None                          None  1.140717e+09  24000318.26 -3.130138e+08\n1   catalog channel                          None  3.949869e+08   7976956.02 -4.571558e+07\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  8.185201e+05      1616.56 -1.237419e+05\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  0.000000e+00      1913.29 -7.140200e+02\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00      2079.78 -2.454700e+02\n5   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00     44864.26 -2.770302e+04\n6   catalog channel  catalog_pageAAAAAAAAABBAAAAA  8.064250e+05      1427.41 -5.246177e+04\n7   catalog channel  catalog_pageAAAAAAAAABDAAAAA  9.174218e+05         0.00 -3.589204e+04\n8   catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00     47783.62 -1.855003e+04\n9   catalog channel  catalog_pageAAAAAAAAACBAAAAA  7.946497e+05       430.41 -1.855166e+05\n10  catalog channel  catalog_pageAAAAAAAAACDAAAAA  1.138213e+06         0.00  5.007000e+01\n11  catalog channel  catalog_pageAAAAAAAAADAAAAAA  0.000000e+00     44368.40 -2.315494e+04\n12  catalog channel  catalog_pageAAAAAAAAADBAAAAA  7.539862e+05      5622.75 -8.793739e+04\n13  catalog channel  catalog_pageAAAAAAAAADCAAAAA  0.000000e+00       736.50 -6.489000e+02\n14  catalog channel  catalog_pageAAAAAAAAADDAAAAA  8.536835e+05         0.00 -1.242765e+05\n15  catalog channel  catalog_pageAAAAAAAAAEAAAAAA  0.000000e+00     83146.53 -4.079643e+04\n16  catalog channel  catalog_pageAAAAAAAAAEBAAAAA  7.949546e+05      1769.50 -8.601681e+04\n17  catalog channel  catalog_pageAAAAAAAAAECAAAAA  0.000000e+00      1722.24 -4.904300e+02\n18  catalog channel  catalog_pageAAAAAAAAAEDAAAAA  9.223145e+05         0.00 -1.477075e+05\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   csr\n union all\n select 'web channel' as channel\n        , 'web' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) as combined\n group by channel, id\n )\nselect *\nfrom results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"COMBINED\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"COMBINED\".\"CHANNEL\" AS \"CHANNEL\" , \"COMBINED\".\"ID\" AS \"ID\" , SUM ( \"COMBINED\".\"SALES\" ) AS \"SALES\" , SUM ( \"COMBINED\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"COMBINED\".\"PROFIT\" ) AS \"PROFIT\" FROM \"COMBINED\" AS \"COMBINED\" GROUP BY \"COMBINED\".\"CHANNEL\" , \"COMBINED\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS COMBINED GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAAMBDAAAAA    923093.33       0.00  -190769.68\n1   catalog channel  catalog_pageAAAAAAAAOADAAAAA   1043157.38       0.00   -85621.75\n2   catalog channel  catalog_pageAAAAAAAADCDAAAAA    957463.45       0.00   -47548.16\n3   catalog channel  catalog_pageAAAAAAAAFCDAAAAA    791767.26       0.00  -122144.39\n4   catalog channel  catalog_pageAAAAAAAAFMAAAAAA   1556636.84   10129.89  -160370.92\n5   catalog channel  catalog_pageAAAAAAAAFABAAAAA    954603.28       0.00   -20145.64\n6   catalog channel  catalog_pageAAAAAAAABLAAAAAA   1688211.49     898.35  -228459.13\n7   catalog channel  catalog_pageAAAAAAAABJAAAAAA   1761059.21   12659.89  -199824.45\n8   catalog channel  catalog_pageAAAAAAAADFAAAAAA         0.00   66412.15   -32305.01\n9   catalog channel  catalog_pageAAAAAAAALIBAAAAA         0.00    6158.90    -5714.87\n10  catalog channel  catalog_pageAAAAAAAADMBAAAAA         0.00     103.60     -241.99\n11  catalog channel  catalog_pageAAAAAAAAHKCAAAAA         0.00    1376.90     -785.02\n12  catalog channel  catalog_pageAAAAAAAALOCAAAAA         0.00     117.84     -101.63\n13  catalog channel  catalog_pageAAAAAAAAEMCAAAAA         0.00    3225.18     -623.23\n14  catalog channel  catalog_pageAAAAAAAAOMCAAAAA         0.00    1653.76    -2115.92\n15  catalog channel  catalog_pageAAAAAAAACLCAAAAA         0.00       4.40      -97.35\n16    store channel         storeAAAAAAAABAAAAAAA  10723432.36  251783.93 -4947346.80\n17  catalog channel  catalog_pageAAAAAAAAJGDAAAAA    888123.23       0.00   -74362.54\n18  catalog channel  catalog_pageAAAAAAAANGDAAAAA    850614.43       0.00  -127434.83\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.260223,
                    "execution_time": 0.058699,
                    "compile_time": 0.000693,
                    "planning_time": 0.152011
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.372045,
                    "execution_time": 0.070693,
                    "compile_time": 0.000676,
                    "planning_time": 0.265025
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAAMBDAAAAA    923093.33       0.00  -190769.68\n1   catalog channel  catalog_pageAAAAAAAAOADAAAAA   1043157.38       0.00   -85621.75\n2   catalog channel  catalog_pageAAAAAAAADCDAAAAA    957463.45       0.00   -47548.16\n3   catalog channel  catalog_pageAAAAAAAAFCDAAAAA    791767.26       0.00  -122144.39\n4   catalog channel  catalog_pageAAAAAAAAFMAAAAAA   1556636.84   10129.89  -160370.92\n5   catalog channel  catalog_pageAAAAAAAAFABAAAAA    954603.28       0.00   -20145.64\n6   catalog channel  catalog_pageAAAAAAAABLAAAAAA   1688211.49     898.35  -228459.13\n7   catalog channel  catalog_pageAAAAAAAABJAAAAAA   1761059.21   12659.89  -199824.45\n8   catalog channel  catalog_pageAAAAAAAADFAAAAAA         0.00   66412.15   -32305.01\n9   catalog channel  catalog_pageAAAAAAAALIBAAAAA         0.00    6158.90    -5714.87\n10  catalog channel  catalog_pageAAAAAAAADMBAAAAA         0.00     103.60     -241.99\n11  catalog channel  catalog_pageAAAAAAAAHKCAAAAA         0.00    1376.90     -785.02\n12  catalog channel  catalog_pageAAAAAAAALOCAAAAA         0.00     117.84     -101.63\n13  catalog channel  catalog_pageAAAAAAAAEMCAAAAA         0.00    3225.18     -623.23\n14  catalog channel  catalog_pageAAAAAAAAOMCAAAAA         0.00    1653.76    -2115.92\n15  catalog channel  catalog_pageAAAAAAAACLCAAAAA         0.00       4.40      -97.35\n16    store channel         storeAAAAAAAABAAAAAAA  10723432.36  251783.93 -4947346.80\n17  catalog channel  catalog_pageAAAAAAAAJGDAAAAA    888123.23       0.00   -74362.54\n18  catalog channel  catalog_pageAAAAAAAANGDAAAAA    850614.43       0.00  -127434.83\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(returns) as returns,\n        sum(profit_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as returns,\n            cast(0 as decimal(7,2)) as profit_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as returns,\n           sr_net_loss as profit_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(returns) as returns,\n        sum(profit_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as returns,\n            cast(0 as decimal(7,2)) as profit_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as returns,\n           cr_net_loss as profit_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(returns) as returns,\n        sum(profit_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as returns,\n            cast(0 as decimal(7,2)) as profit_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as returns,\n           wr_net_loss as profit_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  wsr\n )\n group by channel, id)\nselect * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURNS\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURNS\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"PROFIT_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURNS\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURNS\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"PROFIT_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"PROFIT_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURNS\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURNS\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"PROFIT_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"PROFIT_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURNS\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURNS\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"PROFIT_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.007879,
                    "execution_time": 1.452791,
                    "compile_time": 0.000418,
                    "planning_time": 0.034489,
                    "create_size": 1664
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 2.053055,
                    "execution_time": 1.423609,
                    "compile_time": 0.000438,
                    "planning_time": 0.114516,
                    "create_size": 1664
                }
            }
        ],
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURNS , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURNS , SR_NET_LOSS AS PROFIT_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURNS , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURNS , CR_NET_LOSS AS PROFIT_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURNS , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURNS , WR_NET_LOSS AS PROFIT_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0     store channel         storeAAAAAAAALCAAAAAA  10091585.75  269694.87 -4874030.70\n1     store channel         storeAAAAAAAAIDAAAAAA  10836517.45  285628.14 -4957480.47\n2   catalog channel  catalog_pageAAAAAAAAFKAAAAAA   1745928.65    1666.92  -253222.22\n3   catalog channel  catalog_pageAAAAAAAAHDDAAAAA    885062.74       0.00  -110355.53\n4   catalog channel  catalog_pageAAAAAAAANEBAAAAA    881690.88    2711.79   -79799.03\n5   catalog channel  catalog_pageAAAAAAAAEEDAAAAA    918941.40       0.00   -79321.51\n6   catalog channel  catalog_pageAAAAAAAAFDDAAAAA    852637.89       0.00   -82595.31\n7   catalog channel  catalog_pageAAAAAAAADEBAAAAA    982362.63    5426.84   -93732.55\n8   catalog channel  catalog_pageAAAAAAAAFFDAAAAA    958142.81       0.00   -53040.75\n9   catalog channel  catalog_pageAAAAAAAACFDAAAAA    845544.65       0.00   -80912.50\n10  catalog channel  catalog_pageAAAAAAAAEFAAAAAA         0.00   40048.37   -18712.79\n11  catalog channel  catalog_pageAAAAAAAACAAAAAAA         0.00   53525.22   -28505.14\n12  catalog channel  catalog_pageAAAAAAAAIACAAAAA         0.00   11248.53    -6392.46\n13  catalog channel  catalog_pageAAAAAAAABCCAAAAA         0.00     862.29     -716.89\n14      web channel           webAAAAAAAAEAAAAAAA   9115465.04  148928.06 -1073009.96\n15  catalog channel  catalog_pageAAAAAAAAGLAAAAAA   1780679.29   29595.14  -222584.25\n16  catalog channel  catalog_pageAAAAAAAANLAAAAAA   1748736.05   12077.55  -311342.62\n17  catalog channel  catalog_pageAAAAAAAAABAAAAAA         0.00   44864.26   -27703.02\n18  catalog channel  catalog_pageAAAAAAAAOPCAAAAA         0.00     750.48     -403.38\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.255329,
                    "execution_time": 0.067798,
                    "compile_time": 0.000686,
                    "planning_time": 0.152275
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.372137,
                    "execution_time": 0.072868,
                    "compile_time": 0.000705,
                    "planning_time": 0.263938
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0     store channel         storeAAAAAAAALCAAAAAA  10091585.75  269694.87 -4874030.70\n1     store channel         storeAAAAAAAAIDAAAAAA  10836517.45  285628.14 -4957480.47\n2   catalog channel  catalog_pageAAAAAAAAFKAAAAAA   1745928.65    1666.92  -253222.22\n3   catalog channel  catalog_pageAAAAAAAAHDDAAAAA    885062.74       0.00  -110355.53\n4   catalog channel  catalog_pageAAAAAAAANEBAAAAA    881690.88    2711.79   -79799.03\n5   catalog channel  catalog_pageAAAAAAAAEEDAAAAA    918941.40       0.00   -79321.51\n6   catalog channel  catalog_pageAAAAAAAAFDDAAAAA    852637.89       0.00   -82595.31\n7   catalog channel  catalog_pageAAAAAAAADEBAAAAA    982362.63    5426.84   -93732.55\n8   catalog channel  catalog_pageAAAAAAAAFFDAAAAA    958142.81       0.00   -53040.75\n9   catalog channel  catalog_pageAAAAAAAACFDAAAAA    845544.65       0.00   -80912.50\n10  catalog channel  catalog_pageAAAAAAAAEFAAAAAA         0.00   40048.37   -18712.79\n11  catalog channel  catalog_pageAAAAAAAACAAAAAAA         0.00   53525.22   -28505.14\n12  catalog channel  catalog_pageAAAAAAAAIACAAAAA         0.00   11248.53    -6392.46\n13  catalog channel  catalog_pageAAAAAAAABCCAAAAA         0.00     862.29     -716.89\n14      web channel           webAAAAAAAAEAAAAAAA   9115465.04  148928.06 -1073009.96\n15  catalog channel  catalog_pageAAAAAAAAGLAAAAAA   1780679.29   29595.14  -222584.25\n16  catalog channel  catalog_pageAAAAAAAANLAAAAAA   1748736.05   12077.55  -311342.62\n17  catalog channel  catalog_pageAAAAAAAAABAAAAAA         0.00   44864.26   -27703.02\n18  catalog channel  catalog_pageAAAAAAAAOPCAAAAA         0.00     750.48     -403.38\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from wsr\n ) final_results\n group by channel, id)\n select *\n from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"FINAL_RESULTS\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"FINAL_RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_RESULTS\".\"ID\" AS \"ID\" , SUM ( \"FINAL_RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"FINAL_RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"FINAL_RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"FINAL_RESULTS\" AS \"FINAL_RESULTS\" GROUP BY \"FINAL_RESULTS\".\"CHANNEL\" , \"FINAL_RESULTS\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS FINAL_RESULTS GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id       sales   returns     profit\n0   catalog channel  catalog_pageAAAAAAAAJBDAAAAA   901329.96      0.00  -88947.92\n1   catalog channel  catalog_pageAAAAAAAANJAAAAAA  1712875.27  10022.56 -211512.79\n2   catalog channel  catalog_pageAAAAAAAALDAAAAAA        0.00  68628.98  -38127.59\n3   catalog channel  catalog_pageAAAAAAAAFPBAAAAA        0.00   2084.40   -1387.14\n4   catalog channel  catalog_pageAAAAAAAABEAAAAAA        0.00  34901.85  -15985.25\n5   catalog channel  catalog_pageAAAAAAAAEGCAAAAA        0.00   2619.05   -1439.04\n6   catalog channel  catalog_pageAAAAAAAANEAAAAAA        0.00  36606.31  -24172.83\n7   catalog channel  catalog_pageAAAAAAAAMKCAAAAA        0.00   6209.24   -7331.81\n8   catalog channel  catalog_pageAAAAAAAAHMBAAAAA        0.00   6174.17   -2950.14\n9   catalog channel  catalog_pageAAAAAAAACOBAAAAA        0.00   1494.35    -663.22\n10  catalog channel  catalog_pageAAAAAAAAICCAAAAA        0.00   2325.27   -1219.75\n11  catalog channel  catalog_pageAAAAAAAAODCAAAAA        0.00    240.12    -202.24\n12  catalog channel  catalog_pageAAAAAAAAIECAAAAA        0.00   2362.81   -1067.45\n13  catalog channel  catalog_pageAAAAAAAADNBAAAAA        0.00     62.13    -271.90\n14  catalog channel  catalog_pageAAAAAAAAFABAAAAA   954603.28      0.00  -20145.64\n15  catalog channel  catalog_pageAAAAAAAABLAAAAAA  1688211.49    898.35 -228459.13\n16  catalog channel  catalog_pageAAAAAAAAOADAAAAA  1043157.38      0.00  -85621.75\n17  catalog channel  catalog_pageAAAAAAAABJAAAAAA  1761059.21  12659.89 -199824.45\n18  catalog channel  catalog_pageAAAAAAAAFCDAAAAA   791767.26      0.00 -122144.39\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.256446,
                    "execution_time": 0.069148,
                    "compile_time": 0.00071,
                    "planning_time": 0.151892
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.380466,
                    "execution_time": 0.083471,
                    "compile_time": 0.000715,
                    "planning_time": 0.261749
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id       sales   returns     profit\n0   catalog channel  catalog_pageAAAAAAAAJBDAAAAA   901329.96      0.00  -88947.92\n1   catalog channel  catalog_pageAAAAAAAANJAAAAAA  1712875.27  10022.56 -211512.79\n2   catalog channel  catalog_pageAAAAAAAALDAAAAAA        0.00  68628.98  -38127.59\n3   catalog channel  catalog_pageAAAAAAAAFPBAAAAA        0.00   2084.40   -1387.14\n4   catalog channel  catalog_pageAAAAAAAABEAAAAAA        0.00  34901.85  -15985.25\n5   catalog channel  catalog_pageAAAAAAAAEGCAAAAA        0.00   2619.05   -1439.04\n6   catalog channel  catalog_pageAAAAAAAANEAAAAAA        0.00  36606.31  -24172.83\n7   catalog channel  catalog_pageAAAAAAAAMKCAAAAA        0.00   6209.24   -7331.81\n8   catalog channel  catalog_pageAAAAAAAAHMBAAAAA        0.00   6174.17   -2950.14\n9   catalog channel  catalog_pageAAAAAAAACOBAAAAA        0.00   1494.35    -663.22\n10  catalog channel  catalog_pageAAAAAAAAICCAAAAA        0.00   2325.27   -1219.75\n11  catalog channel  catalog_pageAAAAAAAAODCAAAAA        0.00    240.12    -202.24\n12  catalog channel  catalog_pageAAAAAAAAIECAAAAA        0.00   2362.81   -1067.45\n13  catalog channel  catalog_pageAAAAAAAADNBAAAAA        0.00     62.13    -271.90\n14  catalog channel  catalog_pageAAAAAAAAFABAAAAA   954603.28      0.00  -20145.64\n15  catalog channel  catalog_pageAAAAAAAABLAAAAAA  1688211.49    898.35 -228459.13\n16  catalog channel  catalog_pageAAAAAAAAOADAAAAA  1043157.38      0.00  -85621.75\n17  catalog channel  catalog_pageAAAAAAAABJAAAAAA  1761059.21  12659.89 -199824.45\n18  catalog channel  catalog_pageAAAAAAAAFCDAAAAA   791767.26      0.00 -122144.39\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from wsr\n ) final_results\n group by channel, id\n) \nselect * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"FINAL_RESULTS\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"FINAL_RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_RESULTS\".\"ID\" AS \"ID\" , SUM ( \"FINAL_RESULTS\".\"SALES\" ) AS \"SALES\" , SUM ( \"FINAL_RESULTS\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"FINAL_RESULTS\".\"PROFIT\" ) AS \"PROFIT\" FROM \"FINAL_RESULTS\" AS \"FINAL_RESULTS\" GROUP BY \"FINAL_RESULTS\".\"CHANNEL\" , \"FINAL_RESULTS\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS FINAL_RESULTS GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0     store channel         storeAAAAAAAAMEAAAAAA  11810473.83  259050.52 -5104792.67\n1   catalog channel  catalog_pageAAAAAAAAIBBAAAAA    935937.12    6331.94   -70268.78\n2   catalog channel  catalog_pageAAAAAAAAGHAAAAAA   1755271.76    4609.53  -241128.88\n3   catalog channel  catalog_pageAAAAAAAAEEBAAAAA    902756.52   16160.50  -109413.36\n4   catalog channel  catalog_pageAAAAAAAAICBAAAAA    790103.19    8644.75   -68870.85\n5   catalog channel  catalog_pageAAAAAAAAMEAAAAAA         0.00   28694.67   -22886.74\n6   catalog channel  catalog_pageAAAAAAAAJFAAAAAA         0.00   48561.22   -36369.48\n7   catalog channel  catalog_pageAAAAAAAABBAAAAAA         0.00   45289.74   -31743.52\n8   catalog channel  catalog_pageAAAAAAAACBAAAAAA         0.00   36164.90   -19311.72\n9   catalog channel  catalog_pageAAAAAAAAEBAAAAAA         0.00   41623.67   -30524.71\n10  catalog channel  catalog_pageAAAAAAAALMBAAAAA         0.00    3971.10    -1072.36\n11  catalog channel  catalog_pageAAAAAAAAKFBAAAAA         0.00    3593.78    -1222.26\n12  catalog channel  catalog_pageAAAAAAAAOLCAAAAA         0.00       8.22      -71.48\n13  catalog channel  catalog_pageAAAAAAAALPBAAAAA         0.00    1297.44     -447.37\n14  catalog channel  catalog_pageAAAAAAAADECAAAAA         0.00      36.44      -53.78\n15  catalog channel  catalog_pageAAAAAAAAFABAAAAA    954603.28       0.00   -20145.64\n16  catalog channel  catalog_pageAAAAAAAABLAAAAAA   1688211.49     898.35  -228459.13\n17  catalog channel  catalog_pageAAAAAAAAOADAAAAA   1043157.38       0.00   -85621.75\n18  catalog channel  catalog_pageAAAAAAAABJAAAAAA   1761059.21   12659.89  -199824.45\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.261923,
                    "execution_time": 0.069639,
                    "compile_time": 0.000725,
                    "planning_time": 0.156956
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.371864,
                    "execution_time": 0.07388,
                    "compile_time": 0.000716,
                    "planning_time": 0.262468
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0     store channel         storeAAAAAAAAMEAAAAAA  11810473.83  259050.52 -5104792.67\n1   catalog channel  catalog_pageAAAAAAAAIBBAAAAA    935937.12    6331.94   -70268.78\n2   catalog channel  catalog_pageAAAAAAAAGHAAAAAA   1755271.76    4609.53  -241128.88\n3   catalog channel  catalog_pageAAAAAAAAEEBAAAAA    902756.52   16160.50  -109413.36\n4   catalog channel  catalog_pageAAAAAAAAICBAAAAA    790103.19    8644.75   -68870.85\n5   catalog channel  catalog_pageAAAAAAAAMEAAAAAA         0.00   28694.67   -22886.74\n6   catalog channel  catalog_pageAAAAAAAAJFAAAAAA         0.00   48561.22   -36369.48\n7   catalog channel  catalog_pageAAAAAAAABBAAAAAA         0.00   45289.74   -31743.52\n8   catalog channel  catalog_pageAAAAAAAACBAAAAAA         0.00   36164.90   -19311.72\n9   catalog channel  catalog_pageAAAAAAAAEBAAAAAA         0.00   41623.67   -30524.71\n10  catalog channel  catalog_pageAAAAAAAALMBAAAAA         0.00    3971.10    -1072.36\n11  catalog channel  catalog_pageAAAAAAAAKFBAAAAA         0.00    3593.78    -1222.26\n12  catalog channel  catalog_pageAAAAAAAAOLCAAAAA         0.00       8.22      -71.48\n13  catalog channel  catalog_pageAAAAAAAALPBAAAAA         0.00    1297.44     -447.37\n14  catalog channel  catalog_pageAAAAAAAADECAAAAA         0.00      36.44      -53.78\n15  catalog channel  catalog_pageAAAAAAAAFABAAAAA    954603.28       0.00   -20145.64\n16  catalog channel  catalog_pageAAAAAAAABLAAAAAA   1688211.49     898.35  -228459.13\n17  catalog channel  catalog_pageAAAAAAAAOADAAAAA   1043157.38       0.00   -85621.75\n18  catalog channel  catalog_pageAAAAAAAABJAAAAAA   1761059.21   12659.89  -199824.45\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr)\n group by channel, id\n )\n select * from results; \n /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"_Q_0\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , SUM ( \"_Q_0\".\"SALES\" ) AS \"SALES\" , SUM ( \"_Q_0\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"_Q_0\".\"PROFIT\" ) AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\" GROUP BY \"_Q_0\".\"CHANNEL\" , \"_Q_0\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAALKAAAAAA   1676999.77    2193.70  -247286.97\n1   catalog channel  catalog_pageAAAAAAAAFNAAAAAA   1790827.64    1927.03  -187355.00\n2   catalog channel  catalog_pageAAAAAAAAPCDAAAAA   1000872.36       0.00   -88873.29\n3   catalog channel  catalog_pageAAAAAAAAGNBAAAAA         0.00    4860.71    -2993.16\n4   catalog channel  catalog_pageAAAAAAAAFBCAAAAA         0.00     643.20    -1079.10\n5   catalog channel  catalog_pageAAAAAAAAAFAAAAAA         0.00   65917.55   -32869.68\n6   catalog channel  catalog_pageAAAAAAAANFCAAAAA         0.00      15.75     -287.43\n7   catalog channel  catalog_pageAAAAAAAANCCAAAAA         0.00    5012.81    -2062.77\n8   catalog channel  catalog_pageAAAAAAAAPBCAAAAA         0.00     799.64     -766.54\n9   catalog channel  catalog_pageAAAAAAAAOGCAAAAA         0.00     336.00     -250.88\n10  catalog channel  catalog_pageAAAAAAAAJLCAAAAA         0.00    3014.76    -1056.30\n11  catalog channel  catalog_pageAAAAAAAAMADAAAAA    869320.98       0.00   -72224.74\n12  catalog channel  catalog_pageAAAAAAAAECAAAAAA         0.00   24675.36   -21358.69\n13  catalog channel  catalog_pageAAAAAAAADEAAAAAA         0.00   52832.74   -24941.24\n14  catalog channel  catalog_pageAAAAAAAADGAAAAAA         0.00   43250.39   -26972.91\n15  catalog channel  catalog_pageAAAAAAAACOCAAAAA         0.00    1346.88     -474.53\n16  catalog channel  catalog_pageAAAAAAAAJEAAAAAA         0.00   44070.82   -19783.83\n17  catalog channel  catalog_pageAAAAAAAAMNCAAAAA         0.00    3685.83    -1470.94\n18  catalog channel  catalog_pageAAAAAAAANJCAAAAA         0.00    7202.57     -674.44\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.257855,
                    "execution_time": 0.069316,
                    "compile_time": 0.000713,
                    "planning_time": 0.153149
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.364288,
                    "execution_time": 0.067149,
                    "compile_time": 0.000704,
                    "planning_time": 0.262052
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAALKAAAAAA   1676999.77    2193.70  -247286.97\n1   catalog channel  catalog_pageAAAAAAAAFNAAAAAA   1790827.64    1927.03  -187355.00\n2   catalog channel  catalog_pageAAAAAAAAPCDAAAAA   1000872.36       0.00   -88873.29\n3   catalog channel  catalog_pageAAAAAAAAGNBAAAAA         0.00    4860.71    -2993.16\n4   catalog channel  catalog_pageAAAAAAAAFBCAAAAA         0.00     643.20    -1079.10\n5   catalog channel  catalog_pageAAAAAAAAAFAAAAAA         0.00   65917.55   -32869.68\n6   catalog channel  catalog_pageAAAAAAAANFCAAAAA         0.00      15.75     -287.43\n7   catalog channel  catalog_pageAAAAAAAANCCAAAAA         0.00    5012.81    -2062.77\n8   catalog channel  catalog_pageAAAAAAAAPBCAAAAA         0.00     799.64     -766.54\n9   catalog channel  catalog_pageAAAAAAAAOGCAAAAA         0.00     336.00     -250.88\n10  catalog channel  catalog_pageAAAAAAAAJLCAAAAA         0.00    3014.76    -1056.30\n11  catalog channel  catalog_pageAAAAAAAAMADAAAAA    869320.98       0.00   -72224.74\n12  catalog channel  catalog_pageAAAAAAAAECAAAAAA         0.00   24675.36   -21358.69\n13  catalog channel  catalog_pageAAAAAAAADEAAAAAA         0.00   52832.74   -24941.24\n14  catalog channel  catalog_pageAAAAAAAADGAAAAAA         0.00   43250.39   -26972.91\n15  catalog channel  catalog_pageAAAAAAAACOCAAAAA         0.00    1346.88     -474.53\n16  catalog channel  catalog_pageAAAAAAAAJEAAAAAA         0.00   44070.82   -19783.83\n17  catalog channel  catalog_pageAAAAAAAAMNCAAAAA         0.00    3685.83    -1470.94\n18  catalog channel  catalog_pageAAAAAAAANJCAAAAA         0.00    7202.57     -674.44\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id\n )\nselect * from results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAABABAAAAA    866625.20    2239.90  -137073.84\n1   catalog channel  catalog_pageAAAAAAAAPMAAAAAA   1645523.67   14749.90  -216208.48\n2   catalog channel  catalog_pageAAAAAAAAJEDAAAAA    844334.23       0.00  -117207.88\n3   catalog channel  catalog_pageAAAAAAAAAMAAAAAA   1757314.61   14774.55  -214194.27\n4   catalog channel  catalog_pageAAAAAAAAHOAAAAAA    893031.33   13831.51  -123738.45\n5   catalog channel  catalog_pageAAAAAAAAFHAAAAAA   1683657.34   12336.93  -206244.22\n6   catalog channel  catalog_pageAAAAAAAAIEAAAAAA         0.00   35695.72   -32661.24\n7   catalog channel  catalog_pageAAAAAAAAHBAAAAAA         0.00   37078.71   -30545.27\n8   catalog channel  catalog_pageAAAAAAAAONBAAAAA         0.00    1329.16    -3909.16\n9   catalog channel  catalog_pageAAAAAAAAKGBAAAAA         0.00    2348.50    -1273.01\n10  catalog channel  catalog_pageAAAAAAAAFGCAAAAA         0.00    5005.71    -3840.39\n11  catalog channel  catalog_pageAAAAAAAABFBAAAAA         0.00     486.48     -197.90\n12  catalog channel  catalog_pageAAAAAAAAJMCAAAAA         0.00     117.40     -126.35\n13      web channel      web_siteAAAAAAAABAAAAAAA   9317672.30  132065.20  -951568.45\n14    store channel         storeAAAAAAAAAEAAAAAA  11152243.89  233380.61 -4755436.69\n15  catalog channel  catalog_pageAAAAAAAAGOAAAAAA    828782.76    8704.86  -115919.13\n16  catalog channel  catalog_pageAAAAAAAAOEDAAAAA    889341.11       0.00   -81361.39\n17  catalog channel  catalog_pageAAAAAAAAAEAAAAAA         0.00   83146.53   -40796.43\n18  catalog channel  catalog_pageAAAAAAAAAGAAAAAA         0.00   30628.22   -22062.29\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.261516,
                    "execution_time": 0.074383,
                    "compile_time": 0.000688,
                    "planning_time": 0.152103
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.369368,
                    "execution_time": 0.069782,
                    "compile_time": 0.000689,
                    "planning_time": 0.264654
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAABABAAAAA    866625.20    2239.90  -137073.84\n1   catalog channel  catalog_pageAAAAAAAAPMAAAAAA   1645523.67   14749.90  -216208.48\n2   catalog channel  catalog_pageAAAAAAAAJEDAAAAA    844334.23       0.00  -117207.88\n3   catalog channel  catalog_pageAAAAAAAAAMAAAAAA   1757314.61   14774.55  -214194.27\n4   catalog channel  catalog_pageAAAAAAAAHOAAAAAA    893031.33   13831.51  -123738.45\n5   catalog channel  catalog_pageAAAAAAAAFHAAAAAA   1683657.34   12336.93  -206244.22\n6   catalog channel  catalog_pageAAAAAAAAIEAAAAAA         0.00   35695.72   -32661.24\n7   catalog channel  catalog_pageAAAAAAAAHBAAAAAA         0.00   37078.71   -30545.27\n8   catalog channel  catalog_pageAAAAAAAAONBAAAAA         0.00    1329.16    -3909.16\n9   catalog channel  catalog_pageAAAAAAAAKGBAAAAA         0.00    2348.50    -1273.01\n10  catalog channel  catalog_pageAAAAAAAAFGCAAAAA         0.00    5005.71    -3840.39\n11  catalog channel  catalog_pageAAAAAAAABFBAAAAA         0.00     486.48     -197.90\n12  catalog channel  catalog_pageAAAAAAAAJMCAAAAA         0.00     117.40     -126.35\n13      web channel      web_siteAAAAAAAABAAAAAAA   9317672.30  132065.20  -951568.45\n14    store channel         storeAAAAAAAAAEAAAAAA  11152243.89  233380.61 -4755436.69\n15  catalog channel  catalog_pageAAAAAAAAGOAAAAAA    828782.76    8704.86  -115919.13\n16  catalog channel  catalog_pageAAAAAAAAOEDAAAAA    889341.11       0.00   -81361.39\n17  catalog channel  catalog_pageAAAAAAAAAEAAAAAA         0.00   83146.53   -40796.43\n18  catalog channel  catalog_pageAAAAAAAAAGAAAAAA         0.00   30628.22   -22062.29\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\nSELECT * FROM results /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT * FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0     store channel         storeAAAAAAAAKAAAAAAA  10414844.71  203703.59 -4656558.42\n1   catalog channel  catalog_pageAAAAAAAAHLAAAAAA   1922326.24   17367.66  -170257.70\n2   catalog channel  catalog_pageAAAAAAAAKHAAAAAA   1831250.61   13444.77  -189289.41\n3   catalog channel  catalog_pageAAAAAAAAFPAAAAAA    885667.64   15619.52   -43444.52\n4   catalog channel  catalog_pageAAAAAAAACNAAAAAA   1685914.02   20319.64   -75254.46\n5   catalog channel  catalog_pageAAAAAAAAAJAAAAAA   1810074.20   10679.41  -112295.05\n6   catalog channel  catalog_pageAAAAAAAABFDAAAAA   1016670.47       0.00   -76804.67\n7   catalog channel  catalog_pageAAAAAAAADABAAAAA    824091.49     360.72   -98641.16\n8   catalog channel  catalog_pageAAAAAAAALPAAAAAA    895315.79   16237.53  -102033.98\n9   catalog channel  catalog_pageAAAAAAAAMICAAAAA         0.00    2654.53     -156.51\n10  catalog channel  catalog_pageAAAAAAAAFCAAAAAA         0.00   26458.77   -19037.59\n11  catalog channel  catalog_pageAAAAAAAAPDAAAAAA         0.00   31434.40   -18820.11\n12  catalog channel  catalog_pageAAAAAAAAEGAAAAAA         0.00   38594.96   -26735.32\n13  catalog channel  catalog_pageAAAAAAAAKJCAAAAA         0.00    7794.58    -3411.10\n14  catalog channel  catalog_pageAAAAAAAAGHCAAAAA         0.00    3927.56    -3086.59\n15  catalog channel  catalog_pageAAAAAAAAKNBAAAAA         0.00    7401.56    -1290.61\n16  catalog channel  catalog_pageAAAAAAAAIOBAAAAA         0.00    2485.44     -986.82\n17  catalog channel  catalog_pageAAAAAAAALJCAAAAA         0.00     168.70     -503.03\n18  catalog channel  catalog_pageAAAAAAAABPBAAAAA         0.00    1352.25    -4539.81\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.256736,
                    "execution_time": 0.068038,
                    "compile_time": 0.000794,
                    "planning_time": 0.153232
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.258468,
                    "execution_time": 0.071428,
                    "compile_time": 0.000705,
                    "planning_time": 0.151845
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0     store channel         storeAAAAAAAAKAAAAAAA  10414844.71  203703.59 -4656558.42\n1   catalog channel  catalog_pageAAAAAAAAHLAAAAAA   1922326.24   17367.66  -170257.70\n2   catalog channel  catalog_pageAAAAAAAAKHAAAAAA   1831250.61   13444.77  -189289.41\n3   catalog channel  catalog_pageAAAAAAAAFPAAAAAA    885667.64   15619.52   -43444.52\n4   catalog channel  catalog_pageAAAAAAAACNAAAAAA   1685914.02   20319.64   -75254.46\n5   catalog channel  catalog_pageAAAAAAAAAJAAAAAA   1810074.20   10679.41  -112295.05\n6   catalog channel  catalog_pageAAAAAAAABFDAAAAA   1016670.47       0.00   -76804.67\n7   catalog channel  catalog_pageAAAAAAAADABAAAAA    824091.49     360.72   -98641.16\n8   catalog channel  catalog_pageAAAAAAAALPAAAAAA    895315.79   16237.53  -102033.98\n9   catalog channel  catalog_pageAAAAAAAAMICAAAAA         0.00    2654.53     -156.51\n10  catalog channel  catalog_pageAAAAAAAAFCAAAAAA         0.00   26458.77   -19037.59\n11  catalog channel  catalog_pageAAAAAAAAPDAAAAAA         0.00   31434.40   -18820.11\n12  catalog channel  catalog_pageAAAAAAAAEGAAAAAA         0.00   38594.96   -26735.32\n13  catalog channel  catalog_pageAAAAAAAAKJCAAAAA         0.00    7794.58    -3411.10\n14  catalog channel  catalog_pageAAAAAAAAGHCAAAAA         0.00    3927.56    -3086.59\n15  catalog channel  catalog_pageAAAAAAAAKNBAAAAA         0.00    7401.56    -1290.61\n16  catalog channel  catalog_pageAAAAAAAAIOBAAAAA         0.00    2485.44     -986.82\n17  catalog channel  catalog_pageAAAAAAAALJCAAAAA         0.00     168.70     -503.03\n18  catalog channel  catalog_pageAAAAAAAABPBAAAAA         0.00    1352.25    -4539.81\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from results \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAAFABAAAAA    954603.28       0.00   -20145.64\n1   catalog channel  catalog_pageAAAAAAAABLAAAAAA   1688211.49     898.35  -228459.13\n2   catalog channel  catalog_pageAAAAAAAAOADAAAAA   1043157.38       0.00   -85621.75\n3   catalog channel  catalog_pageAAAAAAAABJAAAAAA   1761059.21   12659.89  -199824.45\n4   catalog channel  catalog_pageAAAAAAAAFCDAAAAA    791767.26       0.00  -122144.39\n5   catalog channel  catalog_pageAAAAAAAAFMAAAAAA   1556636.84   10129.89  -160370.92\n6   catalog channel  catalog_pageAAAAAAAAMBDAAAAA    923093.33       0.00  -190769.68\n7   catalog channel  catalog_pageAAAAAAAADCDAAAAA    957463.45       0.00   -47548.16\n8   catalog channel  catalog_pageAAAAAAAADFAAAAAA         0.00   66412.15   -32305.01\n9   catalog channel  catalog_pageAAAAAAAALIBAAAAA         0.00    6158.90    -5714.87\n10  catalog channel  catalog_pageAAAAAAAADMBAAAAA         0.00     103.60     -241.99\n11  catalog channel  catalog_pageAAAAAAAACLCAAAAA         0.00       4.40      -97.35\n12  catalog channel  catalog_pageAAAAAAAALOCAAAAA         0.00     117.84     -101.63\n13  catalog channel  catalog_pageAAAAAAAAEMCAAAAA         0.00    3225.18     -623.23\n14  catalog channel  catalog_pageAAAAAAAAHKCAAAAA         0.00    1376.90     -785.02\n15  catalog channel  catalog_pageAAAAAAAAOMCAAAAA         0.00    1653.76    -2115.92\n16    store channel         storeAAAAAAAABAAAAAAA  10723432.36  251783.93 -4947346.80\n17  catalog channel  catalog_pageAAAAAAAALNAAAAAA   1749229.89   28232.09  -277456.00\n18  catalog channel  catalog_pageAAAAAAAAJGDAAAAA    888123.23       0.00   -74362.54\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.255179,
                    "execution_time": 0.068231,
                    "compile_time": 0.000708,
                    "planning_time": 0.151954
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.375494,
                    "execution_time": 0.073549,
                    "compile_time": 0.000694,
                    "planning_time": 0.26672
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAAFABAAAAA    954603.28       0.00   -20145.64\n1   catalog channel  catalog_pageAAAAAAAABLAAAAAA   1688211.49     898.35  -228459.13\n2   catalog channel  catalog_pageAAAAAAAAOADAAAAA   1043157.38       0.00   -85621.75\n3   catalog channel  catalog_pageAAAAAAAABJAAAAAA   1761059.21   12659.89  -199824.45\n4   catalog channel  catalog_pageAAAAAAAAFCDAAAAA    791767.26       0.00  -122144.39\n5   catalog channel  catalog_pageAAAAAAAAFMAAAAAA   1556636.84   10129.89  -160370.92\n6   catalog channel  catalog_pageAAAAAAAAMBDAAAAA    923093.33       0.00  -190769.68\n7   catalog channel  catalog_pageAAAAAAAADCDAAAAA    957463.45       0.00   -47548.16\n8   catalog channel  catalog_pageAAAAAAAADFAAAAAA         0.00   66412.15   -32305.01\n9   catalog channel  catalog_pageAAAAAAAALIBAAAAA         0.00    6158.90    -5714.87\n10  catalog channel  catalog_pageAAAAAAAADMBAAAAA         0.00     103.60     -241.99\n11  catalog channel  catalog_pageAAAAAAAACLCAAAAA         0.00       4.40      -97.35\n12  catalog channel  catalog_pageAAAAAAAALOCAAAAA         0.00     117.84     -101.63\n13  catalog channel  catalog_pageAAAAAAAAEMCAAAAA         0.00    3225.18     -623.23\n14  catalog channel  catalog_pageAAAAAAAAHKCAAAAA         0.00    1376.90     -785.02\n15  catalog channel  catalog_pageAAAAAAAAOMCAAAAA         0.00    1653.76    -2115.92\n16    store channel         storeAAAAAAAABAAAAAAA  10723432.36  251783.93 -4947346.80\n17  catalog channel  catalog_pageAAAAAAAALNAAAAAA   1749229.89   28232.09  -277456.00\n18  catalog channel  catalog_pageAAAAAAAAJGDAAAAA    888123.23       0.00   -74362.54\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS ) LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0     store channel         storeAAAAAAAAEAAAAAAA  10732093.41  248208.27 -5056838.18\n1   catalog channel  catalog_pageAAAAAAAABBBAAAAA    685823.18    8994.80  -136586.30\n2   catalog channel  catalog_pageAAAAAAAAOCBAAAAA    838846.05   19108.35   -98951.44\n3   catalog channel  catalog_pageAAAAAAAALHAAAAAA   1739439.98    9811.75  -183831.92\n4   catalog channel  catalog_pageAAAAAAAAMCBAAAAA    733210.80    4617.10  -117790.03\n5   catalog channel  catalog_pageAAAAAAAAMAAAAAAA         0.00   50680.15   -29310.16\n6   catalog channel  catalog_pageAAAAAAAAOBAAAAAA         0.00   32690.59   -23215.80\n7   catalog channel  catalog_pageAAAAAAAAEAAAAAAA         0.00   23345.38    -8403.91\n8   catalog channel  catalog_pageAAAAAAAABCAAAAAA         0.00   43492.12   -23184.93\n9   catalog channel  catalog_pageAAAAAAAACFAAAAAA         0.00   32906.87   -27377.35\n10  catalog channel  catalog_pageAAAAAAAAIHBAAAAA         0.00    1875.57    -1792.32\n11  catalog channel  catalog_pageAAAAAAAALECAAAAA         0.00      11.70     -295.83\n12  catalog channel  catalog_pageAAAAAAAABOBAAAAA         0.00    3451.80    -1577.61\n13  catalog channel  catalog_pageAAAAAAAALGCAAAAA         0.00     831.16     -559.34\n14  catalog channel  catalog_pageAAAAAAAAMDCAAAAA         0.00       0.08      -51.01\n15      web channel      web_siteAAAAAAAAJBAAAAAA   9629180.53  158962.03  -725035.03\n16    store channel         storeAAAAAAAAGCAAAAAA   9885557.40  295446.51 -4605212.38\n17  catalog channel  catalog_pageAAAAAAAADPAAAAAA    867441.61    2616.66   -68051.22\n18  catalog channel  catalog_pageAAAAAAAALJAAAAAA   1778984.29   10941.97  -230312.19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.264016,
                    "execution_time": 0.068872,
                    "compile_time": 0.000712,
                    "planning_time": 0.160319
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.383729,
                    "execution_time": 0.068329,
                    "compile_time": 0.000702,
                    "planning_time": 0.280385
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0     store channel         storeAAAAAAAAEAAAAAAA  10732093.41  248208.27 -5056838.18\n1   catalog channel  catalog_pageAAAAAAAABBBAAAAA    685823.18    8994.80  -136586.30\n2   catalog channel  catalog_pageAAAAAAAAOCBAAAAA    838846.05   19108.35   -98951.44\n3   catalog channel  catalog_pageAAAAAAAALHAAAAAA   1739439.98    9811.75  -183831.92\n4   catalog channel  catalog_pageAAAAAAAAMCBAAAAA    733210.80    4617.10  -117790.03\n5   catalog channel  catalog_pageAAAAAAAAMAAAAAAA         0.00   50680.15   -29310.16\n6   catalog channel  catalog_pageAAAAAAAAOBAAAAAA         0.00   32690.59   -23215.80\n7   catalog channel  catalog_pageAAAAAAAAEAAAAAAA         0.00   23345.38    -8403.91\n8   catalog channel  catalog_pageAAAAAAAABCAAAAAA         0.00   43492.12   -23184.93\n9   catalog channel  catalog_pageAAAAAAAACFAAAAAA         0.00   32906.87   -27377.35\n10  catalog channel  catalog_pageAAAAAAAAIHBAAAAA         0.00    1875.57    -1792.32\n11  catalog channel  catalog_pageAAAAAAAALECAAAAA         0.00      11.70     -295.83\n12  catalog channel  catalog_pageAAAAAAAABOBAAAAA         0.00    3451.80    -1577.61\n13  catalog channel  catalog_pageAAAAAAAALGCAAAAA         0.00     831.16     -559.34\n14  catalog channel  catalog_pageAAAAAAAAMDCAAAAA         0.00       0.08      -51.01\n15      web channel      web_siteAAAAAAAAJBAAAAAA   9629180.53  158962.03  -725035.03\n16    store channel         storeAAAAAAAAGCAAAAAA   9885557.40  295446.51 -4605212.38\n17  catalog channel  catalog_pageAAAAAAAADPAAAAAA    867441.61    2616.66   -68051.22\n18  catalog channel  catalog_pageAAAAAAAALJAAAAAA   1778984.29   10941.97  -230312.19\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns\n     , date_dim\n     , store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns\n     , date_dim\n     , catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns\n     , date_dim\n     , web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union all\n  select channel, id, sales, returns, profit from results\n) as final_results\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FINAL_RESULTS\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION ALL SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FINAL_RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_RESULTS\".\"ID\" AS \"ID\" , \"FINAL_RESULTS\".\"SALES\" AS \"SALES\" , \"FINAL_RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"FINAL_RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"FINAL_RESULTS\" AS \"FINAL_RESULTS\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION ALL SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS ) AS FINAL_RESULTS LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAAJBDAAAAA    901329.96       0.00   -88947.92\n1   catalog channel  catalog_pageAAAAAAAANJAAAAAA   1712875.27   10022.56  -211512.79\n2   catalog channel  catalog_pageAAAAAAAALDAAAAAA         0.00   68628.98   -38127.59\n3   catalog channel  catalog_pageAAAAAAAAFPBAAAAA         0.00    2084.40    -1387.14\n4   catalog channel  catalog_pageAAAAAAAABEAAAAAA         0.00   34901.85   -15985.25\n5   catalog channel  catalog_pageAAAAAAAAEGCAAAAA         0.00    2619.05    -1439.04\n6   catalog channel  catalog_pageAAAAAAAANEAAAAAA         0.00   36606.31   -24172.83\n7   catalog channel  catalog_pageAAAAAAAAMKCAAAAA         0.00    6209.24    -7331.81\n8   catalog channel  catalog_pageAAAAAAAAHMBAAAAA         0.00    6174.17    -2950.14\n9   catalog channel  catalog_pageAAAAAAAACOBAAAAA         0.00    1494.35     -663.22\n10  catalog channel  catalog_pageAAAAAAAAICCAAAAA         0.00    2325.27    -1219.75\n11  catalog channel  catalog_pageAAAAAAAAODCAAAAA         0.00     240.12     -202.24\n12  catalog channel  catalog_pageAAAAAAAAIECAAAAA         0.00    2362.81    -1067.45\n13  catalog channel  catalog_pageAAAAAAAADNBAAAAA         0.00      62.13     -271.90\n14    store channel         storeAAAAAAAAIDAAAAAA  10836517.45  285628.14 -4957480.47\n15    store channel         storeAAAAAAAALCAAAAAA  10091585.75  269694.87 -4874030.70\n16  catalog channel  catalog_pageAAAAAAAAFFDAAAAA    958142.81       0.00   -53040.75\n17  catalog channel  catalog_pageAAAAAAAADEBAAAAA    982362.63    5426.84   -93732.55\n18  catalog channel  catalog_pageAAAAAAAAFKAAAAAA   1745928.65    1666.92  -253222.22\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.484298,
                    "execution_time": 0.11364,
                    "compile_time": 0.001031,
                    "planning_time": 0.462265
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.605609,
                    "execution_time": 0.115418,
                    "compile_time": 0.000998,
                    "planning_time": 0.579625
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAAJBDAAAAA    901329.96       0.00   -88947.92\n1   catalog channel  catalog_pageAAAAAAAANJAAAAAA   1712875.27   10022.56  -211512.79\n2   catalog channel  catalog_pageAAAAAAAALDAAAAAA         0.00   68628.98   -38127.59\n3   catalog channel  catalog_pageAAAAAAAAFPBAAAAA         0.00    2084.40    -1387.14\n4   catalog channel  catalog_pageAAAAAAAABEAAAAAA         0.00   34901.85   -15985.25\n5   catalog channel  catalog_pageAAAAAAAAEGCAAAAA         0.00    2619.05    -1439.04\n6   catalog channel  catalog_pageAAAAAAAANEAAAAAA         0.00   36606.31   -24172.83\n7   catalog channel  catalog_pageAAAAAAAAMKCAAAAA         0.00    6209.24    -7331.81\n8   catalog channel  catalog_pageAAAAAAAAHMBAAAAA         0.00    6174.17    -2950.14\n9   catalog channel  catalog_pageAAAAAAAACOBAAAAA         0.00    1494.35     -663.22\n10  catalog channel  catalog_pageAAAAAAAAICCAAAAA         0.00    2325.27    -1219.75\n11  catalog channel  catalog_pageAAAAAAAAODCAAAAA         0.00     240.12     -202.24\n12  catalog channel  catalog_pageAAAAAAAAIECAAAAA         0.00    2362.81    -1067.45\n13  catalog channel  catalog_pageAAAAAAAADNBAAAAA         0.00      62.13     -271.90\n14    store channel         storeAAAAAAAAIDAAAAAA  10836517.45  285628.14 -4957480.47\n15    store channel         storeAAAAAAAALCAAAAAA  10091585.75  269694.87 -4874030.70\n16  catalog channel  catalog_pageAAAAAAAAFFDAAAAA    958142.81       0.00   -53040.75\n17  catalog channel  catalog_pageAAAAAAAADEBAAAAA    982362.63    5426.84   -93732.55\n18  catalog channel  catalog_pageAAAAAAAAFKAAAAAA   1745928.65    1666.92  -253222.22\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union\n  select channel, null as id, sum(sales), sum(returns), sum(profit) from results group by channel\n) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"_Q_0\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" ) SELECT \"_Q_0\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_0\".\"ID\" AS \"ID\" , \"_Q_0\".\"SALES\" AS \"SALES\" , \"_Q_0\".\"RETURNS\" AS \"RETURNS\" , \"_Q_0\".\"PROFIT\" AS \"PROFIT\" FROM \"_Q_0\" AS \"_Q_0\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS GROUP BY CHANNEL ) LIMIT 21",
                "preview": "\n/*            channel                            id       sales   returns     profit\n0   catalog channel  catalog_pageAAAAAAAANGAAAAAA        0.00  37405.09  -22822.30\n1   catalog channel  catalog_pageAAAAAAAADGAAAAAA        0.00  43250.39  -26972.91\n2   catalog channel  catalog_pageAAAAAAAAJEAAAAAA        0.00  44070.82  -19783.83\n3   catalog channel  catalog_pageAAAAAAAAMBBAAAAA   826570.41    652.68  -93215.64\n4   catalog channel  catalog_pageAAAAAAAAGNAAAAAA  1678264.62   4877.19 -153749.13\n5   catalog channel  catalog_pageAAAAAAAAFEAAAAAA        0.00  33722.67  -20638.45\n6   catalog channel  catalog_pageAAAAAAAAGCCAAAAA        0.00    286.72    -628.97\n7   catalog channel  catalog_pageAAAAAAAAPIBAAAAA        0.00   1462.05    -759.66\n8   catalog channel  catalog_pageAAAAAAAACDCAAAAA        0.00    950.04   -1838.70\n9   catalog channel  catalog_pageAAAAAAAAOIBAAAAA        0.00     12.58     -90.25\n10  catalog channel  catalog_pageAAAAAAAABCBAAAAA   958941.28   6298.51  -91966.53\n11  catalog channel  catalog_pageAAAAAAAABKBAAAAA        0.00    971.58   -1470.97\n12  catalog channel  catalog_pageAAAAAAAAPOBAAAAA        0.00   4994.62   -1690.40\n13  catalog channel  catalog_pageAAAAAAAAACAAAAAA        0.00  47783.62  -18550.03\n14  catalog channel  catalog_pageAAAAAAAAJOBAAAAA        0.00   3900.06   -2266.87\n15  catalog channel  catalog_pageAAAAAAAAIDAAAAAA        0.00  55194.73  -27543.83\n16  catalog channel  catalog_pageAAAAAAAANFCAAAAA        0.00     15.75    -287.43\n17  catalog channel  catalog_pageAAAAAAAAKPCAAAAA        0.00   5618.26   -2751.55\n18  catalog channel  catalog_pageAAAAAAAAJECAAAAA        0.00   1530.98   -4992.58\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.647195,
                    "execution_time": 0.212972,
                    "compile_time": 0.001823,
                    "planning_time": 0.49058
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.750903,
                    "execution_time": 0.204405,
                    "compile_time": 0.001758,
                    "planning_time": 0.601265
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id       sales   returns     profit\n0   catalog channel  catalog_pageAAAAAAAANGAAAAAA        0.00  37405.09  -22822.30\n1   catalog channel  catalog_pageAAAAAAAADGAAAAAA        0.00  43250.39  -26972.91\n2   catalog channel  catalog_pageAAAAAAAAJEAAAAAA        0.00  44070.82  -19783.83\n3   catalog channel  catalog_pageAAAAAAAAMBBAAAAA   826570.41    652.68  -93215.64\n4   catalog channel  catalog_pageAAAAAAAAGNAAAAAA  1678264.62   4877.19 -153749.13\n5   catalog channel  catalog_pageAAAAAAAAFEAAAAAA        0.00  33722.67  -20638.45\n6   catalog channel  catalog_pageAAAAAAAAGCCAAAAA        0.00    286.72    -628.97\n7   catalog channel  catalog_pageAAAAAAAAPIBAAAAA        0.00   1462.05    -759.66\n8   catalog channel  catalog_pageAAAAAAAACDCAAAAA        0.00    950.04   -1838.70\n9   catalog channel  catalog_pageAAAAAAAAOIBAAAAA        0.00     12.58     -90.25\n10  catalog channel  catalog_pageAAAAAAAABCBAAAAA   958941.28   6298.51  -91966.53\n11  catalog channel  catalog_pageAAAAAAAABKBAAAAA        0.00    971.58   -1470.97\n12  catalog channel  catalog_pageAAAAAAAAPOBAAAAA        0.00   4994.62   -1690.40\n13  catalog channel  catalog_pageAAAAAAAAACAAAAAA        0.00  47783.62  -18550.03\n14  catalog channel  catalog_pageAAAAAAAAJOBAAAAA        0.00   3900.06   -2266.87\n15  catalog channel  catalog_pageAAAAAAAAIDAAAAAA        0.00  55194.73  -27543.83\n16  catalog channel  catalog_pageAAAAAAAANFCAAAAA        0.00     15.75    -287.43\n17  catalog channel  catalog_pageAAAAAAAAKPCAAAAA        0.00   5618.26   -2751.55\n18  catalog channel  catalog_pageAAAAAAAAJECAAAAA        0.00   1530.98   -4992.58\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - 0) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - 0) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - 0) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union\n  select channel, null as id, sum(sales), sum(returns), sum(profit) from results group by channel\n) results_final  /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - 0 AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - 0 AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - 0 AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"RESULTS_FINAL\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" ) SELECT \"RESULTS_FINAL\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS_FINAL\".\"ID\" AS \"ID\" , \"RESULTS_FINAL\".\"SALES\" AS \"SALES\" , \"RESULTS_FINAL\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS_FINAL\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS_FINAL\" AS \"RESULTS_FINAL\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.644249,
                    "execution_time": 1.165686,
                    "compile_time": 0.000393,
                    "planning_time": 0.032141,
                    "create_size": 1408
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 1.761242,
                    "execution_time": 1.195121,
                    "compile_time": 0.000397,
                    "planning_time": 0.113405,
                    "create_size": 1408
                }
            }
        ],
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - 0 ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - 0 ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - 0 ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS GROUP BY CHANNEL ) AS RESULTS_FINAL LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAAKDDAAAAA    855731.57      19.76  -134923.31\n1   catalog channel  catalog_pageAAAAAAAAAKBAAAAA         0.00    1541.65        0.00\n2   catalog channel  catalog_pageAAAAAAAAIEDAAAAA    723675.33       0.00   -93119.99\n3   catalog channel  catalog_pageAAAAAAAAICAAAAAA         0.00   42663.27        0.00\n4   catalog channel  catalog_pageAAAAAAAAEJCAAAAA         0.00    5480.30        0.00\n5   catalog channel  catalog_pageAAAAAAAACHBAAAAA         0.00    5699.47        0.00\n6   catalog channel  catalog_pageAAAAAAAAHLAAAAAA   1922326.24   17367.66  -166803.26\n7   catalog channel  catalog_pageAAAAAAAAFPAAAAAA    885667.64   15619.52   -35950.30\n8   catalog channel  catalog_pageAAAAAAAAAJAAAAAA   1810074.20   10679.41  -106526.80\n9   catalog channel  catalog_pageAAAAAAAABMAAAAAA   1795615.90    6836.79  -173896.95\n10  catalog channel  catalog_pageAAAAAAAANHAAAAAA   1722575.15   14009.22  -207215.81\n11  catalog channel  catalog_pageAAAAAAAAKFDAAAAA    733350.63       0.00  -159605.65\n12  catalog channel  catalog_pageAAAAAAAAJIAAAAAA   1803570.19   15162.79  -105511.63\n13  catalog channel  catalog_pageAAAAAAAABDBAAAAA    827592.76    2274.10  -142483.88\n14  catalog channel  catalog_pageAAAAAAAAKBAAAAAA         0.00   43024.24        0.00\n15  catalog channel  catalog_pageAAAAAAAAKHBAAAAA         0.00     200.12        0.00\n16    store channel         storeAAAAAAAAPEAAAAAA  10891120.91  345518.42 -4649230.62\n17    store channel         storeAAAAAAAAIAAAAAAA  12409043.85  243295.50 -5305122.29\n18    store channel         storeAAAAAAAAFFAAAAAA   9925478.43  245505.07 -4214659.58\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.626237,
                    "execution_time": 0.200036,
                    "compile_time": 0.001837,
                    "planning_time": 0.483035
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.745012,
                    "execution_time": 0.197101,
                    "compile_time": 0.00181,
                    "planning_time": 0.607012
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAAKDDAAAAA    855731.57      19.76  -134923.31\n1   catalog channel  catalog_pageAAAAAAAAAKBAAAAA         0.00    1541.65        0.00\n2   catalog channel  catalog_pageAAAAAAAAIEDAAAAA    723675.33       0.00   -93119.99\n3   catalog channel  catalog_pageAAAAAAAAICAAAAAA         0.00   42663.27        0.00\n4   catalog channel  catalog_pageAAAAAAAAEJCAAAAA         0.00    5480.30        0.00\n5   catalog channel  catalog_pageAAAAAAAACHBAAAAA         0.00    5699.47        0.00\n6   catalog channel  catalog_pageAAAAAAAAHLAAAAAA   1922326.24   17367.66  -166803.26\n7   catalog channel  catalog_pageAAAAAAAAFPAAAAAA    885667.64   15619.52   -35950.30\n8   catalog channel  catalog_pageAAAAAAAAAJAAAAAA   1810074.20   10679.41  -106526.80\n9   catalog channel  catalog_pageAAAAAAAABMAAAAAA   1795615.90    6836.79  -173896.95\n10  catalog channel  catalog_pageAAAAAAAANHAAAAAA   1722575.15   14009.22  -207215.81\n11  catalog channel  catalog_pageAAAAAAAAKFDAAAAA    733350.63       0.00  -159605.65\n12  catalog channel  catalog_pageAAAAAAAAJIAAAAAA   1803570.19   15162.79  -105511.63\n13  catalog channel  catalog_pageAAAAAAAABDBAAAAA    827592.76    2274.10  -142483.88\n14  catalog channel  catalog_pageAAAAAAAAKBAAAAAA         0.00   43024.24        0.00\n15  catalog channel  catalog_pageAAAAAAAAKHBAAAAA         0.00     200.12        0.00\n16    store channel         storeAAAAAAAAPEAAAAAA  10891120.91  345518.42 -4649230.62\n17    store channel         storeAAAAAAAAIAAAAAAA  12409043.85  243295.50 -5305122.29\n18    store channel         storeAAAAAAAAFFAAAAAA   9925478.43  245505.07 -4214659.58\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union\n  select channel, null as id, sum(sales), sum(returns), sum(profit) from results group by channel\n  union\n  select null as channel, null as id, sum(sales), sum(returns), sum(profit) from results) foo\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS ) AS FOO LIMIT 21",
                "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAABDAAAAAA         0.00   51817.21   -29780.79\n1   catalog channel  catalog_pageAAAAAAAAJFBAAAAA         0.00     723.55     -738.97\n2   catalog channel  catalog_pageAAAAAAAAFHAAAAAA   1683657.34   12336.93  -206244.22\n3   catalog channel  catalog_pageAAAAAAAAJEDAAAAA    844334.23       0.00  -117207.88\n4   catalog channel  catalog_pageAAAAAAAAHFDAAAAA    893717.02       0.00  -118034.85\n5   catalog channel  catalog_pageAAAAAAAAKECAAAAA         0.00    1133.55    -1576.38\n6   catalog channel  catalog_pageAAAAAAAAGLCAAAAA         0.00       3.72      -54.67\n7   catalog channel  catalog_pageAAAAAAAAHJCAAAAA         0.00   11172.50    -2782.65\n8   catalog channel  catalog_pageAAAAAAAAEGBAAAAA         0.00    6816.83    -4299.17\n9   catalog channel  catalog_pageAAAAAAAAGOAAAAAA    828782.76    8704.86  -115919.13\n10  catalog channel  catalog_pageAAAAAAAAMGCAAAAA         0.00    1686.57     -782.24\n11  catalog channel  catalog_pageAAAAAAAACECAAAAA         0.00    5473.80    -4069.33\n12  catalog channel  catalog_pageAAAAAAAAMECAAAAA         0.00    3525.63    -4649.21\n13      web channel      web_siteAAAAAAAAKAAAAAAA   9669240.15  171382.81  -939818.36\n14    store channel         storeAAAAAAAAEEAAAAAA  11829804.29  211448.67 -5294016.56\n15    store channel         storeAAAAAAAACGAAAAAA  10307329.48  252528.98 -4738880.14\n16    store channel         storeAAAAAAAACAAAAAAA  10564414.99  235652.99 -4712581.59\n17    store channel         storeAAAAAAAAOCAAAAAA  10226677.29  270063.34 -4418080.79\n18  catalog channel  catalog_pageAAAAAAAANJCAAAAA         0.00    7202.57     -674.44\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.861919,
                    "execution_time": 0.243146,
                    "compile_time": 0.002202,
                    "planning_time": 0.662607
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.983005,
                    "execution_time": 0.253773,
                    "compile_time": 0.002213,
                    "planning_time": 0.783622
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id        sales    returns      profit\n0   catalog channel  catalog_pageAAAAAAAABDAAAAAA         0.00   51817.21   -29780.79\n1   catalog channel  catalog_pageAAAAAAAAJFBAAAAA         0.00     723.55     -738.97\n2   catalog channel  catalog_pageAAAAAAAAFHAAAAAA   1683657.34   12336.93  -206244.22\n3   catalog channel  catalog_pageAAAAAAAAJEDAAAAA    844334.23       0.00  -117207.88\n4   catalog channel  catalog_pageAAAAAAAAHFDAAAAA    893717.02       0.00  -118034.85\n5   catalog channel  catalog_pageAAAAAAAAKECAAAAA         0.00    1133.55    -1576.38\n6   catalog channel  catalog_pageAAAAAAAAGLCAAAAA         0.00       3.72      -54.67\n7   catalog channel  catalog_pageAAAAAAAAHJCAAAAA         0.00   11172.50    -2782.65\n8   catalog channel  catalog_pageAAAAAAAAEGBAAAAA         0.00    6816.83    -4299.17\n9   catalog channel  catalog_pageAAAAAAAAGOAAAAAA    828782.76    8704.86  -115919.13\n10  catalog channel  catalog_pageAAAAAAAAMGCAAAAA         0.00    1686.57     -782.24\n11  catalog channel  catalog_pageAAAAAAAACECAAAAA         0.00    5473.80    -4069.33\n12  catalog channel  catalog_pageAAAAAAAAMECAAAAA         0.00    3525.63    -4649.21\n13      web channel      web_siteAAAAAAAAKAAAAAAA   9669240.15  171382.81  -939818.36\n14    store channel         storeAAAAAAAAEEAAAAAA  11829804.29  211448.67 -5294016.56\n15    store channel         storeAAAAAAAACGAAAAAA  10307329.48  252528.98 -4738880.14\n16    store channel         storeAAAAAAAACAAAAAAA  10564414.99  235652.99 -4712581.59\n17    store channel         storeAAAAAAAAOCAAAAAA  10226677.29  270063.34 -4418080.79\n18  catalog channel  catalog_pageAAAAAAAANJCAAAAA         0.00    7202.57     -674.44\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union\n  select channel, null as id, sum(sales), sum(returns), sum(profit) from results group by channel\n  union\n  select null as channel, null as id, sum(sales), sum(returns), sum(profit) from results) foo\norder by channel, id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\" ORDER BY \"CHANNEL\" NULLS LAST , \"ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS ) AS FOO ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
                "preview": "\n/*            channel                            id         sales      returns        profit\n0              None                          None  1.140717e+09  24000318.26 -3.130138e+08\n1   catalog channel                          None  3.949869e+08   7976956.02 -4.571558e+07\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  8.185201e+05      1616.56 -1.237419e+05\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  0.000000e+00      1913.29 -7.140200e+02\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00      2079.78 -2.454700e+02\n5   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00     44864.26 -2.770302e+04\n6   catalog channel  catalog_pageAAAAAAAAABBAAAAA  8.064250e+05      1427.41 -5.246177e+04\n7   catalog channel  catalog_pageAAAAAAAAABDAAAAA  9.174218e+05         0.00 -3.589204e+04\n8   catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00     47783.62 -1.855003e+04\n9   catalog channel  catalog_pageAAAAAAAAACBAAAAA  7.946497e+05       430.41 -1.855166e+05\n10  catalog channel  catalog_pageAAAAAAAAACDAAAAA  1.138213e+06         0.00  5.007000e+01\n11  catalog channel  catalog_pageAAAAAAAAADAAAAAA  0.000000e+00     44368.40 -2.315494e+04\n12  catalog channel  catalog_pageAAAAAAAAADBAAAAA  7.539862e+05      5622.75 -8.793739e+04\n13  catalog channel  catalog_pageAAAAAAAAADCAAAAA  0.000000e+00       736.50 -6.489000e+02\n14  catalog channel  catalog_pageAAAAAAAAADDAAAAA  8.536835e+05         0.00 -1.242765e+05\n15  catalog channel  catalog_pageAAAAAAAAAEAAAAAA  0.000000e+00     83146.53 -4.079643e+04\n16  catalog channel  catalog_pageAAAAAAAAAEBAAAAA  7.949546e+05      1769.50 -8.601681e+04\n17  catalog channel  catalog_pageAAAAAAAAAECAAAAA  0.000000e+00      1722.24 -4.904300e+02\n18  catalog channel  catalog_pageAAAAAAAAAEDAAAAA  9.223145e+05         0.00 -1.477075e+05\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.862041,
                    "execution_time": 0.242497,
                    "compile_time": 0.002277,
                    "planning_time": 0.658842
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.974918,
                    "execution_time": 0.242237,
                    "compile_time": 0.002194,
                    "planning_time": 0.770879
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id         sales      returns        profit\n0              None                          None  1.140717e+09  24000318.26 -3.130138e+08\n1   catalog channel                          None  3.949869e+08   7976956.02 -4.571558e+07\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  8.185201e+05      1616.56 -1.237419e+05\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  0.000000e+00      1913.29 -7.140200e+02\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00      2079.78 -2.454700e+02\n5   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00     44864.26 -2.770302e+04\n6   catalog channel  catalog_pageAAAAAAAAABBAAAAA  8.064250e+05      1427.41 -5.246177e+04\n7   catalog channel  catalog_pageAAAAAAAAABDAAAAA  9.174218e+05         0.00 -3.589204e+04\n8   catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00     47783.62 -1.855003e+04\n9   catalog channel  catalog_pageAAAAAAAAACBAAAAA  7.946497e+05       430.41 -1.855166e+05\n10  catalog channel  catalog_pageAAAAAAAAACDAAAAA  1.138213e+06         0.00  5.007000e+01\n11  catalog channel  catalog_pageAAAAAAAAADAAAAAA  0.000000e+00     44368.40 -2.315494e+04\n12  catalog channel  catalog_pageAAAAAAAAADBAAAAA  7.539862e+05      5622.75 -8.793739e+04\n13  catalog channel  catalog_pageAAAAAAAAADCAAAAA  0.000000e+00       736.50 -6.489000e+02\n14  catalog channel  catalog_pageAAAAAAAAADDAAAAA  8.536835e+05         0.00 -1.242765e+05\n15  catalog channel  catalog_pageAAAAAAAAAEAAAAAA  0.000000e+00     83146.53 -4.079643e+04\n16  catalog channel  catalog_pageAAAAAAAAAEBAAAAA  7.949546e+05      1769.50 -8.601681e+04\n17  catalog channel  catalog_pageAAAAAAAAAECAAAAA  0.000000e+00      1722.24 -4.904300e+02\n18  catalog channel  catalog_pageAAAAAAAAAEDAAAAA  9.223145e+05         0.00 -1.477075e+05\n...*/"
    },
    {
        "input": "-- start template query5a.tpl query 98 in stream 0\nwith /* TPC-DS query5a.tpl 0.98 */ ssr as\n (select s_store_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ss_store_sk as store_sk,\n            ss_sold_date_sk  as date_sk,\n            ss_ext_sales_price as sales_price,\n            ss_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from store_sales\n    union all\n    select sr_store_sk as store_sk,\n           sr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           sr_return_amt as return_amt,\n           sr_net_loss as net_loss\n    from store_returns\n   ) salesreturns,\n     date_dim,\n     store\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date) \n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  cs_catalog_page_sk as page_sk,\n            cs_sold_date_sk  as date_sk,\n            cs_ext_sales_price as sales_price,\n            cs_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from catalog_sales\n    union all\n    select cr_catalog_page_sk as page_sk,\n           cr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           cr_return_amount as return_amt,\n           cr_net_loss as net_loss\n    from catalog_returns\n   ) salesreturns,\n     date_dim,\n     catalog_page\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n        sum(sales_price) as sales,\n        sum(profit) as profit,\n        sum(return_amt) as returns,\n        sum(net_loss) as profit_loss\n from\n  ( select  ws_web_site_sk as wsr_web_site_sk,\n            ws_sold_date_sk  as date_sk,\n            ws_ext_sales_price as sales_price,\n            ws_net_profit as profit,\n            cast(0 as decimal(7,2)) as return_amt,\n            cast(0 as decimal(7,2)) as net_loss\n    from web_sales\n    union all\n    select ws_web_site_sk as wsr_web_site_sk,\n           wr_returned_date_sk as date_sk,\n           cast(0 as decimal(7,2)) as sales_price,\n           cast(0 as decimal(7,2)) as profit,\n           wr_return_amt as return_amt,\n           wr_net_loss as net_loss\n    from web_returns left outer join web_sales on\n         ( wr_item_sk = ws_item_sk\n           and wr_order_number = ws_order_number)\n   ) salesreturns,\n     date_dim,\n     web_site\n where date_sk = d_date_sk\n       and d_date between cast('1998-08-11' as date)\n                  and dateadd(day,14,cast('1998-08-11' as date))\n       and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n ,\n results as\n (select channel\n        , id\n        , sum(sales) as sales\n        , sum(returns) as returns\n        , sum(profit) as profit\n from \n (select 'store channel' as channel\n        , 'store' || s_store_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   ssr\n union all\n select 'catalog channel' as channel\n        , 'catalog_page' || cp_catalog_page_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from  csr\n union all\n select 'web channel' as channel\n        , 'web_site' || web_site_id as id\n        , sales\n        , returns\n        , (profit - profit_loss) as profit\n from   wsr\n ) x\n group by channel, id)\n select  channel, id, sales, returns, profit from ( \n  select channel, id, sales, returns, profit from results\n  union\n  select channel, null as id, sum(sales), sum(returns), sum(profit) from results group by channel\n  union\n  select null as channel, null as id, sum(sales), sum(returns), sum(profit) from results) foo\norder by channel, id\nlimit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALESRETURNS\" AS ( SELECT \"STORE_SALES\".\"SS_STORE_SK\" AS \"STORE_SK\" , \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"STORE_SALES\".\"SS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" UNION ALL SELECT \"STORE_RETURNS\".\"SR_STORE_SK\" AS \"STORE_SK\" , \"STORE_RETURNS\".\"SR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"STORE_RETURNS\".\"SR_RETURN_AMT\" AS \"RETURN_AMT\" , \"STORE_RETURNS\".\"SR_NET_LOSS\" AS \"NET_LOSS\" FROM \"STORE_RETURNS\" AS \"STORE_RETURNS\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_DATE\" AS \"D_DATE\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_DATE\" <= TS_OR_DS_ADD ( 'DAY' , 14 , DAY , TIMESTAMP ) AND \"DATE_DIM\".\"D_DATE\" >= CAST ( '1998-08-11' AS DATE ) ) , \"SSR\" AS ( SELECT \"STORE\".\"S_STORE_ID\" AS \"S_STORE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"STORE\" AS \"STORE\" ON \"SALESRETURNS\".\"STORE_SK\" = \"STORE\".\"S_STORE_SK\" GROUP BY \"STORE\".\"S_STORE_ID\" ) , \"SALESRETURNS_2\" AS ( SELECT \"CATALOG_SALES\".\"CS_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"CATALOG_SALES\".\"CS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"CATALOG_SALES\".\"CS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" UNION ALL SELECT \"CATALOG_RETURNS\".\"CR_CATALOG_PAGE_SK\" AS \"PAGE_SK\" , \"CATALOG_RETURNS\".\"CR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"CATALOG_RETURNS\".\"CR_RETURN_AMOUNT\" AS \"RETURN_AMT\" , \"CATALOG_RETURNS\".\"CR_NET_LOSS\" AS \"NET_LOSS\" FROM \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ) , \"CSR\" AS ( SELECT \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" AS \"CP_CATALOG_PAGE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_2\" AS \"SALESRETURNS\" JOIN \"CATALOG_PAGE\" AS \"CATALOG_PAGE\" ON \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_SK\" = \"SALESRETURNS\".\"PAGE_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" GROUP BY \"CATALOG_PAGE\".\"CP_CATALOG_PAGE_ID\" ) , \"SALESRETURNS_3\" AS ( SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AS \"DATE_SK\" , \"WEB_SALES\".\"WS_EXT_SALES_PRICE\" AS \"SALES_PRICE\" , \"WEB_SALES\".\"WS_NET_PROFIT\" AS \"PROFIT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"RETURN_AMT\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"NET_LOSS\" FROM \"WEB_SALES\" AS \"WEB_SALES\" UNION ALL SELECT \"WEB_SALES\".\"WS_WEB_SITE_SK\" AS \"WSR_WEB_SITE_SK\" , \"WEB_RETURNS\".\"WR_RETURNED_DATE_SK\" AS \"DATE_SK\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"SALES_PRICE\" , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS \"PROFIT\" , \"WEB_RETURNS\".\"WR_RETURN_AMT\" AS \"RETURN_AMT\" , \"WEB_RETURNS\".\"WR_NET_LOSS\" AS \"NET_LOSS\" FROM \"WEB_RETURNS\" AS \"WEB_RETURNS\" LEFT JOIN \"WEB_SALES\" AS \"WEB_SALES\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" ) , \"WSR\" AS ( SELECT \"WEB_SITE\".\"WEB_SITE_ID\" AS \"WEB_SITE_ID\" , SUM ( \"SALESRETURNS\".\"SALES_PRICE\" ) AS \"SALES\" , SUM ( \"SALESRETURNS\".\"PROFIT\" ) AS \"PROFIT\" , SUM ( \"SALESRETURNS\".\"RETURN_AMT\" ) AS \"RETURNS\" , SUM ( \"SALESRETURNS\".\"NET_LOSS\" ) AS \"PROFIT_LOSS\" FROM \"SALESRETURNS_3\" AS \"SALESRETURNS\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"SALESRETURNS\".\"DATE_SK\" JOIN \"WEB_SITE\" AS \"WEB_SITE\" ON \"SALESRETURNS\".\"WSR_WEB_SITE_SK\" = \"WEB_SITE\".\"WEB_SITE_SK\" GROUP BY \"WEB_SITE\".\"WEB_SITE_ID\" ) , \"X\" AS ( SELECT 'store channel' AS \"CHANNEL\" , 'store' || \"SSR\".\"S_STORE_ID\" AS \"ID\" , \"SSR\".\"SALES\" AS \"SALES\" , \"SSR\".\"RETURNS\" AS \"RETURNS\" , \"SSR\".\"PROFIT\" - \"SSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"SSR\" AS \"SSR\" UNION ALL SELECT 'catalog channel' AS \"CHANNEL\" , 'catalog_page' || \"CSR\".\"CP_CATALOG_PAGE_ID\" AS \"ID\" , \"CSR\".\"SALES\" AS \"SALES\" , \"CSR\".\"RETURNS\" AS \"RETURNS\" , \"CSR\".\"PROFIT\" - \"CSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"CSR\" AS \"CSR\" UNION ALL SELECT 'web channel' AS \"CHANNEL\" , 'web_site' || \"WSR\".\"WEB_SITE_ID\" AS \"ID\" , \"WSR\".\"SALES\" AS \"SALES\" , \"WSR\".\"RETURNS\" AS \"RETURNS\" , \"WSR\".\"PROFIT\" - \"WSR\".\"PROFIT_LOSS\" AS \"PROFIT\" FROM \"WSR\" AS \"WSR\" ) , \"RESULTS\" AS ( SELECT \"X\".\"CHANNEL\" AS \"CHANNEL\" , \"X\".\"ID\" AS \"ID\" , SUM ( \"X\".\"SALES\" ) AS \"SALES\" , SUM ( \"X\".\"RETURNS\" ) AS \"RETURNS\" , SUM ( \"X\".\"PROFIT\" ) AS \"PROFIT\" FROM \"X\" AS \"X\" GROUP BY \"X\".\"CHANNEL\" , \"X\".\"ID\" ) , \"FOO\" AS ( SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , \"RESULTS\".\"ID\" AS \"ID\" , \"RESULTS\".\"SALES\" AS \"SALES\" , \"RESULTS\".\"RETURNS\" AS \"RETURNS\" , \"RESULTS\".\"PROFIT\" AS \"PROFIT\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT \"RESULTS\".\"CHANNEL\" AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"CHANNEL\" UNION SELECT NULL AS \"CHANNEL\" , NULL AS \"ID\" , SUM ( \"RESULTS\".\"SALES\" ) AS \"_COL_2\" , SUM ( \"RESULTS\".\"RETURNS\" ) AS \"_COL_3\" , SUM ( \"RESULTS\".\"PROFIT\" ) AS \"_COL_4\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"FOO\".\"CHANNEL\" AS \"CHANNEL\" , \"FOO\".\"ID\" AS \"ID\" , \"FOO\".\"SALES\" AS \"SALES\" , \"FOO\".\"RETURNS\" AS \"RETURNS\" , \"FOO\".\"PROFIT\" AS \"PROFIT\" FROM \"FOO\" AS \"FOO\" ORDER BY \"CHANNEL\" NULLS LAST , \"ID\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH SSR AS ( SELECT S_STORE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT SS_STORE_SK AS STORE_SK , SS_SOLD_DATE_SK AS DATE_SK , SS_EXT_SALES_PRICE AS SALES_PRICE , SS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM STORE_SALES UNION ALL SELECT SR_STORE_SK AS STORE_SK , SR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , SR_RETURN_AMT AS RETURN_AMT , SR_NET_LOSS AS NET_LOSS FROM STORE_RETURNS ) AS SALESRETURNS , DATE_DIM , STORE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND STORE_SK = S_STORE_SK GROUP BY S_STORE_ID ) , CSR AS ( SELECT CP_CATALOG_PAGE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT CS_CATALOG_PAGE_SK AS PAGE_SK , CS_SOLD_DATE_SK AS DATE_SK , CS_EXT_SALES_PRICE AS SALES_PRICE , CS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM CATALOG_SALES UNION ALL SELECT CR_CATALOG_PAGE_SK AS PAGE_SK , CR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , CR_RETURN_AMOUNT AS RETURN_AMT , CR_NET_LOSS AS NET_LOSS FROM CATALOG_RETURNS ) AS SALESRETURNS , DATE_DIM , CATALOG_PAGE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND PAGE_SK = CP_CATALOG_PAGE_SK GROUP BY CP_CATALOG_PAGE_ID ) , WSR AS ( SELECT WEB_SITE_ID , SUM ( SALES_PRICE ) AS SALES , SUM ( PROFIT ) AS PROFIT , SUM ( RETURN_AMT ) AS RETURNS , SUM ( NET_LOSS ) AS PROFIT_LOSS FROM ( SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WS_SOLD_DATE_SK AS DATE_SK , WS_EXT_SALES_PRICE AS SALES_PRICE , WS_NET_PROFIT AS PROFIT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS RETURN_AMT , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS NET_LOSS FROM WEB_SALES UNION ALL SELECT WS_WEB_SITE_SK AS WSR_WEB_SITE_SK , WR_RETURNED_DATE_SK AS DATE_SK , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS SALES_PRICE , CAST ( 0 AS DECIMAL ( 7 , 2 ) ) AS PROFIT , WR_RETURN_AMT AS RETURN_AMT , WR_NET_LOSS AS NET_LOSS FROM WEB_RETURNS LEFT OUTER JOIN WEB_SALES ON ( WR_ITEM_SK = WS_ITEM_SK AND WR_ORDER_NUMBER = WS_ORDER_NUMBER ) ) AS SALESRETURNS , DATE_DIM , WEB_SITE WHERE DATE_SK = D_DATE_SK AND D_DATE BETWEEN CAST ( '1998-08-11' AS DATE ) AND DATEADD ( DAY , 14 , CAST ( '1998-08-11' AS DATE ) ) AND WSR_WEB_SITE_SK = WEB_SITE_SK GROUP BY WEB_SITE_ID ) , RESULTS AS ( SELECT CHANNEL , ID , SUM ( SALES ) AS SALES , SUM ( RETURNS ) AS RETURNS , SUM ( PROFIT ) AS PROFIT FROM ( SELECT 'store channel' AS CHANNEL , 'store' || S_STORE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM SSR UNION ALL SELECT 'catalog channel' AS CHANNEL , 'catalog_page' || CP_CATALOG_PAGE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM CSR UNION ALL SELECT 'web channel' AS CHANNEL , 'web_site' || WEB_SITE_ID AS ID , SALES , RETURNS , ( PROFIT - PROFIT_LOSS ) AS PROFIT FROM WSR ) AS X GROUP BY CHANNEL , ID ) SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM ( SELECT CHANNEL , ID , SALES , RETURNS , PROFIT FROM RESULTS UNION SELECT CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS GROUP BY CHANNEL UNION SELECT NULL AS CHANNEL , NULL AS ID , SUM ( SALES ) , SUM ( RETURNS ) , SUM ( PROFIT ) FROM RESULTS ) AS FOO ORDER BY CHANNEL NULLS FIRST , ID NULLS FIRST LIMIT 21",
                "preview": "\n/*            channel                            id         sales      returns        profit\n0              None                          None  1.140717e+09  24000318.26 -3.130138e+08\n1   catalog channel                          None  3.949869e+08   7976956.02 -4.571558e+07\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  8.185201e+05      1616.56 -1.237419e+05\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  0.000000e+00      1913.29 -7.140200e+02\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00      2079.78 -2.454700e+02\n5   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00     44864.26 -2.770302e+04\n6   catalog channel  catalog_pageAAAAAAAAABBAAAAA  8.064250e+05      1427.41 -5.246177e+04\n7   catalog channel  catalog_pageAAAAAAAAABDAAAAA  9.174218e+05         0.00 -3.589204e+04\n8   catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00     47783.62 -1.855003e+04\n9   catalog channel  catalog_pageAAAAAAAAACBAAAAA  7.946497e+05       430.41 -1.855166e+05\n10  catalog channel  catalog_pageAAAAAAAAACDAAAAA  1.138213e+06         0.00  5.007000e+01\n11  catalog channel  catalog_pageAAAAAAAAADAAAAAA  0.000000e+00     44368.40 -2.315494e+04\n12  catalog channel  catalog_pageAAAAAAAAADBAAAAA  7.539862e+05      5622.75 -8.793739e+04\n13  catalog channel  catalog_pageAAAAAAAAADCAAAAA  0.000000e+00       736.50 -6.489000e+02\n14  catalog channel  catalog_pageAAAAAAAAADDAAAAA  8.536835e+05         0.00 -1.242765e+05\n15  catalog channel  catalog_pageAAAAAAAAAEAAAAAA  0.000000e+00     83146.53 -4.079643e+04\n16  catalog channel  catalog_pageAAAAAAAAAEBAAAAA  7.949546e+05      1769.50 -8.601681e+04\n17  catalog channel  catalog_pageAAAAAAAAAECAAAAA  0.000000e+00      1722.24 -4.904300e+02\n18  catalog channel  catalog_pageAAAAAAAAAEDAAAAA  9.223145e+05         0.00 -1.477075e+05\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.861728,
                    "execution_time": 0.242642,
                    "compile_time": 0.002301,
                    "planning_time": 0.65961
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.861995,
                    "execution_time": 0.24613,
                    "compile_time": 0.002356,
                    "planning_time": 0.656711
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*            channel                            id         sales      returns        profit\n0              None                          None  1.140717e+09  24000318.26 -3.130138e+08\n1   catalog channel                          None  3.949869e+08   7976956.02 -4.571558e+07\n2   catalog channel  catalog_pageAAAAAAAAAABAAAAA  8.185201e+05      1616.56 -1.237419e+05\n3   catalog channel  catalog_pageAAAAAAAAAACAAAAA  0.000000e+00      1913.29 -7.140200e+02\n4   catalog channel  catalog_pageAAAAAAAAAADAAAAA  0.000000e+00      2079.78 -2.454700e+02\n5   catalog channel  catalog_pageAAAAAAAAABAAAAAA  0.000000e+00     44864.26 -2.770302e+04\n6   catalog channel  catalog_pageAAAAAAAAABBAAAAA  8.064250e+05      1427.41 -5.246177e+04\n7   catalog channel  catalog_pageAAAAAAAAABDAAAAA  9.174218e+05         0.00 -3.589204e+04\n8   catalog channel  catalog_pageAAAAAAAAACAAAAAA  0.000000e+00     47783.62 -1.855003e+04\n9   catalog channel  catalog_pageAAAAAAAAACBAAAAA  7.946497e+05       430.41 -1.855166e+05\n10  catalog channel  catalog_pageAAAAAAAAACDAAAAA  1.138213e+06         0.00  5.007000e+01\n11  catalog channel  catalog_pageAAAAAAAAADAAAAAA  0.000000e+00     44368.40 -2.315494e+04\n12  catalog channel  catalog_pageAAAAAAAAADBAAAAA  7.539862e+05      5622.75 -8.793739e+04\n13  catalog channel  catalog_pageAAAAAAAAADCAAAAA  0.000000e+00       736.50 -6.489000e+02\n14  catalog channel  catalog_pageAAAAAAAAADDAAAAA  8.536835e+05         0.00 -1.242765e+05\n15  catalog channel  catalog_pageAAAAAAAAAEAAAAAA  0.000000e+00     83146.53 -4.079643e+04\n16  catalog channel  catalog_pageAAAAAAAAAEBAAAAA  7.949546e+05      1769.50 -8.601681e+04\n17  catalog channel  catalog_pageAAAAAAAAAECAAAAA  0.000000e+00      1722.24 -4.904300e+02\n18  catalog channel  catalog_pageAAAAAAAAAEDAAAAA  9.223145e+05         0.00 -1.477075e+05\n...*/"
    }
]