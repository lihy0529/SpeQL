[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n/*CURSOR_IDENTIFIER*/) SELECT * FROM results_rollup",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.173438,
                    "execution_time": 0.082196,
                    "compile_time": 0.000483,
                    "planning_time": 0.05421,
                    "create_size": 64
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.271813,
                    "execution_time": 0.099429,
                    "compile_time": 0.000466,
                    "planning_time": 0.133402,
                    "create_size": 64
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" GROUP BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.085267,
                    "execution_time": 0.04982,
                    "compile_time": 0.0004,
                    "planning_time": 0.007611,
                    "create_size": 9
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.132709,
                    "execution_time": 0.050375,
                    "compile_time": 0.000419,
                    "planning_time": 0.04945,
                    "create_size": 9
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category         i_class  t_category  t_class  lochierarchy\n0        -0.4411        Books         history           0        0             0\n1        -0.4324        Shoes            mens           0        0             0\n2        -0.4383       Sports          tennis           0        0             0\n3        -0.4380       Sports            None           0        1             1\n4        -0.4375        Books            None           0        1             1\n5        -0.4421         Home          tables           0        0             0\n6        -0.4254        Music            rock           0        0             0\n7        -0.4349        Women      fragrances           0        0             0\n8        -0.4284         Home        bathroom           0        0             0\n9        -0.4404      Jewelry   semi-precious           0        0             0\n10       -0.2115                    classical           0        0             0\n11       -0.4200     Children         newborn           0        0             0\n12       -0.4345      Jewelry      mens watch           0        0             0\n13       -0.4396  Electronics        scanners           0        0             0\n14       -0.4546        Books         science           0        0             0\n15       -0.4359          Men          shirts           0        0             0\n16       -0.4324  Electronics            None           0        1             1\n17       -0.4407      Jewelry     consignment           0        0             0\n18       -0.3436                       karoke           0        0             0\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017238,
                    "execution_time": 0.00724,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.003812
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.055913,
                    "execution_time": 0.007427,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.039055
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_2\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_2\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\""
            }
        ],
        "preview": "\n/*    gross_margin   i_category         i_class  t_category  t_class  lochierarchy\n0        -0.4411        Books         history           0        0             0\n1        -0.4324        Shoes            mens           0        0             0\n2        -0.4383       Sports          tennis           0        0             0\n3        -0.4380       Sports            None           0        1             1\n4        -0.4375        Books            None           0        1             1\n5        -0.4421         Home          tables           0        0             0\n6        -0.4254        Music            rock           0        0             0\n7        -0.4349        Women      fragrances           0        0             0\n8        -0.4284         Home        bathroom           0        0             0\n9        -0.4404      Jewelry   semi-precious           0        0             0\n10       -0.2115                    classical           0        0             0\n11       -0.4200     Children         newborn           0        0             0\n12       -0.4345      Jewelry      mens watch           0        0             0\n13       -0.4396  Electronics        scanners           0        0             0\n14       -0.4546        Books         science           0        0             0\n15       -0.4359          Men          shirts           0        0             0\n16       -0.4324  Electronics            None           0        1             1\n17       -0.4407      Jewelry     consignment           0        0             0\n18       -0.3436                       karoke           0        0             0\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category, NULL AS i_class, 1 as t_category, 0 as t_class, 2 as lochierarchy from results\n)\nselect * from results_rollup\norder by lochierarchy, i_category, i_class\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" NULLS LAST , \"RESULTS_ROLLUP\".\"I_CATEGORY\" NULLS LAST , \"RESULTS_ROLLUP\".\"I_CLASS\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" GROUP BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.102867,
                    "execution_time": 0.057747,
                    "compile_time": 0.000549,
                    "planning_time": 0.010938,
                    "create_size": 9
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.146205,
                    "execution_time": 0.057601,
                    "compile_time": 0.000514,
                    "planning_time": 0.052468,
                    "create_size": 9
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ORDER BY \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  t_category  t_class  lochierarchy\n0        -0.3964                                       0        0             0\n1        -0.5724                 accessories           0        0             0\n2        -0.1109                     archery           0        0             0\n3        -0.3503                    athletic           0        0             0\n4        -0.3865                  basketball           0        0             0\n5        -0.2680                      birdal           0        0             0\n6        -0.3904                   bracelets           0        0             0\n7        -0.3385                  camcorders           0        0             0\n8        -0.4788                     camping           0        0             0\n9        -0.2115                   classical           0        0             0\n10       -0.6571                     country           0        0             0\n11       -0.2092                      custom           0        0             0\n12       -0.5494                 disk drives           0        0             0\n13       -0.4126                     dresses           0        0             0\n14       -0.2827             dvd/vcr players           0        0             0\n15       -0.4831                     fitness           0        0             0\n16       -0.2297                    flatware           0        0             0\n17       -0.3310                  fragrances           0        0             0\n18       -0.6809                        guns           0        0             0\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018256,
                    "execution_time": 0.00789,
                    "compile_time": 7.4e-05,
                    "planning_time": 0.00422
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.057878,
                    "execution_time": 0.008538,
                    "compile_time": 7.7e-05,
                    "planning_time": 0.039674
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ORDER BY \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_3\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ORDER BY \"SPEQLITE_TEMP_TABLE_3\".\"LOCHIERARCHY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_3\".\"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  t_category  t_class  lochierarchy\n0        -0.3964                                       0        0             0\n1        -0.5724                 accessories           0        0             0\n2        -0.1109                     archery           0        0             0\n3        -0.3503                    athletic           0        0             0\n4        -0.3865                  basketball           0        0             0\n5        -0.2680                      birdal           0        0             0\n6        -0.3904                   bracelets           0        0             0\n7        -0.3385                  camcorders           0        0             0\n8        -0.4788                     camping           0        0             0\n9        -0.2115                   classical           0        0             0\n10       -0.6571                     country           0        0             0\n11       -0.2092                      custom           0        0             0\n12       -0.5494                 disk drives           0        0             0\n13       -0.4126                     dresses           0        0             0\n14       -0.2827             dvd/vcr players           0        0             0\n15       -0.4831                     fitness           0        0             0\n16       -0.2297                    flatware           0        0             0\n17       -0.3310                  fragrances           0        0             0\n18       -0.6809                        guns           0        0             0\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n/*CURSOR_IDENTIFIER*/ select * from results_rollup",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\" GROUP BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" UNION SELECT SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_NET_PROFIT\" ) / SUM ( \"SPEQLITE_TEMP_TABLE_1\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.10249,
                    "execution_time": 0.057714,
                    "compile_time": 0.000519,
                    "planning_time": 0.01085,
                    "create_size": 9
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.143797,
                    "execution_time": 0.057621,
                    "compile_time": 0.000525,
                    "planning_time": 0.052515,
                    "create_size": 9
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category          i_class  t_category  t_class  lochierarchy\n0        -0.4263        Women        maternity           0        0             0\n1        -0.4432      Jewelry           estate           0        0             0\n2        -0.4543        Books         business           0        0             0\n3        -0.4364        Books          mystery           0        0             0\n4        -0.4377       Sports           hockey           0        0             0\n5        -0.4184  Electronics  dvd/vcr players           0        0             0\n6        -0.4360     Children  school-uniforms           0        0             0\n7        -0.4289      Jewelry           custom           0        0             0\n8        -0.4123         Home        wallpaper           0        0             0\n9        -0.4532         Home          bedding           0        0             0\n10       -0.4183  Electronics            audio           0        0             0\n11       -0.6182                     self-help           0        0             0\n12       -0.4208      Jewelry           birdal           0        0             0\n13       -0.3904                     bracelets           0        0             0\n14       -0.4218          Men            pants           0        0             0\n15       -0.4328       Sports         baseball           0        0             0\n16       -0.4437      Jewelry          earings           0        0             0\n17       -0.4386       Sports          fishing           0        0             0\n18       -0.4335        Women             None           0        1             1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017131,
                    "execution_time": 0.007087,
                    "compile_time": 4.8e-05,
                    "planning_time": 0.003812
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.055001,
                    "execution_time": 0.007205,
                    "compile_time": 5.4e-05,
                    "planning_time": 0.039419
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    gross_margin   i_category          i_class  t_category  t_class  lochierarchy\n0        -0.4263        Women        maternity           0        0             0\n1        -0.4432      Jewelry           estate           0        0             0\n2        -0.4543        Books         business           0        0             0\n3        -0.4364        Books          mystery           0        0             0\n4        -0.4377       Sports           hockey           0        0             0\n5        -0.4184  Electronics  dvd/vcr players           0        0             0\n6        -0.4360     Children  school-uniforms           0        0             0\n7        -0.4289      Jewelry           custom           0        0             0\n8        -0.4123         Home        wallpaper           0        0             0\n9        -0.4532         Home          bedding           0        0             0\n10       -0.4183  Electronics            audio           0        0             0\n11       -0.6182                     self-help           0        0             0\n12       -0.4208      Jewelry           birdal           0        0             0\n13       -0.3904                     bracelets           0        0             0\n14       -0.4218          Men            pants           0        0             0\n15       -0.4328       Sports         baseball           0        0             0\n16       -0.4437      Jewelry          earings           0        0             0\n17       -0.4386       Sports          fishing           0        0             0\n18       -0.4335        Women             None           0        1             1\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select * from results_rollup\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"RESULTS_ROLLUP\".\"T_CLASS\" AS \"T_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category          i_class  t_category  t_class  lochierarchy\n0        -0.4263        Women        maternity           0        0             0\n1        -0.4432      Jewelry           estate           0        0             0\n2        -0.4543        Books         business           0        0             0\n3        -0.4364        Books          mystery           0        0             0\n4        -0.4377       Sports           hockey           0        0             0\n5        -0.4184  Electronics  dvd/vcr players           0        0             0\n6        -0.4360     Children  school-uniforms           0        0             0\n7        -0.4289      Jewelry           custom           0        0             0\n8        -0.4123         Home        wallpaper           0        0             0\n9        -0.4532         Home          bedding           0        0             0\n10       -0.4183  Electronics            audio           0        0             0\n11       -0.6182                     self-help           0        0             0\n12       -0.4208      Jewelry           birdal           0        0             0\n13       -0.3904                     bracelets           0        0             0\n14       -0.4218          Men            pants           0        0             0\n15       -0.4328       Sports         baseball           0        0             0\n16       -0.4437      Jewelry          earings           0        0             0\n17       -0.4386       Sports          fishing           0        0             0\n18       -0.4335        Women             None           0        1             1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017214,
                    "execution_time": 0.007148,
                    "compile_time": 4.6e-05,
                    "planning_time": 0.003858
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.018238,
                    "execution_time": 0.007844,
                    "compile_time": 5.1e-05,
                    "planning_time": 0.003976
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CATEGORY\" AS \"T_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" AS \"T_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    gross_margin   i_category          i_class  t_category  t_class  lochierarchy\n0        -0.4263        Women        maternity           0        0             0\n1        -0.4432      Jewelry           estate           0        0             0\n2        -0.4543        Books         business           0        0             0\n3        -0.4364        Books          mystery           0        0             0\n4        -0.4377       Sports           hockey           0        0             0\n5        -0.4184  Electronics  dvd/vcr players           0        0             0\n6        -0.4360     Children  school-uniforms           0        0             0\n7        -0.4289      Jewelry           custom           0        0             0\n8        -0.4123         Home        wallpaper           0        0             0\n9        -0.4532         Home          bedding           0        0             0\n10       -0.4183  Electronics            audio           0        0             0\n11       -0.6182                     self-help           0        0             0\n12       -0.4208      Jewelry           birdal           0        0             0\n13       -0.3904                     bracelets           0        0             0\n14       -0.4218          Men            pants           0        0             0\n15       -0.4328       Sports         baseball           0        0             0\n16       -0.4437      Jewelry          earings           0        0             0\n17       -0.4386       Sports          fishing           0        0             0\n18       -0.4335        Women             None           0        1             1\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over () as rank_value\n/*CURSOR_IDENTIFIER*/ from results_rollup order by lochierarchy, i_category, i_class",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" , \"I_CATEGORY\" , \"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.3964                                         0           1\n1        -0.5724                 accessories             0           1\n2        -0.1109                     archery             0           1\n3        -0.3503                    athletic             0           1\n4        -0.3865                  basketball             0           1\n5        -0.2680                      birdal             0           1\n6        -0.3904                   bracelets             0           1\n7        -0.3385                  camcorders             0           1\n8        -0.4788                     camping             0           1\n9        -0.2115                   classical             0           1\n10       -0.6571                     country             0           1\n11       -0.2092                      custom             0           1\n12       -0.5494                 disk drives             0           1\n13       -0.4126                     dresses             0           1\n14       -0.2827             dvd/vcr players             0           1\n15       -0.4831                     fitness             0           1\n16       -0.2297                    flatware             0           1\n17       -0.3310                  fragrances             0           1\n18       -0.6809                        guns             0           1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.021429,
                    "execution_time": 0.00958,
                    "compile_time": 9.7e-05,
                    "planning_time": 0.004454
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.060294,
                    "execution_time": 0.009974,
                    "compile_time": 9.4e-05,
                    "planning_time": 0.039843
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.3964                                         0           1\n1        -0.5724                 accessories             0           1\n2        -0.1109                     archery             0           1\n3        -0.3503                    athletic             0           1\n4        -0.3865                  basketball             0           1\n5        -0.2680                      birdal             0           1\n6        -0.3904                   bracelets             0           1\n7        -0.3385                  camcorders             0           1\n8        -0.4788                     camping             0           1\n9        -0.2115                   classical             0           1\n10       -0.6571                     country             0           1\n11       -0.2092                      custom             0           1\n12       -0.5494                 disk drives             0           1\n13       -0.4126                     dresses             0           1\n14       -0.2827             dvd/vcr players             0           1\n15       -0.4831                     fitness             0           1\n16       -0.2297                    flatware             0           1\n17       -0.3310                  fragrances             0           1\n18       -0.6809                        guns             0           1\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end) as rank_value\n/*CURSOR_IDENTIFIER*/ from results_rollup order by lochierarchy, i_category, i_class",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" , \"I_CATEGORY\" , \"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.3964                                         0           1\n1        -0.5724                 accessories             0           1\n2        -0.1109                     archery             0           1\n3        -0.3503                    athletic             0           1\n4        -0.3865                  basketball             0           1\n5        -0.2680                      birdal             0           1\n6        -0.3904                   bracelets             0           1\n7        -0.3385                  camcorders             0           1\n8        -0.4788                     camping             0           1\n9        -0.2115                   classical             0           1\n10       -0.6571                     country             0           1\n11       -0.2092                      custom             0           1\n12       -0.5494                 disk drives             0           1\n13       -0.4126                     dresses             0           1\n14       -0.2827             dvd/vcr players             0           1\n15       -0.4831                     fitness             0           1\n16       -0.2297                    flatware             0           1\n17       -0.3310                  fragrances             0           1\n18       -0.6809                        guns             0           1\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.023581,
                    "execution_time": 0.010372,
                    "compile_time": 0.000151,
                    "planning_time": 0.00513
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.061841,
                    "execution_time": 0.011316,
                    "compile_time": 0.000136,
                    "planning_time": 0.040598
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ) AS \"RANK_VALUE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_value\n0        -0.3964                                         0           1\n1        -0.5724                 accessories             0           1\n2        -0.1109                     archery             0           1\n3        -0.3503                    athletic             0           1\n4        -0.3865                  basketball             0           1\n5        -0.2680                      birdal             0           1\n6        -0.3904                   bracelets             0           1\n7        -0.3385                  camcorders             0           1\n8        -0.4788                     camping             0           1\n9        -0.2115                   classical             0           1\n10       -0.6571                     country             0           1\n11       -0.2092                      custom             0           1\n12       -0.5494                 disk drives             0           1\n13       -0.4126                     dresses             0           1\n14       -0.2827             dvd/vcr players             0           1\n15       -0.4831                     fitness             0           1\n16       -0.2297                    flatware             0           1\n17       -0.3310                  fragrances             0           1\n18       -0.6809                        guns             0           1\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category         i_class  lochierarchy  rank_within_parent\n0        -0.5056      Books                             0                   1\n1        -0.4546      Books         science             0                   2\n2        -0.4543      Books        business             0                   3\n3        -0.4538      Books         romance             0                   4\n4        -0.4446      Books       reference             0                   5\n5        -0.4411      Books         history             0                   6\n6        -0.4386      Books         fiction             0                   7\n7        -0.4373      Books         cooking             0                   8\n8        -0.4368      Books     home repair             0                   9\n9        -0.4364      Books         mystery             0                  10\n10       -0.4351      Books       computers             0                  11\n11       -0.4348      Books          travel             0                  12\n12       -0.4321      Books       self-help             0                  13\n13       -0.4315      Books  entertainments             0                  14\n14       -0.4311      Books       parenting             0                  15\n15       -0.4252      Books            arts             0                  16\n16       -0.4157      Books          sports             0                  17\n17       -0.4494    Jewelry        diamonds             0                   1\n18       -0.4444    Jewelry   jewelry boxes             0                   2\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.021783,
                    "execution_time": 0.009273,
                    "compile_time": 9.3e-05,
                    "planning_time": 0.004933
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.059487,
                    "execution_time": 0.009776,
                    "compile_time": 9.4e-05,
                    "planning_time": 0.040269
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    gross_margin i_category         i_class  lochierarchy  rank_within_parent\n0        -0.5056      Books                             0                   1\n1        -0.4546      Books         science             0                   2\n2        -0.4543      Books        business             0                   3\n3        -0.4538      Books         romance             0                   4\n4        -0.4446      Books       reference             0                   5\n5        -0.4411      Books         history             0                   6\n6        -0.4386      Books         fiction             0                   7\n7        -0.4373      Books         cooking             0                   8\n8        -0.4368      Books     home repair             0                   9\n9        -0.4364      Books         mystery             0                  10\n10       -0.4351      Books       computers             0                  11\n11       -0.4348      Books          travel             0                  12\n12       -0.4321      Books       self-help             0                  13\n13       -0.4315      Books  entertainments             0                  14\n14       -0.4311      Books       parenting             0                  15\n15       -0.4252      Books            arts             0                  16\n16       -0.4157      Books          sports             0                  17\n17       -0.4494    Jewelry        diamonds             0                   1\n18       -0.4444    Jewelry   jewelry boxes             0                   2\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by lochierarchy, i_category, i_class\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" , \"I_CATEGORY\" , \"I_CLASS\" LIMIT 21",
                "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_within_parent\n0        -0.3964                                         0                  21\n1        -0.5724                 accessories             0                   7\n2        -0.1109                     archery             0                  42\n3        -0.3503                    athletic             0                  26\n4        -0.3865                  basketball             0                  23\n5        -0.2680                      birdal             0                  33\n6        -0.3904                   bracelets             0                  22\n7        -0.3385                  camcorders             0                  28\n8        -0.4788                     camping             0                  15\n9        -0.2115                   classical             0                  37\n10       -0.6571                     country             0                   4\n11       -0.2092                      custom             0                  39\n12       -0.5494                 disk drives             0                   9\n13       -0.4126                     dresses             0                  20\n14       -0.2827             dvd/vcr players             0                  31\n15       -0.4831                     fitness             0                  14\n16       -0.2297                    flatware             0                  35\n17       -0.3310                  fragrances             0                  29\n18       -0.6809                        guns             0                   3\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.023862,
                    "execution_time": 0.010236,
                    "compile_time": 0.000126,
                    "planning_time": 0.005509
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.05966,
                    "execution_time": 0.010879,
                    "compile_time": 0.000147,
                    "planning_time": 0.040627
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" NULLS LAST , \"I_CATEGORY\" NULLS LAST , \"I_CLASS\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin i_category          i_class  lochierarchy  rank_within_parent\n0        -0.3964                                         0                  21\n1        -0.5724                 accessories             0                   7\n2        -0.1109                     archery             0                  42\n3        -0.3503                    athletic             0                  26\n4        -0.3865                  basketball             0                  23\n5        -0.2680                      birdal             0                  33\n6        -0.3904                   bracelets             0                  22\n7        -0.3385                  camcorders             0                  28\n8        -0.4788                     camping             0                  15\n9        -0.2115                   classical             0                  37\n10       -0.6571                     country             0                   4\n11       -0.2092                      custom             0                  39\n12       -0.5494                 disk drives             0                   9\n13       -0.4126                     dresses             0                  20\n14       -0.2827             dvd/vcr players             0                  31\n15       -0.4831                     fitness             0                  14\n16       -0.2297                    flatware             0                  35\n17       -0.3310                  fragrances             0                  29\n18       -0.6809                        guns             0                   3\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC LIMIT 21",
                "preview": "\n/*    gross_margin   i_category     i_class  lochierarchy  rank_within_parent\n0        -0.4336         None        None             2                   1\n1        -0.4375        Books        None             1                   2\n2        -0.4363        Shoes        None             1                   3\n3        -0.4335        Women        None             1                   4\n4        -0.4330        Music        None             1                   5\n5        -0.4328         Home        None             1                   6\n6        -0.4325      Jewelry        None             1                   7\n7        -0.4324  Electronics        None             1                   8\n8        -0.4314     Children        None             1                   9\n9        -0.4301          Men        None             1                  10\n10       -0.3948                     None             1                  11\n11       -0.4380       Sports        None             1                   1\n12       -0.4303        Women    swimwear             0                   3\n13       -0.4464         Home        kids             0                   2\n14       -0.4263        Women   maternity             0                   4\n15       -0.4444         Home        rugs             0                   3\n16       -0.3687        Women                         0                   5\n17       -0.4421         Home      tables             0                   4\n18       -0.4349        Women  fragrances             0                   2\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.02397,
                    "execution_time": 0.010769,
                    "compile_time": 0.000124,
                    "planning_time": 0.005215
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.059421,
                    "execution_time": 0.010624,
                    "compile_time": 0.000135,
                    "planning_time": 0.040452
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST"
            }
        ],
        "preview": "\n/*    gross_margin   i_category     i_class  lochierarchy  rank_within_parent\n0        -0.4336         None        None             2                   1\n1        -0.4375        Books        None             1                   2\n2        -0.4363        Shoes        None             1                   3\n3        -0.4335        Women        None             1                   4\n4        -0.4330        Music        None             1                   5\n5        -0.4328         Home        None             1                   6\n6        -0.4325      Jewelry        None             1                   7\n7        -0.4324  Electronics        None             1                   8\n8        -0.4314     Children        None             1                   9\n9        -0.4301          Men        None             1                  10\n10       -0.3948                     None             1                  11\n11       -0.4380       Sports        None             1                   1\n12       -0.4303        Women    swimwear             0                   3\n13       -0.4464         Home        kids             0                   2\n14       -0.4263        Women   maternity             0                   4\n15       -0.4444         Home        rugs             0                   3\n16       -0.3687        Women                         0                   5\n17       -0.4421         Home      tables             0                   4\n18       -0.4349        Women  fragrances             0                   2\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END LIMIT 21",
                "preview": "\n/*    gross_margin   i_category      i_class  lochierarchy  rank_within_parent\n0        -0.4336         None         None             2                   1\n1        -0.4375        Books         None             1                   2\n2        -0.4363        Shoes         None             1                   3\n3        -0.4335        Women         None             1                   4\n4        -0.4330        Music         None             1                   5\n5        -0.4328         Home         None             1                   6\n6        -0.4325      Jewelry         None             1                   7\n7        -0.4324  Electronics         None             1                   8\n8        -0.4314     Children         None             1                   9\n9        -0.4301          Men         None             1                  10\n10       -0.3948                      None             1                  11\n11       -0.4380       Sports         None             1                   1\n12       -0.7442                 reference             0                   2\n13       -0.6809                      guns             0                   3\n14       -0.6571                   country             0                   4\n15       -0.6394                   musical             0                   5\n16       -0.6182                 self-help             0                   6\n17       -0.5724               accessories             0                   7\n18       -0.5552                  portable             0                   8\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.023998,
                    "execution_time": 0.01021,
                    "compile_time": 0.000131,
                    "planning_time": 0.005476
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.061068,
                    "execution_time": 0.011146,
                    "compile_time": 0.000139,
                    "planning_time": 0.041373
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin   i_category      i_class  lochierarchy  rank_within_parent\n0        -0.4336         None         None             2                   1\n1        -0.4375        Books         None             1                   2\n2        -0.4363        Shoes         None             1                   3\n3        -0.4335        Women         None             1                   4\n4        -0.4330        Music         None             1                   5\n5        -0.4328         Home         None             1                   6\n6        -0.4325      Jewelry         None             1                   7\n7        -0.4324  Electronics         None             1                   8\n8        -0.4314     Children         None             1                   9\n9        -0.4301          Men         None             1                  10\n10       -0.3948                      None             1                  11\n11       -0.4380       Sports         None             1                   1\n12       -0.7442                 reference             0                   2\n13       -0.6809                      guns             0                   3\n14       -0.6571                   country             0                   4\n15       -0.6394                   musical             0                   5\n16       -0.6182                 self-help             0                   6\n17       -0.5724               accessories             0                   7\n18       -0.5552                  portable             0                   8\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n  ,rank_within_parent\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END , \"RANK_WITHIN_PARENT\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category      i_class  lochierarchy  rank_within_parent\n0        -0.4336         None         None             2                   1\n1        -0.4380       Sports         None             1                   1\n2        -0.4375        Books         None             1                   2\n3        -0.4363        Shoes         None             1                   3\n4        -0.4335        Women         None             1                   4\n5        -0.4330        Music         None             1                   5\n6        -0.4328         Home         None             1                   6\n7        -0.4325      Jewelry         None             1                   7\n8        -0.4324  Electronics         None             1                   8\n9        -0.4314     Children         None             1                   9\n10       -0.4301          Men         None             1                  10\n11       -0.3948                      None             1                  11\n12       -0.9472                      rugs             0                   1\n13       -0.7442                 reference             0                   2\n14       -0.6809                      guns             0                   3\n15       -0.6571                   country             0                   4\n16       -0.6394                   musical             0                   5\n17       -0.6182                 self-help             0                   6\n18       -0.5724               accessories             0                   7\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.025593,
                    "execution_time": 0.011103,
                    "compile_time": 0.00013,
                    "planning_time": 0.006239
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.060773,
                    "execution_time": 0.01058,
                    "compile_time": 0.000172,
                    "planning_time": 0.041603
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST"
            }
        ],
        "preview": "\n/*    gross_margin   i_category      i_class  lochierarchy  rank_within_parent\n0        -0.4336         None         None             2                   1\n1        -0.4380       Sports         None             1                   1\n2        -0.4375        Books         None             1                   2\n3        -0.4363        Shoes         None             1                   3\n4        -0.4335        Women         None             1                   4\n5        -0.4330        Music         None             1                   5\n6        -0.4328         Home         None             1                   6\n7        -0.4325      Jewelry         None             1                   7\n8        -0.4324  Electronics         None             1                   8\n9        -0.4314     Children         None             1                   9\n10       -0.4301          Men         None             1                  10\n11       -0.3948                      None             1                  11\n12       -0.9472                      rugs             0                   1\n13       -0.7442                 reference             0                   2\n14       -0.6809                      guns             0                   3\n15       -0.6571                   country             0                   4\n16       -0.6394                   musical             0                   5\n17       -0.6182                 self-help             0                   6\n18       -0.5724               accessories             0                   7\n...*/"
    },
    {
        "input": "-- start template query36a.tpl query 21 in stream 0\nwith /* TPC-DS query36a.tpl 0.21 */ results as\n (select \n    sum(ss_net_profit) as ss_net_profit, sum(ss_ext_sales_price) as ss_ext_sales_price,\n    sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin\n   ,i_category\n   ,i_class\n   ,0 as g_category, 0 as g_class\n from\n    store_sales\n   ,date_dim       d1\n   ,item\n   ,store\n where\n    d1.d_year = 2002 \n    and d1.d_date_sk = ss_sold_date_sk\n    and i_item_sk  = ss_item_sk \n    and s_store_sk  = ss_store_sk\n    and s_state in ('MN','TN','MI','WV',\n                 'NC','GA','TN','OH')\n group by i_category,i_class)\n ,\n results_rollup as\n (select gross_margin ,i_category ,i_class,0 as t_category, 0 as t_class, 0 as lochierarchy from results\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   i_category, NULL AS i_class, 0 as t_category, 1 as t_class, 1 as lochierarchy from results group by i_category\n union\n select sum(ss_net_profit)/sum(ss_ext_sales_price) as gross_margin,\n   NULL AS i_category ,NULL AS i_class, 1 as t_category, 1 as t_class, 2 as lochierarchy from results)\n  select \n  gross_margin ,i_category ,i_class, lochierarchy,rank() over (\n \tpartition by lochierarchy, case when t_class = 0 then i_category end \n \torder by gross_margin asc) as rank_within_parent\n from results_rollup\n order by\n   lochierarchy desc\n  ,case when lochierarchy = 0 then i_category end\n  ,rank_within_parent\n  limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"RESULTS\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) AS \"SS_NET_PROFIT\" , SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"SS_EXT_SALES_PRICE\" , SUM ( \"STORE_SALES\".\"SS_NET_PROFIT\" ) / SUM ( \"STORE_SALES\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" AS \"I_CLASS\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" = 2002 JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STATE\" IN ( 'MN' , 'TN' , 'MI' , 'WV' , 'NC' , 'GA' , 'TN' , 'OH' ) AND \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_CLASS\" ) , \"RESULTS_ROLLUP\" AS ( SELECT \"RESULTS\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS\".\"I_CLASS\" AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 0 AS \"T_CLASS\" , 0 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , \"RESULTS\".\"I_CATEGORY\" AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 0 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 1 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" GROUP BY \"RESULTS\".\"I_CATEGORY\" UNION SELECT SUM ( \"RESULTS\".\"SS_NET_PROFIT\" ) / SUM ( \"RESULTS\".\"SS_EXT_SALES_PRICE\" ) AS \"GROSS_MARGIN\" , NULL AS \"I_CATEGORY\" , NULL AS \"I_CLASS\" , 1 AS \"T_CATEGORY\" , 1 AS \"T_CLASS\" , 2 AS \"LOCHIERARCHY\" FROM \"RESULTS\" AS \"RESULTS\" ) SELECT \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"RESULTS_ROLLUP\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"RESULTS_ROLLUP\".\"I_CLASS\" AS \"I_CLASS\" , \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"RESULTS_ROLLUP\".\"LOCHIERARCHY\" , CASE WHEN \"RESULTS_ROLLUP\".\"T_CLASS\" = 0 THEN \"RESULTS_ROLLUP\".\"I_CATEGORY\" END ORDER BY \"RESULTS_ROLLUP\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"RESULTS_ROLLUP\" AS \"RESULTS_ROLLUP\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END , \"RANK_WITHIN_PARENT\" LIMIT 21",
                "preview": "\n/*    gross_margin   i_category      i_class  lochierarchy  rank_within_parent\n0        -0.4336         None         None             2                   1\n1        -0.4380       Sports         None             1                   1\n2        -0.4375        Books         None             1                   2\n3        -0.4363        Shoes         None             1                   3\n4        -0.4335        Women         None             1                   4\n5        -0.4330        Music         None             1                   5\n6        -0.4328         Home         None             1                   6\n7        -0.4325      Jewelry         None             1                   7\n8        -0.4324  Electronics         None             1                   8\n9        -0.4314     Children         None             1                   9\n10       -0.4301          Men         None             1                  10\n11       -0.3948                      None             1                  11\n12       -0.9472                      rugs             0                   1\n13       -0.7442                 reference             0                   2\n14       -0.6809                      guns             0                   3\n15       -0.6571                   country             0                   4\n16       -0.6394                   musical             0                   5\n17       -0.6182                 self-help             0                   6\n18       -0.5724               accessories             0                   7\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.025687,
                    "execution_time": 0.010603,
                    "compile_time": 0.000145,
                    "planning_time": 0.006295
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.026379,
                    "execution_time": 0.011475,
                    "compile_time": 0.000135,
                    "planning_time": 0.006315
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" AS \"GROSS_MARGIN\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_4\".\"I_CLASS\" AS \"I_CLASS\" , \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" AS \"LOCHIERARCHY\" , RANK ( ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_4\".\"LOCHIERARCHY\" , CASE WHEN \"SPEQLITE_TEMP_TABLE_4\".\"T_CLASS\" = 0 THEN \"SPEQLITE_TEMP_TABLE_4\".\"I_CATEGORY\" END ORDER BY \"SPEQLITE_TEMP_TABLE_4\".\"GROSS_MARGIN\" NULLS LAST ) AS \"RANK_WITHIN_PARENT\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ORDER BY \"LOCHIERARCHY\" DESC NULLS FIRST , CASE WHEN \"LOCHIERARCHY\" = 0 THEN \"I_CATEGORY\" END NULLS LAST , \"RANK_WITHIN_PARENT\" NULLS LAST LIMIT 100"
            }
        ],
        "preview": "\n/*    gross_margin   i_category      i_class  lochierarchy  rank_within_parent\n0        -0.4336         None         None             2                   1\n1        -0.4380       Sports         None             1                   1\n2        -0.4375        Books         None             1                   2\n3        -0.4363        Shoes         None             1                   3\n4        -0.4335        Women         None             1                   4\n5        -0.4330        Music         None             1                   5\n6        -0.4328         Home         None             1                   6\n7        -0.4325      Jewelry         None             1                   7\n8        -0.4324  Electronics         None             1                   8\n9        -0.4314     Children         None             1                   9\n10       -0.4301          Men         None             1                  10\n11       -0.3948                      None             1                  11\n12       -0.9472                      rugs             0                   1\n13       -0.7442                 reference             0                   2\n14       -0.6809                      guns             0                   3\n15       -0.6571                   country             0                   4\n16       -0.6394                   musical             0                   5\n17       -0.6182                 self-help             0                   6\n18       -0.5724               accessories             0                   7\n...*/"
    }
]