[
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) AS inter \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) AS sales_data \nGROUP BY channel, i_brand_id, i_class_id, i_category_id\n/*CURSOR_IDENTIFIER*/;",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"INTER\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"INTER\" AS \"INTER\" ON \"INTER\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"INTER\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"INTER\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"SALES_DATA\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"SALES_DATA\".\"CHANNEL\" AS \"CHANNEL\" , \"SALES_DATA\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SALES_DATA\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SALES_DATA\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SALES_DATA\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SALES_DATA\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SALES_DATA\" AS \"SALES_DATA\" GROUP BY \"SALES_DATA\".\"CHANNEL\" , \"SALES_DATA\".\"I_BRAND_ID\" , \"SALES_DATA\".\"I_CLASS_ID\" , \"SALES_DATA\".\"I_CATEGORY_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.252853,
                    "execution_time": 0.0487,
                    "compile_time": 0.089955,
                    "planning_time": 0.020876,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.25581,
                    "execution_time": 2.991559,
                    "compile_time": 3.141636,
                    "planning_time": 0.022126,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.133124,
                    "execution_time": 0.03347,
                    "compile_time": 0.054601,
                    "planning_time": 0.022913,
                    "create_size": 20
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.319491,
                    "execution_time": 0.032759,
                    "compile_time": 3.17885,
                    "planning_time": 0.081457,
                    "create_size": 20
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.855171,
                    "execution_time": 1.561278,
                    "compile_time": 0.061166,
                    "planning_time": 0.043104,
                    "create_size": 768
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 12.723404,
                    "execution_time": 7.384075,
                    "compile_time": 6.200877,
                    "planning_time": 0.142394,
                    "create_size": 768
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT AVG ( \"SPEQLITE_TEMP_TABLE_3\".\"QUANTITY\" * \"SPEQLITE_TEMP_TABLE_3\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.137542,
                    "execution_time": 0.0562,
                    "compile_time": 0.053615,
                    "planning_time": 0.003215,
                    "create_size": 4
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 5.951956,
                    "execution_time": 0.246342,
                    "compile_time": 5.757409,
                    "planning_time": 0.059882,
                    "create_size": 4
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"SPEQLITE_TEMP_TABLE_4\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.076272,
                    "execution_time": 0.035039,
                    "compile_time": 0.015885,
                    "planning_time": 0.002532,
                    "create_size": 4
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 2.956482,
                    "execution_time": 0.036584,
                    "compile_time": 2.839788,
                    "planning_time": 0.055809,
                    "create_size": 4
                }
            }
        ],
        "query": [
            {
                "query": "WITH CROSS_ITEMS AS ( SELECT I_ITEM_SK AS SS_ITEM_SK FROM ITEM , ( SELECT ISS.I_BRAND_ID AS BRAND_ID , ISS.I_CLASS_ID AS CLASS_ID , ISS.I_CATEGORY_ID AS CATEGORY_ID FROM STORE_SALES , ITEM AS ISS , DATE_DIM AS D1 WHERE SS_ITEM_SK = ISS.I_ITEM_SK AND SS_SOLD_DATE_SK = D1.D_DATE_SK AND D1.D_YEAR BETWEEN 1999 AND 1999 + 2 INTERSECT SELECT ICS.I_BRAND_ID , ICS.I_CLASS_ID , ICS.I_CATEGORY_ID FROM CATALOG_SALES , ITEM AS ICS , DATE_DIM AS D2 WHERE CS_ITEM_SK = ICS.I_ITEM_SK AND CS_SOLD_DATE_SK = D2.D_DATE_SK AND D2.D_YEAR BETWEEN 1999 AND 1999 + 2 INTERSECT SELECT IWS.I_BRAND_ID , IWS.I_CLASS_ID , IWS.I_CATEGORY_ID FROM WEB_SALES , ITEM AS IWS , DATE_DIM AS D3 WHERE WS_ITEM_SK = IWS.I_ITEM_SK AND WS_SOLD_DATE_SK = D3.D_DATE_SK AND D3.D_YEAR BETWEEN 1999 AND 1999 + 2 ) AS INTER WHERE I_BRAND_ID = BRAND_ID AND I_CLASS_ID = CLASS_ID AND I_CATEGORY_ID = CATEGORY_ID ) , AVG_SALES AS ( SELECT AVG ( QUANTITY * LIST_PRICE ) AS AVERAGE_SALES FROM ( SELECT SS_QUANTITY AS QUANTITY , SS_LIST_PRICE AS LIST_PRICE FROM STORE_SALES , DATE_DIM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR BETWEEN 1999 AND 1999 + 2 UNION ALL SELECT CS_QUANTITY AS QUANTITY , CS_LIST_PRICE AS LIST_PRICE FROM CATALOG_SALES , DATE_DIM WHERE CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR BETWEEN 1999 AND 1999 + 2 UNION ALL SELECT WS_QUANTITY AS QUANTITY , WS_LIST_PRICE AS LIST_PRICE FROM WEB_SALES , DATE_DIM WHERE WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR BETWEEN 1999 AND 1999 + 2 ) AS X ) SELECT CHANNEL , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , SUM ( SALES ) , SUM ( NUMBER_SALES ) FROM ( SELECT 'store' AS CHANNEL , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , SUM ( SS_QUANTITY * SS_LIST_PRICE ) AS SALES , COUNT ( * ) AS NUMBER_SALES FROM STORE_SALES , ITEM , DATE_DIM WHERE SS_ITEM_SK IN ( SELECT SS_ITEM_SK FROM CROSS_ITEMS ) AND SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 + 2 AND D_MOY = 11 GROUP BY I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID HAVING SUM ( SS_QUANTITY * SS_LIST_PRICE ) > ( SELECT AVERAGE_SALES FROM AVG_SALES ) UNION ALL SELECT 'catalog' AS CHANNEL , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES , COUNT ( * ) AS NUMBER_SALES FROM CATALOG_SALES , ITEM , DATE_DIM WHERE CS_ITEM_SK IN ( SELECT SS_ITEM_SK FROM CROSS_ITEMS ) AND CS_ITEM_SK = I_ITEM_SK AND CS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 + 2 AND D_MOY = 11 GROUP BY I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID HAVING SUM ( CS_QUANTITY * CS_LIST_PRICE ) > ( SELECT AVERAGE_SALES FROM AVG_SALES ) UNION ALL SELECT 'web' AS CHANNEL , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES , COUNT ( * ) AS NUMBER_SALES FROM WEB_SALES , ITEM , DATE_DIM WHERE WS_ITEM_SK IN ( SELECT SS_ITEM_SK FROM CROSS_ITEMS ) AND WS_ITEM_SK = I_ITEM_SK AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1999 + 2 AND D_MOY = 11 GROUP BY I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID HAVING SUM ( WS_QUANTITY * WS_LIST_PRICE ) > ( SELECT AVERAGE_SALES FROM AVG_SALES ) ) AS SALES_DATA GROUP BY CHANNEL , I_BRAND_ID , I_CLASS_ID , I_CATEGORY_ID LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) \nGROUP BY channel, i_brand_id, i_class_id, i_category_id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"_Q_1\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.514081,
                    "execution_time": 0.391942,
                    "compile_time": 0.000697,
                    "planning_time": 0.075146,
                    "create_size": 96
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.806099,
                    "execution_time": 0.390094,
                    "compile_time": 0.167007,
                    "planning_time": 0.200005,
                    "create_size": 96
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" ON \"SPEQLITE_TEMP_TABLE_6\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_6\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_6\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.165008,
                    "execution_time": 0.064567,
                    "compile_time": 0.05466,
                    "planning_time": 0.005564,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.610752,
                    "execution_time": 0.065441,
                    "compile_time": 6.43892,
                    "planning_time": 0.060636,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.106095,
                    "execution_time": 0.031479,
                    "compile_time": 0.030006,
                    "planning_time": 0.022599,
                    "create_size": 6
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.224577,
                    "execution_time": 0.031303,
                    "compile_time": 3.086107,
                    "planning_time": 0.082211,
                    "create_size": 6
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH _Q_1 AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0    store    10006013           6             10    868945.66     214\n1    store     3002002           2              3  44542436.68   12013\n2    store     2001001           1              7   1452533.84     401\n3    store     1004001           4              6    884173.48     259\n4    store     1003001           9              6    115532.42      30\n5    store    10010016           3             10     50147.96      15\n6    store     9008010           8              9    699142.99     173\n7    store     7005004           5              7   1584453.12     427\n8    store     7007004           7              7   2133682.47     554\n9    store     3003002           4              3   1976593.03     548\n10   store     5002001           2              9   1842723.32     456\n11   store     9004011           4              2    188892.43      52\n12   store     7013006          10              7    117840.69      31\n13   store     8005004           5              8   1690832.17     455\n14   store     8003010           3              8   2560465.37     718\n15   store    10012001          12             10   1069111.56     270\n16   store     2002001           2             10   1371188.91     410\n17   store     4001002           2              4   2415366.68     681\n18   store     4004002          16              4    511464.17     148\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.387414,
                    "execution_time": 0.260884,
                    "compile_time": 0.000957,
                    "planning_time": 0.087038
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.560129,
                    "execution_time": 0.271242,
                    "compile_time": 0.101247,
                    "planning_time": 0.156603
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH _Q_1 AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\"",
                "rewrite": "WITH _Q_1 AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0    store    10006013           6             10    868945.66     214\n1    store     3002002           2              3  44542436.68   12013\n2    store     2001001           1              7   1452533.84     401\n3    store     1004001           4              6    884173.48     259\n4    store     1003001           9              6    115532.42      30\n5    store    10010016           3             10     50147.96      15\n6    store     9008010           8              9    699142.99     173\n7    store     7005004           5              7   1584453.12     427\n8    store     7007004           7              7   2133682.47     554\n9    store     3003002           4              3   1976593.03     548\n10   store     5002001           2              9   1842723.32     456\n11   store     9004011           4              2    188892.43      52\n12   store     7013006          10              7    117840.69      31\n13   store     8005004           5              8   1690832.17     455\n14   store     8003010           3              8   2560465.37     718\n15   store    10012001          12             10   1069111.56     270\n16   store     2002001           2             10   1371188.91     410\n17   store     4001002           2              4   2415366.68     681\n18   store     4004002          16              4    511464.17     148\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) \nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id \nORDER BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"_Q_1\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.463036,
                    "execution_time": 0.234092,
                    "compile_time": 0.046989,
                    "planning_time": 0.084441,
                    "create_size": 396
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.679892,
                    "execution_time": 0.250334,
                    "compile_time": 3.250974,
                    "planning_time": 0.080775,
                    "create_size": 432
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_10\" AS SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.204743,
                    "execution_time": 0.068129,
                    "compile_time": 0.055401,
                    "planning_time": 0.004632,
                    "create_size": 423
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.596104,
                    "execution_time": 0.069517,
                    "compile_time": 3.3877,
                    "planning_time": 0.059032,
                    "create_size": 405
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_10\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" ORDER BY \"CHANNEL\" , \"I_BRAND_ID\" , \"I_CLASS_ID\" , \"I_CATEGORY_ID\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0   catalog     1001001           1              1   981145.38     214\n1   catalog     1001001           1              2  1183046.87     211\n2   catalog     1001001           1              3  1026091.56     224\n3   catalog     1001001           1              4  1600580.52     317\n4   catalog     1001001           1              5   899958.49     192\n5   catalog     1001001           1              6   866063.53     171\n6   catalog     1001001           1              7  1091626.52     227\n7   catalog     1001001           1              8  1069083.86     207\n8   catalog     1001001           1              9   759494.39     150\n9   catalog     1001001           1             10  1280189.70     237\n10  catalog     1001001           2              1   284397.15      52\n11  catalog     1001001           2              2   362192.03      62\n12  catalog     1001001           2              3   111970.19      19\n13  catalog     1001001           2              4   121900.82      25\n14  catalog     1001001           2              5   138685.75      30\n15  catalog     1001001           2              6    52649.76      10\n16  catalog     1001001           2              7    26118.28       9\n17  catalog     1001001           2              8    71002.77      13\n18  catalog     1001001           2             10    96746.59      22\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.034653,
                    "execution_time": 0.01012,
                    "compile_time": 0.014677,
                    "planning_time": 0.003979
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.261193,
                    "execution_time": 0.011035,
                    "compile_time": 3.209042,
                    "planning_time": 0.041165
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_10\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_10\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST"
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0   catalog     1001001           1              1   981145.38     214\n1   catalog     1001001           1              2  1183046.87     211\n2   catalog     1001001           1              3  1026091.56     224\n3   catalog     1001001           1              4  1600580.52     317\n4   catalog     1001001           1              5   899958.49     192\n5   catalog     1001001           1              6   866063.53     171\n6   catalog     1001001           1              7  1091626.52     227\n7   catalog     1001001           1              8  1069083.86     207\n8   catalog     1001001           1              9   759494.39     150\n9   catalog     1001001           1             10  1280189.70     237\n10  catalog     1001001           2              1   284397.15      52\n11  catalog     1001001           2              2   362192.03      62\n12  catalog     1001001           2              3   111970.19      19\n13  catalog     1001001           2              4   121900.82      25\n14  catalog     1001001           2              5   138685.75      30\n15  catalog     1001001           2              6    52649.76      10\n16  catalog     1001001           2              7    26118.28       9\n17  catalog     1001001           2              8    71002.77      13\n18  catalog     1001001           2             10    96746.59      22\n...*/"
    },
    {
        "input": "WITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) final\n/*CURSOR_IDENTIFIER*/\nGROUP  BY channel, \n          i_brand_id, \n          i_class_id, \n          i_category_id;",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"FINAL\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"FINAL\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"FINAL\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"FINAL\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"FINAL\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"FINAL\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"FINAL\" AS \"FINAL\" GROUP BY \"FINAL\".\"CHANNEL\" , \"FINAL\".\"I_BRAND_ID\" , \"FINAL\".\"I_CLASS_ID\" , \"FINAL\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"CHANNEL\" AS \"CHANNEL\" , \"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_COL_4\" AS \"_COL_4\" , \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id    _col_4  _col_5\n0      web     6005005           3              4   7343.76       6\n1      web     7016005          14              9  40175.24       5\n2      web     8011010           2              8  37500.27       7\n3      web     8016005           1              5  41619.32       6\n4      web     7013009           3              8  45179.03       6\n5      web     8014009          14              8  10030.69       3\n6      web     8011007           2             10  27118.87       3\n7      web     3003001          11             10  15700.54       1\n8      web     7002003           2              5  51419.55      11\n9      web    10014013          12              9   4961.15       3\n10     web     6010005           3              3  28466.36       4\n11     web     8006007           5              6  24542.80       6\n12     web    10008013           8              8  26954.94       3\n13     web     7009007           7             10  18811.68       4\n14     web     5003001           9              8  26077.30       6\n15     web     6011007          11              3  38583.48       6\n16     web     8012007           1              2  31745.19       6\n17     web     8003009           3              9  20060.20       3\n18     web     8001007           5              8  26194.25       4\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.083665,
                    "execution_time": 0.00825,
                    "compile_time": 0.065881,
                    "planning_time": 0.003551
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.093944,
                    "execution_time": 0.00765,
                    "compile_time": 3.039907,
                    "planning_time": 0.038737
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"CHANNEL\" AS \"CHANNEL\", \"I_BRAND_ID\" AS \"I_BRAND_ID\", \"I_CLASS_ID\" AS \"I_CLASS_ID\", \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\", \"_COL_4\" AS \"_COL_4\", \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id    _col_4  _col_5\n0      web     6005005           3              4   7343.76       6\n1      web     7016005          14              9  40175.24       5\n2      web     8011010           2              8  37500.27       7\n3      web     8016005           1              5  41619.32       6\n4      web     7013009           3              8  45179.03       6\n5      web     8014009          14              8  10030.69       3\n6      web     8011007           2             10  27118.87       3\n7      web     3003001          11             10  15700.54       1\n8      web     7002003           2              5  51419.55      11\n9      web    10014013          12              9   4961.15       3\n10     web     6010005           3              3  28466.36       4\n11     web     8006007           5              6  24542.80       6\n12     web    10008013           8              8  26954.94       3\n13     web     7009007           7             10  18811.68       4\n14     web     5003001           9              8  26077.30       6\n15     web     6011007          11              3  38583.48       6\n16     web     8012007           1              2  31745.19       6\n17     web     8003009           3              9  20060.20       3\n18     web     8001007           5              8  26194.25       4\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) ) AS final_result\nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id; \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"FINAL_RESULT\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"FINAL_RESULT\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_RESULT\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"FINAL_RESULT\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"FINAL_RESULT\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"FINAL_RESULT\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"FINAL_RESULT\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"FINAL_RESULT\" AS \"FINAL_RESULT\" GROUP BY \"FINAL_RESULT\".\"CHANNEL\" , \"FINAL_RESULT\".\"I_BRAND_ID\" , \"FINAL_RESULT\".\"I_CLASS_ID\" , \"FINAL_RESULT\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"CHANNEL\" AS \"CHANNEL\" , \"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_COL_4\" AS \"_COL_4\" , \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0    store     7002006          11              7    81933.21      16\n1    store     7010005          16              8    96517.42      21\n2    store    10009016           9              3    42621.27      19\n3    store     4001001           9              9   106507.81      27\n4    store     1003001           2              3   212553.80      53\n5    store    10011013          11              9   273074.23      88\n6    store    10001017           4              2    57817.36      20\n7    store    10007011           7             10   727821.90     217\n8    store    10004010           4              3    60969.55      13\n9    store     8006003           6              6    44453.50      11\n10   store     8001009           2              1   113041.79      41\n11   store     7001001           9              6    55747.20      16\n12   store    10002016           2              5    93567.21      21\n13   store     6006006          13              6   153205.98      25\n14   store     4002001           5              7    69345.12      15\n15   store     6007004           7              6  2284056.85     641\n16   store     9005010           2              9   124278.25      33\n17   store     7009006          11              7   123329.94      31\n18   store     6013002           4              6    30232.47      11\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017625,
                    "execution_time": 0.008304,
                    "compile_time": 4.5e-05,
                    "planning_time": 0.003425
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.017452,
                    "execution_time": 0.007628,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.003666
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"CHANNEL\" AS \"CHANNEL\", \"I_BRAND_ID\" AS \"I_BRAND_ID\", \"I_CLASS_ID\" AS \"I_CLASS_ID\", \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\", \"_COL_4\" AS \"_COL_4\", \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0    store     7002006          11              7    81933.21      16\n1    store     7010005          16              8    96517.42      21\n2    store    10009016           9              3    42621.27      19\n3    store     4001001           9              9   106507.81      27\n4    store     1003001           2              3   212553.80      53\n5    store    10011013          11              9   273074.23      88\n6    store    10001017           4              2    57817.36      20\n7    store    10007011           7             10   727821.90     217\n8    store    10004010           4              3    60969.55      13\n9    store     8006003           6              6    44453.50      11\n10   store     8001009           2              1   113041.79      41\n11   store     7001001           9              6    55747.20      16\n12   store    10002016           2              5    93567.21      21\n13   store     6006006          13              6   153205.98      25\n14   store     4002001           5              7    69345.12      15\n15   store     6007004           7              6  2284056.85     641\n16   store     9005010           2              9   124278.25      33\n17   store     7009006          11              7   123329.94      31\n18   store     6013002           4              6    30232.47      11\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales) AS total_sales, \n               Sum(number_sales) AS total_number_sales \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) a\nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"A\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"A\".\"CHANNEL\" AS \"CHANNEL\" , \"A\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"A\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"A\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"A\".\"SALES\" ) AS \"TOTAL_SALES\" , SUM ( \"A\".\"NUMBER_SALES\" ) AS \"TOTAL_NUMBER_SALES\" FROM \"A\" AS \"A\" GROUP BY \"A\".\"CHANNEL\" , \"A\".\"I_BRAND_ID\" , \"A\".\"I_CLASS_ID\" , \"A\".\"I_CATEGORY_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_11\" AS SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"TOTAL_SALES\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"TOTAL_NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.136509,
                    "execution_time": 0.055312,
                    "compile_time": 0.000288,
                    "planning_time": 0.004711,
                    "create_size": 423
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.402278,
                    "execution_time": 0.054468,
                    "compile_time": 0.209818,
                    "planning_time": 0.060722,
                    "create_size": 405
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_11\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"TOTAL_SALES\" AS \"TOTAL_SALES\" , \"SPEQLITE_TEMP_TABLE_11\".\"TOTAL_NUMBER_SALES\" AS \"TOTAL_NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_11\" AS \"SPEQLITE_TEMP_TABLE_11\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id  total_sales  total_number_sales\n0      web     7004003           3              5      7297.00                   3\n1      web     6010007          10              9     64448.45                  12\n2      web     6002008           4              6     63142.24                   8\n3      web     9012006           8              9     34490.61                   4\n4      web     6008005          14              8     41961.78                   5\n5      web     8010009           4              2     33551.33                   7\n6      web     7014005           2              1     12344.76                   2\n7      web     7013001          12              7     25548.30                   5\n8      web     1004001           5              7     45007.53                   6\n9      web     8013002           5              8     43355.77                   4\n10     web     1002001          13              8     37988.37                  10\n11     web     7005003           4              3     20117.38                   3\n12     web     7015007          15             10      7812.93                   2\n13     web     4003001          10             10     13240.16                   5\n14     web     6003002          16              6     57175.38                   7\n15     web     9004009           1              5     25053.52                   5\n16     web     3002001           1              2     24546.98                   4\n17     web     7012001          15             10     13800.04                   5\n18     web     8011009           6              6     12439.49                   2\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.016763,
                    "execution_time": 0.007405,
                    "compile_time": 4.4e-05,
                    "planning_time": 0.003534
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.162168,
                    "execution_time": 0.007715,
                    "compile_time": 0.109621,
                    "planning_time": 0.038658
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"TOTAL_SALES\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"TOTAL_NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_11\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_11\".\"TOTAL_SALES\" AS \"TOTAL_SALES\" , \"SPEQLITE_TEMP_TABLE_11\".\"TOTAL_NUMBER_SALES\" AS \"TOTAL_NUMBER_SALES\" FROM \"SPEQLITE_TEMP_TABLE_11\" AS \"SPEQLITE_TEMP_TABLE_11\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id  total_sales  total_number_sales\n0      web     7004003           3              5      7297.00                   3\n1      web     6010007          10              9     64448.45                  12\n2      web     6002008           4              6     63142.24                   8\n3      web     9012006           8              9     34490.61                   4\n4      web     6008005          14              8     41961.78                   5\n5      web     8010009           4              2     33551.33                   7\n6      web     7014005           2              1     12344.76                   2\n7      web     7013001          12              7     25548.30                   5\n8      web     1004001           5              7     45007.53                   6\n9      web     8013002           5              8     43355.77                   4\n10     web     1002001          13              8     37988.37                  10\n11     web     7005003           4              3     20117.38                   3\n12     web     7015007          15             10      7812.93                   2\n13     web     4003001          10             10     13240.16                   5\n14     web     6003002          16              6     57175.38                   7\n15     web     9004009           1              5     25053.52                   5\n16     web     3002001           1              2     24546.98                   4\n17     web     7012001          15             10     13800.04                   5\n18     web     8011009           6              6     12439.49                   2\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2\n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)\n     ) final_sales\nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"FINAL_SALES\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"FINAL_SALES\".\"CHANNEL\" AS \"CHANNEL\" , \"FINAL_SALES\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"FINAL_SALES\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"FINAL_SALES\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"FINAL_SALES\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"FINAL_SALES\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"FINAL_SALES\" AS \"FINAL_SALES\" GROUP BY \"FINAL_SALES\".\"CHANNEL\" , \"FINAL_SALES\".\"I_BRAND_ID\" , \"FINAL_SALES\".\"I_CLASS_ID\" , \"FINAL_SALES\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"CHANNEL\" AS \"CHANNEL\" , \"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_COL_4\" AS \"_COL_4\" , \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0       web     9006012           2              9    33183.42       7\n1       web     2001001          16              7    30410.54       7\n2       web     8015006           1              8    68808.69      14\n3       web    10006001           6              2    13996.73       5\n4       web     6005001           9              6    34171.07       3\n5       web     9006011           6              8    65567.94       9\n6       web     7006009           2              3    41535.45       8\n7       web     8010004           1              8    56277.12      13\n8       web     6015007           5             10     9526.70       2\n9       web     9016010           7              9    13518.42       3\n10      web    10002014           3              1    18262.04       6\n11      web    10003016           3              2    23236.92       8\n12      web     3004001           1              1    96509.69      27\n13      web     7002009           5              8    23154.06       3\n14  catalog    10016006          16              7    55447.03      15\n15  catalog     7002008           2              7  1840412.22     349\n16  catalog     1004002           3              1  1764265.33     348\n17  catalog     1001001          16              8    72424.91      12\n18      web    10010014          12             10    32938.42       8\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.016798,
                    "execution_time": 0.007566,
                    "compile_time": 4.4e-05,
                    "planning_time": 0.003484
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.017784,
                    "execution_time": 0.007979,
                    "compile_time": 4.5e-05,
                    "planning_time": 0.003674
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"CHANNEL\" AS \"CHANNEL\", \"I_BRAND_ID\" AS \"I_BRAND_ID\", \"I_CLASS_ID\" AS \"I_CLASS_ID\", \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\", \"_COL_4\" AS \"_COL_4\", \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0       web     9006012           2              9    33183.42       7\n1       web     2001001          16              7    30410.54       7\n2       web     8015006           1              8    68808.69      14\n3       web    10006001           6              2    13996.73       5\n4       web     6005001           9              6    34171.07       3\n5       web     9006011           6              8    65567.94       9\n6       web     7006009           2              3    41535.45       8\n7       web     8010004           1              8    56277.12      13\n8       web     6015007           5             10     9526.70       2\n9       web     9016010           7              9    13518.42       3\n10      web    10002014           3              1    18262.04       6\n11      web    10003016           3              2    23236.92       8\n12      web     3004001           1              1    96509.69      27\n13      web     7002009           5              8    23154.06       3\n14  catalog    10016006          16              7    55447.03      15\n15  catalog     7002008           2              7  1840412.22     349\n16  catalog     1004002           3              1  1764265.33     348\n17  catalog     1001001          16              8    72424.91      12\n18      web    10010014          12             10    32938.42       8\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n       i_brand_id, \n       i_class_id, \n       i_category_id, \n       Sum(sales), \n       Sum(number_sales) \nFROM   (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) a \nGROUP  BY channel, i_brand_id, i_class_id, i_category_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"A\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"A\".\"CHANNEL\" AS \"CHANNEL\" , \"A\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"A\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"A\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"A\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"A\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"A\" AS \"A\" GROUP BY \"A\".\"CHANNEL\" , \"A\".\"I_BRAND_ID\" , \"A\".\"I_CLASS_ID\" , \"A\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"CHANNEL\" AS \"CHANNEL\" , \"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_COL_4\" AS \"_COL_4\" , \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0       web     9006012           2              9    33183.42       7\n1       web     2001001          16              7    30410.54       7\n2       web     8015006           1              8    68808.69      14\n3       web    10006001           6              2    13996.73       5\n4       web     6005001           9              6    34171.07       3\n5       web     9006011           6              8    65567.94       9\n6       web     7006009           2              3    41535.45       8\n7       web     8010004           1              8    56277.12      13\n8       web     6015007           5             10     9526.70       2\n9       web     9016010           7              9    13518.42       3\n10      web    10002014           3              1    18262.04       6\n11      web    10003016           3              2    23236.92       8\n12      web     3004001           1              1    96509.69      27\n13      web     7002009           5              8    23154.06       3\n14  catalog    10016006          16              7    55447.03      15\n15  catalog     7002008           2              7  1840412.22     349\n16  catalog     1004002           3              1  1764265.33     348\n17  catalog     1001001          16              8    72424.91      12\n18      web    10010014          12             10    32938.42       8\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.016883,
                    "execution_time": 0.007285,
                    "compile_time": 4.5e-05,
                    "planning_time": 0.003583
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.017221,
                    "execution_time": 0.007448,
                    "compile_time": 4.6e-05,
                    "planning_time": 0.003718
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"CHANNEL\" AS \"CHANNEL\", \"I_BRAND_ID\" AS \"I_BRAND_ID\", \"I_CLASS_ID\" AS \"I_CLASS_ID\", \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\", \"_COL_4\" AS \"_COL_4\", \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0       web     9006012           2              9    33183.42       7\n1       web     2001001          16              7    30410.54       7\n2       web     8015006           1              8    68808.69      14\n3       web    10006001           6              2    13996.73       5\n4       web     6005001           9              6    34171.07       3\n5       web     9006011           6              8    65567.94       9\n6       web     7006009           2              3    41535.45       8\n7       web     8010004           1              8    56277.12      13\n8       web     6015007           5             10     9526.70       2\n9       web     9016010           7              9    13518.42       3\n10      web    10002014           3              1    18262.04       6\n11      web    10003016           3              2    23236.92       8\n12      web     3004001           1              1    96509.69      27\n13      web     7002009           5              8    23154.06       3\n14  catalog    10016006          16              7    55447.03      15\n15  catalog     7002008           2              7  1840412.22     349\n16  catalog     1004002           3              1  1764265.33     348\n17  catalog     1001001          16              8    72424.91      12\n18      web    10010014          12             10    32938.42       8\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) \nGROUP BY channel, i_brand_id, i_class_id, i_category_id /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"_Q_1\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"CHANNEL\" AS \"CHANNEL\" , \"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_COL_4\" AS \"_COL_4\" , \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0       web     9006012           2              9    33183.42       7\n1       web     2001001          16              7    30410.54       7\n2       web     8015006           1              8    68808.69      14\n3       web    10006001           6              2    13996.73       5\n4       web     6005001           9              6    34171.07       3\n5       web     9006011           6              8    65567.94       9\n6       web     7006009           2              3    41535.45       8\n7       web     8010004           1              8    56277.12      13\n8       web     6015007           5             10     9526.70       2\n9       web     9016010           7              9    13518.42       3\n10      web    10002014           3              1    18262.04       6\n11      web    10003016           3              2    23236.92       8\n12      web     3004001           1              1    96509.69      27\n13      web     7002009           5              8    23154.06       3\n14  catalog    10016006          16              7    55447.03      15\n15  catalog     7002008           2              7  1840412.22     349\n16  catalog     1004002           3              1  1764265.33     348\n17  catalog     1001001          16              8    72424.91      12\n18      web    10010014          12             10    32938.42       8\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.016815,
                    "execution_time": 0.00743,
                    "compile_time": 4.6e-05,
                    "planning_time": 0.003442
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.01769,
                    "execution_time": 0.007724,
                    "compile_time": 4.6e-05,
                    "planning_time": 0.003792
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"CHANNEL\" AS \"CHANNEL\", \"I_BRAND_ID\" AS \"I_BRAND_ID\", \"I_CLASS_ID\" AS \"I_CLASS_ID\", \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\", \"_COL_4\" AS \"_COL_4\", \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0       web     9006012           2              9    33183.42       7\n1       web     2001001          16              7    30410.54       7\n2       web     8015006           1              8    68808.69      14\n3       web    10006001           6              2    13996.73       5\n4       web     6005001           9              6    34171.07       3\n5       web     9006011           6              8    65567.94       9\n6       web     7006009           2              3    41535.45       8\n7       web     8010004           1              8    56277.12      13\n8       web     6015007           5             10     9526.70       2\n9       web     9016010           7              9    13518.42       3\n10      web    10002014           3              1    18262.04       6\n11      web    10003016           3              2    23236.92       8\n12      web     3004001           1              1    96509.69      27\n13      web     7002009           5              8    23154.06       3\n14  catalog    10016006          16              7    55447.03      15\n15  catalog     7002008           2              7  1840412.22     349\n16  catalog     1004002           3              1  1764265.33     348\n17  catalog     1001001          16              8    72424.91      12\n18      web    10010014          12             10    32938.42       8\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id) \nGROUP  BY channel, \n          i_brand_id, \n          i_class_id, \n          i_category_id; \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"_Q_1\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" ) SELECT \"_Q_1\".\"CHANNEL\" AS \"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"_Q_1\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"_Q_1\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"_Q_1\" AS \"_Q_1\" GROUP BY \"_Q_1\".\"CHANNEL\" , \"_Q_1\".\"I_BRAND_ID\" , \"_Q_1\".\"I_CLASS_ID\" , \"_Q_1\".\"I_CATEGORY_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_12\" AS SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.409834,
                    "execution_time": 0.222526,
                    "compile_time": 0.039643,
                    "planning_time": 0.075363,
                    "create_size": 405
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.261502,
                    "execution_time": 0.222773,
                    "compile_time": 5.787871,
                    "planning_time": 0.171883,
                    "create_size": 405
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_13\" AS SELECT \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_12\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_12\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_12\" AS \"SPEQLITE_TEMP_TABLE_12\" GROUP BY \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.138169,
                    "execution_time": 0.05633,
                    "compile_time": 0.000278,
                    "planning_time": 0.004663,
                    "create_size": 414
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.193059,
                    "execution_time": 0.055281,
                    "compile_time": 0.00029,
                    "planning_time": 0.05934,
                    "create_size": 414
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_13\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_13\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_13\" AS \"SPEQLITE_TEMP_TABLE_13\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0    store     4001001          15             10   241282.62      62\n1    store     8015001          15              5    82722.69      22\n2    store     6012007          12              4   193235.70      65\n3    store    10007014           1             10    78316.34      21\n4    store    10009015           3             10    62217.68      19\n5    store     8008006           2              8   202789.69      62\n6    store     6006008           6              6  2322570.21     613\n7    store     6005003           5              9   201321.23      64\n8    store     8013009          13              9    97278.24      31\n9    store    10002011           2             10   668243.11     166\n10   store     3002001          13              9    54926.09      19\n11   store     9007009           7              8   197119.67      56\n12   store     7003009           3              6    89398.05      20\n13   store    10010001           2              2   122789.16      25\n14   store     7013007           8              7    81700.88      23\n15   store     6003003           1             10    55549.35      15\n16   store     7016001           1              5    98457.43      28\n17   store     9002012           2              9  1242860.97     345\n18   store     6009001           9              4    78750.05      23\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017642,
                    "execution_time": 0.007873,
                    "compile_time": 4.5e-05,
                    "planning_time": 0.003777
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.052728,
                    "execution_time": 0.007571,
                    "compile_time": 4.6e-05,
                    "planning_time": 0.03885
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_12\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_12\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_12\" AS \"SPEQLITE_TEMP_TABLE_12\" GROUP BY \"SPEQLITE_TEMP_TABLE_12\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_12\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_13\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_13\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_13\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_13\" AS \"SPEQLITE_TEMP_TABLE_13\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0    store     4001001          15             10   241282.62      62\n1    store     8015001          15              5    82722.69      22\n2    store     6012007          12              4   193235.70      65\n3    store    10007014           1             10    78316.34      21\n4    store    10009015           3             10    62217.68      19\n5    store     8008006           2              8   202789.69      62\n6    store     6006008           6              6  2322570.21     613\n7    store     6005003           5              9   201321.23      64\n8    store     8013009          13              9    97278.24      31\n9    store    10002011           2             10   668243.11     166\n10   store     3002001          13              9    54926.09      19\n11   store     9007009           7              8   197119.67      56\n12   store     7003009           3              6    89398.05      20\n13   store    10010001           2              2   122789.16      25\n14   store     7013007           8              7    81700.88      23\n15   store     6003003           1             10    55549.35      15\n16   store     7016001           1              5    98457.43      28\n17   store     9002012           2              9  1242860.97     345\n18   store     6009001           9              4    78750.05      23\n...*/"
    },
    {
        "input": "-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  iss.i_item_sk = ss_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  ics.i_item_sk = cs_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  iws.i_item_sk = ws_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              iss.i_brand_id, \n              iss.i_class_id, \n              iss.i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item iss, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = iss.i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY iss.i_brand_id, \n                 iss.i_class_id, \n                 iss.i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              ics.i_brand_id, \n              ics.i_class_id, \n              ics.i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item ics, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = ics.i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY ics.i_brand_id, \n                 ics.i_class_id, \n                 ics.i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              iws.i_brand_id, \n              iws.i_class_id, \n              iws.i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item iws, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = iws.i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY iws.i_brand_id, \n                 iws.i_class_id, \n                 iws.i_category_id) total_sales \nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ISS\" AS ( SELECT \"ISS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ISS\" ) , \"ICS\" AS ( SELECT \"ICS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ICS\" ) , \"IWS\" AS ( SELECT \"IWS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"IWS\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ISS\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ICS\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"IWS\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"TOTAL_SALES\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ISS\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ISS\".\"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ICS\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ICS\".\"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"IWS\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"IWS\".\"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" ) SELECT \"TOTAL_SALES\".\"CHANNEL\" AS \"CHANNEL\" , \"TOTAL_SALES\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"TOTAL_SALES\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"TOTAL_SALES\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"TOTAL_SALES\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"TOTAL_SALES\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"TOTAL_SALES\" AS \"TOTAL_SALES\" GROUP BY \"TOTAL_SALES\".\"CHANNEL\" , \"TOTAL_SALES\".\"I_BRAND_ID\" , \"TOTAL_SALES\".\"I_CLASS_ID\" , \"TOTAL_SALES\".\"I_CATEGORY_ID\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_14\" AS SELECT \"ISS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ISS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ISS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.163448,
                    "execution_time": 0.047786,
                    "compile_time": 0.000222,
                    "planning_time": 0.02176,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.222986,
                    "execution_time": 0.048307,
                    "compile_time": 0.000225,
                    "planning_time": 0.080139,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_15\" AS SELECT \"ICS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ICS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.163225,
                    "execution_time": 0.047926,
                    "compile_time": 0.000228,
                    "planning_time": 0.021299,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.225767,
                    "execution_time": 0.050213,
                    "compile_time": 0.000221,
                    "planning_time": 0.081182,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_16\" AS SELECT \"IWS\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"IWS\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.16388,
                    "execution_time": 0.048601,
                    "compile_time": 0.00022,
                    "planning_time": 0.021881,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.222679,
                    "execution_time": 0.048307,
                    "compile_time": 0.000225,
                    "planning_time": 0.079878,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_17\" AS SELECT \"SPEQLITE_TEMP_TABLE_14\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"SPEQLITE_TEMP_TABLE_14\" AS \"SPEQLITE_TEMP_TABLE_14\" ON \"SPEQLITE_TEMP_TABLE_14\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"SPEQLITE_TEMP_TABLE_15\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"SPEQLITE_TEMP_TABLE_15\" AS \"SPEQLITE_TEMP_TABLE_15\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_15\".\"I_ITEM_SK\" INTERSECT SELECT \"SPEQLITE_TEMP_TABLE_16\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"SPEQLITE_TEMP_TABLE_16\" AS \"SPEQLITE_TEMP_TABLE_16\" ON \"SPEQLITE_TEMP_TABLE_16\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 2.140653,
                    "execution_time": 1.836057,
                    "compile_time": 0.193931,
                    "planning_time": 0.06401,
                    "create_size": 96
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 12.12583,
                    "execution_time": 2.571035,
                    "compile_time": 9.330627,
                    "planning_time": 0.169797,
                    "create_size": 96
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_18\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM\" AS \"ITEM\" JOIN \"SPEQLITE_TEMP_TABLE_17\" AS \"SPEQLITE_TEMP_TABLE_17\" ON \"SPEQLITE_TEMP_TABLE_17\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"SPEQLITE_TEMP_TABLE_17\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"SPEQLITE_TEMP_TABLE_17\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.169654,
                    "execution_time": 0.058204,
                    "compile_time": 0.044536,
                    "planning_time": 0.025647,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.09357,
                    "execution_time": 0.060523,
                    "compile_time": 5.905267,
                    "planning_time": 0.083356,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_19\" AS SELECT 'store' AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_18\" AS \"SPEQLITE_TEMP_TABLE_18\" ON \"SPEQLITE_TEMP_TABLE_18\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_14\" AS \"SPEQLITE_TEMP_TABLE_14\" ON \"SPEQLITE_TEMP_TABLE_14\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_18\".\"SS_ITEM_SK\" IS NULL GROUP BY \"SPEQLITE_TEMP_TABLE_14\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_14\".\"I_CATEGORY_ID\" HAVING MAX ( \"SPEQLITE_TEMP_TABLE_5\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"_U_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_18\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_15\" AS \"SPEQLITE_TEMP_TABLE_15\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_15\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"SPEQLITE_TEMP_TABLE_15\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_15\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_18\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"SPEQLITE_TEMP_TABLE_16\" AS \"SPEQLITE_TEMP_TABLE_16\" ON \"SPEQLITE_TEMP_TABLE_16\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"SPEQLITE_TEMP_TABLE_16\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_16\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.390426,
                    "execution_time": 0.220521,
                    "compile_time": 0.001033,
                    "planning_time": 0.076096,
                    "create_size": 405
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.488219,
                    "execution_time": 0.218294,
                    "compile_time": 0.001029,
                    "planning_time": 0.175426,
                    "create_size": 441
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_20\" AS SELECT \"SPEQLITE_TEMP_TABLE_19\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_19\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_19\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_19\" AS \"SPEQLITE_TEMP_TABLE_19\" GROUP BY \"SPEQLITE_TEMP_TABLE_19\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CATEGORY_ID\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.137175,
                    "execution_time": 0.054643,
                    "compile_time": 0.000287,
                    "planning_time": 0.004807,
                    "create_size": 423
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.193987,
                    "execution_time": 0.056144,
                    "compile_time": 0.000289,
                    "planning_time": 0.059653,
                    "create_size": 414
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_20\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_20\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_20\" AS \"SPEQLITE_TEMP_TABLE_20\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0     store    10006015           6              3    71544.93      21\n1     store     9007005           3              2    52536.71      11\n2     store     4001001          11             10    33479.78      13\n3     store     7015003          15              3   100055.38      27\n4     store    10011001          11              6    46982.25      11\n5     store     7003001           2              1    82432.01      20\n6     store     6008003          16              9    49795.15      15\n7   catalog     7013006          13              7  1081809.80     209\n8     store     7013003           1              5    73116.49      20\n9     store     8013009           1              3    76096.24      19\n10    store     7003005           3              4   480091.77     107\n11    store     1004001           4             10  2047857.79     530\n12    store     7010008           6              7    87839.34      30\n13    store     3003001           6              8    63946.53      16\n14    store     3003001           2              1   386554.21      95\n15    store     9012003           1              3    84647.55      25\n16    store     7008005           3             10    73418.79      18\n17    store     7002005           1              8    56232.39      17\n18    store     9010006           2              9   153556.31      42\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.016977,
                    "execution_time": 0.007475,
                    "compile_time": 4.5e-05,
                    "planning_time": 0.003577
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.052175,
                    "execution_time": 0.007673,
                    "compile_time": 4.5e-05,
                    "planning_time": 0.038442
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_19\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_19\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_19\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_19\" AS \"SPEQLITE_TEMP_TABLE_19\" GROUP BY \"SPEQLITE_TEMP_TABLE_19\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_19\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_20\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_20\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_20\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_20\" AS \"SPEQLITE_TEMP_TABLE_20\""
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0     store    10006015           6              3    71544.93      21\n1     store     9007005           3              2    52536.71      11\n2     store     4001001          11             10    33479.78      13\n3     store     7015003          15              3   100055.38      27\n4     store    10011001          11              6    46982.25      11\n5     store     7003001           2              1    82432.01      20\n6     store     6008003          16              9    49795.15      15\n7   catalog     7013006          13              7  1081809.80     209\n8     store     7013003           1              5    73116.49      20\n9     store     8013009           1              3    76096.24      19\n10    store     7003005           3              4   480091.77     107\n11    store     1004001           4             10  2047857.79     530\n12    store     7010008           6              7    87839.34      30\n13    store     3003001           6              8    63946.53      16\n14    store     3003001           2              1   386554.21      95\n15    store     9012003           1              3    84647.55      25\n16    store     7008005           3             10    73418.79      18\n17    store     7002005           1              8    56232.39      17\n18    store     9010006           2              9   153556.31      42\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": " \n\n-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) y \nGROUP BY channel, \n         i_brand_id, \n         i_class_id, \n         i_category_id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"Y\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"Y\".\"CHANNEL\" AS \"CHANNEL\" , \"Y\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"Y\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"Y\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"Y\" AS \"Y\" GROUP BY \"Y\".\"CHANNEL\" , \"Y\".\"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"CHANNEL\" AS \"CHANNEL\" , \"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"_COL_4\" AS \"_COL_4\" , \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\" LIMIT 21",
                "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0    store     6013002          13              6  2619109.64     674\n1    store     8005009           5              5   135383.92      32\n2    store     6002004           6              6    97187.64      26\n3    store    10006014           6              7    70481.71      19\n4    store     4004001           7              6   228920.17      61\n5    store     8015002           4              8   243275.79      68\n6    store     6013008           1              6   223957.33      56\n7    store     7003009           3              4    48681.42      16\n8    store     1001001           4              6   235276.53      64\n9    store     8012007          12              5    61503.56      20\n10   store     3004001          15              6   190090.27      57\n11   store     7012003           5              7    94038.65      21\n12   store     3002001          12              8    56556.90      19\n13   store     7010001           3              2    74593.72      20\n14   store     6014003          14              2    86258.36      18\n15   store     6012005           2              2    81462.96      15\n16   store     1003001           2              9   186841.22      50\n17   store     8005005           5              8    88031.81      24\n18   store     6013007          11             10    68916.36      18\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.016933,
                    "execution_time": 0.007245,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.003574
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.017871,
                    "execution_time": 0.007681,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.003921
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\"",
                "rewrite": "SELECT \"CHANNEL\" AS \"CHANNEL\", \"I_BRAND_ID\" AS \"I_BRAND_ID\", \"I_CLASS_ID\" AS \"I_CLASS_ID\", \"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\", \"_COL_4\" AS \"_COL_4\", \"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_10\" AS \"SPEQLITE_TEMP_TABLE_10\""
            }
        ],
        "preview": "\n/*   channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0    store     6013002          13              6  2619109.64     674\n1    store     8005009           5              5   135383.92      32\n2    store     6002004           6              6    97187.64      26\n3    store    10006014           6              7    70481.71      19\n4    store     4004001           7              6   228920.17      61\n5    store     8015002           4              8   243275.79      68\n6    store     6013008           1              6   223957.33      56\n7    store     7003009           3              4    48681.42      16\n8    store     1001001           4              6   235276.53      64\n9    store     8012007          12              5    61503.56      20\n10   store     3004001          15              6   190090.27      57\n11   store     7012003           5              7    94038.65      21\n12   store     3002001          12              8    56556.90      19\n13   store     7010001           3              2    74593.72      20\n14   store     6014003          14              2    86258.36      18\n15   store     6012005           2              2    81462.96      15\n16   store     1003001           2              9   186841.22      50\n17   store     8005005           5              8    88031.81      24\n18   store     6013007          11             10    68916.36      18\n...*/"
    },
    {
        "input": " \n\n-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) y \nGROUP  BY rollup ( channel, i_brand_id, i_class_id, i_category_id ) \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"Y\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"Y\".\"CHANNEL\" AS \"CHANNEL\" , \"Y\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"Y\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"Y\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"Y\" AS \"Y\" GROUP BY ROLLUP ( \"Y\".\"CHANNEL\" , \"Y\".\"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" )"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_21\" AS SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY ROLLUP ( \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.226644,
                    "execution_time": 0.072528,
                    "compile_time": 0.039009,
                    "planning_time": 0.006079,
                    "create_size": 684
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.341078,
                    "execution_time": 0.077381,
                    "compile_time": 3.088969,
                    "planning_time": 0.061182,
                    "create_size": 684
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0       web     3001001           8             10    95756.57      20\n1       web     1002001          11              8    91821.91      16\n2       web     7003005           3              8    48548.44      11\n3       web    10006011           2              5     5351.91       2\n4       web     8007005           7             10    23481.57       6\n5       web     8014007          14              8    15452.27      10\n6     store     8008006           4              8   106653.66      31\n7   catalog     3001001           3              3   246058.83      49\n8   catalog     8014002          14              8  1579605.76     311\n9   catalog     9007010           5              9    66669.88      14\n10  catalog     2003002          14              2   439197.76      80\n11      web     8003010           6              8    13498.78       5\n12      web     9012009           4              3    44702.91       6\n13      web     6012003          12             10   131917.83      19\n14      web     8007007           2              5    14010.16       3\n15      web     9010011           4              3    21872.59       4\n16      web     6007007           7              7    27816.29       7\n17      web     6016003           2              3     9710.50       1\n18      web     7001005           7              8    23721.05       4\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.016893,
                    "execution_time": 0.007525,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.003558
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.052559,
                    "execution_time": 0.008151,
                    "compile_time": 4.4e-05,
                    "planning_time": 0.038319
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY ROLLUP ( \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" )",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\""
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id      _col_4  _col_5\n0       web     3001001           8             10    95756.57      20\n1       web     1002001          11              8    91821.91      16\n2       web     7003005           3              8    48548.44      11\n3       web    10006011           2              5     5351.91       2\n4       web     8007005           7             10    23481.57       6\n5       web     8014007          14              8    15452.27      10\n6     store     8008006           4              8   106653.66      31\n7   catalog     3001001           3              3   246058.83      49\n8   catalog     8014002          14              8  1579605.76     311\n9   catalog     9007010           5              9    66669.88      14\n10  catalog     2003002          14              2   439197.76      80\n11      web     8003010           6              8    13498.78       5\n12      web     9012009           4              3    44702.91       6\n13      web     6012003          12             10   131917.83      19\n14      web     8007007           2              5    14010.16       3\n15      web     9010011           4              3    21872.59       4\n16      web     6007007           7              7    27816.29       7\n17      web     6016003           2              3     9710.50       1\n18      web     7001005           7              8    23721.05       4\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": " \n\n-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk AS ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) AS average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store' AS channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog' AS channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web' AS channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) y \nGROUP  BY rollup ( channel, i_brand_id, i_class_id, i_category_id ) \nORDER  BY channel, \n          i_brand_id, \n          i_class_id /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"Y\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"Y\".\"CHANNEL\" AS \"CHANNEL\" , \"Y\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"Y\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"Y\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"Y\" AS \"Y\" GROUP BY ROLLUP ( \"Y\".\"CHANNEL\" , \"Y\".\"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" , \"I_BRAND_ID\" , \"I_CLASS_ID\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     1001001           1            8.0   1069083.86     207\n1   catalog     1001001           1            5.0    899958.49     192\n2   catalog     1001001           1            9.0    759494.39     150\n3   catalog     1001001           1            NaN  10757280.82    2150\n4   catalog     1001001           1            4.0   1600580.52     317\n5   catalog     1001001           1           10.0   1280189.70     237\n6   catalog     1001001           1            2.0   1183046.87     211\n7   catalog     1001001           1            3.0   1026091.56     224\n8   catalog     1001001           1            7.0   1091626.52     227\n9   catalog     1001001           1            1.0    981145.38     214\n10  catalog     1001001           1            6.0    866063.53     171\n11  catalog     1001001           2            3.0    111970.19      19\n12  catalog     1001001           2            7.0     26118.28       9\n13  catalog     1001001           2            8.0     71002.77      13\n14  catalog     1001001           2            1.0    284397.15      52\n15  catalog     1001001           2            5.0    138685.75      30\n16  catalog     1001001           2           10.0     96746.59      22\n17  catalog     1001001           2            2.0    362192.03      62\n18  catalog     1001001           2            4.0    121900.82      25\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.036618,
                    "execution_time": 0.010278,
                    "compile_time": 0.016464,
                    "planning_time": 0.003867
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.50761,
                    "execution_time": 0.011812,
                    "compile_time": 4.456663,
                    "planning_time": 0.039149
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY ROLLUP ( \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST"
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     1001001           1            8.0   1069083.86     207\n1   catalog     1001001           1            5.0    899958.49     192\n2   catalog     1001001           1            9.0    759494.39     150\n3   catalog     1001001           1            NaN  10757280.82    2150\n4   catalog     1001001           1            4.0   1600580.52     317\n5   catalog     1001001           1           10.0   1280189.70     237\n6   catalog     1001001           1            2.0   1183046.87     211\n7   catalog     1001001           1            3.0   1026091.56     224\n8   catalog     1001001           1            7.0   1091626.52     227\n9   catalog     1001001           1            1.0    981145.38     214\n10  catalog     1001001           1            6.0    866063.53     171\n11  catalog     1001001           2            3.0    111970.19      19\n12  catalog     1001001           2            7.0     26118.28       9\n13  catalog     1001001           2            8.0     71002.77      13\n14  catalog     1001001           2            1.0    284397.15      52\n15  catalog     1001001           2            5.0    138685.75      30\n16  catalog     1001001           2           10.0     96746.59      22\n17  catalog     1001001           2            2.0    362192.03      62\n18  catalog     1001001           2            4.0    121900.82      25\n...*/"
    },
    {
        "input": " \n\n-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) y \nGROUP  BY rollup ( channel, i_brand_id, i_class_id, i_category_id ) \nORDER  BY channel, \n          i_brand_id, \n          i_class_id, \n          i_category_id\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"Y\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"Y\".\"CHANNEL\" AS \"CHANNEL\" , \"Y\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"Y\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"Y\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"Y\" AS \"Y\" GROUP BY ROLLUP ( \"Y\".\"CHANNEL\" , \"Y\".\"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" , \"I_BRAND_ID\" , \"I_CLASS_ID\" , \"I_CATEGORY_ID\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     1001001           1            1.0    981145.38     214\n1   catalog     1001001           1            2.0   1183046.87     211\n2   catalog     1001001           1            3.0   1026091.56     224\n3   catalog     1001001           1            4.0   1600580.52     317\n4   catalog     1001001           1            5.0    899958.49     192\n5   catalog     1001001           1            6.0    866063.53     171\n6   catalog     1001001           1            7.0   1091626.52     227\n7   catalog     1001001           1            8.0   1069083.86     207\n8   catalog     1001001           1            9.0    759494.39     150\n9   catalog     1001001           1           10.0   1280189.70     237\n10  catalog     1001001           1            NaN  10757280.82    2150\n11  catalog     1001001           2            1.0    284397.15      52\n12  catalog     1001001           2            2.0    362192.03      62\n13  catalog     1001001           2            3.0    111970.19      19\n14  catalog     1001001           2            4.0    121900.82      25\n15  catalog     1001001           2            5.0    138685.75      30\n16  catalog     1001001           2            6.0     52649.76      10\n17  catalog     1001001           2            7.0     26118.28       9\n18  catalog     1001001           2            8.0     71002.77      13\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.019186,
                    "execution_time": 0.009286,
                    "compile_time": 6.8e-05,
                    "planning_time": 0.003933
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.111187,
                    "execution_time": 0.009216,
                    "compile_time": 0.056467,
                    "planning_time": 0.039276
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY ROLLUP ( \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST"
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     1001001           1            1.0    981145.38     214\n1   catalog     1001001           1            2.0   1183046.87     211\n2   catalog     1001001           1            3.0   1026091.56     224\n3   catalog     1001001           1            4.0   1600580.52     317\n4   catalog     1001001           1            5.0    899958.49     192\n5   catalog     1001001           1            6.0    866063.53     171\n6   catalog     1001001           1            7.0   1091626.52     227\n7   catalog     1001001           1            8.0   1069083.86     207\n8   catalog     1001001           1            9.0    759494.39     150\n9   catalog     1001001           1           10.0   1280189.70     237\n10  catalog     1001001           1            NaN  10757280.82    2150\n11  catalog     1001001           2            1.0    284397.15      52\n12  catalog     1001001           2            2.0    362192.03      62\n13  catalog     1001001           2            3.0    111970.19      19\n14  catalog     1001001           2            4.0    121900.82      25\n15  catalog     1001001           2            5.0    138685.75      30\n16  catalog     1001001           2            6.0     52649.76      10\n17  catalog     1001001           2            7.0     26118.28       9\n18  catalog     1001001           2            8.0     71002.77      13\n...*/"
    },
    {
        "input": " \n\n-- start query 14 in stream 0 using template query14.tpl \nWITH cross_items \n     AS (SELECT i_item_sk ss_item_sk \n         FROM   item, \n                (SELECT iss.i_brand_id    brand_id, \n                        iss.i_class_id    class_id, \n                        iss.i_category_id category_id \n                 FROM   store_sales, \n                        item iss, \n                        date_dim d1 \n                 WHERE  ss_item_sk = iss.i_item_sk \n                        AND ss_sold_date_sk = d1.d_date_sk \n                        AND d1.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT ics.i_brand_id, \n                        ics.i_class_id, \n                        ics.i_category_id \n                 FROM   catalog_sales, \n                        item ics, \n                        date_dim d2 \n                 WHERE  cs_item_sk = ics.i_item_sk \n                        AND cs_sold_date_sk = d2.d_date_sk \n                        AND d2.d_year BETWEEN 1999 AND 1999 + 2 \n                 INTERSECT \n                 SELECT iws.i_brand_id, \n                        iws.i_class_id, \n                        iws.i_category_id \n                 FROM   web_sales, \n                        item iws, \n                        date_dim d3 \n                 WHERE  ws_item_sk = iws.i_item_sk \n                        AND ws_sold_date_sk = d3.d_date_sk \n                        AND d3.d_year BETWEEN 1999 AND 1999 + 2) \n         WHERE  i_brand_id = brand_id \n                AND i_class_id = class_id \n                AND i_category_id = category_id), \n     avg_sales \n     AS (SELECT Avg(quantity * list_price) average_sales \n         FROM   (SELECT ss_quantity   quantity, \n                        ss_list_price list_price \n                 FROM   store_sales, \n                        date_dim \n                 WHERE  ss_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT cs_quantity   quantity, \n                        cs_list_price list_price \n                 FROM   catalog_sales, \n                        date_dim \n                 WHERE  cs_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2 \n                 UNION ALL \n                 SELECT ws_quantity   quantity, \n                        ws_list_price list_price \n                 FROM   web_sales, \n                        date_dim \n                 WHERE  ws_sold_date_sk = d_date_sk \n                        AND d_year BETWEEN 1999 AND 1999 + 2) x) \nSELECT channel, \n               i_brand_id, \n               i_class_id, \n               i_category_id, \n               Sum(sales), \n               Sum(number_sales) \nFROM  (SELECT 'store'                          channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ss_quantity * ss_list_price) sales, \n              Count(*)                         number_sales \n       FROM   store_sales, \n              item, \n              date_dim \n       WHERE  ss_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ss_item_sk = i_item_sk \n              AND ss_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ss_quantity * ss_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'catalog'                        channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(cs_quantity * cs_list_price) sales, \n              Count(*)                         number_sales \n       FROM   catalog_sales, \n              item, \n              date_dim \n       WHERE  cs_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND cs_item_sk = i_item_sk \n              AND cs_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(cs_quantity * cs_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales) \n       UNION ALL \n       SELECT 'web'                            channel, \n              i_brand_id, \n              i_class_id, \n              i_category_id, \n              Sum(ws_quantity * ws_list_price) sales, \n              Count(*)                         number_sales \n       FROM   web_sales, \n              item, \n              date_dim \n       WHERE  ws_item_sk IN (SELECT ss_item_sk \n                             FROM   cross_items) \n              AND ws_item_sk = i_item_sk \n              AND ws_sold_date_sk = d_date_sk \n              AND d_year = 1999 + 2 \n              AND d_moy = 11 \n       GROUP  BY i_brand_id, \n                 i_class_id, \n                 i_category_id \n       HAVING Sum(ws_quantity * ws_list_price) > (SELECT average_sales \n                                                  FROM   avg_sales)) y \nGROUP  BY rollup ( channel, i_brand_id, i_class_id, i_category_id ) \nORDER  BY channel, \n          i_brand_id, \n          i_class_id, \n          i_category_id\nLIMIT 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"ITEM_2\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"I_ITEM_SK\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"ITEM\" AS \"ITEM\" ) , \"_Q_0\" AS ( SELECT \"ISS\".\"I_BRAND_ID\" AS \"BRAND_ID\" , \"ISS\".\"I_CLASS_ID\" AS \"CLASS_ID\" , \"ISS\".\"I_CATEGORY_ID\" AS \"CATEGORY_ID\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"D1\" ON \"D1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"D1\".\"D_YEAR\" <= 2001 AND \"D1\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ISS\" ON \"ISS\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" INTERSECT SELECT \"ICS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ICS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ICS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM\" AS \"D2\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"D2\".\"D_DATE_SK\" AND \"D2\".\"D_YEAR\" <= 2001 AND \"D2\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"ICS\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ICS\".\"I_ITEM_SK\" INTERSECT SELECT \"IWS\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"IWS\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"IWS\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM\" AS \"D3\" ON \"D3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"D3\".\"D_YEAR\" <= 2001 AND \"D3\".\"D_YEAR\" >= 1999 JOIN \"ITEM\" AS \"IWS\" ON \"IWS\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" ) , \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" <= 2001 AND \"DATE_DIM\".\"D_YEAR\" >= 1999 ) , \"X\" AS ( SELECT \"STORE_SALES\".\"SS_QUANTITY\" AS \"QUANTITY\" , \"STORE_SALES\".\"SS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" UNION ALL SELECT \"CATALOG_SALES\".\"CS_QUANTITY\" AS \"QUANTITY\" , \"CATALOG_SALES\".\"CS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" UNION ALL SELECT \"WEB_SALES\".\"WS_QUANTITY\" AS \"QUANTITY\" , \"WEB_SALES\".\"WS_LIST_PRICE\" AS \"LIST_PRICE\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" ) , \"AVG_SALES\" AS ( SELECT AVG ( \"X\".\"QUANTITY\" * \"X\".\"LIST_PRICE\" ) AS \"AVERAGE_SALES\" FROM \"X\" AS \"X\" ) , \"_U_1\" AS ( SELECT \"AVG_SALES\".\"AVERAGE_SALES\" AS \"AVERAGE_SALES\" FROM \"AVG_SALES\" AS \"AVG_SALES\" ) , \"_U_0\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"SS_ITEM_SK\" FROM \"ITEM_2\" AS \"ITEM\" JOIN \"_Q_0\" AS \"_Q_0\" ON \"_Q_0\".\"BRAND_ID\" = \"ITEM\".\"I_BRAND_ID\" AND \"_Q_0\".\"CATEGORY_ID\" = \"ITEM\".\"I_CATEGORY_ID\" AND \"_Q_0\".\"CLASS_ID\" = \"ITEM\".\"I_CLASS_ID\" GROUP BY \"ITEM\".\"I_ITEM_SK\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 11 AND \"DATE_DIM\".\"D_YEAR\" = 2001 ) , \"Y\" AS ( SELECT 'store' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"_U_1\" AS \"_U_1\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"SS_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" WHERE NOT \"_U_0\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_1\".\"AVERAGE_SALES\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_LIST_PRICE\" ) UNION ALL SELECT 'catalog' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"_U_1\" AS \"_U_3\" LEFT JOIN \"_U_0\" AS \"_U_2\" ON \"_U_2\".\"SS_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"CATALOG_SALES\".\"CS_ITEM_SK\" = \"ITEM\".\"I_ITEM_SK\" WHERE NOT \"_U_2\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_3\".\"AVERAGE_SALES\" ) < SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) UNION ALL SELECT 'web' AS \"CHANNEL\" , \"ITEM\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" , COUNT ( * ) AS \"NUMBER_SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"_U_1\" AS \"_U_5\" LEFT JOIN \"_U_0\" AS \"_U_4\" ON \"_U_4\".\"SS_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" JOIN \"ITEM_2\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" WHERE NOT \"_U_4\".\"SS_ITEM_SK\" IS NULL GROUP BY \"ITEM\".\"I_BRAND_ID\" , \"ITEM\".\"I_CLASS_ID\" , \"ITEM\".\"I_CATEGORY_ID\" HAVING MAX ( \"_U_5\".\"AVERAGE_SALES\" ) < SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) ) SELECT \"Y\".\"CHANNEL\" AS \"CHANNEL\" , \"Y\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"Y\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"Y\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"Y\" AS \"Y\" GROUP BY ROLLUP ( \"Y\".\"CHANNEL\" , \"Y\".\"I_BRAND_ID\" , \"Y\".\"I_CLASS_ID\" , \"Y\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" , \"I_BRAND_ID\" , \"I_CLASS_ID\" , \"I_CATEGORY_ID\" LIMIT 21",
                "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     1001001           1            1.0    981145.38     214\n1   catalog     1001001           1            2.0   1183046.87     211\n2   catalog     1001001           1            3.0   1026091.56     224\n3   catalog     1001001           1            4.0   1600580.52     317\n4   catalog     1001001           1            5.0    899958.49     192\n5   catalog     1001001           1            6.0    866063.53     171\n6   catalog     1001001           1            7.0   1091626.52     227\n7   catalog     1001001           1            8.0   1069083.86     207\n8   catalog     1001001           1            9.0    759494.39     150\n9   catalog     1001001           1           10.0   1280189.70     237\n10  catalog     1001001           1            NaN  10757280.82    2150\n11  catalog     1001001           2            1.0    284397.15      52\n12  catalog     1001001           2            2.0    362192.03      62\n13  catalog     1001001           2            3.0    111970.19      19\n14  catalog     1001001           2            4.0    121900.82      25\n15  catalog     1001001           2            5.0    138685.75      30\n16  catalog     1001001           2            6.0     52649.76      10\n17  catalog     1001001           2            7.0     26118.28       9\n18  catalog     1001001           2            8.0     71002.77      13\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.019568,
                    "execution_time": 0.009708,
                    "compile_time": 6.7e-05,
                    "planning_time": 0.003923
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.019884,
                    "execution_time": 0.009456,
                    "compile_time": 6.9e-05,
                    "planning_time": 0.00417
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"SALES\" ) AS \"_COL_4\" , SUM ( \"SPEQLITE_TEMP_TABLE_9\".\"NUMBER_SALES\" ) AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_9\" AS \"SPEQLITE_TEMP_TABLE_9\" GROUP BY ROLLUP ( \"SPEQLITE_TEMP_TABLE_9\".\"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_9\".\"I_CATEGORY_ID\" ) ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST LIMIT 100",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_21\".\"CHANNEL\" AS \"CHANNEL\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_BRAND_ID\" AS \"I_BRAND_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CLASS_ID\" AS \"I_CLASS_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"I_CATEGORY_ID\" AS \"I_CATEGORY_ID\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_4\" AS \"_COL_4\" , \"SPEQLITE_TEMP_TABLE_21\".\"_COL_5\" AS \"_COL_5\" FROM \"SPEQLITE_TEMP_TABLE_21\" AS \"SPEQLITE_TEMP_TABLE_21\" ORDER BY \"CHANNEL\" NULLS LAST , \"I_BRAND_ID\" NULLS LAST , \"I_CLASS_ID\" NULLS LAST , \"I_CATEGORY_ID\" NULLS LAST LIMIT 100"
            }
        ],
        "preview": "\n/*    channel  i_brand_id  i_class_id  i_category_id       _col_4  _col_5\n0   catalog     1001001           1            1.0    981145.38     214\n1   catalog     1001001           1            2.0   1183046.87     211\n2   catalog     1001001           1            3.0   1026091.56     224\n3   catalog     1001001           1            4.0   1600580.52     317\n4   catalog     1001001           1            5.0    899958.49     192\n5   catalog     1001001           1            6.0    866063.53     171\n6   catalog     1001001           1            7.0   1091626.52     227\n7   catalog     1001001           1            8.0   1069083.86     207\n8   catalog     1001001           1            9.0    759494.39     150\n9   catalog     1001001           1           10.0   1280189.70     237\n10  catalog     1001001           1            NaN  10757280.82    2150\n11  catalog     1001001           2            1.0    284397.15      52\n12  catalog     1001001           2            2.0    362192.03      62\n13  catalog     1001001           2            3.0    111970.19      19\n14  catalog     1001001           2            4.0    121900.82      25\n15  catalog     1001001           2            5.0    138685.75      30\n16  catalog     1001001           2            6.0     52649.76      10\n17  catalog     1001001           2            7.0     26118.28       9\n18  catalog     1001001           2            8.0     71002.77      13\n...*/"
    }
]