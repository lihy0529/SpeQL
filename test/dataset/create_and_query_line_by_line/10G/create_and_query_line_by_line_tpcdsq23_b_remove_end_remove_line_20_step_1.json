[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(CS_QUANTITY*CS_LIST_PRICE) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n        group by c_last_name,c_first_name) as sales_summary\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"SALES_SUMMARY\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH SALES_SUMMARY AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH SALES_SUMMARY AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\"",
                "rewrite": "WITH SALES_SUMMARY AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\""
            }
        ],
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc, i_item_sk item_sk, d_date solddate, count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1999,2000,2001)\n  group by substring(i_item_desc,1,30), i_item_sk, d_date\n  having count(*) > 4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select ss_customer_sk c_customer_sk, sum(ss_quantity * ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1999,2000,2001)\n        group by ss_customer_sk)),\n best_ss_customer as\n (select ss_customer_sk c_customer_sk, sum(ss_quantity * ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by ss_customer_sk\n  having sum(ss_quantity * ss_sales_price) > (95/100.0) * (select tpcds_cmax from max_store_sales))\n  select c_last_name, c_first_name, sales\n from (select c_last_name, c_first_name, sum(cs_net_paid) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n/*CURSOR_IDENTIFIER*/\n         group by c_last_name, c_first_name) as customer_sales",
        "optimize": [
            "WITH \"CUSTOMER_SALES\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "WITH CUSTOMER_SALES AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "WITH CUSTOMER_SALES AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\"",
                "rewrite": "WITH CUSTOMER_SALES AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_NET_PAID\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"CUSTOMER_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER_SALES\".\"SALES\" AS \"SALES\" FROM \"CUSTOMER_SALES\" AS \"CUSTOMER_SALES\""
            }
        ],
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_sales_price*cs_quantity) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         group by c_last_name,c_first_name)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" * \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.280781,
                    "execution_time": 1.09901,
                    "compile_time": 0.103722,
                    "planning_time": 0.046372,
                    "create_size": 32
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 7.740386,
                    "execution_time": 4.179921,
                    "compile_time": 3.502224,
                    "planning_time": 0.109428,
                    "create_size": 32
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.327,
                    "execution_time": 0.188296,
                    "compile_time": 0.065107,
                    "planning_time": 0.020623,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 4.33276,
                    "execution_time": 1.279929,
                    "compile_time": 2.918373,
                    "planning_time": 0.079445,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.762353,
                    "execution_time": 0.417026,
                    "compile_time": 0.151386,
                    "planning_time": 0.033705,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 10.343191,
                    "execution_time": 3.770091,
                    "compile_time": 6.310666,
                    "planning_time": 0.095598,
                    "create_size": 512
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_SALES_PRICE * CS_QUANTITY ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.869054,
                    "execution_time": 1.577516,
                    "compile_time": 0.153349,
                    "planning_time": 0.098405
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.861042,
                    "execution_time": 7.130422,
                    "compile_time": 6.728023,
                    "planning_time": 0.181775
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/"
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n        group by c_last_name,c_first_name) /* Added GROUP BY for c_last_name and c_first_name */ \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.881823,
                    "execution_time": 1.598741,
                    "compile_time": 0.143407,
                    "planning_time": 0.099553
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 8.389754,
                    "execution_time": 1.793043,
                    "compile_time": 6.367597,
                    "planning_time": 0.186307
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.71159,
                    "execution_time": 1.570402,
                    "compile_time": 0.000861,
                    "planning_time": 0.100584
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.757781,
                    "execution_time": 1.616039,
                    "compile_time": 0.000862,
                    "planning_time": 0.100979
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c.c_last_name, c.c_first_name, sum(ws_quantity*ws_list_price) sales\n       from web_sales\n            , customer c\n where ws_sold_date_sk in (select d_date_sk from date_dim where d_year = 1998 and d_moy = 4)\n     and ws_bill_customer_sk = c.c_customer_sk\n     and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n group by c_last_name,c_first_name) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"_U_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"DATE_DIM\".\"D_DATE_SK\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"C\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"C\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_3\" AS \"_U_3\" ON \"_U_3\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER\" AS \"C\" ON \"C\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" WHERE NOT \"_U_3\".\"D_DATE_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"C\".\"C_LAST_NAME\" , \"C\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C.C_LAST_NAME , C.C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER AS C WHERE WS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 ) AND WS_BILL_CUSTOMER_SK = C.C_CUSTOMER_SK AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*  c_last_name c_first_name    sales\n0    Robinson      Michael  57038.1*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.981715,
                    "execution_time": 1.639787,
                    "compile_time": 0.120778,
                    "planning_time": 0.71377
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 10.675275,
                    "execution_time": 2.534386,
                    "compile_time": 7.824525,
                    "planning_time": 3.661102
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*  c_last_name c_first_name    sales\n0    Robinson      Michael  57038.1*/"
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) > 4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(CS_QUANTITY*CS_LIST_PRICE) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(WS_QUANTITY*WS_LIST_PRICE) sales\n       from web_sales\n           ,customer\n           ,date_dim\n       where ws_bill_customer_sk = c_customer_sk\n         and ws_sold_date_sk = d_date_sk\n         and d_year = 1998\n         and ws_item_sk in (select item_sk from frequent_ss_items)\n       group by c_last_name,c_first_name\n) /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" = 1998 WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK AND WS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR = 1998 AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*   c_last_name c_first_name     sales\n0          Lee       Walter  34999.74\n1      Tillery       Cristy   3805.46\n2      Bradley      Lillian   3365.82\n3    Rosenberg         Kyle  11640.60\n4         Dodd       Edward  16514.08\n5        Wells        Tammy   8742.04\n6     Lockwood      Lillian   2344.84\n7       Bucher     Benjamin   9389.04\n8        White     Charlene   6959.68\n9       Harris        Scott    113.28\n10       Small        James  12948.74\n11   Weinstein         Lisa   7556.64\n12      Jordan        Helen   5701.08\n13      Turner         Leon   9889.55\n14       Mccoy      Barbara  12982.62\n15      Graham        Rocky   9507.24\n16        Ford         Ryan   4125.15\n17      Walker        Brian   8812.58\n18    Goldberg        Glenn  10585.95\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 2.075832,
                    "execution_time": 1.714475,
                    "compile_time": 0.161315,
                    "planning_time": 1.433793
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 13.560004,
                    "execution_time": 2.678466,
                    "compile_time": 10.582702,
                    "planning_time": 5.054791
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   c_last_name c_first_name     sales\n0          Lee       Walter  34999.74\n1      Tillery       Cristy   3805.46\n2      Bradley      Lillian   3365.82\n3    Rosenberg         Kyle  11640.60\n4         Dodd       Edward  16514.08\n5        Wells        Tammy   8742.04\n6     Lockwood      Lillian   2344.84\n7       Bucher     Benjamin   9389.04\n8        White     Charlene   6959.68\n9       Harris        Scott    113.28\n10       Small        James  12948.74\n11   Weinstein         Lisa   7556.64\n12      Jordan        Helen   5701.08\n13      Turner         Leon   9889.55\n14       Mccoy      Barbara  12982.62\n15      Graham        Rocky   9507.24\n16        Ford         Ryan   4125.15\n17      Walker        Brian   8812.58\n18    Goldberg        Glenn  10585.95\n...*/"
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select ss_item_sk item_sk,count(*) cnt\n  from store_sales\n  where ss_sold_date_sk in (select d_date_sk from date_dim where d_year in (1998,1998 + 1,1998 + 2,1998 + 3))\n  group by ss_item_sk\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select ss_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n        where ss_sold_date_sk in (select d_date_sk from date_dim where d_year in (1998,1998+1,1998+2,1998+3))\n        group by ss_customer_sk)),\n best_ss_customer as\n (select ss_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n  where ss_customer_sk is not null\n  group by ss_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select tpcds_cmax from max_store_sales))\n select c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_sales_price) sales\n       from catalog_sales\n           ,customer\n       where cs_sold_date_sk in (select d_date_sk from date_dim where d_year = 1998 and d_moy = 4)\n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name\n     union all\n     select c_last_name,c_first_name,sum(ws_quantity*ws_sales_price) sales\n      from web_sales\n          ,customer\n      where ws_sold_date_sk in (select d_date_sk from date_dim where d_year = 1998 and d_moy = 4)\n        and ws_item_sk in (select item_sk from frequent_ss_items)\n        and ws_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n        and ws_bill_customer_sk = c_customer_sk\n     group by c_last_name,c_first_name\n ) as full_sales\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"_U_0\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"DATE_DIM\".\"D_DATE_SK\" ) , \"FREQUENT_SS_ITEMS\" AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"_U_0\" AS \"_U_0\" ON \"_U_0\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"_U_0\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_ITEM_SK\" HAVING COUNT ( * ) > 4 ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"_U_0\" AS \"_U_1\" ON \"_U_1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"_U_1\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" WHERE NOT \"STORE_SALES\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"DATE_DIM\".\"D_DATE_SK\" ) , \"_U_4\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_5\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"FULL_SALES\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_3\" AS \"_U_3\" ON \"_U_3\".\"D_DATE_SK\" = \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" LEFT JOIN \"_U_4\" AS \"_U_4\" ON \"_U_4\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_5\" AS \"_U_5\" ON \"_U_5\".\"SS_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" WHERE NOT \"_U_3\".\"D_DATE_SK\" IS NULL AND NOT \"_U_4\".\"ITEM_SK\" IS NULL AND NOT \"_U_5\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_3\" AS \"_U_6\" ON \"_U_6\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"_U_4\" AS \"_U_7\" ON \"_U_7\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_5\" AS \"_U_8\" ON \"_U_8\".\"SS_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" WHERE NOT \"_U_6\".\"D_DATE_SK\" IS NULL AND NOT \"_U_7\".\"ITEM_SK\" IS NULL AND NOT \"_U_8\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"FULL_SALES\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"FULL_SALES\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"FULL_SALES\".\"SALES\" AS \"SALES\" FROM \"FULL_SALES\" AS \"FULL_SALES\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"DATE_DIM\".\"D_DATE_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.093262,
                    "execution_time": 0.031805,
                    "compile_time": 0.0146,
                    "planning_time": 0.023271,
                    "create_size": 16
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.200066,
                    "execution_time": 0.031729,
                    "compile_time": 3.059147,
                    "planning_time": 0.083395,
                    "create_size": 16
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ON \"SPEQLITE_TEMP_TABLE_4\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"SPEQLITE_TEMP_TABLE_4\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_ITEM_SK\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.648484,
                    "execution_time": 0.516099,
                    "compile_time": 0.057465,
                    "planning_time": 0.029244,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.742909,
                    "execution_time": 0.517074,
                    "compile_time": 3.093747,
                    "planning_time": 0.084801,
                    "create_size": 512
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"_U_1\" ON \"_U_1\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" WHERE NOT \"_U_1\".\"D_DATE_SK\" IS NULL GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.325802,
                    "execution_time": 1.091435,
                    "compile_time": 0.035562,
                    "planning_time": 0.027157,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 4.446179,
                    "execution_time": 1.0947,
                    "compile_time": 3.089923,
                    "planning_time": 0.085164,
                    "create_size": 512
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SS_ITEM_SK AS ITEM_SK , COUNT ( * ) AS CNT FROM STORE_SALES WHERE SS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) ) GROUP BY SS_ITEM_SK HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES WHERE SS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) ) GROUP BY SS_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES WHERE NOT SS_CUSTOMER_SK IS NULL GROUP BY SS_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT TPCDS_CMAX FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_SALES_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER WHERE CS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 ) AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_SALES_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER WHERE WS_SOLD_DATE_SK IN ( SELECT D_DATE_SK FROM DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 ) AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) AS FULL_SALES LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select ss_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by ss_customer_sk)),\n best_ss_customer as\n (select ss_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by ss_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select tpcds_cmax from max_store_sales))\nselect c_last_name, c_first_name, sales\nfrom (select c_last_name, c_first_name, sum(cs_quantity*cs_list_price) sales\n       from catalog_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n        and d_moy = 4 \n        and cs_sold_date_sk = d_date_sk \n        and cs_item_sk in (select item_sk from frequent_ss_items)\n        and cs_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n        and cs_bill_customer_sk = c_customer_sk \n      group by c_last_name, c_first_name\n     union all\n     select c_last_name, c_first_name, sum(ws_quantity*ws_list_price) sales\n      from web_sales\n          ,customer\n          ,date_dim \n      where d_year = 1998 \n        and d_moy = 4 \n        and ws_sold_date_sk = d_date_sk\n        and ws_item_sk in (select item_sk from frequent_ss_items)\n        and ws_bill_customer_sk in (select ss_customer_sk from best_ss_customer)\n        and ws_bill_customer_sk = c_customer_sk \n      group by c_last_name, c_first_name)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"SS_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"SS_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"SS_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"SS_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.654084,
                    "execution_time": 1.407068,
                    "compile_time": 0.039539,
                    "planning_time": 0.034595,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 4.971465,
                    "execution_time": 1.404649,
                    "compile_time": 3.295593,
                    "planning_time": 0.09796,
                    "create_size": 512
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SS_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT SS_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY SS_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT TPCDS_CMAX FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT SS_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n/*CURSOR_IDENTIFIER*/\n         and ws_sold_date_sk = d_date_sk \n         group by c_last_name,c_first_name)",
        "optimize": [
            "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\", \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\", SUM(\"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\") AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\", \"CUSTOMER\".\"C_FIRST_NAME\"",
                "rewrite": "SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" CROSS JOIN \"CUSTOMER\" AS \"CUSTOMER\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\""
            }
        ],
        "preview": null
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date_sk solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date_sk\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(CS_QUANTITY*CS_LIST_PRICE) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(WS_QUANTITY*WS_LIST_PRICE) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      ) as sales_summary\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) ) , \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE_SK\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_3\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"SALES_SUMMARY\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_2\" AS \"_U_3\" ON \"_U_3\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_3\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_SUMMARY\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_SUMMARY\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_SUMMARY\".\"SALES\" AS \"SALES\" FROM \"SALES_SUMMARY\" AS \"SALES_SUMMARY\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.091462,
                    "execution_time": 0.03213,
                    "compile_time": 0.014261,
                    "planning_time": 0.02276,
                    "create_size": 20
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.199741,
                    "execution_time": 0.031259,
                    "compile_time": 3.060304,
                    "planning_time": 0.083068,
                    "create_size": 20
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_9\" AS SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE_SK\" HAVING COUNT ( * ) > 4",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.159809,
                    "execution_time": 3.07458,
                    "compile_time": 0.024264,
                    "planning_time": 0.030473,
                    "create_size": 32
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.202972,
                    "execution_time": 3.03774,
                    "compile_time": 3.037089,
                    "planning_time": 0.095755,
                    "create_size": 32
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_10\" AS SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"SPEQLITE_TEMP_TABLE_8\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.586245,
                    "execution_time": 1.355778,
                    "compile_time": 0.031632,
                    "planning_time": 0.025187,
                    "create_size": 512
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 4.898009,
                    "execution_time": 1.360268,
                    "compile_time": 3.275207,
                    "planning_time": 0.08573,
                    "create_size": 512
                }
            }
        ],
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE_SK AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE_SK HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) AS SALES_SUMMARY LIMIT 21",
                "preview": "\n/*  c_last_name c_first_name    sales\n0    Robinson      Michael  57038.1*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.966245,
                    "execution_time": 1.655591,
                    "compile_time": 0.092421,
                    "planning_time": 0.666544
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 7.902408,
                    "execution_time": 4.281672,
                    "compile_time": 3.307645,
                    "planning_time": 0.761727
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*  c_last_name c_first_name    sales\n0    Robinson      Michael  57038.1*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name, c_first_name\n) as sales_data\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"SALES_DATA\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"SALES_DATA\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"SALES_DATA\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"SALES_DATA\".\"SALES\" AS \"SALES\" FROM \"SALES_DATA\" AS \"SALES_DATA\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) AS SALES_DATA LIMIT 21",
                "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.917251,
                    "execution_time": 1.653137,
                    "compile_time": 0.001535,
                    "planning_time": 1.824348
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 2.126499,
                    "execution_time": 1.642687,
                    "compile_time": 0.123045,
                    "planning_time": 1.910724
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/"
    },
    {
        "input": "with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.90188,
                    "execution_time": 1.638174,
                    "compile_time": 0.001556,
                    "planning_time": 1.806379
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.977976,
                    "execution_time": 1.619147,
                    "compile_time": 0.001553,
                    "planning_time": 1.886976
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n/*CURSOR_IDENTIFIER*/\n       group by c_last_name,c_first_name)\n",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.919806,
                    "execution_time": 1.657561,
                    "compile_time": 0.001517,
                    "planning_time": 1.825231
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.899986,
                    "execution_time": 1.638401,
                    "compile_time": 0.001513,
                    "planning_time": 1.807498
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) LIMIT 21",
                "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.929812,
                    "execution_time": 1.66742,
                    "compile_time": 0.001559,
                    "planning_time": 1.835064
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.914864,
                    "execution_time": 1.65305,
                    "compile_time": 0.001573,
                    "planning_time": 1.821246
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n     order by c_last_name,c_first_name,sales\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\" ORDER BY \"C_LAST_NAME\" NULLS LAST , \"C_FIRST_NAME\" NULLS LAST , \"SALES\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) ORDER BY C_LAST_NAME NULLS FIRST , C_FIRST_NAME NULLS FIRST , SALES NULLS FIRST LIMIT 21",
                "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.984255,
                    "execution_time": 1.665683,
                    "compile_time": 0.051831,
                    "planning_time": 1.837372
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 7.859541,
                    "execution_time": 1.668764,
                    "compile_time": 5.833966,
                    "planning_time": 1.921762
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/"
    },
    {
        "input": "\n\n with /* TPC-DS query23.tpl 0.68 part2 */ frequent_ss_items as\n (select substring(i_item_desc,1,30) itemdesc,i_item_sk item_sk,d_date solddate,count(*) cnt\n  from store_sales\n      ,date_dim\n      ,item\n  where ss_sold_date_sk = d_date_sk\n    and ss_item_sk = i_item_sk\n    and d_year in (1998,1998 + 1,1998 + 2,1998 + 3)\n  group by substring(i_item_desc,1,30),i_item_sk,d_date\n  having count(*) >4),\n max_store_sales as\n (select max(csales) tpcds_cmax\n  from (select c_customer_sk,sum(ss_quantity*ss_sales_price) csales\n        from store_sales\n            ,customer\n            ,date_dim \n        where ss_customer_sk = c_customer_sk\n         and ss_sold_date_sk = d_date_sk\n         and d_year in (1998,1998+1,1998+2,1998+3)\n        group by c_customer_sk)),\n best_ss_customer as\n (select c_customer_sk,sum(ss_quantity*ss_sales_price) ssales\n  from store_sales\n      ,customer\n  where ss_customer_sk = c_customer_sk\n  group by c_customer_sk\n  having sum(ss_quantity*ss_sales_price) > (95/100.0) * (select\n  *\n from max_store_sales))\n  select  c_last_name,c_first_name,sales\n from (select c_last_name,c_first_name,sum(cs_quantity*cs_list_price) sales\n        from catalog_sales\n            ,customer\n            ,date_dim \n        where d_year = 1998 \n         and d_moy = 4 \n         and cs_sold_date_sk = d_date_sk \n         and cs_item_sk in (select item_sk from frequent_ss_items)\n         and cs_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and cs_bill_customer_sk = c_customer_sk \n       group by c_last_name,c_first_name\n      union all\n      select c_last_name,c_first_name,sum(ws_quantity*ws_list_price) sales\n       from web_sales\n           ,customer\n           ,date_dim \n       where d_year = 1998 \n         and d_moy = 4 \n         and ws_sold_date_sk = d_date_sk \n         and ws_item_sk in (select item_sk from frequent_ss_items)\n         and ws_bill_customer_sk in (select c_customer_sk from best_ss_customer)\n         and ws_bill_customer_sk = c_customer_sk\n       group by c_last_name,c_first_name) \n     order by c_last_name,c_first_name,sales\n  limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"FREQUENT_SS_ITEMS\" AS ( SELECT \"ITEM\".\"I_ITEM_SK\" AS \"ITEM_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" GROUP BY SUBSTRING ( \"ITEM\".\"I_ITEM_DESC\" , 1 , 30 ) , \"ITEM\".\"I_ITEM_SK\" , \"DATE_DIM\".\"D_DATE\" HAVING COUNT ( * ) > 4 ) , \"CUSTOMER_2\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"_Q_0\" AS ( SELECT SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"CSALES\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND \"DATE_DIM\".\"D_YEAR\" IN ( 1998 , 1999 , 2000 , 2001 ) GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"MAX_STORE_SALES\" AS ( SELECT MAX ( \"_Q_0\".\"CSALES\" ) AS \"TPCDS_CMAX\" FROM \"_Q_0\" AS \"_Q_0\" ) , \"BEST_SS_CUSTOMER\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"STORE_SALES\" AS \"STORE_SALES\" CROSS JOIN \"MAX_STORE_SALES\" AS \"MAX_STORE_SALES\" JOIN \"CUSTOMER_2\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"STORE_SALES\".\"SS_CUSTOMER_SK\" GROUP BY \"CUSTOMER\".\"C_CUSTOMER_SK\" HAVING 0.95 * MAX ( \"MAX_STORE_SALES\".\"TPCDS_CMAX\" ) < SUM ( \"STORE_SALES\".\"SS_QUANTITY\" * \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) , \"_U_1\" AS ( SELECT \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" AS \"ITEM_SK\" FROM \"FREQUENT_SS_ITEMS\" AS \"FREQUENT_SS_ITEMS\" GROUP BY \"FREQUENT_SS_ITEMS\".\"ITEM_SK\" ) , \"_U_2\" AS ( SELECT \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" FROM \"BEST_SS_CUSTOMER\" AS \"BEST_SS_CUSTOMER\" GROUP BY \"BEST_SS_CUSTOMER\".\"C_CUSTOMER_SK\" ) , \"CUSTOMER_3\" AS ( SELECT \"CUSTOMER\".\"C_CUSTOMER_SK\" AS \"C_CUSTOMER_SK\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" FROM \"CUSTOMER\" AS \"CUSTOMER\" ) , \"DATE_DIM_4\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" FROM \"DATE_DIM\" AS \"DATE_DIM\" WHERE \"DATE_DIM\".\"D_MOY\" = 4 AND \"DATE_DIM\".\"D_YEAR\" = 1998 ) , \"_Q_1\" AS ( SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" * \"CATALOG_SALES\".\"CS_LIST_PRICE\" ) AS \"SALES\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"_U_1\" AS \"_U_1\" ON \"_U_1\".\"ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_2\" ON \"_U_2\".\"C_CUSTOMER_SK\" = \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" = \"CUSTOMER\".\"C_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE NOT \"_U_1\".\"ITEM_SK\" IS NULL AND NOT \"_U_2\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" UNION ALL SELECT \"CUSTOMER\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" * \"WEB_SALES\".\"WS_LIST_PRICE\" ) AS \"SALES\" FROM \"WEB_SALES\" AS \"WEB_SALES\" LEFT JOIN \"_U_1\" AS \"_U_3\" ON \"_U_3\".\"ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" LEFT JOIN \"_U_2\" AS \"_U_4\" ON \"_U_4\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"CUSTOMER_3\" AS \"CUSTOMER\" ON \"CUSTOMER\".\"C_CUSTOMER_SK\" = \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" JOIN \"DATE_DIM_4\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" WHERE NOT \"_U_3\".\"ITEM_SK\" IS NULL AND NOT \"_U_4\".\"C_CUSTOMER_SK\" IS NULL GROUP BY \"CUSTOMER\".\"C_LAST_NAME\" , \"CUSTOMER\".\"C_FIRST_NAME\" ) SELECT \"_Q_1\".\"C_LAST_NAME\" AS \"C_LAST_NAME\" , \"_Q_1\".\"C_FIRST_NAME\" AS \"C_FIRST_NAME\" , \"_Q_1\".\"SALES\" AS \"SALES\" FROM \"_Q_1\" AS \"_Q_1\" ORDER BY \"C_LAST_NAME\" NULLS LAST , \"C_FIRST_NAME\" NULLS LAST , \"SALES\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "WITH FREQUENT_SS_ITEMS AS ( SELECT SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) AS ITEMDESC , I_ITEM_SK AS ITEM_SK , D_DATE AS SOLDDATE , COUNT ( * ) AS CNT FROM STORE_SALES , DATE_DIM , ITEM WHERE SS_SOLD_DATE_SK = D_DATE_SK AND SS_ITEM_SK = I_ITEM_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY SUBSTRING ( I_ITEM_DESC FROM 1 FOR 30 ) , I_ITEM_SK , D_DATE HAVING COUNT ( * ) > 4 ) , MAX_STORE_SALES AS ( SELECT MAX ( CSALES ) AS TPCDS_CMAX FROM ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS CSALES FROM STORE_SALES , CUSTOMER , DATE_DIM WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND D_YEAR IN ( 1998 , 1998 + 1 , 1998 + 2 , 1998 + 3 ) GROUP BY C_CUSTOMER_SK ) ) , BEST_SS_CUSTOMER AS ( SELECT C_CUSTOMER_SK , SUM ( SS_QUANTITY * SS_SALES_PRICE ) AS SSALES FROM STORE_SALES , CUSTOMER WHERE SS_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_CUSTOMER_SK HAVING SUM ( SS_QUANTITY * SS_SALES_PRICE ) > ( 95 / 100.0 ) * ( SELECT * FROM MAX_STORE_SALES ) ) SELECT C_LAST_NAME , C_FIRST_NAME , SALES FROM ( SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( CS_QUANTITY * CS_LIST_PRICE ) AS SALES FROM CATALOG_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND CS_SOLD_DATE_SK = D_DATE_SK AND CS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND CS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND CS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME UNION ALL SELECT C_LAST_NAME , C_FIRST_NAME , SUM ( WS_QUANTITY * WS_LIST_PRICE ) AS SALES FROM WEB_SALES , CUSTOMER , DATE_DIM WHERE D_YEAR = 1998 AND D_MOY = 4 AND WS_SOLD_DATE_SK = D_DATE_SK AND WS_ITEM_SK IN ( SELECT ITEM_SK FROM FREQUENT_SS_ITEMS ) AND WS_BILL_CUSTOMER_SK IN ( SELECT C_CUSTOMER_SK FROM BEST_SS_CUSTOMER ) AND WS_BILL_CUSTOMER_SK = C_CUSTOMER_SK GROUP BY C_LAST_NAME , C_FIRST_NAME ) ORDER BY C_LAST_NAME NULLS FIRST , C_FIRST_NAME NULLS FIRST , SALES NULLS FIRST LIMIT 21",
                "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.927293,
                    "execution_time": 1.663743,
                    "compile_time": 0.001609,
                    "planning_time": 1.832426
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.91104,
                    "execution_time": 1.645391,
                    "compile_time": 0.001658,
                    "planning_time": 1.814799
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*Empty DataFrame\nColumns: [c_last_name, c_first_name, sales]\nIndex: []*/"
    }
]