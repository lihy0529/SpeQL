[
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name,\n        v1.d_year, v1.d_moy,\n        v1.avg_monthly_sales,\n        v1.sum_sales, lag(v1.sum_sales) over \n          (partition by v1.i_category, v1.i_brand, v1.s_store_name, v1.s_company_name order by v1.d_year, v1.d_moy) psum, \n        lead(v1.sum_sales) over \n          (partition by v1.i_category, v1.i_brand, v1.s_store_name, v1.s_company_name order by v1.d_year, v1.d_moy) nsum\n from v1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) , \"V2\" AS ( SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , LAG ( \"V1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"V1\".\"I_CATEGORY\" , \"V1\".\"I_BRAND\" , \"V1\".\"S_STORE_NAME\" , \"V1\".\"S_COMPANY_NAME\" ORDER BY \"V1\".\"D_YEAR\" NULLS LAST , \"V1\".\"D_MOY\" NULLS LAST ) AS \"PSUM\" , LEAD ( \"V1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"V1\".\"I_CATEGORY\" , \"V1\".\"I_BRAND\" , \"V1\".\"S_STORE_NAME\" , \"V1\".\"S_COMPANY_NAME\" ORDER BY \"V1\".\"D_YEAR\" NULLS LAST , \"V1\".\"D_MOY\" NULLS LAST ) AS \"NSUM\" FROM \"V1\" AS \"V1\" ) SELECT \"V2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V2\".\"D_YEAR\" AS \"D_YEAR\" , \"V2\".\"D_MOY\" AS \"D_MOY\" , \"V2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V2\".\"PSUM\" AS \"PSUM\" , \"V2\".\"NSUM\" AS \"NSUM\" FROM \"V2\" AS \"V2\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.869218,
                    "execution_time": 0.394539,
                    "compile_time": 0.16703,
                    "planning_time": 0.056886,
                    "create_size": 1386
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 11.315014,
                    "execution_time": 1.290321,
                    "compile_time": 9.628901,
                    "planning_time": 0.1336,
                    "create_size": 1386
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , LAG ( \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_COMPANY_NAME\" ORDER BY \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" NULLS LAST ) AS \"PSUM\" , LEAD ( \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" ) OVER ( PARTITION BY \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_COMPANY_NAME\" ORDER BY \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" NULLS LAST ) AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.382781,
                    "execution_time": 0.094487,
                    "compile_time": 0.000383,
                    "planning_time": 0.006048,
                    "create_size": 1220
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.452186,
                    "execution_time": 0.097221,
                    "compile_time": 0.000376,
                    "planning_time": 0.063306,
                    "create_size": 1230
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_2\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0         ought    2001      7             423.15     216.44   316.19   459.24\n1         ought    2001      8             423.15     459.24   216.44   519.18\n2         ought    2001      9             423.15     519.18   459.24   317.94\n3         ought    2001     10             423.15     317.94   519.18   756.68\n4         ought    2001     11             423.15     756.68   317.94  1010.11\n5         ought    2001     12             423.15    1010.11   756.68   111.25\n6         ought    2002      1             111.25     111.25  1010.11      NaN\n7          n st    2000     12             942.31     942.31      NaN   214.38\n8          n st    2001      1             296.58     214.38   942.31   251.73\n9          n st    2001      2             296.58     251.73   214.38    83.31\n10         n st    2001      3             296.58      83.31   251.73   124.23\n11         n st    2001      4             296.58     124.23    83.31   142.39\n12         n st    2001      5             296.58     142.39   124.23    78.54\n13         n st    2001      6             296.58      78.54   142.39   214.34\n14         n st    2001      7             296.58     214.34    78.54   373.11\n15         n st    2001      8             296.58     373.11   214.34   359.12\n16         n st    2001      9             296.58     359.12   373.11   739.15\n17         n st    2001     10             296.58     739.15   359.12   281.56\n18         n st    2001     11             296.58     281.56   739.15   697.17\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.018225,
                    "execution_time": 0.008139,
                    "compile_time": 4.6e-05,
                    "planning_time": 0.003829
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.056244,
                    "execution_time": 0.007867,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.039115
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_2\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_2\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_2\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_2\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0         ought    2001      7             423.15     216.44   316.19   459.24\n1         ought    2001      8             423.15     459.24   216.44   519.18\n2         ought    2001      9             423.15     519.18   459.24   317.94\n3         ought    2001     10             423.15     317.94   519.18   756.68\n4         ought    2001     11             423.15     756.68   317.94  1010.11\n5         ought    2001     12             423.15    1010.11   756.68   111.25\n6         ought    2002      1             111.25     111.25  1010.11      NaN\n7          n st    2000     12             942.31     942.31      NaN   214.38\n8          n st    2001      1             296.58     214.38   942.31   251.73\n9          n st    2001      2             296.58     251.73   214.38    83.31\n10         n st    2001      3             296.58      83.31   251.73   124.23\n11         n st    2001      4             296.58     124.23    83.31   142.39\n12         n st    2001      5             296.58     142.39   124.23    78.54\n13         n st    2001      6             296.58      78.54   142.39   214.34\n14         n st    2001      7             296.58     214.34    78.54   373.11\n15         n st    2001      8             296.58     373.11   214.34   359.12\n16         n st    2001      9             296.58     359.12   373.11   739.15\n17         n st    2001     10             296.58     739.15   359.12   281.56\n18         n st    2001     11             296.58     281.56   739.15   697.17\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\nwhere v1.s_store_name = v1_lag.s_store_name\nand v1.s_store_name = v1_lead.s_store_name\nand v1_lag.d_year = v1.d_year\nand v1_lead.d_year = v1.d_year\nand v1_lag.d_moy = v1.d_moy - 1\nand v1_lead.d_moy = v1.d_moy + 1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1_LAG.D_YEAR = V1.D_YEAR AND V1_LEAD.D_YEAR = V1.D_YEAR AND V1_LAG.D_MOY = V1.D_MOY - 1 AND V1_LEAD.D_MOY = V1.D_MOY + 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum   nsum\n0           ese    2001      8            2033.93    2915.67  1873.67  83.28\n1           ese    2001      8            2033.93    2915.67   402.36  83.28\n2           ese    2001      8            2033.93    2915.67   540.23  83.28\n3           ese    2001      8            2033.93    2915.67   607.94  83.28\n4           ese    2001      8            2033.93    2915.67    82.24  83.28\n5           ese    2001      8            2033.93    2915.67     3.66  83.28\n6           ese    2001      8            2033.93    2915.67    33.87  83.28\n7           ese    2001      8            2033.93    2915.67     4.09  83.28\n8           ese    2001      8            2033.93    2915.67   174.39  83.28\n9           ese    2001      8            2033.93    2915.67    34.38  83.28\n10          ese    2001      8            2033.93    2915.67    63.63  83.28\n11          ese    2001      8            2033.93    2915.67    20.14  83.28\n12          ese    2001      8            2033.93    2915.67    42.15  83.28\n13          ese    2001      8            2033.93    2915.67   428.64  83.28\n14          ese    2001      8            2033.93    2915.67    94.00  83.28\n15          ese    2001      8            2033.93    2915.67    93.98  83.28\n16          ese    2001      8            2033.93    2915.67   467.86  83.28\n17          ese    2001      8            2033.93    2915.67   217.16  83.28\n18          ese    2001      8            2033.93    2915.67   414.88  83.28\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 2.110871,
                    "execution_time": 1.807115,
                    "compile_time": 0.000921,
                    "planning_time": 0.555003
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 2.086034,
                    "execution_time": 1.708221,
                    "compile_time": 0.000931,
                    "planning_time": 0.631115
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum   nsum\n0           ese    2001      8            2033.93    2915.67  1873.67  83.28\n1           ese    2001      8            2033.93    2915.67   402.36  83.28\n2           ese    2001      8            2033.93    2915.67   540.23  83.28\n3           ese    2001      8            2033.93    2915.67   607.94  83.28\n4           ese    2001      8            2033.93    2915.67    82.24  83.28\n5           ese    2001      8            2033.93    2915.67     3.66  83.28\n6           ese    2001      8            2033.93    2915.67    33.87  83.28\n7           ese    2001      8            2033.93    2915.67     4.09  83.28\n8           ese    2001      8            2033.93    2915.67   174.39  83.28\n9           ese    2001      8            2033.93    2915.67    34.38  83.28\n10          ese    2001      8            2033.93    2915.67    63.63  83.28\n11          ese    2001      8            2033.93    2915.67    20.14  83.28\n12          ese    2001      8            2033.93    2915.67    42.15  83.28\n13          ese    2001      8            2033.93    2915.67   428.64  83.28\n14          ese    2001      8            2033.93    2915.67    94.00  83.28\n15          ese    2001      8            2033.93    2915.67    93.98  83.28\n16          ese    2001      8            2033.93    2915.67   467.86  83.28\n17          ese    2001      8            2033.93    2915.67   217.16  83.28\n18          ese    2001      8            2033.93    2915.67   414.88  83.28\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n/*CURSOR_IDENTIFIER*/ v1.i_brand = v1_lag.i_brand\n and v1.s_store_name = v1_lag.s_store_name\n and v1.s_company_name = v1_lag.s_company_name\n and v1.d_year = v1_lag.d_year + 1\n and v1.i_category = v1_lead.i_category\n and v1.i_brand = v1_lead.i_brand\n and v1.s_store_name = v1_lead.s_store_name\n and v1.s_company_name = v1_lead.s_company_name\n and v1.d_year + 1 = v1_lead.d_year\n and v1.d_moy = 12\n) \nselect * from v2\norder by s_store_name, d_year, d_moy;",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.D_YEAR = V1_LAG.D_YEAR + 1 AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.D_YEAR + 1 = V1_LEAD.D_YEAR AND V1.D_MOY = 12 ) SELECT * FROM V2 ORDER BY S_STORE_NAME NULLS FIRST , D_YEAR NULLS FIRST , D_MOY NULLS FIRST LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          able    2001     12            2813.68    6179.80   4590.85   1381.97\n1          able    2001     12            2323.83    4383.43   2974.82   1348.39\n2          able    2001     12            3750.62    7839.73   4731.30   2181.96\n3          able    2001     12            2596.58    5335.70   4671.03   1687.70\n4          able    2001     12             620.08    1090.05    577.34    428.37\n5          able    2001     12            4168.58    8598.49   6136.73   2054.83\n6          able    2001     12             743.04    1002.34   2067.72    496.16\n7          able    2001     12             795.96    2164.02   1880.50    129.58\n8          able    2001     12            2653.60    4618.32   3978.78   1246.96\n9          able    2001     12            2402.74    5381.36   3177.02   1582.37\n10         able    2001     12            3361.29    7754.30   4751.23   1636.01\n11         able    2001     12             819.24    2044.10   1799.10    484.18\n12         able    2001     12           57174.75  116893.26  76492.95  28355.45\n13         able    2001     12            3094.70    6997.12   4282.77   1231.89\n14         able    2001     12            1041.50    2063.96   1512.11    597.60\n15         able    2001     12             991.58    1519.53   1415.63    366.11\n16         able    2001     12            3781.94    7464.93   5090.93   1589.17\n17         able    2001     12            3630.06    6916.87   4190.59   1749.31\n18         able    2001     12           56166.97  115739.11  75696.81  27862.60\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.008774,
                    "execution_time": 0.632247,
                    "compile_time": 0.000995,
                    "planning_time": 0.651223
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.076898,
                    "execution_time": 0.627093,
                    "compile_time": 0.000996,
                    "planning_time": 0.715706
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          able    2001     12            2813.68    6179.80   4590.85   1381.97\n1          able    2001     12            2323.83    4383.43   2974.82   1348.39\n2          able    2001     12            3750.62    7839.73   4731.30   2181.96\n3          able    2001     12            2596.58    5335.70   4671.03   1687.70\n4          able    2001     12             620.08    1090.05    577.34    428.37\n5          able    2001     12            4168.58    8598.49   6136.73   2054.83\n6          able    2001     12             743.04    1002.34   2067.72    496.16\n7          able    2001     12             795.96    2164.02   1880.50    129.58\n8          able    2001     12            2653.60    4618.32   3978.78   1246.96\n9          able    2001     12            2402.74    5381.36   3177.02   1582.37\n10         able    2001     12            3361.29    7754.30   4751.23   1636.01\n11         able    2001     12             819.24    2044.10   1799.10    484.18\n12         able    2001     12           57174.75  116893.26  76492.95  28355.45\n13         able    2001     12            3094.70    6997.12   4282.77   1231.89\n14         able    2001     12            1041.50    2063.96   1512.11    597.60\n15         able    2001     12             991.58    1519.53   1415.63    366.11\n16         able    2001     12            3781.94    7464.93   5090.93   1589.17\n17         able    2001     12            3630.06    6916.87   4190.59   1749.31\n18         able    2001     12           56166.97  115739.11  75696.81  27862.60\n...*/"
    },
    {
        "input": "with /* TPC-DS query47.tpl 0.42 */ v1 as (\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from store_sales, item, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy\n),\nv2 as (\n  select v1.s_store_name, v1.d_year, v1.d_moy,\n         v1.avg_monthly_sales, v1.sum_sales, \n         v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n  from v1\n  left join v1 v1_lag \n    on v1.i_category = v1_lag.i_category \n    and v1.s_store_name = v1_lag.s_store_name\n    and v1.d_year = v1_lag.d_year \n    and v1.d_moy = v1_lag.d_moy + 1\n  left join v1 v1_lead \n    on v1.i_category = v1_lead.i_category \n    and v1.s_store_name = v1_lead.s_store_name\n    and v1.d_year = v1_lead.d_year \n    and v1.d_moy = v1_lead.d_moy - 1\n  where v1.rn = 1\n)\nselect * from v2;\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" LEFT JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"V1\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" LEFT JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"V1\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"V1\".\"RN\" = 1"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"ITEM\" AS \"ITEM\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.798265,
                    "execution_time": 0.385897,
                    "compile_time": 0.129058,
                    "planning_time": 0.056093,
                    "create_size": 1240
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 8.003568,
                    "execution_time": 0.983055,
                    "compile_time": 6.648099,
                    "planning_time": 0.13721,
                    "create_size": 1240
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_3\".\"RN\" = 1",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.338109,
                    "execution_time": 0.084798,
                    "compile_time": 0.000434,
                    "planning_time": 0.012797,
                    "create_size": 110
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.413765,
                    "execution_time": 0.085329,
                    "compile_time": 0.000449,
                    "planning_time": 0.072588,
                    "create_size": 110
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_4\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales  psum    nsum\n0          n st    2002      1             935.45     935.45  None     NaN\n1          anti    2001      1              46.93      55.92  None   20.33\n2          anti    2001      1              46.93      55.92  None   83.81\n3          anti    2001      1              46.93      55.92  None   19.59\n4          anti    2001      1              46.93      55.92  None  121.01\n5          anti    2001      1              46.93      55.92  None   56.86\n6          anti    2001      1              46.93      55.92  None   38.11\n7          anti    2001      1              46.93      55.92  None   32.29\n8          anti    2001      1              46.93      55.92  None   46.11\n9          anti    2001      1              46.93      55.92  None    8.34\n10         anti    2001      1              46.93      55.92  None   32.12\n11         anti    2001      1              46.93      55.92  None    7.28\n12         anti    2001      1              46.93      55.92  None  677.43\n13         anti    2001      1              46.93      55.92  None    8.54\n14         anti    2001      1              46.93      55.92  None   82.45\n15         anti    2001      1              46.93      55.92  None   63.89\n16         anti    2001      1              46.93      55.92  None    0.08\n17         n st    2002      1             487.55     487.55  None     NaN\n18         anti    2001      1              49.69      84.45  None   20.33\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.01732,
                    "execution_time": 0.00713,
                    "compile_time": 4.6e-05,
                    "planning_time": 0.003925
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.055969,
                    "execution_time": 0.007378,
                    "compile_time": 4.7e-05,
                    "planning_time": 0.039416
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_3\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_3\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LAG\".\"D_MOY\" + 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_3\".\"D_MOY\" = \"V1_LEAD\".\"D_MOY\" - 1 AND \"SPEQLITE_TEMP_TABLE_3\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" AND \"SPEQLITE_TEMP_TABLE_3\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_3\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_3\".\"RN\" = 1",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_4\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_4\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_4\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales  psum    nsum\n0          n st    2002      1             935.45     935.45  None     NaN\n1          anti    2001      1              46.93      55.92  None   20.33\n2          anti    2001      1              46.93      55.92  None   83.81\n3          anti    2001      1              46.93      55.92  None   19.59\n4          anti    2001      1              46.93      55.92  None  121.01\n5          anti    2001      1              46.93      55.92  None   56.86\n6          anti    2001      1              46.93      55.92  None   38.11\n7          anti    2001      1              46.93      55.92  None   32.29\n8          anti    2001      1              46.93      55.92  None   46.11\n9          anti    2001      1              46.93      55.92  None    8.34\n10         anti    2001      1              46.93      55.92  None   32.12\n11         anti    2001      1              46.93      55.92  None    7.28\n12         anti    2001      1              46.93      55.92  None  677.43\n13         anti    2001      1              46.93      55.92  None    8.54\n14         anti    2001      1              46.93      55.92  None   82.45\n15         anti    2001      1              46.93      55.92  None   63.89\n16         anti    2001      1              46.93      55.92  None    0.08\n17         n st    2002      1             487.55     487.55  None     NaN\n18         anti    2001      1              49.69      84.45  None   20.33\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "with /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.d_year = v1_lag.d_year and\n       v1.d_year = v1_lead.d_year and\n       v1.d_moy = v1_lag.d_moy + 1 and\n       v1.d_moy = v1_lead.d_moy - 1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.D_YEAR = V1_LAG.D_YEAR AND V1.D_YEAR = V1_LEAD.D_YEAR AND V1.D_MOY = V1_LAG.D_MOY + 1 AND V1.D_MOY = V1_LEAD.D_MOY - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0           ese    2001      4            2033.93    1381.76  1127.70  1052.67\n1           ese    2001      5            2033.93    1052.67  1381.76  1390.22\n2           ese    2001      6            2033.93    1390.22  1052.67  1335.24\n3           ese    2001      7            2033.93    1335.24  1390.22  2915.67\n4           ese    2001      9            2033.93    2496.10  2915.67  2295.51\n5           ese    2001      2            2033.93     843.28  1175.98  1127.70\n6           ese    2001     11            2033.93    3878.31  2295.51  4514.77\n7           ese    2001      8            2033.93    2915.67  1335.24  2496.10\n8           ese    2001     10            2033.93    2295.51  2496.10  3878.31\n9           ese    2001      3            2033.93    1127.70   843.28  1381.76\n10          pri    2001      2             826.89     477.20   733.30   393.83\n11          pri    2001      6             826.89     706.62   304.68   543.79\n12          pri    2001      7             826.89     543.79   706.62  1053.32\n13          pri    2001      9             826.89    1201.61  1053.32   592.95\n14          pri    2001      5             826.89     304.68   399.70   706.62\n15          pri    2001      8             826.89    1053.32   543.79  1201.61\n16          pri    2001     10             826.89     592.95  1201.61  2015.72\n17          pri    2001      3             826.89     393.83   477.20   399.70\n18          pri    2001     11             826.89    2015.72   592.95  1499.98\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.149696,
                    "execution_time": 0.652511,
                    "compile_time": 0.086798,
                    "planning_time": 0.770176
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.458026,
                    "execution_time": 0.671151,
                    "compile_time": 3.309832,
                    "planning_time": 4.066769
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0           ese    2001      4            2033.93    1381.76  1127.70  1052.67\n1           ese    2001      5            2033.93    1052.67  1381.76  1390.22\n2           ese    2001      6            2033.93    1390.22  1052.67  1335.24\n3           ese    2001      7            2033.93    1335.24  1390.22  2915.67\n4           ese    2001      9            2033.93    2496.10  2915.67  2295.51\n5           ese    2001      2            2033.93     843.28  1175.98  1127.70\n6           ese    2001     11            2033.93    3878.31  2295.51  4514.77\n7           ese    2001      8            2033.93    2915.67  1335.24  2496.10\n8           ese    2001     10            2033.93    2295.51  2496.10  3878.31\n9           ese    2001      3            2033.93    1127.70   843.28  1381.76\n10          pri    2001      2             826.89     477.20   733.30   393.83\n11          pri    2001      6             826.89     706.62   304.68   543.79\n12          pri    2001      7             826.89     543.79   706.62  1053.32\n13          pri    2001      9             826.89    1201.61  1053.32   592.95\n14          pri    2001      5             826.89     304.68   399.70   706.62\n15          pri    2001      8             826.89    1053.32   543.79  1201.61\n16          pri    2001     10             826.89     592.95  1201.61  2015.72\n17          pri    2001      3             826.89     393.83   477.20   399.70\n18          pri    2001     11             826.89    2015.72   592.95  1499.98\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1\n join v1 as v1_lag on v1.i_category = v1_lag.i_category and\n                      v1.i_brand = v1_lag.i_brand and\n                      v1.s_store_name = v1_lag.s_store_name and\n                      v1.d_year = v1_lag.d_year - 1\n join v1 as v1_lead on v1.i_category = v1_lead.i_category and\n                       v1.i_brand = v1_lead.i_brand and\n                       v1.s_store_name = v1_lead.s_store_name and\n                       v1.d_year = v1_lead.d_year + 1\nwhere v1.d_moy between 1 and 12\n/*CURSOR_IDENTIFIER*/\n) \nselect * from v2;",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" - 1 AND \"V1\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" + 1 AND \"V1\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"V1\".\"D_MOY\" <= 12 AND \"V1\".\"D_MOY\" >= 1"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"SPEQLITE_TEMP_TABLE_1\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"SPEQLITE_TEMP_TABLE_1\".\"I_BRAND\" AS \"I_BRAND\" , \"SPEQLITE_TEMP_TABLE_1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_1\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" FROM \"SPEQLITE_TEMP_TABLE_1\" AS \"SPEQLITE_TEMP_TABLE_1\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.387317,
                    "execution_time": 0.077315,
                    "compile_time": 0.068201,
                    "planning_time": 0.00411,
                    "create_size": 1200
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.640196,
                    "execution_time": 0.076855,
                    "compile_time": 3.256439,
                    "planning_time": 0.060687,
                    "create_size": 1240
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_5\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_5\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" - 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" + 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" <= 12 AND \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" >= 1",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.309692,
                    "execution_time": 0.09311,
                    "compile_time": 0.000478,
                    "planning_time": 0.01158,
                    "create_size": 900
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.388938,
                    "execution_time": 0.097548,
                    "compile_time": 0.00048,
                    "planning_time": 0.080029,
                    "create_size": 910
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_6\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_6\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_6\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum     nsum\n0           bar    2001     12             122.00     199.29   13.98    73.18\n1           bar    2001     11             122.00     159.52   13.98    73.18\n2           bar    2001      8             122.00      46.35   13.98    73.18\n3           bar    2001      6             122.00       5.39   13.98    73.18\n4           bar    2001      5             122.00     264.14   13.98    73.18\n5           bar    2001     10             122.00      64.24   13.98    73.18\n6         ation    2001      4            1516.43     875.44  643.86  1677.85\n7         ation    2001      6            1516.43    1315.33  643.86  1677.85\n8         ation    2001      5            1516.43     785.36  643.86  1677.85\n9         ation    2001     12            1516.43    2530.78  643.86  1677.85\n10        ation    2001     10            1516.43    1604.73  643.86  1677.85\n11        ation    2001      2            1516.43     985.15  643.86  1677.85\n12        ation    2001      1            1516.43     977.26  643.86  1677.85\n13        ation    2001      7            1516.43     909.22  643.86  1677.85\n14        ation    2001      3            1516.43     828.24  643.86  1677.85\n15        ation    2001      8            1516.43    1694.80  643.86  1677.85\n16        ation    2001     11            1516.43    3491.83  643.86  1677.85\n17        ation    2001      9            1516.43    2199.03  643.86  1677.85\n18          pri    2001      3              71.95      14.97   27.37   282.69\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017964,
                    "execution_time": 0.007352,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.004289
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.057059,
                    "execution_time": 0.008085,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.039507
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_5\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_5\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LAG\".\"D_YEAR\" - 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_5\".\"D_YEAR\" = \"V1_LEAD\".\"D_YEAR\" + 1 AND \"SPEQLITE_TEMP_TABLE_5\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_5\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_5\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\" WHERE \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" <= 12 AND \"SPEQLITE_TEMP_TABLE_5\".\"D_MOY\" >= 1",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_6\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_6\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_6\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_6\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_6\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum     nsum\n0           bar    2001     12             122.00     199.29   13.98    73.18\n1           bar    2001     11             122.00     159.52   13.98    73.18\n2           bar    2001      8             122.00      46.35   13.98    73.18\n3           bar    2001      6             122.00       5.39   13.98    73.18\n4           bar    2001      5             122.00     264.14   13.98    73.18\n5           bar    2001     10             122.00      64.24   13.98    73.18\n6         ation    2001      4            1516.43     875.44  643.86  1677.85\n7         ation    2001      6            1516.43    1315.33  643.86  1677.85\n8         ation    2001      5            1516.43     785.36  643.86  1677.85\n9         ation    2001     12            1516.43    2530.78  643.86  1677.85\n10        ation    2001     10            1516.43    1604.73  643.86  1677.85\n11        ation    2001      2            1516.43     985.15  643.86  1677.85\n12        ation    2001      1            1516.43     977.26  643.86  1677.85\n13        ation    2001      7            1516.43     909.22  643.86  1677.85\n14        ation    2001      3            1516.43     828.24  643.86  1677.85\n15        ation    2001      8            1516.43    1694.80  643.86  1677.85\n16        ation    2001     11            1516.43    3491.83  643.86  1677.85\n17        ation    2001      9            1516.43    2199.03  643.86  1677.85\n18          pri    2001      3              71.95      14.97   27.37   282.69\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy = 12) or\n         ( d_year = 2001+1 and d_moy = 1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1, v1 as v1_lag, v1 as v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1\n)\nselect * from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          able    2001      1            2163.26    1278.42  5297.02   881.59\n1          able    2001      2            2163.26     881.59  1278.42   847.66\n2          able    2001      3            2163.26     847.66   881.59  1164.42\n3          able    2001      4            2163.26    1164.42   847.66   820.38\n4          able    2001      5            2163.26     820.38  1164.42  1006.53\n5          able    2001      6            2163.26    1006.53   820.38  1867.62\n6          able    2001      7            2163.26    1867.62  1006.53  3040.44\n7          able    2001      8            2163.26    3040.44  1867.62  2585.66\n8          able    2001      9            2163.26    2585.66  3040.44  3381.12\n9          able    2001     10            2163.26    3381.12  2585.66  4142.38\n10         able    2001     11            2163.26    4142.38  3381.12  4942.93\n11         able    2001     12            2163.26    4942.93  4142.38  1786.68\n12        cally    2001      1            1770.57    1094.39  4552.19  1008.28\n13        cally    2001      2            1770.57    1008.28  1094.39   927.69\n14        cally    2001      3            1770.57     927.69  1008.28   497.61\n15        cally    2001      4            1770.57     497.61   927.69   862.89\n16        cally    2001      5            1770.57     862.89   497.61  1409.87\n17        cally    2001      6            1770.57    1409.87   862.89   693.00\n18        cally    2001      7            1770.57     693.00  1409.87  2193.65\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.017372,
                    "execution_time": 0.670729,
                    "compile_time": 0.001089,
                    "planning_time": 0.63121
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.103984,
                    "execution_time": 0.686926,
                    "compile_time": 0.001087,
                    "planning_time": 0.708339
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          able    2001      1            2163.26    1278.42  5297.02   881.59\n1          able    2001      2            2163.26     881.59  1278.42   847.66\n2          able    2001      3            2163.26     847.66   881.59  1164.42\n3          able    2001      4            2163.26    1164.42   847.66   820.38\n4          able    2001      5            2163.26     820.38  1164.42  1006.53\n5          able    2001      6            2163.26    1006.53   820.38  1867.62\n6          able    2001      7            2163.26    1867.62  1006.53  3040.44\n7          able    2001      8            2163.26    3040.44  1867.62  2585.66\n8          able    2001      9            2163.26    2585.66  3040.44  3381.12\n9          able    2001     10            2163.26    3381.12  2585.66  4142.38\n10         able    2001     11            2163.26    4142.38  3381.12  4942.93\n11         able    2001     12            2163.26    4942.93  4142.38  1786.68\n12        cally    2001      1            1770.57    1094.39  4552.19  1008.28\n13        cally    2001      2            1770.57    1008.28  1094.39   927.69\n14        cally    2001      3            1770.57     927.69  1008.28   497.61\n15        cally    2001      4            1770.57     497.61   927.69   862.89\n16        cally    2001      5            1770.57     862.89   497.61  1409.87\n17        cally    2001      6            1770.57    1409.87   862.89   693.00\n18        cally    2001      7            1770.57     693.00  1409.87  2193.65\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) as sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year) as avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) as rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2000 and d_moy =12) or\n         ( d_year = 2002 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name,\n        v1.d_year, v1.d_moy,\n        v1.avg_monthly_sales,\n        v1.sum_sales, v1_lag.sum_sales as psum, v1_lead.sum_sales as nsum\n from v1\n join v1 as v1_lag on v1.i_category = v1_lag.i_category and\n                      v1.i_brand = v1_lag.i_brand and\n                      v1.s_store_name = v1_lag.s_store_name and\n                      v1.s_company_name = v1_lag.s_company_name and\n                      v1.rn = v1_lag.rn + 1\n join v1 as v1_lead on v1.i_category = v1_lead.i_category and\n                       v1.i_brand = v1_lead.i_brand and\n                       v1.s_store_name = v1_lead.s_store_name and\n                       v1.s_company_name = v1_lead.s_company_name and\n                       v1.rn = v1_lead.rn - 1\n)\nselect *\nfrom v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"V1\" AS ( SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" ) SELECT \"V1\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"V1\".\"D_YEAR\" AS \"D_YEAR\" , \"V1\".\"D_MOY\" AS \"D_MOY\" , \"V1\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"V1\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"V1\" AS \"V1\" JOIN \"V1\" AS \"V1_LAG\" ON \"V1\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"V1\".\"RN\" = \"V1_LAG\".\"RN\" + 1 AND \"V1\".\"S_COMPANY_NAME\" = \"V1_LAG\".\"S_COMPANY_NAME\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"V1\" AS \"V1_LEAD\" ON \"V1\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"V1\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"V1\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 AND \"V1\".\"S_COMPANY_NAME\" = \"V1_LEAD\".\"S_COMPANY_NAME\" AND \"V1\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"ITEM\".\"I_CATEGORY\" AS \"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" AS \"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" AS \"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" , \"DATE_DIM\".\"D_MOY\" AS \"D_MOY\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SUM_SALES\" , AVG ( SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" ) AS \"AVG_MONTHLY_SALES\" , RANK ( ) OVER ( PARTITION BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" ORDER BY \"DATE_DIM\".\"D_YEAR\" NULLS LAST , \"DATE_DIM\".\"D_MOY\" NULLS LAST ) AS \"RN\" FROM \"ITEM\" AS \"ITEM\" JOIN \"STORE_SALES\" AS \"STORE_SALES\" ON \"ITEM\".\"I_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" JOIN \"DATE_DIM\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 1 OR \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 ) AND ( \"DATE_DIM\".\"D_MOY\" = 12 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) AND ( \"DATE_DIM\".\"D_YEAR\" = 2000 OR \"DATE_DIM\".\"D_YEAR\" = 2001 OR \"DATE_DIM\".\"D_YEAR\" = 2002 ) JOIN \"STORE\" AS \"STORE\" ON \"STORE\".\"S_STORE_SK\" = \"STORE_SALES\".\"SS_STORE_SK\" GROUP BY \"ITEM\".\"I_CATEGORY\" , \"ITEM\".\"I_BRAND\" , \"STORE\".\"S_STORE_NAME\" , \"STORE\".\"S_COMPANY_NAME\" , \"DATE_DIM\".\"D_YEAR\" , \"DATE_DIM\".\"D_MOY\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.738919,
                    "execution_time": 0.40738,
                    "compile_time": 0.000735,
                    "planning_time": 0.058369,
                    "create_size": 1488
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.946031,
                    "execution_time": 0.395971,
                    "compile_time": 0.140295,
                    "planning_time": 0.134904,
                    "create_size": 1488
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_7\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_7\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LAG\".\"RN\" + 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LAG\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LEAD\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.424917,
                    "execution_time": 0.115168,
                    "compile_time": 0.054027,
                    "planning_time": 0.011511,
                    "create_size": 1010
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.58561,
                    "execution_time": 0.123118,
                    "compile_time": 6.133865,
                    "planning_time": 0.07092,
                    "create_size": 990
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_8\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_8\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0         ation    2001      9            1150.18     908.10  1585.91  1591.91\n1         ation    2001     10            1150.18    1591.91   908.10  2373.38\n2         ation    2001     11            1150.18    2373.38  1591.91  2294.94\n3           bar    2001      1            1943.22    1371.43  3341.56  1189.52\n4           bar    2001      2            1943.22    1189.52  1371.43  1470.62\n5           bar    2001      3            1943.22    1470.62  1189.52  1174.12\n6           bar    2001      4            1943.22    1174.12  1470.62  1306.29\n7           bar    2001      5            1943.22    1306.29  1174.12  1130.07\n8           bar    2001      6            1943.22    1130.07  1306.29   830.13\n9           bar    2001      7            1943.22     830.13  1130.07  2738.51\n10          bar    2001      8            1943.22    2738.51   830.13  2415.16\n11          bar    2001      9            1943.22    2415.16  2738.51  2571.95\n12          bar    2001     10            1943.22    2571.95  2415.16  3309.79\n13          bar    2001     11            1943.22    3309.79  2571.95  3811.09\n14          ese    2001      1            1849.69    1128.87  4468.90   793.69\n15          ese    2001      2            1849.69     793.69  1128.87   825.62\n16          ese    2001      3            1849.69     825.62   793.69  1085.09\n17          ese    2001      4            1849.69    1085.09   825.62  1095.69\n18          ese    2001      5            1849.69    1095.69  1085.09   787.33\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.017576,
                    "execution_time": 0.00734,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.003978
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.055535,
                    "execution_time": 0.008071,
                    "compile_time": 4.9e-05,
                    "planning_time": 0.039437
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_7\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_7\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_7\".\"SUM_SALES\" AS \"SUM_SALES\" , \"V1_LAG\".\"SUM_SALES\" AS \"PSUM\" , \"V1_LEAD\".\"SUM_SALES\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LAG\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LAG\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LAG\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LAG\".\"RN\" + 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LAG\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LAG\".\"S_STORE_NAME\" JOIN \"SPEQLITE_TEMP_TABLE_7\" AS \"V1_LEAD\" ON \"SPEQLITE_TEMP_TABLE_7\".\"I_BRAND\" = \"V1_LEAD\".\"I_BRAND\" AND \"SPEQLITE_TEMP_TABLE_7\".\"I_CATEGORY\" = \"V1_LEAD\".\"I_CATEGORY\" AND \"SPEQLITE_TEMP_TABLE_7\".\"RN\" = \"V1_LEAD\".\"RN\" - 1 AND \"SPEQLITE_TEMP_TABLE_7\".\"S_COMPANY_NAME\" = \"V1_LEAD\".\"S_COMPANY_NAME\" AND \"SPEQLITE_TEMP_TABLE_7\".\"S_STORE_NAME\" = \"V1_LEAD\".\"S_STORE_NAME\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"S_STORE_NAME\" AS \"S_STORE_NAME\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_YEAR\" AS \"D_YEAR\" , \"SPEQLITE_TEMP_TABLE_8\".\"D_MOY\" AS \"D_MOY\" , \"SPEQLITE_TEMP_TABLE_8\".\"AVG_MONTHLY_SALES\" AS \"AVG_MONTHLY_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"SUM_SALES\" AS \"SUM_SALES\" , \"SPEQLITE_TEMP_TABLE_8\".\"PSUM\" AS \"PSUM\" , \"SPEQLITE_TEMP_TABLE_8\".\"NSUM\" AS \"NSUM\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\""
            }
        ],
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0         ation    2001      9            1150.18     908.10  1585.91  1591.91\n1         ation    2001     10            1150.18    1591.91   908.10  2373.38\n2         ation    2001     11            1150.18    2373.38  1591.91  2294.94\n3           bar    2001      1            1943.22    1371.43  3341.56  1189.52\n4           bar    2001      2            1943.22    1189.52  1371.43  1470.62\n5           bar    2001      3            1943.22    1470.62  1189.52  1174.12\n6           bar    2001      4            1943.22    1174.12  1470.62  1306.29\n7           bar    2001      5            1943.22    1306.29  1174.12  1130.07\n8           bar    2001      6            1943.22    1130.07  1306.29   830.13\n9           bar    2001      7            1943.22     830.13  1130.07  2738.51\n10          bar    2001      8            1943.22    2738.51   830.13  2415.16\n11          bar    2001      9            1943.22    2415.16  2738.51  2571.95\n12          bar    2001     10            1943.22    2571.95  2415.16  3309.79\n13          bar    2001     11            1943.22    3309.79  2571.95  3811.09\n14          ese    2001      1            1849.69    1128.87  4468.90   793.69\n15          ese    2001      2            1849.69     793.69  1128.87   825.62\n16          ese    2001      3            1849.69     825.62   793.69  1085.09\n17          ese    2001      4            1849.69    1085.09   825.62  1095.69\n18          ese    2001      5            1849.69    1095.69  1085.09   787.33\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select * from v2\n\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          able    2001      1            2163.26    1278.42  5297.02   881.59\n1          able    2001      2            2163.26     881.59  1278.42   847.66\n2          able    2001      3            2163.26     847.66   881.59  1164.42\n3          able    2001      4            2163.26    1164.42   847.66   820.38\n4          able    2001      5            2163.26     820.38  1164.42  1006.53\n5          able    2001      6            2163.26    1006.53   820.38  1867.62\n6          able    2001      7            2163.26    1867.62  1006.53  3040.44\n7          able    2001      8            2163.26    3040.44  1867.62  2585.66\n8          able    2001      9            2163.26    2585.66  3040.44  3381.12\n9          able    2001     10            2163.26    3381.12  2585.66  4142.38\n10         able    2001     11            2163.26    4142.38  3381.12  4942.93\n11         able    2001     12            2163.26    4942.93  4142.38  1786.68\n12        cally    2001      1            1770.57    1094.39  4552.19  1008.28\n13        cally    2001      2            1770.57    1008.28  1094.39   927.69\n14        cally    2001      3            1770.57     927.69  1008.28   497.61\n15        cally    2001      4            1770.57     497.61   927.69   862.89\n16        cally    2001      5            1770.57     862.89   497.61  1409.87\n17        cally    2001      6            1770.57    1409.87   862.89   693.00\n18        cally    2001      7            1770.57     693.00  1409.87  2193.65\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.998449,
                    "execution_time": 0.650672,
                    "compile_time": 0.001073,
                    "planning_time": 0.629823
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.025094,
                    "execution_time": 0.67859,
                    "compile_time": 0.001074,
                    "planning_time": 0.644369
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          able    2001      1            2163.26    1278.42  5297.02   881.59\n1          able    2001      2            2163.26     881.59  1278.42   847.66\n2          able    2001      3            2163.26     847.66   881.59  1164.42\n3          able    2001      4            2163.26    1164.42   847.66   820.38\n4          able    2001      5            2163.26     820.38  1164.42  1006.53\n5          able    2001      6            2163.26    1006.53   820.38  1867.62\n6          able    2001      7            2163.26    1867.62  1006.53  3040.44\n7          able    2001      8            2163.26    3040.44  1867.62  2585.66\n8          able    2001      9            2163.26    2585.66  3040.44  3381.12\n9          able    2001     10            2163.26    3381.12  2585.66  4142.38\n10         able    2001     11            2163.26    4142.38  3381.12  4942.93\n11         able    2001     12            2163.26    4942.93  4142.38  1786.68\n12        cally    2001      1            1770.57    1094.39  4552.19  1008.28\n13        cally    2001      2            1770.57    1008.28  1094.39   927.69\n14        cally    2001      3            1770.57     927.69  1008.28   497.61\n15        cally    2001      4            1770.57     497.61   927.69   862.89\n16        cally    2001      5            1770.57     862.89   497.61  1409.87\n17        cally    2001      6            1770.57    1409.87   862.89   693.00\n18        cally    2001      7            1770.57     693.00  1409.87  2193.65\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0         ought    2001      8              35.13      17.93    3.18    1.16\n1         ought    2001      9              35.13       1.16   17.93   39.38\n2         ought    2001     10              35.13      39.38    1.16   82.07\n3         ought    2001     11              35.13      82.07   39.38     NaN\n4          anti    2001      5              57.94      51.84   39.15   19.16\n5          anti    2001      6              57.94      19.16   51.84   43.92\n6          anti    2001      8              57.94      43.92   19.16  127.71\n7          anti    2001      9              57.94     127.71   43.92   36.43\n8          anti    2001     10              57.94      36.43  127.71   50.70\n9          anti    2001     11              57.94      50.70   36.43   94.63\n10         anti    2001      7              38.74      14.10   29.77   80.94\n11         anti    2001      8              38.74      80.94   14.10   16.47\n12         anti    2001     11              38.74      16.47   80.94   52.43\n13        ation    2001      3              58.60     119.46   27.28   46.38\n14        ation    2001      5              58.60      46.38  119.46   37.98\n15        ation    2001      6              58.60      37.98   46.38    7.50\n16        ation    2001      7              58.60       7.50   37.98   49.68\n17        ation    2001      8              58.60      49.68    7.50   60.70\n18        ation    2001     10              58.60      60.70   49.68  100.87\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.024601,
                    "execution_time": 0.679428,
                    "compile_time": 0.001052,
                    "planning_time": 0.639457
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.034833,
                    "execution_time": 0.689218,
                    "compile_time": 0.001068,
                    "planning_time": 0.634425
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0         ought    2001      8              35.13      17.93    3.18    1.16\n1         ought    2001      9              35.13       1.16   17.93   39.38\n2         ought    2001     10              35.13      39.38    1.16   82.07\n3         ought    2001     11              35.13      82.07   39.38     NaN\n4          anti    2001      5              57.94      51.84   39.15   19.16\n5          anti    2001      6              57.94      19.16   51.84   43.92\n6          anti    2001      8              57.94      43.92   19.16  127.71\n7          anti    2001      9              57.94     127.71   43.92   36.43\n8          anti    2001     10              57.94      36.43  127.71   50.70\n9          anti    2001     11              57.94      50.70   36.43   94.63\n10         anti    2001      7              38.74      14.10   29.77   80.94\n11         anti    2001      8              38.74      80.94   14.10   16.47\n12         anti    2001     11              38.74      16.47   80.94   52.43\n13        ation    2001      3              58.60     119.46   27.28   46.38\n14        ation    2001      5              58.60      46.38  119.46   37.98\n15        ation    2001      6              58.60      37.98   46.38    7.50\n16        ation    2001      7              58.60       7.50   37.98   49.68\n17        ation    2001      8              58.60      49.68    7.50   60.70\n18        ation    2001     10              58.60      60.70   49.68  100.87\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          able    2001      1            2163.26    1278.42  5297.02   881.59\n1          able    2001      2            2163.26     881.59  1278.42   847.66\n2          able    2001      3            2163.26     847.66   881.59  1164.42\n3          able    2001      4            2163.26    1164.42   847.66   820.38\n4          able    2001      5            2163.26     820.38  1164.42  1006.53\n5          able    2001      6            2163.26    1006.53   820.38  1867.62\n6          able    2001      7            2163.26    1867.62  1006.53  3040.44\n7          able    2001      8            2163.26    3040.44  1867.62  2585.66\n8          able    2001      9            2163.26    2585.66  3040.44  3381.12\n9          able    2001     10            2163.26    3381.12  2585.66  4142.38\n10         able    2001     11            2163.26    4142.38  3381.12  4942.93\n11         able    2001     12            2163.26    4942.93  4142.38  1786.68\n12        cally    2001      1            1770.57    1094.39  4552.19  1008.28\n13        cally    2001      2            1770.57    1008.28  1094.39   927.69\n14        cally    2001      3            1770.57     927.69  1008.28   497.61\n15        cally    2001      4            1770.57     497.61   927.69   862.89\n16        cally    2001      5            1770.57     862.89   497.61  1409.87\n17        cally    2001      6            1770.57    1409.87   862.89   693.00\n18        cally    2001      7            1770.57     693.00  1409.87  2193.65\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.031251,
                    "execution_time": 0.679853,
                    "compile_time": 0.001201,
                    "planning_time": 0.637588
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.066648,
                    "execution_time": 0.645118,
                    "compile_time": 0.001194,
                    "planning_time": 0.696507
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          able    2001      1            2163.26    1278.42  5297.02   881.59\n1          able    2001      2            2163.26     881.59  1278.42   847.66\n2          able    2001      3            2163.26     847.66   881.59  1164.42\n3          able    2001      4            2163.26    1164.42   847.66   820.38\n4          able    2001      5            2163.26     820.38  1164.42  1006.53\n5          able    2001      6            2163.26    1006.53   820.38  1867.62\n6          able    2001      7            2163.26    1867.62  1006.53  3040.44\n7          able    2001      8            2163.26    3040.44  1867.62  2585.66\n8          able    2001      9            2163.26    2585.66  3040.44  3381.12\n9          able    2001     10            2163.26    3381.12  2585.66  4142.38\n10         able    2001     11            2163.26    4142.38  3381.12  4942.93\n11         able    2001     12            2163.26    4942.93  4142.38  1786.68\n12        cally    2001      1            1770.57    1094.39  4552.19  1008.28\n13        cally    2001      2            1770.57    1008.28  1094.39   927.69\n14        cally    2001      3            1770.57     927.69  1008.28   497.61\n15        cally    2001      4            1770.57     497.61   927.69   862.89\n16        cally    2001      5            1770.57     862.89   497.61  1409.87\n17        cally    2001      6            1770.57    1409.87   862.89   693.00\n18        cally    2001      7            1770.57     693.00  1409.87  2193.65\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n/*CURSOR_IDENTIFIER*/\n1=1\n",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND 1 = 1 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0         cally    2001     10              92.93     124.81   79.77  177.34\n1         cally    2001     11              92.93     177.34  124.81  180.27\n2         cally    2001     12              92.93     180.27  177.34   22.13\n3         cally    2001      1             115.25      54.23  204.02  215.11\n4         cally    2001      3             115.25     215.11   54.23   21.98\n5         cally    2001      4             115.25      21.98  215.11   32.12\n6         cally    2001      5             115.25      32.12   21.98  117.94\n7         cally    2001      6             115.25     117.94   32.12  113.51\n8         cally    2001      7             115.25     113.51  117.94   20.86\n9         cally    2001      8             115.25      20.86  113.51   50.98\n10        cally    2001      9             115.25      50.98   20.86  463.63\n11        cally    2001     10             115.25     463.63   50.98   50.23\n12        cally    2001     11             115.25      50.23  463.63  127.20\n13        cally    2001     12             115.25     127.20   50.23  105.56\n14        ation    2001      2              33.97      21.35   95.99   13.16\n15        ation    2001      3              33.97      13.16   21.35    9.08\n16        ation    2001      4              33.97       9.08   13.16   23.04\n17        ation    2001      7              33.97      23.04    9.08    3.86\n18        ation    2001      8              33.97       3.86   23.04   20.00\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.095875,
                    "execution_time": 0.744032,
                    "compile_time": 0.001188,
                    "planning_time": 0.676809
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.11332,
                    "execution_time": 0.680009,
                    "compile_time": 0.001206,
                    "planning_time": 0.720224
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales    psum    nsum\n0         cally    2001     10              92.93     124.81   79.77  177.34\n1         cally    2001     11              92.93     177.34  124.81  180.27\n2         cally    2001     12              92.93     180.27  177.34   22.13\n3         cally    2001      1             115.25      54.23  204.02  215.11\n4         cally    2001      3             115.25     215.11   54.23   21.98\n5         cally    2001      4             115.25      21.98  215.11   32.12\n6         cally    2001      5             115.25      32.12   21.98  117.94\n7         cally    2001      6             115.25     117.94   32.12  113.51\n8         cally    2001      7             115.25     113.51  117.94   20.86\n9         cally    2001      8             115.25      20.86  113.51   50.98\n10        cally    2001      9             115.25      50.98   20.86  463.63\n11        cally    2001     10             115.25     463.63   50.98   50.23\n12        cally    2001     11             115.25      50.23  463.63  127.20\n13        cally    2001     12             115.25     127.20   50.23  105.56\n14        ation    2001      2              33.97      21.35   95.99   13.16\n15        ation    2001      3              33.97      13.16   21.35    9.08\n16        ation    2001      4              33.97       9.08   13.16   23.04\n17        ation    2001      7              33.97      23.04    9.08    3.86\n18        ation    2001      8              33.97       3.86   23.04   20.00\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          able    2001      1            2163.26    1278.42  5297.02   881.59\n1          able    2001      2            2163.26     881.59  1278.42   847.66\n2          able    2001      3            2163.26     847.66   881.59  1164.42\n3          able    2001      4            2163.26    1164.42   847.66   820.38\n4          able    2001      5            2163.26     820.38  1164.42  1006.53\n5          able    2001      6            2163.26    1006.53   820.38  1867.62\n6          able    2001      7            2163.26    1867.62  1006.53  3040.44\n7          able    2001      8            2163.26    3040.44  1867.62  2585.66\n8          able    2001      9            2163.26    2585.66  3040.44  3381.12\n9          able    2001     10            2163.26    3381.12  2585.66  4142.38\n10         able    2001     11            2163.26    4142.38  3381.12  4942.93\n11         able    2001     12            2163.26    4942.93  4142.38  1786.68\n12        cally    2001      1            1770.57    1094.39  4552.19  1008.28\n13        cally    2001      2            1770.57    1008.28  1094.39   927.69\n14        cally    2001      3            1770.57     927.69  1008.28   497.61\n15        cally    2001      4            1770.57     497.61   927.69   862.89\n16        cally    2001      5            1770.57     862.89   497.61  1409.87\n17        cally    2001      6            1770.57    1409.87   862.89   693.00\n18        cally    2001      7            1770.57     693.00  1409.87  2193.65\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.080562,
                    "execution_time": 0.726,
                    "compile_time": 0.001217,
                    "planning_time": 0.684519
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.145433,
                    "execution_time": 0.714618,
                    "compile_time": 0.001188,
                    "planning_time": 0.755347
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales     psum     nsum\n0          able    2001      1            2163.26    1278.42  5297.02   881.59\n1          able    2001      2            2163.26     881.59  1278.42   847.66\n2          able    2001      3            2163.26     847.66   881.59  1164.42\n3          able    2001      4            2163.26    1164.42   847.66   820.38\n4          able    2001      5            2163.26     820.38  1164.42  1006.53\n5          able    2001      6            2163.26    1006.53   820.38  1867.62\n6          able    2001      7            2163.26    1867.62  1006.53  3040.44\n7          able    2001      8            2163.26    3040.44  1867.62  2585.66\n8          able    2001      9            2163.26    2585.66  3040.44  3381.12\n9          able    2001     10            2163.26    3381.12  2585.66  4142.38\n10         able    2001     11            2163.26    4142.38  3381.12  4942.93\n11         able    2001     12            2163.26    4942.93  4142.38  1786.68\n12        cally    2001      1            1770.57    1094.39  4552.19  1008.28\n13        cally    2001      2            1770.57    1008.28  1094.39   927.69\n14        cally    2001      3            1770.57     927.69  1008.28   497.61\n15        cally    2001      4            1770.57     497.61   927.69   862.89\n16        cally    2001      5            1770.57     862.89   497.61  1409.87\n17        cally    2001      6            1770.57    1409.87   862.89   693.00\n18        cally    2001      7            1770.57     693.00  1409.87  2193.65\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, sum_sales\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , SUM_SALES NULLS FIRST LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          eing    2001      2           58721.20   27048.97  33909.25  34647.93\n1          able    2001      3           59157.76   29194.68  31501.37  37174.55\n2          able    2001      3           57395.37   27480.89  30086.16  33222.64\n3           ese    2001      2           57715.07   28437.81  36185.12  31695.78\n4          eing    2001      2           57681.47   28801.10  36126.33  32465.18\n5          eing    2001      2           58729.62   29860.31  35556.77  34094.84\n6          eing    2001      2           58476.74   29608.18  35405.35  37592.40\n7           ese    2001      2           57611.09   28769.22  36092.40  29527.30\n8           bar    2001      2           58227.01   29409.10  37550.75  36473.82\n9          able    2001      3           55708.20   26913.77  32319.94  35682.95\n10          ese    2001      2           56990.28   28339.38  38281.82  32087.03\n11         able    2001      3           58846.95   30363.97  31295.05  36355.93\n12         able    2001      3           58513.79   30066.75  31152.70  35776.47\n13         eing    2001      2           57154.48   28771.31  36661.39  33231.16\n14         eing    2001      2           56756.53   28406.10  33882.44  30264.74\n15          ese    2001      2           57625.25   29290.68  36502.64  33761.33\n16         able    2001      3           57947.64   29651.98  30809.67  32288.61\n17         able    2001      3           56166.97   27943.13  30893.04  32784.19\n18          ese    2001      3           57611.09   29527.30  28769.22  33786.54\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.063245,
                    "execution_time": 0.70868,
                    "compile_time": 0.001133,
                    "planning_time": 0.665309
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.175806,
                    "execution_time": 0.751086,
                    "compile_time": 0.001147,
                    "planning_time": 0.772072
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          eing    2001      2           58721.20   27048.97  33909.25  34647.93\n1          able    2001      3           59157.76   29194.68  31501.37  37174.55\n2          able    2001      3           57395.37   27480.89  30086.16  33222.64\n3           ese    2001      2           57715.07   28437.81  36185.12  31695.78\n4          eing    2001      2           57681.47   28801.10  36126.33  32465.18\n5          eing    2001      2           58729.62   29860.31  35556.77  34094.84\n6          eing    2001      2           58476.74   29608.18  35405.35  37592.40\n7           ese    2001      2           57611.09   28769.22  36092.40  29527.30\n8           bar    2001      2           58227.01   29409.10  37550.75  36473.82\n9          able    2001      3           55708.20   26913.77  32319.94  35682.95\n10          ese    2001      2           56990.28   28339.38  38281.82  32087.03\n11         able    2001      3           58846.95   30363.97  31295.05  36355.93\n12         able    2001      3           58513.79   30066.75  31152.70  35776.47\n13         eing    2001      2           57154.48   28771.31  36661.39  33231.16\n14         eing    2001      2           56756.53   28406.10  33882.44  30264.74\n15          ese    2001      2           57625.25   29290.68  36502.64  33761.33\n16         able    2001      3           57947.64   29651.98  30809.67  32288.61\n17         able    2001      3           56166.97   27943.13  30893.04  32784.19\n18          ese    2001      3           57611.09   29527.30  28769.22  33786.54\n...*/"
    },
    {
        "input": "-- start template query47.tpl query 42 in stream 0\nwith /* TPC-DS query47.tpl 0.42 */ v1 as(\n select i_category, i_brand,\n        s_store_name, s_company_name,\n        d_year, d_moy,\n        sum(ss_sales_price) sum_sales,\n        avg(sum(ss_sales_price)) over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name, d_year)\n          avg_monthly_sales,\n        rank() over\n          (partition by i_category, i_brand,\n                     s_store_name, s_company_name\n           order by d_year, d_moy) rn\n from item, store_sales, date_dim, store\n where ss_item_sk = i_item_sk and\n       ss_sold_date_sk = d_date_sk and\n       ss_store_sk = s_store_sk and\n       (\n         d_year = 2001 or\n         ( d_year = 2001-1 and d_moy =12) or\n         ( d_year = 2001+1 and d_moy =1)\n       )\n group by i_category, i_brand,\n          s_store_name, s_company_name,\n          d_year, d_moy),\n v2 as(\n select v1.s_store_name\n        ,v1.d_year, v1.d_moy\n        ,v1.avg_monthly_sales\n        ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum\n from v1, v1 v1_lag, v1 v1_lead\n where v1.i_category = v1_lag.i_category and\n       v1.i_category = v1_lead.i_category and\n       v1.i_brand = v1_lag.i_brand and\n       v1.i_brand = v1_lead.i_brand and\n       v1.s_store_name = v1_lag.s_store_name and\n       v1.s_store_name = v1_lead.s_store_name and\n       v1.s_company_name = v1_lag.s_company_name and\n       v1.s_company_name = v1_lead.s_company_name and\n       v1.rn = v1_lag.rn + 1 and\n       v1.rn = v1_lead.rn - 1)\n  select  *\n from v2\n where  d_year = 2001 and    \n        avg_monthly_sales > 0 and\n        case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1\n order by sum_sales - avg_monthly_sales, sum_sales\n limit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": null,
        "create": null,
        "query": [
            {
                "query": "WITH V1 AS ( SELECT I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY , SUM ( SS_SALES_PRICE ) AS SUM_SALES , AVG ( SUM ( SS_SALES_PRICE ) ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR ) AS AVG_MONTHLY_SALES , RANK ( ) OVER ( PARTITION BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME ORDER BY D_YEAR NULLS FIRST , D_MOY NULLS FIRST ) AS RN FROM ITEM , STORE_SALES , DATE_DIM , STORE WHERE SS_ITEM_SK = I_ITEM_SK AND SS_SOLD_DATE_SK = D_DATE_SK AND SS_STORE_SK = S_STORE_SK AND ( D_YEAR = 2001 OR ( D_YEAR = 2001 - 1 AND D_MOY = 12 ) OR ( D_YEAR = 2001 + 1 AND D_MOY = 1 ) ) GROUP BY I_CATEGORY , I_BRAND , S_STORE_NAME , S_COMPANY_NAME , D_YEAR , D_MOY ) , V2 AS ( SELECT V1.S_STORE_NAME , V1.D_YEAR , V1.D_MOY , V1.AVG_MONTHLY_SALES , V1.SUM_SALES , V1_LAG.SUM_SALES AS PSUM , V1_LEAD.SUM_SALES AS NSUM FROM V1 , V1 AS V1_LAG , V1 AS V1_LEAD WHERE V1.I_CATEGORY = V1_LAG.I_CATEGORY AND V1.I_CATEGORY = V1_LEAD.I_CATEGORY AND V1.I_BRAND = V1_LAG.I_BRAND AND V1.I_BRAND = V1_LEAD.I_BRAND AND V1.S_STORE_NAME = V1_LAG.S_STORE_NAME AND V1.S_STORE_NAME = V1_LEAD.S_STORE_NAME AND V1.S_COMPANY_NAME = V1_LAG.S_COMPANY_NAME AND V1.S_COMPANY_NAME = V1_LEAD.S_COMPANY_NAME AND V1.RN = V1_LAG.RN + 1 AND V1.RN = V1_LEAD.RN - 1 ) SELECT * FROM V2 WHERE D_YEAR = 2001 AND AVG_MONTHLY_SALES > 0 AND CASE WHEN AVG_MONTHLY_SALES > 0 THEN ABS ( SUM_SALES - AVG_MONTHLY_SALES ) / AVG_MONTHLY_SALES ELSE NULL END > 0.1 ORDER BY SUM_SALES - AVG_MONTHLY_SALES NULLS FIRST , SUM_SALES NULLS FIRST LIMIT 21",
                "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          eing    2001      2           58721.20   27048.97  33909.25  34647.93\n1          able    2001      3           59157.76   29194.68  31501.37  37174.55\n2          able    2001      3           57395.37   27480.89  30086.16  33222.64\n3           ese    2001      2           57715.07   28437.81  36185.12  31695.78\n4          eing    2001      2           57681.47   28801.10  36126.33  32465.18\n5          eing    2001      2           58729.62   29860.31  35556.77  34094.84\n6          eing    2001      2           58476.74   29608.18  35405.35  37592.40\n7           ese    2001      2           57611.09   28769.22  36092.40  29527.30\n8           bar    2001      2           58227.01   29409.10  37550.75  36473.82\n9          able    2001      3           55708.20   26913.77  32319.94  35682.95\n10          ese    2001      2           56990.28   28339.38  38281.82  32087.03\n11         able    2001      3           58846.95   30363.97  31295.05  36355.93\n12         able    2001      3           58513.79   30066.75  31152.70  35776.47\n13         eing    2001      2           57154.48   28771.31  36661.39  33231.16\n14         eing    2001      2           56756.53   28406.10  33882.44  30264.74\n15          ese    2001      2           57625.25   29290.68  36502.64  33761.33\n16         able    2001      3           57947.64   29651.98  30809.67  32288.61\n17         able    2001      3           56166.97   27943.13  30893.04  32784.19\n18          ese    2001      3           57611.09   29527.30  28769.22  33786.54\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.081523,
                    "execution_time": 0.724869,
                    "compile_time": 0.001128,
                    "planning_time": 0.672839
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 1.062893,
                    "execution_time": 0.704389,
                    "compile_time": 0.001158,
                    "planning_time": 0.671311
                }
            }
        ],
        "rewrite_main_query": null,
        "preview": "\n/*   s_store_name  d_year  d_moy  avg_monthly_sales  sum_sales      psum      nsum\n0          eing    2001      2           58721.20   27048.97  33909.25  34647.93\n1          able    2001      3           59157.76   29194.68  31501.37  37174.55\n2          able    2001      3           57395.37   27480.89  30086.16  33222.64\n3           ese    2001      2           57715.07   28437.81  36185.12  31695.78\n4          eing    2001      2           57681.47   28801.10  36126.33  32465.18\n5          eing    2001      2           58729.62   29860.31  35556.77  34094.84\n6          eing    2001      2           58476.74   29608.18  35405.35  37592.40\n7           ese    2001      2           57611.09   28769.22  36092.40  29527.30\n8           bar    2001      2           58227.01   29409.10  37550.75  36473.82\n9          able    2001      3           55708.20   26913.77  32319.94  35682.95\n10          ese    2001      2           56990.28   28339.38  38281.82  32087.03\n11         able    2001      3           58846.95   30363.97  31295.05  36355.93\n12         able    2001      3           58513.79   30066.75  31152.70  35776.47\n13         eing    2001      2           57154.48   28771.31  36661.39  33231.16\n14         eing    2001      2           56756.53   28406.10  33882.44  30264.74\n15          ese    2001      2           57625.25   29290.68  36502.64  33761.33\n16         able    2001      3           57947.64   29651.98  30809.67  32288.61\n17         able    2001      3           56166.97   27943.13  30893.04  32784.19\n18          ese    2001      3           57611.09   29527.30  28769.22  33786.54\n...*/"
    }
]