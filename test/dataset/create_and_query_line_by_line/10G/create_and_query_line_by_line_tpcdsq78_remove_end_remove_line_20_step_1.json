[
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) AS ws_qty,\n    sum(ws_wholesale_cost) AS ws_wc,\n    sum(ws_sales_price) AS ws_sp\n   from web_sales\n   left join web_returns on WR_ORDER_NUMBER=WS_ORDER_NUMBER and WS_ITEM_SK=WR_ITEM_SK\n   join date_dim on WS_SOLD_DATE_SK = D_DATE_SK\n   where WR_ORDER_NUMBER is null\n   group by d_year, WS_ITEM_SK, WS_BILL_CUSTOMER_SK\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk AS cs_customer_sk,\n    sum(cs_quantity) AS cs_qty,\n    sum(cs_wholesale_cost) AS cs_wc,\n    sum(cs_sales_price) AS cs_sp\n   from catalog_sales\n   left join catalog_returns on CR_ORDER_NUMBER=CS_ORDER_NUMBER and CS_ITEM_SK=CR_ITEM_SK\n   join date_dim on CS_SOLD_DATE_SK = D_DATE_SK\n   where CR_ORDER_NUMBER is null\n   group by d_year, CS_ITEM_SK, CS_BILL_CUSTOMER_SK\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) AS ss_qty,\n    sum(ss_wholesale_cost) AS ss_wc,\n    sum(ss_sales_price) AS ss_sp\n   from store_sales\n   left join store_returns on SR_TICKET_NUMBER=SS_TICKET_NUMBER and SS_ITEM_SK=SR_ITEM_SK\n   join date_dim on SS_SOLD_DATE_SK = D_DATE_SK\n   where SR_TICKET_NUMBER is null\n   group by d_year, SS_ITEM_SK, SS_CUSTOMER_SK\n/*CURSOR_IDENTIFIER*/\n  )\nselect * from ws\nunion all\nselect * from cs\nunion all\nselect * from ss;",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" FROM \"WS\" AS \"WS\" UNION ALL SELECT \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" FROM \"CS\" AS \"CS\" UNION ALL SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_1\" AS SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.104269,
                    "execution_time": 0.040033,
                    "compile_time": 0.000235,
                    "planning_time": 0.024197,
                    "create_size": 480
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.109534,
                    "execution_time": 0.039871,
                    "compile_time": 0.000219,
                    "planning_time": 0.028423,
                    "create_size": 480
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_2\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.497561,
                    "execution_time": 0.985686,
                    "compile_time": 0.000522,
                    "planning_time": 0.043932,
                    "create_size": 1152
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 2.136059,
                    "execution_time": 1.550489,
                    "compile_time": 0.000534,
                    "planning_time": 0.113693,
                    "create_size": 1152
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_3\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.961635,
                    "execution_time": 1.452503,
                    "compile_time": 0.000521,
                    "planning_time": 0.043372,
                    "create_size": 1408
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 2.575418,
                    "execution_time": 1.989956,
                    "compile_time": 0.000537,
                    "planning_time": 0.114128,
                    "create_size": 1408
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_4\" AS SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"SPEQLITE_TEMP_TABLE_1\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 3.092675,
                    "execution_time": 2.592189,
                    "compile_time": 0.000533,
                    "planning_time": 0.040758,
                    "create_size": 1792
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 3.13088,
                    "execution_time": 2.548185,
                    "compile_time": 0.001626,
                    "planning_time": 0.112824,
                    "create_size": 1792
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" UNION ALL SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" UNION ALL SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    ws_sold_year  ws_item_sk  ws_customer_sk  ws_qty  ws_wc   ws_sp\n0           1998       46180          166782      88  29.44    3.23\n1           1998       45487          166782      93   6.84   10.61\n2           1998       25498          233805      49  21.60   31.00\n3           1998       75718          467076      36  74.72   21.78\n4           1998       97384          141435      10  51.56   10.10\n5           1998       30302          141435       7  52.49   25.79\n6           1998       11692          141435      21  32.79   53.26\n7           1998       31790          141435      77  93.22  175.13\n8           1998       81260          141435      92   5.32    2.00\n9           1998       96362          181030      42  17.42   11.32\n10          1998       55198          181030      28  87.56  136.24\n11          1998       10816          325547      18  59.08   13.74\n12          1998       55126          325547      90  99.79  168.00\n13          1998       11444          244255      78  25.47    8.21\n14          1998      101834          244255      11  33.95   82.22\n15          1998       49516          352128      40  18.15   10.09\n16          1998       64934          352128      48  30.72   23.97\n17          1998       43868          438598      48  99.78  169.92\n18          1998       91676          438598      79  23.84   16.61\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.040326,
                    "execution_time": 0.022664,
                    "compile_time": 0.00013,
                    "planning_time": 0.009915
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.080787,
                    "execution_time": 0.022232,
                    "compile_time": 0.001848,
                    "planning_time": 0.046728
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" UNION ALL SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" UNION ALL SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" UNION ALL SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" UNION ALL SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    ws_sold_year  ws_item_sk  ws_customer_sk  ws_qty  ws_wc   ws_sp\n0           1998       46180          166782      88  29.44    3.23\n1           1998       45487          166782      93   6.84   10.61\n2           1998       25498          233805      49  21.60   31.00\n3           1998       75718          467076      36  74.72   21.78\n4           1998       97384          141435      10  51.56   10.10\n5           1998       30302          141435       7  52.49   25.79\n6           1998       11692          141435      21  32.79   53.26\n7           1998       31790          141435      77  93.22  175.13\n8           1998       81260          141435      92   5.32    2.00\n9           1998       96362          181030      42  17.42   11.32\n10          1998       55198          181030      28  87.56  136.24\n11          1998       10816          325547      18  59.08   13.74\n12          1998       55126          325547      90  99.79  168.00\n13          1998       11444          244255      78  25.47    8.21\n14          1998      101834          244255      11  33.95   82.22\n15          1998       49516          352128      40  18.15   10.09\n16          1998       64934          352128      48  30.72   23.97\n17          1998       43868          438598      48  99.78  169.92\n18          1998       91676          438598      79  23.84   16.61\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) AS ws_qty,\n    sum(ws_wholesale_cost) AS ws_wc,\n    sum(ws_sales_price) AS ws_sp\n   from web_sales\n   left join web_returns on ws_order_number=wr_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk AS cs_customer_sk,\n    sum(cs_quantity) AS cs_qty,\n    sum(cs_wholesale_cost) AS cs_wc,\n    sum(cs_sales_price) AS cs_sp\n   from catalog_sales\n   left join catalog_returns on cs_order_number=cr_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) AS ss_qty,\n    sum(ss_wholesale_cost) AS ss_wc,\n    sum(ss_sales_price) AS ss_sp\n   from store_sales\n   left join store_returns on ss_ticket_number=sr_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\nselect * from ws\nunion all\nselect * from cs\nunion all\nselect * from ss\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"SS\" AS \"SS\""
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LIMIT 21",
                "preview": "\n/*    ss_sold_year  ss_item_sk  ss_customer_sk  ss_qty  ss_wc   ss_sp\n0           1998       57889        172448.0    41.0  83.55   70.30\n1           1998       71551        492160.0    54.0   7.14    6.65\n2           1998       18058        244265.0    54.0  59.42   81.86\n3           1998        6565         86514.0    26.0  37.18   28.82\n4           1998       52240         86514.0    77.0   7.29    5.88\n5           1998       73999         64658.0    12.0  31.34   37.56\n6           1998       81310        322489.0    64.0   2.93    2.93\n7           1998       58549        322489.0    11.0  20.47    3.88\n8           1998       71600        291613.0    96.0  86.07  145.42\n9           1998       72782        291613.0    59.0  79.68  104.91\n10          1998       99934        213341.0    44.0  24.09   24.51\n11          1998       99472             NaN    70.0  39.46   64.47\n12          1998       56437          9720.0    98.0  98.71  107.79\n13          1998       41372        372042.0    35.0   5.26    6.34\n14          1998       72502         59839.0    10.0  25.78   29.72\n15          1998        4664         13463.0    58.0   3.30    3.85\n16          1998       24320        164084.0     9.0  65.95   73.33\n17          1998       80404        106742.0    50.0  90.94   49.92\n18          1998       41371        434519.0    94.0  77.00   23.53\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.050847,
                    "execution_time": 0.008294,
                    "compile_time": 0.032541,
                    "planning_time": 0.003855
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.234685,
                    "execution_time": 0.008563,
                    "compile_time": 3.176167,
                    "planning_time": 0.039331
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\""
            }
        ],
        "preview": "\n/*    ss_sold_year  ss_item_sk  ss_customer_sk  ss_qty  ss_wc   ss_sp\n0           1998       57889        172448.0    41.0  83.55   70.30\n1           1998       71551        492160.0    54.0   7.14    6.65\n2           1998       18058        244265.0    54.0  59.42   81.86\n3           1998        6565         86514.0    26.0  37.18   28.82\n4           1998       52240         86514.0    77.0   7.29    5.88\n5           1998       73999         64658.0    12.0  31.34   37.56\n6           1998       81310        322489.0    64.0   2.93    2.93\n7           1998       58549        322489.0    11.0  20.47    3.88\n8           1998       71600        291613.0    96.0  86.07  145.42\n9           1998       72782        291613.0    59.0  79.68  104.91\n10          1998       99934        213341.0    44.0  24.09   24.51\n11          1998       99472             NaN    70.0  39.46   64.47\n12          1998       56437          9720.0    98.0  98.71  107.79\n13          1998       41372        372042.0    35.0   5.26    6.34\n14          1998       72502         59839.0    10.0  25.78   29.72\n15          1998        4664         13463.0    58.0   3.30    3.85\n16          1998       24320        164084.0     9.0  65.95   73.33\n17          1998       80404        106742.0    50.0  90.94   49.92\n18          1998       41371        434519.0    94.0  77.00   23.53\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select * \n/*CURSOR_IDENTIFIER*/ from ws \n  full outer join cs on cs.cs_item_sk = ws.ws_item_sk \n  and cs.cs_customer_sk = ws.ws_customer_sk \n  and cs.cs_sold_year = ws.ws_sold_year \n  full outer join ss on ss.ss_item_sk = ws.ws_item_sk \n  and ss.ss_customer_sk = ws.ws_customer_sk \n  and ss.ss_sold_year = ws.ws_sold_year\n",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"WS\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"WS\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WS\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"WS\".\"WS_QTY\" AS \"WS_QTY\" , \"WS\".\"WS_WC\" AS \"WS_WC\" , \"WS\".\"WS_SP\" AS \"WS_SP\" , \"CS\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"CS\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CS\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"CS\".\"CS_QTY\" AS \"CS_QTY\" , \"CS\".\"CS_WC\" AS \"CS_WC\" , \"CS\".\"CS_SP\" AS \"CS_SP\" , \"SS\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SS\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SS\".\"SS_QTY\" AS \"SS_QTY\" , \"SS\".\"SS_WC\" AS \"SS_WC\" , \"SS\".\"SS_SP\" AS \"SS_SP\" FROM \"WS\" AS \"WS\" FULL JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" FULL JOIN \"SS\" AS \"SS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" FULL JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" FULL JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1,
                    "create_size": 0
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" FULL JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" FULL JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" LIMIT 21",
                "preview": "\n/*   ws_sold_year ws_item_sk ws_customer_sk ws_qty ws_wc ws_sp  cs_sold_year  cs_item_sk  cs_customer_sk  cs_qty  cs_wc   cs_sp ss_sold_year ss_item_sk ss_customer_sk ss_qty ss_wc ss_sp\n0          None       None           None   None  None  None          1998       35048           63834      98  93.56   81.50         None       None           None   None  None  None\n1          None       None           None   None  None  None          1998       99481          378392      95  10.13    3.55         None       None           None   None  None  None\n2          None       None           None   None  None  None          1998       48922          318918       4  84.87   48.47         None       None           None   None  None  None\n3          None       None           None   None  None  None          1998       95479          318918      12  16.43    3.94         None       None           None   None  None  None\n4          None       None           None   None  None  None          1998       36988          318918       7  17.67   16.53         None       None           None   None  None  None\n5          None       None           None   None  None  None          1998       86482           60875      73  66.90    7.04         None       None           None   None  None  None\n6          None       None           None   None  None  None          1998       91208          477545      67   6.18    8.52         None       None           None   None  None  None\n7          None       None           None   None  None  None          1998       94352          264930      80  80.10   35.68         None       None           None   None  None  None\n8          None       None           None   None  None  None          1998       60992          431263      90  66.18  144.93         None       None           None   None  None  None\n9          None       None           None   None  None  None          1998       78115          484124      22  32.59   29.48         None       None           None   None  None  None\n10         None       None           None   None  None  None          1998       99205          467235      84  13.66   33.05         None       None           None   None  None  None\n11         None       None           None   None  None  None          1998       26756          314273      25  84.18   75.30         None       None           None   None  None  None\n12         None       None           None   None  None  None          1998       87418          314273      26  90.14   97.56         None       None           None   None  None  None\n13         None       None           None   None  None  None          1998       29983          286663      42  48.39  119.65         None       None           None   None  None  None\n14         None       None           None   None  None  None          1998       24416          286663      55  70.17  182.44         None       None           None   None  None  None\n15         None       None           None   None  None  None          1998       95929          268231      38  40.98  115.17         None       None           None   None  None  None\n16         None       None           None   None  None  None          1998       50500          159683      72  52.41   75.62         None       None           None   None  None  None\n17         None       None           None   None  None  None          1998        4063          497855      10   6.32    9.25         None       None           None   None  None  None\n18         None       None           None   None  None  None          1998       57391          497855      28  12.73   20.73         None       None           None   None  None  None\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 1.851688,
                    "execution_time": 1.824043,
                    "compile_time": 0.000246,
                    "planning_time": 0.011907
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.713404,
                    "execution_time": 1.822757,
                    "compile_time": 2.820604,
                    "planning_time": 0.048233
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" FULL JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" FULL JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\"",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" AS \"WS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" AS \"CS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" AS \"SS_SOLD_YEAR\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" FULL JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" FULL JOIN \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\""
            }
        ],
        "preview": "\n/*   ws_sold_year ws_item_sk ws_customer_sk ws_qty ws_wc ws_sp  cs_sold_year  cs_item_sk  cs_customer_sk  cs_qty  cs_wc   cs_sp ss_sold_year ss_item_sk ss_customer_sk ss_qty ss_wc ss_sp\n0          None       None           None   None  None  None          1998       35048           63834      98  93.56   81.50         None       None           None   None  None  None\n1          None       None           None   None  None  None          1998       99481          378392      95  10.13    3.55         None       None           None   None  None  None\n2          None       None           None   None  None  None          1998       48922          318918       4  84.87   48.47         None       None           None   None  None  None\n3          None       None           None   None  None  None          1998       95479          318918      12  16.43    3.94         None       None           None   None  None  None\n4          None       None           None   None  None  None          1998       36988          318918       7  17.67   16.53         None       None           None   None  None  None\n5          None       None           None   None  None  None          1998       86482           60875      73  66.90    7.04         None       None           None   None  None  None\n6          None       None           None   None  None  None          1998       91208          477545      67   6.18    8.52         None       None           None   None  None  None\n7          None       None           None   None  None  None          1998       94352          264930      80  80.10   35.68         None       None           None   None  None  None\n8          None       None           None   None  None  None          1998       60992          431263      90  66.18  144.93         None       None           None   None  None  None\n9          None       None           None   None  None  None          1998       78115          484124      22  32.59   29.48         None       None           None   None  None  None\n10         None       None           None   None  None  None          1998       99205          467235      84  13.66   33.05         None       None           None   None  None  None\n11         None       None           None   None  None  None          1998       26756          314273      25  84.18   75.30         None       None           None   None  None  None\n12         None       None           None   None  None  None          1998       87418          314273      26  90.14   97.56         None       None           None   None  None  None\n13         None       None           None   None  None  None          1998       29983          286663      42  48.39  119.65         None       None           None   None  None  None\n14         None       None           None   None  None  None          1998       24416          286663      55  70.17  182.44         None       None           None   None  None  None\n15         None       None           None   None  None  None          1998       95929          268231      38  40.98  115.17         None       None           None   None  None  None\n16         None       None           None   None  None  None          1998       50500          159683      72  52.41   75.62         None       None           None   None  None  None\n17         None       None           None   None  None  None          1998        4063          497855      10   6.32    9.25         None       None           None   None  None  None\n18         None       None           None   None  None  None          1998       57391          497855      28  12.73   20.73         None       None           None   None  None  None\n...*/"
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": null,
        "optimize": null,
        "create": null,
        "query": null,
        "rewrite_main_query": null,
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk as ws_customer_sk,\n    sum(ws_quantity) as ws_qty,\n    sum(ws_wholesale_cost) as ws_wc,\n    sum(ws_sales_price) as ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk as cs_customer_sk,\n    sum(cs_quantity) as cs_qty,\n    sum(cs_wholesale_cost) as cs_wc,\n    sum(cs_sales_price) as cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) as ss_qty,\n    sum(ss_wholesale_cost) as ss_wc,\n    sum(ss_sales_price) as ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) as ratio,\nss_qty as store_qty, ss_wc as store_wholesale_cost, ss_sp as store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) as other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) as other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) as other_chan_sales_price\nfrom ss\nleft join ws on ss.ss_item_sk = ws.ws_item_sk\nleft join cs on ss.ss_item_sk = cs.cs_item_sk\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\""
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_5\" AS SELECT \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" AS \"WS_QTY\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" AS \"WS_WC\" , \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" AS \"WS_SP\" FROM \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.724668,
                    "execution_time": 0.345499,
                    "compile_time": 0.000262,
                    "planning_time": 0.00345,
                    "create_size": 896
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.793141,
                    "execution_time": 0.345317,
                    "compile_time": 0.002203,
                    "planning_time": 0.060394,
                    "create_size": 896
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_6\" AS SELECT \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" AS \"CS_QTY\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" AS \"CS_WC\" , \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" AS \"CS_SP\" FROM \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.904322,
                    "execution_time": 0.517733,
                    "compile_time": 0.000253,
                    "planning_time": 0.003351,
                    "create_size": 1152
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 0.95086,
                    "execution_time": 0.506852,
                    "compile_time": 0.000265,
                    "planning_time": 0.060181,
                    "create_size": 1152
                }
            },
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_7\" AS SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"SS_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"SS_WC\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"SS_SP\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\"",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 1.668958,
                    "execution_time": 1.07162,
                    "compile_time": 0.075392,
                    "planning_time": 0.003483,
                    "create_size": 1664
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 6.557267,
                    "execution_time": 2.64182,
                    "compile_time": 3.419329,
                    "planning_time": 0.059444,
                    "create_size": 1664
                }
            }
        ],
        "query": [
            {
                "query": "WITH WS AS ( SELECT D_YEAR AS WS_SOLD_YEAR , WS_ITEM_SK , WS_BILL_CUSTOMER_SK AS WS_CUSTOMER_SK , SUM ( WS_QUANTITY ) AS WS_QTY , SUM ( WS_WHOLESALE_COST ) AS WS_WC , SUM ( WS_SALES_PRICE ) AS WS_SP FROM WEB_SALES LEFT JOIN WEB_RETURNS ON WR_ORDER_NUMBER = WS_ORDER_NUMBER AND WS_ITEM_SK = WR_ITEM_SK JOIN DATE_DIM ON WS_SOLD_DATE_SK = D_DATE_SK WHERE WR_ORDER_NUMBER IS NULL GROUP BY D_YEAR , WS_ITEM_SK , WS_BILL_CUSTOMER_SK ) , CS AS ( SELECT D_YEAR AS CS_SOLD_YEAR , CS_ITEM_SK , CS_BILL_CUSTOMER_SK AS CS_CUSTOMER_SK , SUM ( CS_QUANTITY ) AS CS_QTY , SUM ( CS_WHOLESALE_COST ) AS CS_WC , SUM ( CS_SALES_PRICE ) AS CS_SP FROM CATALOG_SALES LEFT JOIN CATALOG_RETURNS ON CR_ORDER_NUMBER = CS_ORDER_NUMBER AND CS_ITEM_SK = CR_ITEM_SK JOIN DATE_DIM ON CS_SOLD_DATE_SK = D_DATE_SK WHERE CR_ORDER_NUMBER IS NULL GROUP BY D_YEAR , CS_ITEM_SK , CS_BILL_CUSTOMER_SK ) , SS AS ( SELECT D_YEAR AS SS_SOLD_YEAR , SS_ITEM_SK , SS_CUSTOMER_SK , SUM ( SS_QUANTITY ) AS SS_QTY , SUM ( SS_WHOLESALE_COST ) AS SS_WC , SUM ( SS_SALES_PRICE ) AS SS_SP FROM STORE_SALES LEFT JOIN STORE_RETURNS ON SR_TICKET_NUMBER = SS_TICKET_NUMBER AND SS_ITEM_SK = SR_ITEM_SK JOIN DATE_DIM ON SS_SOLD_DATE_SK = D_DATE_SK WHERE SR_TICKET_NUMBER IS NULL GROUP BY D_YEAR , SS_ITEM_SK , SS_CUSTOMER_SK ) SELECT SS_CUSTOMER_SK , ROUND ( SS_QTY / ( COALESCE ( WS_QTY , 0 ) + COALESCE ( CS_QTY , 0 ) ) , 2 ) AS RATIO , SS_QTY AS STORE_QTY , SS_WC AS STORE_WHOLESALE_COST , SS_SP AS STORE_SALES_PRICE , COALESCE ( WS_QTY , 0 ) + COALESCE ( CS_QTY , 0 ) AS OTHER_CHAN_QTY , COALESCE ( WS_WC , 0 ) + COALESCE ( CS_WC , 0 ) AS OTHER_CHAN_WHOLESALE_COST , COALESCE ( WS_SP , 0 ) + COALESCE ( CS_SP , 0 ) AS OTHER_CHAN_SALES_PRICE FROM SS LEFT JOIN WS ON SS.SS_ITEM_SK = WS.WS_ITEM_SK LEFT JOIN CS ON SS.SS_ITEM_SK = CS.CS_ITEM_SK LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_7\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_7\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_6\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_7\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_7\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_7\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_6\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_6\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_5\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_6\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_7\" AS \"SPEQLITE_TEMP_TABLE_7\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_6\" AS \"SPEQLITE_TEMP_TABLE_6\" ON \"SPEQLITE_TEMP_TABLE_6\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_5\" AS \"SPEQLITE_TEMP_TABLE_5\" ON \"SPEQLITE_TEMP_TABLE_7\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_5\".\"WS_ITEM_SK\"",
                "rewrite": null
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk AS cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk) \nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
        ],
        "create": null,
        "query": [
            {
                "query": "WITH WS AS ( SELECT D_YEAR AS WS_SOLD_YEAR , WS_ITEM_SK , WS_BILL_CUSTOMER_SK AS WS_CUSTOMER_SK , SUM ( WS_QUANTITY ) AS WS_QTY , SUM ( WS_WHOLESALE_COST ) AS WS_WC , SUM ( WS_SALES_PRICE ) AS WS_SP FROM WEB_SALES LEFT JOIN WEB_RETURNS ON WR_ORDER_NUMBER = WS_ORDER_NUMBER AND WS_ITEM_SK = WR_ITEM_SK JOIN DATE_DIM ON WS_SOLD_DATE_SK = D_DATE_SK WHERE WR_ORDER_NUMBER IS NULL GROUP BY D_YEAR , WS_ITEM_SK , WS_BILL_CUSTOMER_SK ) , CS AS ( SELECT D_YEAR AS CS_SOLD_YEAR , CS_ITEM_SK , CS_BILL_CUSTOMER_SK AS CS_CUSTOMER_SK , SUM ( CS_QUANTITY ) AS CS_QTY , SUM ( CS_WHOLESALE_COST ) AS CS_WC , SUM ( CS_SALES_PRICE ) AS CS_SP FROM CATALOG_SALES LEFT JOIN CATALOG_RETURNS ON CR_ORDER_NUMBER = CS_ORDER_NUMBER AND CS_ITEM_SK = CR_ITEM_SK JOIN DATE_DIM ON CS_SOLD_DATE_SK = D_DATE_SK WHERE CR_ORDER_NUMBER IS NULL GROUP BY D_YEAR , CS_ITEM_SK , CS_BILL_CUSTOMER_SK ) , SS AS ( SELECT D_YEAR AS SS_SOLD_YEAR , SS_ITEM_SK , SS_CUSTOMER_SK , SUM ( SS_QUANTITY ) AS SS_QTY , SUM ( SS_WHOLESALE_COST ) AS SS_WC , SUM ( SS_SALES_PRICE ) AS SS_SP FROM STORE_SALES LEFT JOIN STORE_RETURNS ON SR_TICKET_NUMBER = SS_TICKET_NUMBER AND SS_ITEM_SK = SR_ITEM_SK JOIN DATE_DIM ON SS_SOLD_DATE_SK = D_DATE_SK WHERE SR_TICKET_NUMBER IS NULL GROUP BY D_YEAR , SS_ITEM_SK , SS_CUSTOMER_SK ) SELECT SS_CUSTOMER_SK , ROUND ( SS_QTY / ( COALESCE ( WS_QTY , 0 ) + COALESCE ( CS_QTY , 0 ) ) , 2 ) AS RATIO , SS_QTY AS STORE_QTY , SS_WC AS STORE_WHOLESALE_COST , SS_SP AS STORE_SALES_PRICE , COALESCE ( WS_QTY , 0 ) + COALESCE ( CS_QTY , 0 ) AS OTHER_CHAN_QTY , COALESCE ( WS_WC , 0 ) + COALESCE ( CS_WC , 0 ) AS OTHER_CHAN_WHOLESALE_COST , COALESCE ( WS_SP , 0 ) + COALESCE ( CS_SP , 0 ) AS OTHER_CHAN_SALES_PRICE FROM SS LEFT JOIN CS ON ( CS_SOLD_YEAR = SS_SOLD_YEAR AND CS_ITEM_SK = SS_ITEM_SK AND CS_CUSTOMER_SK = SS_CUSTOMER_SK ) LEFT JOIN WS ON ( WS_SOLD_YEAR = SS_SOLD_YEAR AND WS_ITEM_SK = SS_ITEM_SK AND WS_CUSTOMER_SK = SS_CUSTOMER_SK ) LIMIT 21",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 15,
                    "execution_time": -1,
                    "compile_time": -1,
                    "planning_time": -1
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\"",
                "rewrite": null
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\""
        ],
        "create": null,
        "query": null,
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\"",
                "rewrite": null
            }
        ],
        "preview": null
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) )"
        ],
        "create": [
            {
                "create": "CREATE TEMPORARY TABLE \"SPEQLITE_TEMP_TABLE_8\" AS SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) )",
                "retry_time": 0,
                "create_metrics": {
                    "elapsed_time": 0.577363,
                    "execution_time": 0.446163,
                    "compile_time": 0.077151,
                    "planning_time": 0.017777,
                    "create_size": 22
                },
                "create_metrics_warm_up": {
                    "elapsed_time": 10.517953,
                    "execution_time": 0.434861,
                    "compile_time": 9.95884,
                    "planning_time": 0.076882,
                    "create_size": 22
                }
            }
        ],
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0           421685    NaN        NaN                 14.71               3.97              42                      85.77                  147.70\n1           139784    1.0       45.0                  2.01               0.25              37                      74.13                   38.18\n2           258472    1.0       83.0                 13.08               5.70              60                      97.37                  259.00\n3           155258    0.0       32.0                 91.75             120.19              88                      33.16                    1.76\n4           387278    3.0       38.0                 31.41               7.56              11                      40.66                   23.83\n5           193787    1.0       38.0                 40.45              15.04              38                      82.41                   24.32\n6           261776    0.0       64.0                 34.83              24.96              85                      85.91                   54.32\n7           246489   30.0       60.0                 66.09              85.38               2                      30.34                    4.76\n8           139816    0.0       36.0                 43.10              50.74              76                      79.42                   85.05\n9           378369    1.0       39.0                 88.21              19.33              39                       5.25                    8.57\n10          124314    0.0       15.0                 57.89              13.57              96                      15.23                   11.68\n11          227475    2.0       96.0                 19.85               4.07              44                      66.26                   39.79\n12          401522    7.0       45.0                 63.60              79.78               6                      18.40                   31.89\n13           54047    2.0       80.0                 43.50              36.74              40                      66.40                   11.31\n14           11373    0.0       17.0                 63.16               2.82              89                      88.74                    7.31\n15          230867    3.0       58.0                 32.89              55.06              15                      23.84                    4.02\n16          121338    0.0       47.0                 25.51              25.29              87                      43.80                   75.70\n17          405248    1.0       10.0                 60.74              22.61               9                      48.24                   31.23\n18          267672    0.0       17.0                  5.37               6.03              65                      40.94                    7.92\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.060446,
                    "execution_time": 0.007278,
                    "compile_time": 0.042385,
                    "planning_time": 0.004251
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 3.360092,
                    "execution_time": 0.008083,
                    "compile_time": 3.301586,
                    "planning_time": 0.040417
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) )",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\""
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0           421685    NaN        NaN                 14.71               3.97              42                      85.77                  147.70\n1           139784    1.0       45.0                  2.01               0.25              37                      74.13                   38.18\n2           258472    1.0       83.0                 13.08               5.70              60                      97.37                  259.00\n3           155258    0.0       32.0                 91.75             120.19              88                      33.16                    1.76\n4           387278    3.0       38.0                 31.41               7.56              11                      40.66                   23.83\n5           193787    1.0       38.0                 40.45              15.04              38                      82.41                   24.32\n6           261776    0.0       64.0                 34.83              24.96              85                      85.91                   54.32\n7           246489   30.0       60.0                 66.09              85.38               2                      30.34                    4.76\n8           139816    0.0       36.0                 43.10              50.74              76                      79.42                   85.05\n9           378369    1.0       39.0                 88.21              19.33              39                       5.25                    8.57\n10          124314    0.0       15.0                 57.89              13.57              96                      15.23                   11.68\n11          227475    2.0       96.0                 19.85               4.07              44                      66.26                   39.79\n12          401522    7.0       45.0                 63.60              79.78               6                      18.40                   31.89\n13           54047    2.0       80.0                 43.50              36.74              40                      66.40                   11.31\n14           11373    0.0       17.0                 63.16               2.82              89                      88.74                    7.31\n15          230867    3.0       58.0                 32.89              55.06              15                      23.84                    4.02\n16          121338    0.0       47.0                 25.51              25.29              87                      43.80                   75.70\n17          405248    1.0       10.0                 60.74              22.61               9                      48.24                   31.23\n18          267672    0.0       17.0                  5.37               6.03              65                      40.94                    7.92\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \nss_customer_sk /*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.036688,
                    "execution_time": 0.008258,
                    "compile_time": 0.017672,
                    "planning_time": 0.004414
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.778267,
                    "execution_time": 0.009316,
                    "compile_time": 4.724997,
                    "planning_time": 0.039797
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk AS ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.019169,
                    "execution_time": 0.008189,
                    "compile_time": 7.7e-05,
                    "planning_time": 0.004429
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.019794,
                    "execution_time": 0.008489,
                    "compile_time": 7.9e-05,
                    "planning_time": 0.004606
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk, \n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.038034,
                    "execution_time": 0.008779,
                    "compile_time": 0.018113,
                    "planning_time": 0.004672
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.411645,
                    "execution_time": 0.009309,
                    "compile_time": 4.359795,
                    "planning_time": 0.040346
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" DESC NULLS FIRST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC NULLS FIRST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC , \"OTHER_CHAN_QTY\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.063427,
                    "execution_time": 0.008762,
                    "compile_time": 0.042671,
                    "planning_time": 0.005082
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.752494,
                    "execution_time": 0.009732,
                    "compile_time": 4.699457,
                    "planning_time": 0.040377
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select D_YEAR AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on WR_ORDER_NUMBER=WS_ORDER_NUMBER and ws_item_sk=WR_ITEM_SK\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where WR_ORDER_NUMBER is null\n   group by D_YEAR, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select D_YEAR AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on CR_ORDER_NUMBER=CS_ORDER_NUMBER and cs_item_sk=CR_ITEM_SK\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where CR_ORDER_NUMBER is null\n   group by D_YEAR, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select D_YEAR AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on SR_TICKET_NUMBER=SS_TICKET_NUMBER and ss_item_sk=SR_ITEM_SK\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where SR_TICKET_NUMBER is null\n   group by D_YEAR, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.047173,
                    "execution_time": 0.007942,
                    "compile_time": 0.02754,
                    "planning_time": 0.005053
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.096622,
                    "execution_time": 0.009386,
                    "compile_time": 4.044445,
                    "planning_time": 0.040494
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" , \"OTHER_CHAN_SALES_PRICE\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.035359,
                    "execution_time": 0.008783,
                    "compile_time": 0.015094,
                    "planning_time": 0.004991
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.99966,
                    "execution_time": 0.008828,
                    "compile_time": 4.947061,
                    "planning_time": 0.040686
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price,\n  ratio\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" , \"OTHER_CHAN_SALES_PRICE\" , \"RATIO\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.036315,
                    "execution_time": 0.008384,
                    "compile_time": 0.015726,
                    "planning_time": 0.005321
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 4.798716,
                    "execution_time": 0.008875,
                    "compile_time": 4.746459,
                    "planning_time": 0.040667
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/"
    },
    {
        "input": "-- start template query78.tpl query 10 in stream 0\nwith /* TPC-DS query78.tpl 0.10 */ ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select \nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by \n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price,\n  ratio\nlimit 100\n/*CURSOR_IDENTIFIER*/",
        "optimize": [
            "WITH \"DATE_DIM_2\" AS ( SELECT \"DATE_DIM\".\"D_DATE_SK\" AS \"D_DATE_SK\" , \"DATE_DIM\".\"D_YEAR\" AS \"D_YEAR\" FROM \"DATE_DIM\" AS \"DATE_DIM\" ) , \"WS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"WS_SOLD_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" AS \"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" AS \"WS_CUSTOMER_SK\" , SUM ( \"WEB_SALES\".\"WS_QUANTITY\" ) AS \"WS_QTY\" , SUM ( \"WEB_SALES\".\"WS_WHOLESALE_COST\" ) AS \"WS_WC\" , SUM ( \"WEB_SALES\".\"WS_SALES_PRICE\" ) AS \"WS_SP\" FROM \"WEB_SALES\" AS \"WEB_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"WEB_SALES\".\"WS_SOLD_DATE_SK\" LEFT JOIN \"WEB_RETURNS\" AS \"WEB_RETURNS\" ON \"WEB_RETURNS\".\"WR_ITEM_SK\" = \"WEB_SALES\".\"WS_ITEM_SK\" AND \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" = \"WEB_SALES\".\"WS_ORDER_NUMBER\" WHERE \"WEB_RETURNS\".\"WR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"WEB_SALES\".\"WS_ITEM_SK\" , \"WEB_SALES\".\"WS_BILL_CUSTOMER_SK\" ) , \"CS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"CS_SOLD_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" AS \"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" AS \"CS_CUSTOMER_SK\" , SUM ( \"CATALOG_SALES\".\"CS_QUANTITY\" ) AS \"CS_QTY\" , SUM ( \"CATALOG_SALES\".\"CS_WHOLESALE_COST\" ) AS \"CS_WC\" , SUM ( \"CATALOG_SALES\".\"CS_SALES_PRICE\" ) AS \"CS_SP\" FROM \"CATALOG_SALES\" AS \"CATALOG_SALES\" LEFT JOIN \"CATALOG_RETURNS\" AS \"CATALOG_RETURNS\" ON \"CATALOG_RETURNS\".\"CR_ITEM_SK\" = \"CATALOG_SALES\".\"CS_ITEM_SK\" AND \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" = \"CATALOG_SALES\".\"CS_ORDER_NUMBER\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"CATALOG_SALES\".\"CS_SOLD_DATE_SK\" = \"DATE_DIM\".\"D_DATE_SK\" WHERE \"CATALOG_RETURNS\".\"CR_ORDER_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"CATALOG_SALES\".\"CS_ITEM_SK\" , \"CATALOG_SALES\".\"CS_BILL_CUSTOMER_SK\" ) , \"SS\" AS ( SELECT \"DATE_DIM\".\"D_YEAR\" AS \"SS_SOLD_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" AS \"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , SUM ( \"STORE_SALES\".\"SS_QUANTITY\" ) AS \"SS_QTY\" , SUM ( \"STORE_SALES\".\"SS_WHOLESALE_COST\" ) AS \"SS_WC\" , SUM ( \"STORE_SALES\".\"SS_SALES_PRICE\" ) AS \"SS_SP\" FROM \"STORE_SALES\" AS \"STORE_SALES\" JOIN \"DATE_DIM_2\" AS \"DATE_DIM\" ON \"DATE_DIM\".\"D_DATE_SK\" = \"STORE_SALES\".\"SS_SOLD_DATE_SK\" LEFT JOIN \"STORE_RETURNS\" AS \"STORE_RETURNS\" ON \"STORE_RETURNS\".\"SR_ITEM_SK\" = \"STORE_SALES\".\"SS_ITEM_SK\" AND \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" = \"STORE_SALES\".\"SS_TICKET_NUMBER\" WHERE \"STORE_RETURNS\".\"SR_TICKET_NUMBER\" IS NULL GROUP BY \"DATE_DIM\".\"D_YEAR\" , \"STORE_SALES\".\"SS_ITEM_SK\" , \"STORE_SALES\".\"SS_CUSTOMER_SK\" ) SELECT \"SS\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SS\".\"SS_QTY\" / ( COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SS\".\"SS_QTY\" AS \"STORE_QTY\" , \"SS\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SS\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"WS\".\"WS_QTY\" , 0 ) + COALESCE ( \"CS\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"WS\".\"WS_WC\" , 0 ) + COALESCE ( \"CS\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"WS\".\"WS_SP\" , 0 ) + COALESCE ( \"CS\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SS\" AS \"SS\" LEFT JOIN \"CS\" AS \"CS\" ON \"CS\".\"CS_CUSTOMER_SK\" = \"SS\".\"SS_CUSTOMER_SK\" AND \"CS\".\"CS_ITEM_SK\" = \"SS\".\"SS_ITEM_SK\" AND \"CS\".\"CS_SOLD_YEAR\" = \"SS\".\"SS_SOLD_YEAR\" LEFT JOIN \"WS\" AS \"WS\" ON \"SS\".\"SS_CUSTOMER_SK\" = \"WS\".\"WS_CUSTOMER_SK\" AND \"SS\".\"SS_ITEM_SK\" = \"WS\".\"WS_ITEM_SK\" AND \"SS\".\"SS_SOLD_YEAR\" = \"WS\".\"WS_SOLD_YEAR\" WHERE \"SS\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"CS\".\"CS_QTY\" > 0 AND NOT \"CS\".\"CS_QTY\" IS NULL ) OR ( \"WS\".\"WS_QTY\" > 0 AND NOT \"WS\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SS\".\"SS_QTY\" DESC NULLS FIRST , \"SS\".\"SS_WC\" DESC NULLS FIRST , \"SS\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST LIMIT 100"
        ],
        "create": null,
        "query": [
            {
                "query": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC , \"OTHER_CHAN_QTY\" , \"OTHER_CHAN_WHOLESALE_COST\" , \"OTHER_CHAN_SALES_PRICE\" , \"RATIO\" LIMIT 21",
                "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/",
                "retry_time": 0,
                "query_metrics": {
                    "elapsed_time": 0.020284,
                    "execution_time": 0.008267,
                    "compile_time": 8.1e-05,
                    "planning_time": 0.005154
                },
                "query_metrics_warm_up": {
                    "elapsed_time": 0.020678,
                    "execution_time": 0.008486,
                    "compile_time": 8.1e-05,
                    "planning_time": 0.005358
                }
            }
        ],
        "rewrite_main_query": [
            {
                "script": "SELECT \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , ROUND ( CAST ( \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" / ( COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) ) AS BIGINT ) , 2 ) AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" AS \"STORE_SALES_PRICE\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" , 0 ) AS \"OTHER_CHAN_QTY\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_WC\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_WC\" , 0 ) AS \"OTHER_CHAN_WHOLESALE_COST\" , COALESCE ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_SP\" , 0 ) + COALESCE ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_SP\" , 0 ) AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_4\" AS \"SPEQLITE_TEMP_TABLE_4\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_3\" AS \"SPEQLITE_TEMP_TABLE_3\" ON \"SPEQLITE_TEMP_TABLE_3\".\"CS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_3\".\"CS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" LEFT JOIN \"SPEQLITE_TEMP_TABLE_2\" AS \"SPEQLITE_TEMP_TABLE_2\" ON \"SPEQLITE_TEMP_TABLE_4\".\"SS_CUSTOMER_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_CUSTOMER_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_ITEM_SK\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_ITEM_SK\" AND \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = \"SPEQLITE_TEMP_TABLE_2\".\"WS_SOLD_YEAR\" WHERE \"SPEQLITE_TEMP_TABLE_4\".\"SS_SOLD_YEAR\" = 2001 AND ( ( \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_3\".\"CS_QTY\" IS NULL ) OR ( \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" > 0 AND NOT \"SPEQLITE_TEMP_TABLE_2\".\"WS_QTY\" IS NULL ) ) ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_WC\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_4\".\"SS_SP\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST LIMIT 100",
                "rewrite": "SELECT \"SPEQLITE_TEMP_TABLE_8\".\"SS_CUSTOMER_SK\" AS \"SS_CUSTOMER_SK\" , \"SPEQLITE_TEMP_TABLE_8\".\"RATIO\" AS \"RATIO\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" AS \"STORE_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" AS \"STORE_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" AS \"STORE_SALES_PRICE\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_QTY\" AS \"OTHER_CHAN_QTY\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_WHOLESALE_COST\" AS \"OTHER_CHAN_WHOLESALE_COST\" , \"SPEQLITE_TEMP_TABLE_8\".\"OTHER_CHAN_SALES_PRICE\" AS \"OTHER_CHAN_SALES_PRICE\" FROM \"SPEQLITE_TEMP_TABLE_8\" AS \"SPEQLITE_TEMP_TABLE_8\" ORDER BY \"SS_CUSTOMER_SK\" NULLS LAST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_QTY\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_WHOLESALE_COST\" DESC NULLS FIRST , \"SPEQLITE_TEMP_TABLE_8\".\"STORE_SALES_PRICE\" DESC NULLS FIRST , \"OTHER_CHAN_QTY\" NULLS LAST , \"OTHER_CHAN_WHOLESALE_COST\" NULLS LAST , \"OTHER_CHAN_SALES_PRICE\" NULLS LAST , \"RATIO\" NULLS LAST LIMIT 100"
            }
        ],
        "preview": "\n/*    ss_customer_sk  ratio  store_qty  store_wholesale_cost  store_sales_price  other_chan_qty  other_chan_wholesale_cost  other_chan_sales_price\n0               60    1.0       81.0                   NaN                NaN              43                       7.74                    3.55\n1              322    0.0       10.0                 76.11              74.21              93                      41.28                   38.95\n2              341    0.0       91.0                 29.14              33.57              98                      84.86                    3.03\n3              709    0.0       59.0                 96.79              91.81              63                      95.26                   46.00\n4             1515    0.0       31.0                 86.33              66.88              81                      46.30                   90.28\n5             1981    3.0       13.0                 24.79              40.36               4                      49.51                   43.55\n6             3218    0.0       55.0                  3.52               3.78              70                      86.87                    0.00\n7             4100    NaN        NaN                 73.64                NaN              84                      93.07                  235.42\n8             4269    0.0       18.0                 84.44              88.91              85                      81.72                   35.05\n9             4931    0.0       74.0                 82.45               3.39              75                      53.99                   42.25\n10            5791    0.0       52.0                 48.29              38.91              65                       6.29                   13.11\n11            6289    6.0       88.0                 43.00              75.00              14                      49.01                    6.76\n12            6612    3.0       81.0                 87.24              41.63              23                      77.30                   89.37\n13            6847    1.0       80.0                 32.24              17.17              46                      38.17                    8.89\n14            7376   65.0       65.0                 13.95              16.31               1                       5.42                    3.79\n15            7565    2.0       42.0                 47.41              16.39              16                      94.84                  192.24\n16            9438   25.0       77.0                   NaN               1.79               3                      88.26                  104.16\n17            9839    0.0        3.0                 20.75              22.04              82                      38.37                   17.29\n18           11002    0.0       41.0                 81.65              59.96              77                      73.09                  198.19\n...*/"
    }
]